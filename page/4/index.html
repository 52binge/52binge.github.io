<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Auckland New Zealand</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Everyone should not forget his dream">
<meta property="og:type" content="website">
<meta property="og:title" content="Auckland New Zealand">
<meta property="og:url" content="http:&#x2F;&#x2F;iequa.com&#x2F;page&#x2F;4&#x2F;index.html">
<meta property="og:site_name" content="Auckland New Zealand">
<meta property="og:description" content="Everyone should not forget his dream">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8864dc75a81a27b7e44c00138af95d66";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;" target="_blank" rel="noopener"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/ai1">AI</a>
        
          <a class="main-nav-link" href="/tensorflow">TF/Keras</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://iequa.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-chatbot/chatbot-common-links" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/12/01/chatbot/chatbot-common-links/"><strong>Chatbot Common Useful Links</strong></a>
      <small class=article-date-index>&nbsp; 2018-12-01</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/12/01/chatbot/chatbot-common-links/" class="article-date">
  <time datetime="2018-12-01T11:16:21.000Z" itemprop="datePublished">2018-12-01</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/chatbot/">chatbot</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/12/01/chatbot/chatbot-common-links/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>Here are some useful links about Chatbot</p>
<p>&lt;!-- more --&gt;</p>
<h2>Tensorflow</h2>
<ul>
<li><a href="https://blog.csdn.net/leviopku/article/details/78508951" target="_blank" rel="noopener">TensorFlowä¸­global_stepçš„ç®€å•åˆ†æ</a></li>
<li><a href="https://feisky.xyz/machine-learning/tensorflow/hello.html" target="_blank" rel="noopener">Tensorflow å…¥é—¨ï¼Œ å¾ˆå¥½çš„æ•™ç¨‹</a></li>
<li><a href="https://applenob.github.io/tf_10.html#tf.sequence_mask" target="_blank" rel="noopener">Tensorflow å­¦ä¹ ç¬”è®° æ•°æ®å¤„ç† sequence_mask</a></li>
<li><a href="https://blog.csdn.net/qq_28808697/article/details/80648657" target="_blank" rel="noopener">tensorflow å­¦ä¹ ç¬”è®°-- tf.reduce_maxã€tf.sequence_mask</a></li>
<li><a href="https://blog.csdn.net/UESTC_C2_403/article/details/72779417" target="_blank" rel="noopener">tf.nn.embedding_lookupå‡½æ•°çš„ç”¨æ³•</a></li>
<li><a href="https://ask.hellobi.com/blog/wenwen/11367" target="_blank" rel="noopener">ä½¿ç”¨Seq2Seq+attentionå®ç°ç®€å•çš„Chatbot</a></li>
<li><a href="https://blog.csdn.net/banana1006034246/article/details/75092388" target="_blank" rel="noopener">tf.strided_sliceå‡½æ•°</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/27685060" target="_blank" rel="noopener">Tensorlow ä¸­æ–‡API: å¸¸é‡(constants) - 5. tf.fill</a></li>
<li><a href="https://blog.csdn.net/mao_xiao_feng/article/details/53366163" target="_blank" rel="noopener">ã€TensorFlowã€‘tf.concatçš„ç”¨æ³•</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10187814" target="_blank" rel="noopener">[ç¬¬ 28 å¤©] æ·±åº¦å­¸ç¿’ï¼ˆ2ï¼‰TensorBoard</a></li>
<li><a href="https://blog.csdn.net/hu_guan_jie/article/details/78495297" target="_blank" rel="noopener">tf.identityçš„æ„ä¹‰ä»¥åŠç”¨ä¾‹</a></li>
<li><a href="https://www.jianshu.com/p/c0c5f1bdbb88" target="_blank" rel="noopener">TensorflowåŠ¨æ€seq2seqä½¿ç”¨æ€»ç»“ï¼ˆr1.3ï¼‰- Loss Function</a></li>
<li><a href="https://blog.csdn.net/u012436149/article/details/53184847" target="_blank" rel="noopener">tensorflowå­¦ä¹ ç¬”è®°(äºŒåä¸€):tensorflowå¯è§†åŒ–</a></li>
<li><a href="https://blog.csdn.net/hustqb/article/details/80260002" target="_blank" rel="noopener">tensorflowâ€”tf.gradients()ç®€å•å®ç”¨æ•™ç¨‹</a></li>
<li><a href="https://blog.csdn.net/u013713117/article/details/56281715" target="_blank" rel="noopener">tf.clip_by_global_normç†è§£</a></li>
<li><a href="https://applenob.github.io/tf_6.html" target="_blank" rel="noopener">Tensorflow å­¦ä¹ ç¬”è®°ï¼ˆå…­ï¼‰ â€”â€”â€”â€” Optimizer</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/47929039" target="_blank" rel="noopener">Tensorflowä¸­çš„Seq2Seqå…¨å®¶æ¡¶</a></li>
<li><a href="https://blog.csdn.net/weixin_41700555/article/details/85011957" target="_blank" rel="noopener">map() ä¸ nest.map_structureï¼ˆï¼‰ çš„åŒºåˆ«åŠç”¨æ³•</a></li>
</ul>
<h2>Seq2Seq</h2>
<ul>
<li><a href="https://blog.csdn.net/wuzqChom/article/details/77073246" target="_blank" rel="noopener">sampled softmax Csdn wuzqChom</a></li>
<li><a href="https://www.zhihu.com/question/62070907/answer/218745719" target="_blank" rel="noopener">å¦‚ä½•é€šä¿—ç†è§£sampled softmaxæœºåˆ¶ï¼Ÿ</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/sequence_loss" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/12/01/tensorflow/sequence_loss/"><strong>Tensorflow Sequence_loss</strong></a>
      <small class=article-date-index>&nbsp; 2018-12-01</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/12/01/tensorflow/sequence_loss/" class="article-date">
  <time datetime="2018-12-01T05:36:21.000Z" itemprop="datePublished">2018-12-01</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/12/01/tensorflow/sequence_loss/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>sequence_loss æ˜¯ nlpç®—æ³• ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªå‡½æ•°. rnn,lstm,attentionéƒ½è¦ç”¨åˆ°è¿™ä¸ªå‡½æ•°.çœ‹ä¸‹é¢ä»£ç :</p>
<p>&lt;!-- more --&gt;</p>
<h2>1. ç‰¹æ®Šçš„ğŸŒ°</h2>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.contrib.seq2seq <span class="keyword">import</span> sequence_loss</span><br><span class="line"></span><br><span class="line">logits_np = np.array([</span><br><span class="line">    [[<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>], [<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>], [<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>]],</span><br><span class="line">    [[<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>], [<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>], [<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>]]</span><br><span class="line">])</span><br><span class="line">targets_np = np.array([</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">], dtype=np.int32)</span><br><span class="line"></span><br><span class="line">logits = tf.convert_to_tensor(logits_np)</span><br><span class="line">targets = tf.convert_to_tensor(targets_np)</span><br><span class="line">cost = sequence_loss(logits=logits,</span><br><span class="line">                     targets=targets,</span><br><span class="line">                     weights=tf.ones_like(targets, dtype=tf.float64))</span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init)</span><br><span class="line">    r = sess.run(cost)</span><br><span class="line">    print(r)</span><br></pre></td></tr></table></figure></p>
<p>å…ˆå¯¹æ¯ä¸ª[0.5,0.5,0.5,0.5]å–softmax. softmax([0.5,0.5,0.5,0.5])=(0.25,0.25,0.25,0.25)ç„¶åå†è®¡ç®—-ln(0.25)*6/6=1.38629436112.</p>
<h2>2. ä¸€èˆ¬çš„ğŸŒ°</h2>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.contrib.seq2seq <span class="keyword">import</span> sequence_loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ä¸ªå¥å­ï¼Œ3ä¸ªæ—¶åˆ»ï¼Œ4ä¸ªå€¼(è¯æ±‡è¡¨)</span></span><br><span class="line">output_np = np.array(</span><br><span class="line">    [</span><br><span class="line">        [[<span class="number">0.6</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>], [<span class="number">0.9</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>], [<span class="number">1.0</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>]],</span><br><span class="line">        [[<span class="number">0.2</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>], [<span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>], [<span class="number">0.4</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>]]</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line">print(output_np.shape)</span><br><span class="line"><span class="comment"># 2ä¸ªå¥å­ï¼Œ</span></span><br><span class="line">target_np = np.array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">                      [<span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>]],</span><br><span class="line">                     dtype=np.int32)</span><br><span class="line">print(target_np.shape)</span><br><span class="line">output = tf.convert_to_tensor(output_np, np.float32)</span><br><span class="line">target = tf.convert_to_tensor(target_np, np.int32)</span><br><span class="line"></span><br><span class="line">cost = sequence_loss(output,</span><br><span class="line">                     target,</span><br><span class="line">                     tf.ones_like(target, dtype=np.float32))</span><br><span class="line"></span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init)</span><br><span class="line">    cost_r = sess.run(cost)</span><br><span class="line">    print(cost_r)</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªä»£ç ä½œç”¨å’Œä¸‹é¢çš„tf.reduce_mean(softmax_cross_entropy_with_logits)ä½œç”¨ä¸€è‡´.</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_onehot</span><span class="params">(a)</span>:</span></span><br><span class="line">    max_index = np.max(a)</span><br><span class="line">    b = np.zeros((a.shape[<span class="number">0</span>], max_index + <span class="number">1</span>))</span><br><span class="line">    b[np.arange(a.shape[<span class="number">0</span>]), a] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line">logits_ph = tf.placeholder(tf.float32, shape=(<span class="literal">None</span>, <span class="literal">None</span>))</span><br><span class="line">labels_ph = tf.placeholder(tf.float32, shape=(<span class="literal">None</span>, <span class="literal">None</span>))</span><br><span class="line">output_np = np.array([</span><br><span class="line">    [<span class="number">0.6</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>],</span><br><span class="line">    [<span class="number">0.9</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>],</span><br><span class="line">    [<span class="number">1.0</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>],</span><br><span class="line">    [<span class="number">0.2</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>],</span><br><span class="line">    [<span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>],</span><br><span class="line">    [<span class="number">0.4</span>, <span class="number">0.5</span>, <span class="number">0.3</span>, <span class="number">0.2</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cost = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels=labels_ph, logits=logits_ph))</span><br><span class="line">target_np = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init)</span><br><span class="line">    cost_r = sess.run(cost, feed_dict=&#123;logits_ph: output_np, labels_ph: to_onehot(target_np)&#125;)</span><br><span class="line">    print(cost_r)</span><br></pre></td></tr></table></figure></p>
<p>å†å–äº¤å‰ç†µ,å†å–å¹³å‡.</p>
<h2>seq2seq çš„åº”ç”¨</h2>
<p>chatbot åº”ç”¨ seq2seq éœ€è¦ç”¨åˆ° sequence_loss</p>
<h2>Reference</h2>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tools/body-health" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/11/26/tools/body-health/"><strong>å·¥ç¨‹å¸ˆåº”è¯¥å¦‚ä½•æ³¨æ„èº«ä½“å¥åº·ï¼Ÿ</strong></a>
      <small class=article-date-index>&nbsp; 2018-11-26</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/11/26/tools/body-health/" class="article-date">
  <time datetime="2018-11-26T09:26:48.000Z" itemprop="datePublished">2018-11-26</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tools/">tools</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/11/26/tools/body-health/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>IT å·¥ç¨‹å¸ˆç¾¤ä½“æ˜¯èŒä¸šç—…é«˜å‘äººç¾¤ï¼ˆä¸è¯´äº†ï¼Œéƒ½æ˜¯æ³ª...ï¼‰</p>
<p>&lt;!-- more --&gt;</p>
<p><strong>ç¨‹åºå‘˜å¸¸è§çš„èŒä¸šç—…</strong></p>
<ul>
<li>é¢ˆæ¤ç—…</li>
<li>è…°æ¤ç—…</li>
<li>ä¹…åå¯¹å‰åˆ—è…ºçš„å±å®³ä»¥åŠè‚¥èƒ–é—®é¢˜</li>
<li>çœ¼ç–²åŠ³ã€ç”¨çœ¼è¿‡åº¦</li>
<li>é¥®é£Ÿã€ä½œæ¯ä¸è§„å¾‹å¯¼è‡´çš„èƒƒç—…ç­‰ä¸€ç³»åˆ—é—®é¢˜</li>
</ul>
<p><strong>å…¨æ–‡ç›®å½•ï¼š</strong></p>
<p>é¢ˆæ¤ã€è…°æ¤ç—…é˜²æ²»ã€ä¹…åå¯¹å‰åˆ—è…ºã€è‚›é—¨çš„å±å®³ä»¥åŠè‚¥èƒ–é—®é¢˜</p>
<ul>
<li>æ¢ä¸€æŠŠäººä½“å·¥å­¦æ¤…ï¼Œé™„ä¸åŒä»·ä½å“ç‰Œæ¨è</li>
<li>ç«™ç«‹å¼åŠå…¬</li>
<li>äººä½“å·¥å­¦æ¤…å’Œç«™ç«‹å¼åŠå…¬ï¼Œåº”è¯¥é€‰æ‹©å“ªä¸ªï¼Ÿ</li>
</ul>
<p>ç”¨çœ¼è¿‡åº¦ã€çœ¼ç–²åŠ³</p>
<ul>
<li>æŠ¤çœ¼å® è½¯ä»¶</li>
<li>Gunnar é˜²è“å…‰çœ¼é•œ</li>
<li>f.lux è½¯ä»¶</li>
</ul>
<h2>Reference</h2>
<ul>
<li><a href="https://www.zhihu.com/question/20402689" target="_blank" rel="noopener">ç¨‹åºå‘˜åº”è¯¥å¦‚ä½•æ³¨æ„èº«ä½“å¥åº·ï¼Ÿå¯èƒ½æ‚£å“ªäº›èŒä¸šç—…ï¼Ÿå¦‚ä½•é˜²æ²»ï¼Ÿ</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-nlp/glove-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/11/16/nlp/glove-1/"><strong>Glove å’Œ fastText</strong></a>
      <small class=article-date-index>&nbsp; 2018-11-16</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/11/16/nlp/glove-1/" class="article-date">
  <time datetime="2018-11-15T23:00:21.000Z" itemprop="datePublished">2018-11-16</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/nlp/">nlp</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/11/16/nlp/glove-1/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>æœ¬èŠ‚ä»‹ç»ä¸¤ç§æ›´æ–°ä¸€ç‚¹çš„è¯å‘é‡ã€‚åˆ†åˆ«æ˜¯2014å¹´Stanfordå‘è¡¨çš„<a href="https://nlp.stanford.edu/projects/glove/" target="_blank" rel="noopener">Glove</a>å’Œ2017å¹´ç”±Facebookå‘è¡¨çš„<a href="https://fasttext.cc/" target="_blank" rel="noopener">fastText</a>.</p>
<p>&lt;!-- more --&gt;</p>
<p>è®©æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ word2vec ä¸­çš„è·³å­—æ¨¡å‹ã€‚å°†è·³å­—æ¨¡å‹ä¸­ä½¿ç”¨ softmax è¿ç®—è¡¨è¾¾çš„æ¡ä»¶æ¦‚ç‡ $\mathbb{P}(w_j\mid w_i)$. è®°ä½œ $q_{ij}$ï¼Œå³</p>
<p>$$
q_{ij}=\frac{\exp(\mathbf{u}_j^\top \mathbf{v}_i)}{ \sum_{k \in \mathcal{V}} \text{exp}(\mathbf{u}_k^\top \mathbf{v}_i)},
$$</p>
<h2>GloVe æ¨¡å‹</h2>
<p>æœ‰é‰´äºæ­¤ï¼Œä½œä¸ºåœ¨ word2vec ä¹‹åæå‡ºçš„è¯åµŒå…¥æ¨¡å‹ï¼ŒGloVe é‡‡ç”¨äº†å¹³æ–¹æŸå¤±ï¼Œå¹¶åŸºäºè¯¥æŸå¤±å¯¹è·³å­—æ¨¡å‹åšäº†ä¸‰ç‚¹æ”¹åŠ¨</p>
<h2>ä»æ¡ä»¶æ¦‚ç‡æ¯”å€¼ç†è§£ GloVe</h2>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä»å¦å¤–ä¸€ä¸ªè§’åº¦æ¥ç†è§£ GloVe è¯åµŒå…¥ã€‚æ²¿ç”¨æœ¬èŠ‚å‰é¢çš„ç¬¦å·ï¼Œ$\mathbb{P}(w_j \mid w_i)$ è¡¨ç¤ºæ•°æ®é›†ä¸­ä»¥ $w_i$ ä¸ºä¸­å¿ƒè¯ç”ŸæˆèƒŒæ™¯è¯ $w_j$ çš„æ¡ä»¶æ¦‚ç‡ï¼Œå¹¶è®°ä½œ $p_{ij}$ã€‚ä½œä¸ºæºäºæŸå¤§å‹è¯­æ–™åº“çš„çœŸå®ä¾‹å­ï¼Œä»¥ä¸‹åˆ—ä¸¾äº†ä¸¤ç»„åˆ†åˆ«ä»¥â€œiceâ€ï¼ˆâ€œå†°â€ï¼‰å’Œâ€œsteamâ€ï¼ˆâ€œè’¸æ±½â€ï¼‰ä¸ºä¸­å¿ƒè¯çš„æ¡ä»¶æ¦‚ç‡ä»¥åŠå®ƒä»¬ä¹‹é—´çš„æ¯”å€¼ [1]ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">$w_k$=</th>
<th style="text-align:center">â€œsolidâ€</th>
<th style="text-align:center">â€œgasâ€</th>
<th style="text-align:center">â€œwaterâ€</th>
<th style="text-align:center">â€œfashionâ€</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$p_1=\mathbb{P}(w_k\mid\text{&quot;ice&quot;})$</td>
<td style="text-align:center">0.00019</td>
<td style="text-align:center">0.000066</td>
<td style="text-align:center">0.003</td>
<td style="text-align:center">0.000017</td>
</tr>
<tr>
<td style="text-align:center">$p_2=\mathbb{P}(w_k\mid\text{&quot;steam&quot;})$</td>
<td style="text-align:center">0.000022</td>
<td style="text-align:center">0.00078</td>
<td style="text-align:center">0.0022</td>
<td style="text-align:center">0.000018</td>
</tr>
<tr>
<td style="text-align:center">$p_1/p_2$</td>
<td style="text-align:center">8.9</td>
<td style="text-align:center">0.085</td>
<td style="text-align:center">1.36</td>
<td style="text-align:center">0.96</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ä»¥ä¸‹ç°è±¡ï¼š</p>
<blockquote>
<ul>
<li>
<p>å¯¹äºä¸â€œiceâ€ç›¸å…³è€Œä¸â€œsteamâ€ä¸ç›¸å…³çš„è¯ $w_k$ï¼Œä¾‹å¦‚ $w_k=$â€œsolidâ€ï¼ˆâ€œå›ºä½“â€ï¼‰ï¼Œæˆ‘ä»¬æœŸæœ›æ¡ä»¶æ¦‚ç‡æ¯”å€¼è¾ƒå¤§ï¼Œä¾‹å¦‚ä¸Šè¡¨æœ€åä¸€è¡Œä¸­çš„å€¼ 8.9ï¼›</p>
</li>
<li>
<p>å¯¹äºä¸â€œiceâ€ä¸ç›¸å…³è€Œä¸ steam ç›¸å…³çš„è¯ $w_k$ï¼Œä¾‹å¦‚ $w_k=$â€œgasâ€ï¼ˆâ€œæ°”ä½“â€ï¼‰ï¼Œæˆ‘ä»¬æœŸæœ›æ¡ä»¶æ¦‚ç‡æ¯”å€¼è¾ƒå°ï¼Œä¾‹å¦‚ä¸Šè¡¨æœ€åä¸€è¡Œä¸­çš„å€¼ 0.085ï¼›</p>
</li>
<li>
<p>å¯¹äºä¸â€œiceâ€å’Œâ€œsteamâ€éƒ½ç›¸å…³çš„è¯ $w_k$ï¼Œä¾‹å¦‚ $w_k=$â€œwaterâ€ï¼ˆâ€œæ°´â€ï¼‰ï¼Œæˆ‘ä»¬æœŸæœ›æ¡ä»¶æ¦‚ç‡æ¯”å€¼æ¥è¿‘ 1ï¼Œä¾‹å¦‚ä¸Šè¡¨æœ€åä¸€è¡Œä¸­çš„å€¼ 1.36ï¼›</p>
</li>
<li>
<p>å¯¹äºä¸â€œiceâ€å’Œâ€œsteamâ€éƒ½ä¸ç›¸å…³çš„è¯ $w_k$ï¼Œä¾‹å¦‚ $w_k=$â€œfashionâ€ï¼ˆâ€œæ—¶å°šâ€ï¼‰ï¼Œæˆ‘ä»¬æœŸæœ›æ¡ä»¶æ¦‚ç‡æ¯”å€¼æ¥è¿‘ 1ï¼Œä¾‹å¦‚ä¸Šè¡¨æœ€åä¸€è¡Œä¸­çš„å€¼ 0.96ã€‚</p>
</li>
</ul>
</blockquote>
<p>ç”±æ­¤å¯è§ï¼Œæ¡ä»¶æ¦‚ç‡æ¯”å€¼èƒ½æ¯”è¾ƒç›´è§‚åœ°è¡¨è¾¾è¯ä¸è¯ä¹‹é—´çš„å…³ç³»ã€‚æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªè¯å‘é‡å‡½æ•°ä½¿å¾—å®ƒèƒ½æœ‰æ•ˆæ‹Ÿåˆæ¡ä»¶æ¦‚ç‡æ¯”å€¼ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä»»æ„ä¸€ä¸ªè¿™æ ·çš„æ¯”å€¼éœ€è¦ä¸‰ä¸ªè¯ $w_i$ã€$w_j$ å’Œ $w_k$ã€‚ä»¥ $w_i$ ä½œä¸ºä¸­å¿ƒè¯çš„æ¡ä»¶æ¦‚ç‡æ¯”å€¼ä¸º ${p_{ij}}/{p_{ik}}$ã€‚æˆ‘ä»¬å¯ä»¥æ‰¾ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä½¿ç”¨è¯å‘é‡æ¥æ‹Ÿåˆè¿™ä¸ªæ¡ä»¶æ¦‚ç‡æ¯”å€¼</p>
<p>$$f(\boldsymbol{u}_j, \boldsymbol{u}_k, {\boldsymbol{v}}_i) \approx \frac{p_{ij}}{p_{ik}}.$$</p>
<p>è¿™é‡Œå‡½æ•° $f$ å¯èƒ½çš„è®¾è®¡å¹¶ä¸å”¯ä¸€ï¼Œæˆ‘ä»¬åªéœ€è€ƒè™‘ä¸€ç§è¾ƒä¸ºåˆç†çš„å¯èƒ½æ€§ã€‚æ³¨æ„åˆ°æ¡ä»¶æ¦‚ç‡æ¯”å€¼æ˜¯ä¸€ä¸ªæ ‡é‡ï¼Œæˆ‘ä»¬å¯ä»¥å°† $f$ é™åˆ¶ä¸ºä¸€ä¸ªæ ‡é‡å‡½æ•°ï¼š$f(\boldsymbol{u}_j, \boldsymbol{u}_k, {\boldsymbol{v}}_i) = f\left((\boldsymbol{u}_j - \boldsymbol{u}_k)^\top {\boldsymbol{v}}_i\right)$ã€‚äº¤æ¢ç´¢å¼• $j$ å’Œ $k$ åå¯ä»¥çœ‹åˆ°å‡½æ•° $f$ åº”è¯¥æ»¡è¶³ $f(x)f(-x)=1$ï¼Œå› æ­¤ä¸€ä¸ªå¯èƒ½æ˜¯ $f(x)=\exp(x)$ï¼Œäºæ˜¯</p>
<p>$$f(\boldsymbol{u}_j, \boldsymbol{u}_k, {\boldsymbol{v}}_i) = \frac{\exp\left(\boldsymbol{u}_j^\top {\boldsymbol{v}}_i\right)}{\exp\left(\boldsymbol{u}_k^\top {\boldsymbol{v}}_i\right)} \approx \frac{p_{ij}}{p_{ik}}.$$</p>
<p>æ»¡è¶³æœ€å³è¾¹çº¦ç­‰å·çš„ä¸€ä¸ªå¯èƒ½æ˜¯ $\exp\left(\boldsymbol{u}_j^\top {\boldsymbol{v}}_i\right) \approx \alpha p_{ij}$ï¼Œè¿™é‡Œ $\alpha$ æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚è€ƒè™‘åˆ° $p_{ij}=x_{ij}/x_i$ï¼Œå–å¯¹æ•°å $\boldsymbol{u}_j^\top {\boldsymbol{v}}_i \approx \log,\alpha + \log,x_{ij} - \log,x_i$ã€‚æˆ‘ä»¬ä½¿ç”¨é¢å¤–çš„åå·®é¡¹æ¥æ‹Ÿåˆ $- \log,\alpha + \log,x_i$ï¼Œä¾‹å¦‚ä¸­å¿ƒè¯åå·®é¡¹ $b_i$ å’ŒèƒŒæ™¯è¯åå·®é¡¹ $c_j$ï¼š</p>
<p>$$\boldsymbol{u}_j^\top \boldsymbol{v}_i + b_i + c_j \approx \log(x_{ij}).$$</p>
<p>å¯¹ä¸Šå¼å·¦å³ä¸¤è¾¹å–å¹³æ–¹è¯¯å·®å¹¶åŠ æƒï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° GloVe çš„æŸå¤±å‡½æ•°ã€‚</p>
<p>&lt;img src=&quot;/images/nlp/glove-1.jpeg&quot; width=&quot;900&quot; /img&gt;</p>
<h2>å°ç»“</h2>
<ul>
<li>åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œäº¤å‰ç†µæŸå¤±å‡½æ•°æœ‰åŠ£åŠ¿ã€‚GloVe é‡‡ç”¨äº†å¹³æ–¹æŸå¤±ï¼Œå¹¶é€šè¿‡è¯å‘é‡æ‹Ÿåˆé¢„å…ˆåŸºäºæ•´ä¸ªæ•°æ®é›†è®¡ç®—å¾—åˆ°çš„å…¨å±€ç»Ÿè®¡ä¿¡æ¯ã€‚</li>
<li>ä»»æ„è¯çš„ä¸­å¿ƒè¯å‘é‡å’ŒèƒŒæ™¯è¯å‘é‡åœ¨ GloVe ä¸­æ˜¯ç­‰ä»·çš„ã€‚</li>
</ul>
<h2>Reference</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=ioSnNLZSQq0&amp;list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax&amp;index=17" target="_blank" rel="noopener">åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ç¬¬åä¸ƒè¯¾ï¼šGloVeã€fastTextå’Œä½¿ç”¨é¢„è®­ç»ƒçš„è¯å‘é‡</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-google-8-rnn-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/11/10/tensorflow/tf-google-8-rnn-2/"><strong>TensorFlowï¼šç¬¬8ç«  LSTM &amp; Bi-RNN &amp; Deep RNN</strong></a>
      <small class=article-date-index>&nbsp; 2018-11-10</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/11/10/tensorflow/tf-google-8-rnn-2/" class="article-date">
  <time datetime="2018-11-10T05:00:21.000Z" itemprop="datePublished">2018-11-10</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/11/10/tensorflow/tf-google-8-rnn-2/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>LSTM å¯ä»¥å­¦ä¹ åˆ°è·ç¦»å¾ˆè¿œçš„ä¿¡æ¯ï¼Œè§£å†³äº†RNNæ— æ³•é•¿æœŸä¾èµ–çš„é—®é¢˜ã€‚</p>
<p>Bidirectional RNN è§£å†³çš„æ˜¯ å½“å‰æ—¶åˆ»çš„è¾“å‡ºä¸ä»…å’Œä¹‹å‰çš„çŠ¶æ€æœ‰å…³ç³»ï¼Œä¹Ÿå’Œä¹‹åçš„çŠ¶æ€ç›¸å…³ã€‚</p>
<p>Deep RNNs æ˜¯ ä¸ºäº†å¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ï¼Œå¯ä»¥åœ¨ç½‘ç»œä¸­è®¾ç½®å¤šä¸ªå¾ªç¯å±‚ï¼Œå°†æ¯å±‚ RNN çš„è¾“å‡ºä¼ ç»™ä¸‹ä¸€å±‚å¤„ç†ã€‚</p>
<p>&lt;!-- more --&gt;</p>
<h2>1. LSTM</h2>
<p>&lt;img src=&quot;/images/tensorflow/tf-google-8-2.jpg&quot; width=&quot;600&quot; /&gt;</p>
<h3>å•å±‚LSTMç»“æ„å®ç°</h3>
<p>Tensorflowä¸­å®ç°äº†ä»¥ä¸‹æ¨¡å— :tf.nn.rnn_cellï¼ŒåŒ…æ‹¬äº†10ä¸ªç±»ï¼š</p>
<ol>
<li>class BasicLSTMCell: Basic LSTM recurrent network cell.</li>
<li>class BasicRNNCell: The most basic RNN cell.</li>
<li>class DeviceWrapper: Operator that ensures an RNNCell runs on a particular device.</li>
<li>class DropoutWrapper: Operator adding dropout to inputs and outputs of the given cell.</li>
<li>class GRUCell: Gated Recurrent Unit cell (cf. http://arxiv.org/abs/1406.1078).</li>
<li>class LSTMCell: Long short-term memory unit (LSTM) recurrent network cell.</li>
<li>class LSTMStateTuple: Tuple used by LSTM Cells for state_size, zero_state, and output state.</li>
<li>class MultiRNNCell: RNN cell composed sequentially of multiple simple cells.</li>
<li>class RNNCell: Abstract object representing an RNN cell.</li>
<li>class ResidualWrapper: RNNCell wrapper that ensures cell inputs are added to the outputs.</li>
</ol>
<p>åœ¨åŸºæœ¬çš„ LSTM cell ä¸­æˆ‘ä»¬ç”¨ç¬¬ä¸€ä¸ªç±»æ¥è¿›è¡Œå®ç°ï¼Œä»–æ˜¯ tf.contrib.rnn.BasicLSTMCell åŒåç±»ï¼Œå®šä¹‰åœ¨ <a href="https://github.com/tensorflow/tensorflow/blob/r1.11/tensorflow/python/ops/rnn_cell_impl.py" target="_blank" rel="noopener">tensorflow/python/ops/rnn_cell_impl.py</a> ä¸­</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">_init__(</span><br><span class="line">    num_units,</span><br><span class="line">    forget_bias=<span class="number">1.0</span>,</span><br><span class="line">    state_is_tuple=<span class="literal">True</span>,</span><br><span class="line">    activation=<span class="literal">None</span>,</span><br><span class="line">    reuse=<span class="literal">None</span>,</span><br><span class="line">    name=<span class="literal">None</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­å‚æ•°è¡¨ç¤ºï¼š</p>
<ul>
<li>num_units è¡¨ç¤ºç¥ç»å…ƒçš„ä¸ªæ•°</li>
<li>forget_bias å°±æ˜¯LSTMä»¬çš„å¿˜è®°ç³»æ•°ï¼Œå¦‚æœç­‰äº1ï¼Œå°±æ˜¯ä¸ä¼šå¿˜è®°ä»»ä½•ä¿¡æ¯ã€‚å¦‚æœç­‰äº0ï¼Œå°±éƒ½å¿˜è®°</li>
<li>state_is_tuple é»˜è®¤å°±æ˜¯Trueï¼Œè¡¨ç¤ºè¿”å›çš„çŠ¶æ€æ˜¯ä¸€ä¸ª 2-tuple (c_state, m_state)</li>
<li>activation è¡¨ç¤ºå†…éƒ¨çŠ¶æ€çš„æ¿€æ´»å‡½æ•°ï¼Œé»˜è®¤æ˜¯ tanh</li>
<li>name è¡¨ç¤ºè¿™ä¸€å±‚çš„åå­—ï¼ŒåŒæ ·åå­—çš„å±‚ä¼šå…±äº«æƒé‡ï¼Œå¦‚æœä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µéœ€è¦è®¾ç½®reuse=True</li>
</ul>
<p>&lt;img src=&quot;/images/tensorflow/tf-google-8-5.jpg&quot; width=&quot;600&quot; /&gt;</p>
<p>é‡‡ç”¨<strong>BasicLSTMCellæ¥å£°æ˜LSTMç»“æ„å¦‚ä¸‹æ‰€ç¤º</strong>ï¼Œæˆ‘ä»¬ç”¨ä¼ªä»£ç å’Œæ³¨é‡Šæ¥è¿›è¡Œè¯´æ˜ã€‚</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªlstmç»“æ„ï¼Œåœ¨tensorflowä¸­é€šè¿‡ä¸€å¥è¯å°±èƒ½å®ç°ä¸€ä¸ªå®Œæ•´çš„lstmç»“æ„</span></span><br><span class="line"><span class="comment"># lstm_hidden_size è¡¨ç¤º LSTM cell ä¸­ç¥ç»å…ƒçš„æ•°é‡ã€‚ cellå…¶å®å°±æ˜¯ä¸€ä¸ªRNNçš„ç½‘ç»œã€‚</span></span><br><span class="line">lstm = tf.nn.rnn_cell.BasicLSTMCell(lstm_hidden_size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†lstmä¸­çš„çŠ¶æ€åˆå§‹åŒ–ä¸ºå…¨0æ•°ç»„ï¼ŒBasicLSTMCellæä¾›äº†zero_stateæ¥ç”Ÿæˆå…¨0æ•°ç»„</span></span><br><span class="line"><span class="comment"># åœ¨ä¼˜åŒ–RNNæ—¶æ¯æ¬¡ä¹Ÿä¼šä½¿ç”¨ä¸€ä¸ªbatchçš„è®­ç»ƒæ ·æœ¬ï¼Œbatch_sizeç»™å‡ºäº†ä¸€ä¸ªbatchçš„å¤§å°</span></span><br><span class="line">state = lstm.zero_state(batch_size, tf.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰æŸå¤±å‡½æ•°</span></span><br><span class="line">loss = <span class="number">0.0</span></span><br><span class="line"><span class="comment"># ä¸ºäº†åœ¨è®­ç»ƒä¸­é¿å…æ¢¯åº¦å¼¥æ•£çš„æƒ…å†µï¼Œè§„å®šä¸€ä¸ªæœ€å¤§çš„åºåˆ—é•¿åº¦num_steps</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(num_steps):</span><br><span class="line">    <span class="comment"># åœ¨ç¬¬ä¸€ä¸ªæ—¶åˆ»å£°æ˜lstmç»“æ„ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œåœ¨ä¹‹åçš„æ—¶åˆ»éƒ½éœ€è¦é‡å¤ä½¿ç”¨ä¹‹å‰å®šä¹‰å¥½çš„å˜é‡</span></span><br><span class="line">    <span class="keyword">if</span> i&gt;<span class="number">0</span>:</span><br><span class="line">        tf.get_variable_scope().reuse_variables()</span><br><span class="line">    <span class="comment"># æ¯ä¸€æ­¥å¤„ç†æ—¶é—´åºåˆ—ä¸­çš„ä¸€ä¸ªæ—¶åˆ»ï¼Œå°†å½“å‰è¾“å…¥current_inputå’Œå‰ä¸€æ—¶åˆ»çŠ¶æ€stateä¼ å…¥LSTMç»“æ„</span></span><br><span class="line">    <span class="comment"># å°±å¯ä»¥å¾—åˆ°å½“å‰lstmç»“æ„çš„è¾“å‡ºlstm_outputå’Œæ›´æ–°åçš„çŠ¶æ€state</span></span><br><span class="line">    lstm_output, state = lstm(current_input, state)</span><br><span class="line">    <span class="comment"># å°†å½“å‰æ—¶åˆ»lstmè¾“å‡ºä¼ å…¥ä¸€ä¸ªå…¨è¿æ¥å±‚å¾—åˆ°æœ€åçš„è¾“å‡º</span></span><br><span class="line">    final_output = fully_connected(lstm_output)</span><br><span class="line">    <span class="comment"># è®¡ç®—å½“å‰æ—¶åˆ»è¾“å‡ºçš„æŸå¤±</span></span><br><span class="line">    loss += calc_loss(final_output, expected_output)</span><br></pre></td></tr></table></figure></p>
<h2>2. Bidirectional RNN</h2>
<ul>
<li>Bidirectional RNN åŒå‘é€’å½’ç¥ç»ç½‘ç»œ. è¯¥ç¥ç»ç½‘ç»œé¦–å…ˆä»æ­£é¢ç†è§£ä¸€éè¿™å¥è¯ï¼Œå†ä»åæ–¹å‘ç†è§£ä¸€é.</li>
</ul>
<p>&lt;img src=&quot;/images/tensorflow/tf-google-8-3.jpg&quot; width=&quot;600&quot; /&gt;</p>
<h2>3. Deep RNNs</h2>
<ul>
<li>Deep RNNs æ·±å±‚ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å±‚æ¬¡å¢ã€‚ æ¨ªå‘è¡¨ç¤ºæ—¶é—´å±•å¼€ï¼Œçºµå‘åˆ™æ˜¯å±‚æ¬¡å±•å¼€ã€‚</li>
</ul>
<p>&lt;!--&lt;img src=&quot;/images/tensorflow/tf-google-8-4.jpg&quot; width=&quot;600&quot; /&gt;
--&gt;
&lt;img src=&quot;/images/deeplearning/C5W1-47_1.png&quot; width=&quot;750&quot; /&gt;</p>
<p>MultiRNNCellçš„åˆå§‹åŒ–æ–¹æ³•å¦‚ä¸‹</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">__init__(</span><br><span class="line">    cells,</span><br><span class="line">    state_is_tuple=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­</p>
<ul>
<li>cells è¡¨ç¤º RNNCells çš„ listï¼ŒæŒ‰ç…§é¡ºåºä»è¾“å…¥åˆ°è¾“å‡ºæ¥è¡¨ç¤ºä¸åŒå±‚çš„å¾ªç¯å±‚</li>
<li>state_is_tuple è¡¨ç¤º æ¥å—å’Œè¿”å›çš„çŠ¶æ€éƒ½æ˜¯ n-tuples, å…¶ä¸­ n = len(cells)ï¼Œå»ºè®®é‡‡ç”¨True</li>
</ul>
<p>åŒæ ·MultiRNNCellæä¾›äº†çŠ¶æ€åˆå§‹åŒ–çš„å‡½æ•°</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">zero_state(</span><br><span class="line">    batch_size,</span><br><span class="line">    dtype</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥ç”¨ä¼ªä»£ç å’Œæ³¨é‡Šæ¥è¯´æ˜Deep RNNå¦‚ä½•å®ç°</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªåŸºæœ¬çš„LSTMç»“æ„ä½œä¸ºå¾ªç¯ä½“çš„åŸºç¡€ç»“æ„ï¼Œå½“ç„¶ä¹Ÿæ”¯æŒä½¿ç”¨å…¶ä»–çš„å¾ªç¯ä½“ç»“æ„</span></span><br><span class="line">lstm_cell = tf.nn.rnn_cell.BasicLSTMCell</span><br><span class="line"><span class="comment"># é€šè¿‡MultiRNNCellsç±»æ¥å®ç°Deep RNNï¼Œå…¶ä¸­number_of_layersè¡¨ç¤ºæœ‰å¤šå°‘å±‚ï¼Œlstm_sizeè¡¨ç¤ºæ¯å±‚çš„å•å…ƒæ•°é‡</span></span><br><span class="line">stacked_lstm = tf.nn.rnn_cell.MultiRNNCell([lstm_cell(lstm_size) <span class="keyword">for</span> _ <span class="keyword">in</span> range(number_of_layers)])</span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å¹¶è·å–åˆå§‹çŠ¶æ€</span></span><br><span class="line">state = stacked_lstm.zeros_state(batch_size, tf.float32)</span><br><span class="line"></span><br><span class="line">foor i <span class="keyword">in</span> range(len(num_steps)):</span><br><span class="line">    <span class="keyword">if</span> i &gt; <span class="number">0</span>:</span><br><span class="line">        tf.get_variable_scope().reuse_variables()</span><br><span class="line">    <span class="comment"># æ ¹æ®å½“å‰è¾“å…¥current_input(x_t) å’Œå‰ä¸€é˜¶æ®µçŠ¶æ€state(h_(t-1), s_(t-1)) æ¥å‰å‘è®¡ç®—å¾—åˆ°å½“å‰çŠ¶æ€state(h_t, s_t) å’Œè¾“å‡ºstacked_lstm_output (h_t)</span></span><br><span class="line">    stacked_lstm_output, state = stacked_lstm(current_input, state)</span><br><span class="line">    <span class="comment"># è¾“å‡ºå–‚ç»™å…¨è”æ¥å±‚</span></span><br><span class="line">    final_output = fully_connected(stacked_lstm_output)</span><br><span class="line">    <span class="comment"># è®¡ç®—æŸå¤±</span></span><br><span class="line">    loss += calc_loss(final_output, expected_output)</span><br><span class="line">    <span class="comment"># è¿›è¡Œä¼˜åŒ–</span></span><br><span class="line">    .......</span><br></pre></td></tr></table></figure></p>
<h2>Reference</h2>
<ul>
<li><a href="https://www.ctolib.com/docs-Tensorflow-c-Tensorflow5.html" target="_blank" rel="noopener">æ·±å…¥æµ…å‡ºTensorflowï¼ˆäº”ï¼‰ï¼šå¾ªç¯ç¥ç»ç½‘ç»œç®€ä»‹</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/37070414" target="_blank" rel="noopener">Tensorflowå®æˆ˜(1): å®ç°æ·±å±‚å¾ªç¯ç¥ç»ç½‘ç»œ</a></li>
<li><a href="https://zh.gluon.ai/" target="_blank" rel="noopener">zh.gluon.ai åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ </a></li>
<li><a href="https://www.zhihu.com/question/272049149" target="_blank" rel="noopener">æ­£ç¡®ç†è§£ cell ä¸ hidden size çš„åŒºåˆ«</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-google-8-rnn-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/11/08/tensorflow/tf-google-8-rnn-1/"><strong>TensorFlowï¼š ç¬¬8ç«  å¾ªç¯ç¥ç»ç½‘ç»œ 1</strong></a>
      <small class=article-date-index>&nbsp; 2018-11-08</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/11/08/tensorflow/tf-google-8-rnn-1/" class="article-date">
  <time datetime="2018-11-08T14:00:21.000Z" itemprop="datePublished">2018-11-08</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/11/08/tensorflow/tf-google-8-rnn-1/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>å®æˆ˜Googleæ·±åº¦å­¦ä¹ æ¡†æ¶ ç¬”è®°-ç¬¬8ç«  å¾ªç¯ç¥ç»ç½‘ç»œ-1-å‰å‘ä¼ æ’­ã€‚ <a href="https://github.com/blair101/deep-learning-action/tree/master/tf.tutorials/Chapter8" target="_blank" rel="noopener">Github: RNN-1-Forward_Propagation.ipynb</a></p>
<p>&lt;!-- more --&gt;</p>
<p>è¿ç®—çš„æµç¨‹å›¾å¯å‚è€ƒä¸‹é¢è¿™å¼ å›¾</p>
<p>&lt;img src=&quot;/images/tensorflow/tf-google-8-1.jpg&quot; width=&quot;800&quot; /&gt;</p>
<h2>RNN Forward Propagation</h2>
<p>RNN å‰å‘ä¼ æ’­çŸ¥è¯†å›é¡¾</p>
<p>&lt;img src=&quot;/images/deeplearning/C5W1-10_1.png&quot; width=&quot;750&quot; /&gt;</p>
<blockquote>
<p>$a^{&lt;0&gt;}=\vec{0}$</p>
<p>$a^{&lt;1&gt;}=g_1(W_{aa}a^{&lt;0&gt;}+W_{ax}x^{&lt;1&gt;}+b_a)$</p>
<p>$y^{&lt;1&gt;}=g_2(W_{ya}a^{&lt;1&gt;}+b_y)$</p>
<p>$a^{&lt;{t}&gt;}=g_1(W_{aa}a^{&lt;{t-1}&gt;}+W_{ax}x^{&lt;{t}&gt;}+b_a)$</p>
<p>$y^{&lt;{t}&gt;}=g_2(W_{ya}a^{&lt;{t}&gt;}+b_y)$</p>
<p>æ¿€æ´»å‡½æ•°ï¼š<strong>$g_1$</strong> ä¸€èˆ¬ä¸º <strong><code>tanh</code>å‡½æ•°</strong> (æˆ–è€…æ˜¯ <strong><code>Relu</code>å‡½æ•°</strong>)ï¼Œ<strong>$g_2$</strong> ä¸€èˆ¬æ˜¯ <strong><code>Sigmod</code>å‡½æ•°</strong>.</p>
<p>æ³¨æ„: å‚æ•°çš„ä¸‹æ ‡æ˜¯æœ‰é¡ºåºå«ä¹‰çš„ï¼Œå¦‚ $W_{ax}$ ä¸‹æ ‡çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¦è®¡ç®—çš„é‡çš„ç±»å‹ï¼Œå³è¦è®¡ç®— $a$ çŸ¢é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºè¦è¿›è¡Œä¹˜æ³•è¿ç®—çš„æ•°æ®ç±»å‹ï¼Œå³éœ€è¦ä¸ $x$ çŸ¢é‡åšè¿ç®—ã€‚å¦‚ $W_{ax} x^{t}\rightarrow{a}$</p>
</blockquote>
<h2>1. å®šä¹‰RNNçš„å‚æ•°</h2>
<p>è¿™ä¸ªä¾‹å­æ˜¯ç”¨npå†™çš„ï¼Œæ²¡ç”¨åˆ°tensorflow</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–ï¼Œ state = a^&#123;&lt;0&gt;&#125; ä¸ å®šä¹‰ X æ—¶é—´åºåˆ—å‚æ•°</span></span><br><span class="line">X = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">state = [<span class="number">0.0</span>, <span class="number">0.0</span>] <span class="comment"># a^&#123;&lt;0&gt;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†å¼€å®šä¹‰ä¸åŒè¾“å…¥éƒ¨åˆ†çš„æƒé‡ä»¥æ–¹ä¾¿æ“ä½œ</span></span><br><span class="line">w_cell_state = np.asarray([[<span class="number">0.1</span>, <span class="number">0.2</span>], [<span class="number">0.3</span>, <span class="number">0.4</span>]]) <span class="comment"># W_&#123;aa&#125;</span></span><br><span class="line">w_cell_input = np.asarray([[<span class="number">0.5</span>, <span class="number">0.6</span>]]) <span class="comment"># W_&#123;ax&#125;</span></span><br><span class="line"></span><br><span class="line">b_cell = np.asarray([<span class="number">0.1</span>, <span class="number">-0.1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ç”¨äºè¾“å‡ºçš„å…¨è¿æ¥å±‚å‚æ•°ï¼Œ ä¸ state = a^&#123;&lt;i&gt;&#125; çš„ shape ç›¸åç½®</span></span><br><span class="line">w_output = np.asarray([[<span class="number">0.1</span>], [<span class="number">2.0</span>]])</span><br><span class="line">b_output = <span class="number">0.1</span></span><br></pre></td></tr></table></figure></p>
<h2>2. æ‰§è¡Œå‰å‘ä¼ æ’­çš„è¿‡ç¨‹</h2>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‰ç…§æ—¶é—´é¡ºåºæ‰§è¡Œå¾ªç¯å®¡è®¡ç½‘ç»œçš„å‰å‘ä¼ æ’­è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(X)):</span><br><span class="line">    <span class="comment"># è®¡ç®—å¾ªç¯ä½“ä¸­çš„å…¨è¿æ¥å±‚ç¥ç»ç½‘ç»œ</span></span><br><span class="line">    before_activation = np.dot(state, w_cell_state) + X[i] * w_cell_input + b_cell</span><br><span class="line">    </span><br><span class="line">    state = np.tanh(before_activation)</span><br><span class="line">    final_output = np.dot(state, w_output) + b_output</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">"iteration round:"</span>, i+<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"before activation: "</span>, before_activation)</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">"state: "</span>, state)</span><br><span class="line">    print(<span class="string">"output: "</span>, final_output)</span><br></pre></td></tr></table></figure></p>
<p>output:</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iteration round: 1</span><br><span class="line">before activation:  [[0.95107374 1.0254142 ]]</span><br><span class="line">state:  [[0.74026877 0.7720626 ]]</span><br><span class="line">output:  [[1.71815207]]</span><br><span class="line">iteration round: 2</span><br><span class="line">before activation:  [[1.40564566 1.55687879]]</span><br><span class="line">state:  [[0.88656589 0.91491336]]</span><br><span class="line">output:  [[2.0184833]]</span><br></pre></td></tr></table></figure></p>
<p>å’Œå…¶ä»–ç¥ç»ç½‘ç»œç±»ä¼¼ï¼Œåœ¨å®šä¹‰å®ŒæŸå¤±å‡½æ•°ä¹‹åï¼Œå¥—ç”¨ç¬¬4ç« ä¸­ä»‹ç»çš„ä¼˜åŒ–æ¡†æ¶TensorFlowå°±å¯ä»¥<strong>è‡ªåŠ¨å®Œæˆæ¨¡å‹è®­ç»ƒ</strong>çš„è¿‡ç¨‹ã€‚è¿™é‡Œå”¯ä¸€éœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼Œç†è®ºä¸Šå¾ªç¯ç¥ç»ç½‘ç»œå¯ä»¥æ”¯æŒä»»æ„é•¿åº¦çš„åºåˆ—ï¼Œç„¶è€Œåœ¨å®é™…ä¸­ï¼Œå¦‚æœåºåˆ—è¿‡é•¿ä¼šå¯¼è‡´ä¼˜åŒ–æ—¶å‡ºç°æ¢¯åº¦æ¶ˆæ•£çš„é—®é¢˜ï¼ˆ<strong>the vanishing gradient problem</strong>ï¼‰ (8) ï¼Œæ‰€ä»¥å®é™…ä¸­ä¸€èˆ¬ä¼š<strong>è§„å®šä¸€ä¸ªæœ€å¤§é•¿åº¦</strong>ï¼Œå½“åºåˆ—é•¿åº¦è¶…è¿‡è§„å®šé•¿åº¦ä¹‹åä¼šå¯¹åºåˆ—è¿›è¡Œæˆªæ–­ã€‚</p>
<h2>Reference</h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/31539492" target="_blank" rel="noopener">çŸ¥ä¹ï¼šã€ŠTensorFlowï¼šå®æˆ˜Googleæ·±åº¦å­¦ä¹ æ¡†æ¶ã€‹ç¬”è®°ã€ä»£ç åŠå‹˜è¯¯-ç¬¬8ç«  å¾ªç¯ç¥ç»ç½‘ç»œ-1-å‰å‘ä¼ æ’­</a></li>
<li><a href="http://b.7dtime.com/B076DGNXP1/13/0.html" target="_blank" rel="noopener">7å¤©æ—¶é—´ï¼š å¾ªç¯ç¥ç»ç½‘ç»œç®€ä»‹ (1)</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-5.4-contrib-learn-Estimator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/11/04/tensorflow/tf-5.4-contrib-learn-Estimator/"><strong>TensorFlow - tf.contrib.learn åˆ›å»º Estimator</strong></a>
      <small class=article-date-index>&nbsp; 2018-11-04</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/11/04/tensorflow/tf-5.4-contrib-learn-Estimator/" class="article-date">
  <time datetime="2018-11-04T02:10:21.000Z" itemprop="datePublished">2018-11-04</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/11/04/tensorflow/tf-5.4-contrib-learn-Estimator/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>tf.contrib.learn æ¡†æ¶å¯ä»¥é€šè¿‡å…¶é«˜çº§åˆ«çš„ Estimator API è½»æ¾æ„å»ºå’Œè®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹.</p>
<p>Estimator æä¾›æ‚¨å¯ä»¥å®ä¾‹åŒ–çš„ç±»ä»¥å¿«é€Ÿé…ç½®å¸¸è§çš„æ¨¡å‹ç±»å‹ï¼Œå¦‚ regressors å’Œ classifiersï¼š</p>
<p>&lt;!-- more --&gt;</p>
<ul>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/LinearClassifier" target="_blank" rel="noopener">tf.contrib.learn.LinearClassifier</a></li>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/LinearRegressor" target="_blank" rel="noopener">tf.contrib.learn.LinearRegressor</a></li>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/DNNClassifier" target="_blank" rel="noopener">tf.contrib.learn.DNNClassifier</a></li>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/DNNRegressor" target="_blank" rel="noopener">tf.contrib.learn.DNNRegressor</a></li>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn" target="_blank" rel="noopener">tf.contrib.learn......</a></li>
</ul>
<p><strong>å®Œæ•´ä»£ç </strong>ï¼š</p>
<ul>
<li><a href="https://github.com/blair101/deep-learning-action/tree/master/tf.contrib.learn/tf-5.4-Estimator" target="_blank" rel="noopener">Github é²é±¼å¹´é¾„é¢„æµ‹å™¨ r1.11 Abalone Age Predictor</a></li>
</ul>
<h2>Reference</h2>
<ul>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029584" target="_blank" rel="noopener">åœ¨tf.contrib.learnä¸­åˆ›å»ºä¼°ç®—å™¨</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-5.3-contrib-learn-MonitorAPI" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/11/04/tensorflow/tf-5.3-contrib-learn-MonitorAPI/"><strong>TensorFlow - tf.contrib.learn åŸºç¡€çš„è®°å½•å’Œç›‘æ§æ•™ç¨‹</strong></a>
      <small class=article-date-index>&nbsp; 2018-11-04</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/11/04/tensorflow/tf-5.3-contrib-learn-MonitorAPI/" class="article-date">
  <time datetime="2018-11-04T01:10:21.000Z" itemprop="datePublished">2018-11-04</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/11/04/tensorflow/tf-5.3-contrib-learn-MonitorAPI/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>è®­ç»ƒæ¨¡å‹æ—¶ï¼Œå®æ—¶è·Ÿè¸ªå’Œè¯„ä¼°è¿›åº¦é€šå¸¸å¾ˆæœ‰ä»·å€¼ã€‚</p>
<p>å­¦ä¹ ä½¿ç”¨TensorFlowçš„æ—¥å¿—è®°å½•åŠŸèƒ½å’ŒMonitorAPIæ¥ç›‘ç£æ­£åœ¨ç”¨ç¥ç»ç½‘ç»œåˆ†ç±»å™¨åˆ†ç±»irisesçš„è®­ç»ƒæƒ…å†µã€‚</p>
<p>&lt;!-- more --&gt;</p>
<p><strong>å®Œæ•´ä»£ç ï¼š</strong></p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Data sets</span></span><br><span class="line">IRIS_TRAINING = <span class="string">"iris_training.csv"</span></span><br><span class="line">IRIS_TEST = <span class="string">"iris_test.csv"</span></span><br><span class="line"></span><br><span class="line">tf.logging.set_verbosity(tf.logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># First download iris_training.csv and iris_test.csv</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load datasets.</span></span><br><span class="line">    training_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">        filename=IRIS_TRAINING,</span><br><span class="line">        target_dtype=np.int,</span><br><span class="line">        features_dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    test_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">        filename=IRIS_TEST,</span><br><span class="line">        target_dtype=np.int,</span><br><span class="line">        features_dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Specify that all features have real-value data</span></span><br><span class="line">    feature_columns = [tf.contrib.layers.real_valued_column(<span class="string">""</span>, dimension=<span class="number">4</span>)]</span><br><span class="line">    <span class="comment"># [_RealValuedColumn(column_name='', dimension=4, default_value=None, dtype=tf.float32, normalizer=None)]</span></span><br><span class="line"></span><br><span class="line">    validation_monitor = tf.contrib.learn.monitors.ValidationMonitor(</span><br><span class="line">        test_set.data,</span><br><span class="line">        test_set.target,</span><br><span class="line">        every_n_steps=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Build 3 layer DNN with 10, 20, 10 units respectively.</span></span><br><span class="line">    classifier = tf.contrib.learn.DNNClassifier(</span><br><span class="line">        feature_columns=feature_columns,</span><br><span class="line">        hidden_units=[<span class="number">10</span>, <span class="number">20</span>, <span class="number">10</span>],</span><br><span class="line">        n_classes=<span class="number">3</span>,</span><br><span class="line">        model_dir=<span class="string">"/tmp/iris_model"</span>,</span><br><span class="line">        config=tf.contrib.learn.RunConfig(save_checkpoints_secs=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fit model.</span></span><br><span class="line">    classifier.fit(x=training_set.data,</span><br><span class="line">                   y=training_set.target,</span><br><span class="line">                   steps=<span class="number">2000</span>,</span><br><span class="line">                   monitors=[validation_monitor])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<blockquote>
<ul>
<li><a href="https://github.com/blair101/TensorFlowExamples/tree/master/tf.contrib.learn/tf-5.3-validationMonitor-Iris" target="_blank" rel="noopener">ä»£ç å‚è§ Blairâ€˜s Github - tf.contrib.learn åŸºç¡€çš„è®°å½•å’Œç›‘æ§æ•™ç¨‹</a></li>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029489" target="_blank" rel="noopener">æ•™ç¨‹å‚è§ cwiki.apachecn.org tf.contrib.learn åŸºç¡€çš„è®°å½•å’Œç›‘æ§æ•™ç¨‹</a></li>
</ul>
</blockquote>
<h2>1. ä½¿ç”¨TensorFlowå¯ç”¨æ—¥å¿—è®°å½•</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒTensorFlowè¢«é…ç½®åœ¨WARNæ—¥å¿—çº§åˆ«ï¼Œä½†æ˜¯å½“è·Ÿè¸ªæ¨¡å‹è®­ç»ƒæ—¶ï¼Œæ‚¨éœ€è¦å°†çº§åˆ«è°ƒæ•´ä¸ºINFOã€‚</p>
<p>ä»£ç çš„å¼€å¤´ï¼ˆåœ¨importå¯¼å…¥ä¹‹åï¼‰ï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tf.logging.set_verbosity(tf.logging.INFO)</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œä»£ç æ—¶ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å…¶ä»–æ—¥å¿—è¾“å‡ºï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">INFO:tensorflow:loss = 1.18812, step = 1</span><br><span class="line">INFO:tensorflow:loss = 0.210323, step = 101</span><br><span class="line">INFO:tensorflow:loss = 0.109025, step = 201</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨INFOçº§åˆ«æ—¥å¿—è®°å½•ï¼Œtf.contrib.learnä¼šåœ¨æ¯100æ­¥ä¹‹åè‡ªåŠ¨å°†training-loss metricsè¾“å‡ºåˆ°stderrã€‚</p>
<h2>2. é…ç½®éªŒè¯ç›‘è§†å™¨è¿›è¡Œæµè¯„ä¼°</h2>
<p>è®°å½•è®­ç»ƒæŸå¤±æœ‰åŠ©äºäº†è§£æ‚¨çš„æ¨¡å‹æ˜¯å¦æ”¶æ•›ï¼Œä½†å¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥äº†è§£è®­ç»ƒä¸­å‘ç”Ÿçš„æƒ…å†µæ€ä¹ˆåŠï¼Ÿtf.contrib.learnæä¾›äº†å‡ ä¸ªé«˜çº§åˆ«Monitorï¼Œæ‚¨å¯ä»¥é™„åŠ åˆ°æ‚¨çš„fitæ“ä½œï¼Œä»¥è¿›ä¸€æ­¥è·Ÿè¸ªmetrics/è°ƒè¯•æ¨¡å‹è®­ç»ƒæœŸé—´çš„æ›´ä½çº§åˆ«TensorFlowæ“ä½œ</p>
<h3>2.1 æ¯éš”Næ­¥è¯„ä¼°</h3>
<p>å¯¹äºirisç¥ç»ç½‘ç»œåˆ†ç±»å™¨ï¼Œåœ¨è®°å½•è®­ç»ƒæŸå¤±æ—¶ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦åŒæ—¶å¯¹æµ‹è¯•æ•°æ®è¿›è¡Œè¯„ä¼°ï¼Œä»¥äº†è§£è¯¥æ¨¡å‹çš„æ³›åŒ–ç¨‹åº¦ã€‚</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">validation_monitor = tf.contrib.learn.monitors.ValidationMonitor(</span><br><span class="line">    test_set.data,</span><br><span class="line">    test_set.target,</span><br><span class="line">    every_n_steps=<span class="number">50</span>)</span><br></pre></td></tr></table></figure></p>
<p>å°†æ­¤ä»£ç æ”¾åœ¨å®ä¾‹åŒ–classifieré‚£è¡Œä¹‹å‰ã€‚</p>
<p>ValidationMonitorä¾é ä¿å­˜çš„checkpointsæ‰§è¡Œè¯„ä¼°æ“ä½œï¼Œå› æ­¤æ‚¨éœ€è¦æ·»åŠ åŒ…å«save_checkpoints_secsçš„<a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/RunConfig" target="_blank" rel="noopener">tf.contrib.learn.RunConfig</a>å»ä¿®æ”¹classifierçš„å®ä¾‹åŒ–ï¼Œè¯¥å‚æ•°æŒ‡å®šåœ¨è®­ç»ƒæœŸé—´ç»è¿‡å¤šå°‘ç§’ä¿å­˜checkpointã€‚</p>
<p>ç”±äºirisæ•°æ®é›†ç›¸å½“å°ï¼Œå› æ­¤è®­ç»ƒé€Ÿåº¦å¾ˆå¿«ï¼Œè®¾ç½®save_checkpoints_secsä¸º1ï¼ˆæ¯1ç§’ä¿å­˜checkpointï¼‰ï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">classifier = tf.contrib.learn.DNNClassifier(</span><br><span class="line">    feature_columns=feature_columns,</span><br><span class="line">    hidden_units=[<span class="number">10</span>, <span class="number">20</span>, <span class="number">10</span>],</span><br><span class="line">    n_classes=<span class="number">3</span>,</span><br><span class="line">    model_dir=<span class="string">"/tmp/iris_model"</span>,</span><br><span class="line">    config=tf.contrib.learn.RunConfig(save_checkpoints_secs=<span class="number">1</span>))</span><br></pre></td></tr></table></figure></p>
<p>validation_monitorï¼Œæ›´æ–°åŒ…å¿«è°ƒç”¨monitorså‚æ•°çš„fitï¼Œè¯¥å‚æ•°åœ¨æ¨¡å‹è®­ç»ƒæœŸé—´ç”ŸæˆåŒ…å«æ‰€æœ‰monitorsçš„listï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">classifier.fit(x=training_set.data,</span><br><span class="line">               y=training_set.target,</span><br><span class="line">               steps=<span class="number">2000</span>,</span><br><span class="line">               monitors=[validation_monitor])</span><br></pre></td></tr></table></figure></p>
<p>é‡æ–°è¿è¡Œä»£ç æ—¶ï¼Œæ‚¨åº”è¯¥åœ¨æ—¥å¿—è¾“å‡ºä¸­çœ‹åˆ°éªŒè¯metricsï¼Œä¾‹å¦‚ï¼š (ä½†æ˜¯æˆ‘è¿™é‡Œè¯•éªŒçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰å‡ºç°)</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">INFO:tensorflow:Validation (step <span class="number">50</span>): loss = <span class="number">1.71139</span>, global_step = <span class="number">0</span>, accuracy = <span class="number">0.266667</span></span><br><span class="line">...</span><br><span class="line">INFO:tensorflow:Validation (step <span class="number">300</span>): loss = <span class="number">0.0714158</span>, global_step = <span class="number">268</span>, accuracy = <span class="number">0.966667</span></span><br><span class="line">...</span><br><span class="line">INFO:tensorflow:Validation (step <span class="number">1750</span>): loss = <span class="number">0.0574449</span>, global_step = <span class="number">1729</span>, accuracy = <span class="number">0.966667</span></span><br></pre></td></tr></table></figure></p>
<h3>2.2 ä½¿ç”¨MetricSpecå®šä¹‰Evaluation Metrics</h3>
<ul>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029489" target="_blank" rel="noopener">è¯¦æƒ…å‚è§ cwiki.apachecn.org tf.contrib.learn åŸºç¡€çš„è®°å½•å’Œç›‘æ§æ•™ç¨‹</a></li>
</ul>
<h3>2.3 é€šè¿‡ValidationMonitoræå‰åœæ­¢è®­ç»ƒ</h3>
<ul>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029489" target="_blank" rel="noopener">è¯¦æƒ…å‚è§ cwiki.apachecn.org tf.contrib.learn åŸºç¡€çš„è®°å½•å’Œç›‘æ§æ•™ç¨‹</a></li>
</ul>
<h2>3. ç”¨TensorBoardå¯è§†åŒ–æ—¥å¿—æ•°æ®</h2>
<p>è¯»å–é€šè¿‡ValidationMonitoråœ¨è®­ç»ƒæœŸé—´äº§ç”Ÿå¤§é‡å…³äºæ¨¡å‹æ€§èƒ½çš„åŸå§‹æ•°æ®çš„æ—¥å¿—ï¼Œæ­¤æ•°æ®çš„å¯è§†åŒ–ï¼Œå¯¹è¿›ä¸€æ­¥äº†è§£è¶‹åŠ¿å¯èƒ½ä¼šæœ‰å¸®åŠ©ï¼Œä¾‹å¦‚å‡†ç¡®æ€§å¦‚ä½•éšç€æ­¥æ•°è€Œå˜åŒ–ã€‚</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ tensorboard --logdir=/tmp/iris_model/</span><br><span class="line">Starting TensorBoard 39 on port 6006</span><br></pre></td></tr></table></figure></p>
<h2>Reference</h2>
<ul>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029489" target="_blank" rel="noopener">tf.contrib.learnåŸºç¡€çš„è®°å½•å’Œç›‘æ§æ•™ç¨‹</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-hadoop/ops-install-CDH6.0.1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/11/02/hadoop/ops-install-CDH6.0.1/"><strong>å¤§æ•°æ®å¹³å°CDH6.0é›†ç¾¤åœ¨çº¿å®‰è£…</strong></a>
      <small class=article-date-index>&nbsp; 2018-11-02</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/11/02/hadoop/ops-install-CDH6.0.1/" class="article-date">
  <time datetime="2018-11-02T06:16:21.000Z" itemprop="datePublished">2018-11-02</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/hadoop/">hadoop</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/11/02/hadoop/ops-install-CDH6.0.1/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>ä»‹ç»äº† CDH é›†ç¾¤çš„æ­å»ºä¸å®‰è£…</p>
<p>æ ‡ç­¾ï¼š Cloudera-Manager CDH Hadoop éƒ¨ç½² é›†ç¾¤</p>
<p>&lt;!-- more --&gt;</p>
<blockquote>
<p>ç›®å‰Hadoopæ¯”è¾ƒæµè¡Œçš„ä¸»è¦æœ‰2ä¸ªç‰ˆæœ¬ï¼ŒApacheå’ŒClouderaç‰ˆæœ¬ã€‚</p>
<ul>
<li>Apache Hadoopï¼šç»´æŠ¤äººå‘˜æ¯”è¾ƒå¤šï¼Œæ›´æ–°é¢‘ç‡æ¯”è¾ƒå¿«ï¼Œä½†æ˜¯ç¨³å®šæ€§æ¯”è¾ƒå·®ã€‚</li>
<li>Cloudera Hadoopï¼ˆCDHï¼‰ï¼šCDHï¼šClouderaå…¬å¸çš„å‘è¡Œç‰ˆæœ¬ï¼ŒåŸºäºApache Hadoopçš„äºŒæ¬¡å¼€å‘ï¼Œä¼˜åŒ–äº†ç»„ä»¶å…¼å®¹å’Œäº¤äº’æ¥å£ã€ç®€åŒ–å®‰è£…é…ç½®ã€å¢åŠ Clouderaå…¼å®¹ç‰¹æ€§ã€‚</li>
</ul>
</blockquote>
<h2>1. æ“ä½œç¯å¢ƒ</h2>
<ul>
<li>CentOS 7.3 x64 ï¼ˆ4C/10G/50Gï¼‰</li>
<li>Cloudera Managerï¼š6.0.1</li>
<li>CDH: 6.0.1</li>
</ul>
<p>ç›¸å…³åŒ…åœ°å€</p>
<p>Cloudera Managerä¸‹è½½åœ°å€ï¼š<a href="https://archive.cloudera.com/cm6/6.0.0/redhat7/yum/RPMS/x86_64/" target="_blank" rel="noopener">https://archive.cloudera.com/cm6/6.0.0/redhat7/yum/RPMS/x86_64/</a></p>
<blockquote>
<ul>
<li>cloudera-manager-agent-6.0.0-530873.el7.x86_64.rpm</li>
<li>cloudera-manager-daemons-6.0.0-530873.el7.x86_64.rpm</li>
<li>cloudera-manager-server-6.0.0-530873.el7.x86_64.rpm</li>
<li>cloudera-manager-server-db-2-6.0.0-530873.el7.x86_64.rpm</li>
<li>oracle-j2sdk1.8-1.8.0+update141-1.x86_64.rpm</li>
</ul>
</blockquote>
<p>CDHå®‰è£…åŒ…åœ°å€ï¼š<a href="https://archive.cloudera.com/cdh6/6.0.0/parcels/" target="_blank" rel="noopener">https://archive.cloudera.com/cdh6/6.0.0/parcels/</a></p>
<blockquote>
<ul>
<li>CDH-6.0.0-1.cdh6.0.0.p0.537114-el7.parcel</li>
<li>CDH-6.0.0-1.cdh6.0.0.p0.537114-el7.parcel.sha256</li>
<li>manifest.json</li>
</ul>
</blockquote>
<p>æ³¨æ„ï¼šä»¥ä¸‹æ“ä½œå‡ç”¨rootç”¨æˆ·æ“ä½œã€‚</p>
<h2>2. ç½‘ç»œé…ç½®(æ‰€æœ‰èŠ‚ç‚¹)</h2>
<p><strong>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸ŠæŠŠIPå’Œä¸»æœºåçš„å¯¹åº”å…³ç³»å†™å…¥</strong></p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ³¨é‡Šæ‰åŸæœ‰çš„è¯­å¥, å¢åŠ ï¼š</span></span><br><span class="line">192.192.0.25 server</span><br><span class="line">192.192.0.26 chdagent1</span><br><span class="line">192.192.0.27 chdagent2</span><br></pre></td></tr></table></figure></p>
<p><strong>åœ¨ç›¸åº”çš„èŠ‚ç‚¹ä¸»æœºä¸Šä¿®æ”¹ä¸»æœºå</strong></p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/sysconfig/network</span><br><span class="line"></span><br><span class="line">NETWORKING=yes</span><br><span class="line">HOSTNAME=cdhserver</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æˆ–è€…æ·»åŠ  HOSTNAME=cdhserver</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>cdhserver æ˜¯ä½ èµ·çš„çš„ä¸»æœºåå­—</p>
</blockquote>
<p><strong>æ‰§è¡Œå‘½ä»¤</strong></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># hostname cdhserver</span><br></pre></td></tr></table></figure></p>
<p>CentOS7è¦å¤šæ‰§è¡Œä»¥ä¸‹è¿™æ­¥ï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hostnamectl set-hostname cdhserver</span><br></pre></td></tr></table></figure></p>
<h2>3. æ‰“é€šSSH</h2>
<p>è®¾ç½®sshæ— å¯†ç ç™»é™†ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</p>
<h2>4. å…³é—­é˜²ç«å¢™å’ŒSELinux</h2>
<p>æ³¨æ„ï¼š éœ€è¦åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œå› ä¸ºæ¶‰åŠåˆ°çš„ç«¯å£å¤ªå¤šäº†ï¼Œä¸´æ—¶å…³é—­é˜²ç«å¢™æ˜¯ä¸ºäº†å®‰è£…èµ·æ¥æ›´æ–¹ä¾¿ï¼Œå®‰è£…å®Œæ¯•åå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®é˜²ç«å¢™ç­–ç•¥ï¼Œä¿è¯é›†ç¾¤å®‰å…¨ã€‚</p>
<p>å…³é—­é˜²ç«å¢™å¹¶å…³é—­è‡ªå¯åŠ¨ï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure></p>
<h2>5. æ‰€æœ‰èŠ‚ç‚¹é…ç½®NTPæœåŠ¡</h2>
<p>é›†ç¾¤ä¸­æ‰€æœ‰ä¸»æœºå¿…é¡»ä¿æŒæ—¶é—´åŒæ­¥ï¼Œå¦‚æœæ—¶é—´ç›¸å·®è¾ƒå¤§ä¼šå¼•èµ·å„ç§é—®é¢˜ã€‚ å…·ä½“æ€è·¯å¦‚ä¸‹ï¼š</p>
<p>masterèŠ‚ç‚¹ä½œä¸ºntpæœåŠ¡å™¨ä¸å¤–ç•Œå¯¹æ—¶ä¸­å¿ƒåŒæ­¥æ—¶é—´ï¼Œéšåå¯¹æ‰€æœ‰datanodeèŠ‚ç‚¹æä¾›æ—¶é—´åŒæ­¥æœåŠ¡ã€‚</p>
<p>æ‰€æœ‰datanodeèŠ‚ç‚¹ä»¥masterèŠ‚ç‚¹ä¸ºåŸºç¡€åŒæ­¥æ—¶é—´ã€‚</p>
<p>æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ç›¸å…³ç»„ä»¶ï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install ntp</span><br></pre></td></tr></table></figure></p>
<p>å¯åŠ¨æœåŠ¡ï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start ntpd</span><br></pre></td></tr></table></figure></p>
<p>é…ç½®å¼€æœºå¯åŠ¨ï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> ntpd</span><br></pre></td></tr></table></figure></p>
<h2>6. å®‰è£… python 2.7</h2>
<p>å¿…é¡»æ˜¯python2.7ç‰ˆæœ¬ï¼ŒCentOS 7 ç³»ç»Ÿå¯ä»¥ä¸ç”¨è£…ï¼Œç³»ç»Ÿè‡ªå¸¦çš„ã€‚</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#ä¸‹è½½å¹¶å®‰è£…EPELï¼Œå®‰è£…python-pipï¼Œpsycopg2æœ‰ä¾èµ–</span><br><span class="line">[root@localhost ~]# wget http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line">[root@localhost ~]# rpm -ivh epel-release-latest-7.noarch.rpm</span><br><span class="line">[root@localhost ~]# yum repolist  #æ£€æŸ¥æ˜¯å¦å·²æ·»åŠ è‡³æºåˆ—è¡¨</span><br></pre></td></tr></table></figure></p>
<p>å‡çº§è½¯ä»¶ä¾èµ–ç‰ˆæœ¬</p>
<p>Starting with CDH 6, PostgreSQL-backed Hue requires the Psycopg2 version to be at least 2.5.4</p>
<p>é¦–å…ˆå®‰è£…epelæ‰©å±•æºï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install python-pip</span><br><span class="line">pip install --upgrade psycopg2</span><br></pre></td></tr></table></figure></p>
<h2>7. å‡†å¤‡Parcelsï¼Œç”¨ä»¥å®‰è£…CDH6</h2>
<p>å°†CHD6ç›¸å…³çš„ParcelåŒ…æ”¾åˆ°ä¸»èŠ‚ç‚¹çš„/opt/cloudera/parcel-repo/ç›®å½•ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ­¤ç›®å½•ï¼Œå¯ä»¥è‡ªå·±åˆ›å»ºã€‚</p>
<blockquote>
<ul>
<li>CDH-6.0.0-1.cdh6.0.0.p0.537114-el7.parcel</li>
<li>CDH-6.0.0-1.cdh6.0.0.p0.537114-el7.parcel.sha256</li>
<li>manifest.json</li>
</ul>
</blockquote>
<p>æ³¨æ„ï¼šæœ€åå°†CDH-6.0.0-1.cdh6.0.0.p0.537114-el7.parcel.sha256ï¼Œé‡å‘½åä¸ºCDH-6.0.0-1.cdh6.0.0.p0.537114-el7.parcel.sha</p>
<p><strong>å®‰è£…repo</strong>:</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://archive.cloudera.com/cm6/6.0.0/redhat7/yum/cloudera-manager.repo -P /etc/yum.repos.d/</span><br></pre></td></tr></table></figure></p>
<p><strong>å¯¼å…¥GPG key</strong>:</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm --import https://archive.cloudera.com/cm6/6.0.0/redhat7/yum/RPM-GPG-KEY-cloudera</span><br></pre></td></tr></table></figure></p>
<p><strong>JDK install</strong>:</p>
<blockquote>
<p>yum install oracle-j2sdk1.8</p>
<p>æ³¨æ„ ï¼š</p>
<ul>
<li>ä½¿ç”¨ yum ä¸‹è½½ï¼Œéœ€è¦ç¡®å®šç‰ˆæœ¬ä¸å®‰è£…CDH6å®˜æ–¹è¦æ±‚çš„éœ€è¦çš„ç‰ˆæœ¬ä¸€è‡´</li>
<li>ä¹Ÿå¯ä¸ä½¿ç”¨ yum å®‰è£…ï¼Œä½¿ç”¨è‡ªå·±ä¸‹è½½ JDKï¼Œç„¶åæ‰‹åŠ¨ç»¿è‰²å®‰è£…é…ç½®</li>
<li>ä¹Ÿå¯åœ¨å®‰è£… CM çš„æ—¶å€™ï¼Œå†æ ¹æ®æç¤ºæ¥å®‰è£…éœ€è¦çš„ JDK</li>
</ul>
<p>ä¸‰ç§æ–¹å¼ä»»é€‰å…¶ä¸€ä¾¿å¯</p>
</blockquote>
<p><strong>yumå®‰è£…CM</strong>:</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install cloudera-manager-server</span><br></pre></td></tr></table></figure></p>
<h2>8. å®‰è£…MySql</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">rpm -ivh mysql-community-release-el7-5.noarch.rpm</span><br><span class="line">yum update</span><br><span class="line">yum install mysql-server</span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br></pre></td></tr></table></figure></p>
<p>åˆå§‹åŒ–Mysql</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/mysql_secure_installation</span><br></pre></td></tr></table></figure></p>
<p>é…ç½®JDBC</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.46.tar.gz</span><br><span class="line">tar zxvf mysql-connector-java-5.1.46.tar.gz</span><br><span class="line">mkdir -p /usr/share/java/</span><br><span class="line"><span class="built_in">cd</span> mysql-connector-java-5.1.46</span><br><span class="line">cp mysql-connector-java-5.1.46-bin.jar /usr/share/java/mysql-connector-java.jar</span><br></pre></td></tr></table></figure></p>
<p>å»ºåº“ï¼šæ ¹æ®å®˜æ–¹æ–‡æ¡£æä¾›çš„å‘½åå»ºåº“ï¼Œæ–¹ä¾¿è®°å¿†ã€‚(åœ¨CMé…ç½®CDHçš„æ—¶å€™ä¼šç”¨åˆ°è¿™äº›åº“å)</p>
<blockquote>
<p>Set up the Cloudera Manager Databaseï¼š/opt/cloudera/cm/schema/scm_prepare_database.sh mysql scm scm</p>
</blockquote>
<p>å‡ºç°å¦‚ä¸‹æ—¥å¿—ï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">JAVA_HOME=/usr/java/jdk1.8.0_141-cloudera</span><br><span class="line">Verifying that we can write to /etc/cloudera-scm-server</span><br><span class="line">Creating SCM configuration file <span class="keyword">in</span> /etc/cloudera-scm-server</span><br><span class="line">Executing:  /usr/java/jdk1.8.0_141-cloudera/bin/java -cp /usr/share/java/mysql-connector-java.jar:/usr/share/java/oracle-connector-java.jar:/usr/share/java/postgresql-connector-java.jar:/opt/cloudera/cm/schema/../lib/* com.cloudera.enterprise.dbutil.DbCommandExecutor /etc/cloudera-scm-server/db.properties com.cloudera.cmf.db.</span><br><span class="line">[main] DbCommandExecutor INFO  Successfully connected to database.</span><br><span class="line">All <span class="keyword">done</span>, your SCM database is configured correctly!</span><br></pre></td></tr></table></figure></p>
<h2>9. å¯åŠ¨CMæœåŠ¡</h2>
<p>å¯åŠ¨ï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start cloudera-scm-server</span><br></pre></td></tr></table></figure></p>
<p>æŸ¥çœ‹æ—¥å¿—ï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tail -f /var/<span class="built_in">log</span>/cloudera-scm-server/cloudera-scm-server.log</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å‡ºç°ï¼šINFO WebServerImpl:com.cloudera.server.cmf.WebServerImpl: Started Jetty server.åˆ™è¡¨ç¤ºæœåŠ¡æ­£å¸¸å¯åŠ¨</p>
</blockquote>
<p>ç™»å½• http://&lt;server_host&gt;:7180 è´¦å·ï¼šadmin</p>
<h2>Reference</h2>
<ul>
<li><a href="https://blog.csdn.net/caolijun1166/article/details/82714387" target="_blank" rel="noopener">CDH 6.0.0 æ­å»º</a></li>
<li><a href="http://blog.51cto.com/pizibaidu/2174297" target="_blank" rel="noopener">CDH6.0.0è¯¦ç»†å®‰è£…æ•™ç¨‹åŠæ‰€é‡åˆ°çš„é—®é¢˜</a></li>
<li><a href="https://www.cloudera.com/documentation/enterprise/6/6.0/topics/installation.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£ - Cloudera Installation Guide</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-5.2-contrib-learn-Input-fn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/11/01/tensorflow/tf-5.2-contrib-learn-Input-fn/"><strong>TensorFlow - tf.contrib.learn æ„å»ºè¾“å…¥å‡½æ•°</strong></a>
      <small class=article-date-index>&nbsp; 2018-11-01</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/11/01/tensorflow/tf-5.2-contrib-learn-Input-fn/" class="article-date">
  <time datetime="2018-11-01T08:10:21.000Z" itemprop="datePublished">2018-11-01</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/11/01/tensorflow/tf-5.2-contrib-learn-Input-fn/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>ä»‹ç»å¦‚ä½•åœ¨tf.contrib.learnä¸­åˆ›å»ºè¾“å…¥å‡½æ•°ã€‚äº†è§£å¦‚ä½•æ„å»ºinput_fnå»é¢„å¤„ç†å’Œå°†æ•°æ®è¾“åˆ°æ¨¡å‹ä¸­çš„æ¦‚è¿°ã€‚</p>
<p>å®ç°åˆ©ç”¨input_fnå°†è®­ç»ƒï¼Œè¯„ä¼°å’Œé¢„æµ‹æ•°æ®æä¾›ç»™ç¥ç»ç½‘ç»œå›å½’å™¨ï¼Œç”¨äºé¢„æµ‹æˆ¿ä»·ä¸­ä½æ•°ã€‚</p>
<p>&lt;!-- more --&gt;</p>
<h2>1. åˆ©ç”¨input_fnè‡ªå®šä¹‰è¾“å…¥Pipelines</h2>
<p>å½“ä½¿ç”¨ tf.contrib.learn è®­ç»ƒç¥ç»ç½‘ç»œï¼Œå®ƒå¯ä»¥ç›´æ¥é€šè¿‡æ‚¨çš„ç‰¹å¾å’Œç›®æ ‡æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œåˆ†ææˆ–é¢„æµ‹æ“ä½œã€‚è¿™æ˜¯ä¸€ä¸ªä»tf.contrib.learnå¿«é€Ÿå…¥é—¨æ•™ç¨‹ä¸­è·å–çš„ç¤ºä¾‹ï¼š</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">training_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">    filename=IRIS_TRAINING, target_dtype=np.int, features_dtype=np.float32)</span><br><span class="line">test_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">    filename=IRIS_TEST, target_dtype=np.int, features_dtype=np.float32)</span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line">classifier.fit(x=training_set.data,</span><br><span class="line">               y=training_set.target,</span><br><span class="line">               steps=<span class="number">2000</span>)</span><br></pre></td></tr></table></figure></p>
<p>å½“éœ€è¦å¯¹æºæ•°æ®è¿›è¡Œå°‘é‡æ“ä½œæ—¶ï¼Œè¿™ç§æ–¹æ³•è¿è¡Œè‰¯å¥½ã€‚ä½†æ˜¯åœ¨éœ€è¦æ›´å¤šç‰¹å¾å·¥ç¨‹çš„æƒ…å†µä¸‹ï¼Œ tf.contrib.learnæ”¯æŒä½¿ç”¨è‡ªå®šä¹‰è¾“å…¥å‡½æ•°ï¼ˆinput_fnï¼‰å°†é¢„å¤„ç†å’Œpipelineæ•°æ®çš„é€»è¾‘å°è£…åˆ°æ¨¡å‹ä¸­ã€‚</p>
<h3>1.1 è§£æinput_fn</h3>
<p>ä»¥ä¸‹ä»£ç é˜è¿°äº†è¾“å…¥å‡½æ•°çš„åŸºæœ¬æ¡†æ¶ï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_input_fn</span><span class="params">()</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Preprocess your data here...</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># ...then return 1) a mapping of feature columns to Tensors with</span></span><br><span class="line">    <span class="comment"># the corresponding feature data, and 2) a Tensor containing labels</span></span><br><span class="line">    <span class="keyword">return</span> feature_cols, labels</span><br></pre></td></tr></table></figure></p>
<p>è¾“å…¥å‡½æ•°éƒ¨åˆ†åŒ…å«ç”¨äºé¢„å¤„ç†è¾“å…¥æ•°æ®çš„ç‰¹å®šé€»è¾‘ï¼Œä¾‹å¦‚æ“¦é™¤ä¸è‰¯ç¤ºä¾‹æˆ–feature scalingã€‚</p>
<p>è¾“å…¥å‡½æ•°å¿…é¡»è¿”å›ä»¥ä¸‹ä¸¤ä¸ªå€¼ï¼Œå…¶ä¸­åŒ…å«è¦é¦ˆé€åˆ°æ¨¡å‹ä¸­çš„æœ€ç»ˆç‰¹å¾å’Œæ ‡ç­¾æ•°æ®ï¼ˆå¦‚ä¸Šè¿°ä»£ç æ¡†æ¶æ‰€ç¤ºï¼‰ï¼š</p>
<blockquote>
<p>feature_cols</p>
<ul>
<li>å°†ç‰¹å¾åˆ—åç§°æ˜ å°„åˆ°ç›¸åº”ç‰¹å¾æ•°æ®çš„Tensorsï¼ˆæˆ–SparseTensorsï¼‰çš„keys/valueså¯¹çš„å­—å…¸ã€‚</li>
</ul>
<p>labels</p>
<ul>
<li>åŒ…å«æ‚¨çš„æ ‡ç­¾ï¼ˆç›®æ ‡ï¼‰å€¼çš„å¼ é‡ï¼šæ‚¨çš„æ¨¡å‹é¢„æµ‹çš„å€¼ã€‚</li>
</ul>
</blockquote>
<h3>1.2 å°†ç‰¹å¾æ•°æ®è½¬æ¢ä¸ºå¼ é‡</h3>
<p>å¦‚æœç‰¹å¾/æ ‡ç­¾æ•°æ®å­˜å‚¨åœ¨pandas æ•°æ®æ¶æ„æˆ–numpyæ•°ç»„ï¼Œä½ éœ€è¦å°†å…¶è½¬æ¢ä¸ºTensoråœ¨å®ƒä»input_fnè¿”å›ä¹‹å‰ã€‚</p>
<p>å¯¹äºè¿ç»­æ•°æ®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨tf.constantåˆ›å»ºå’Œå¡«å……Tensorï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">feature_column_data = [<span class="number">1</span>, <span class="number">2.4</span>, <span class="number">0</span>, <span class="number">9.9</span>, <span class="number">3</span>, <span class="number">120</span>]</span><br><span class="line">feature_tensor = tf.constant(feature_column_data)</span><br></pre></td></tr></table></figure></p>
<h2>2. è¯¦è§ä»£ç </h2>
<ul>
<li><a href="https://github.com/blair101/TensorFlowExamples/blob/master/tf.contrib.learn/tf.contrib.learn%E6%9E%84%E5%BB%BA%E8%BE%93%E5%85%A5%E5%87%BD%E6%95%B0.ipynb" target="_blank" rel="noopener">Blair's Github tf.contrib.learnæ„å»ºè¾“å…¥å‡½æ•°</a></li>
</ul>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"> </span><br><span class="line">tf.logging.set_verbosity(tf.logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å®šä¹‰æ•°æ®é›†ä¸­çš„åˆ—åCOLUMNSã€‚ ä¸ºäº†åŒºåˆ†æ ‡ç­¾çš„ featureï¼Œè¿˜è¦å®šä¹‰ FEATURES å’Œ LABELã€‚</span></span><br><span class="line"></span><br><span class="line">COLUMNS = [<span class="string">"crim"</span>, <span class="string">"zn"</span>, <span class="string">"indus"</span>, <span class="string">"nox"</span>, <span class="string">"rm"</span>, <span class="string">"age"</span>,</span><br><span class="line">           <span class="string">"dis"</span>, <span class="string">"tax"</span>, <span class="string">"ptratio"</span>, <span class="string">"medv"</span>]</span><br><span class="line">FEATURES = [<span class="string">"crim"</span>, <span class="string">"zn"</span>, <span class="string">"indus"</span>, <span class="string">"nox"</span>, <span class="string">"rm"</span>,</span><br><span class="line">            <span class="string">"age"</span>, <span class="string">"dis"</span>, <span class="string">"tax"</span>, <span class="string">"ptratio"</span>]</span><br><span class="line">LABEL = <span class="string">"medv"</span></span><br><span class="line"> </span><br><span class="line">training_set = pd.read_csv(<span class="string">"boston_train.csv"</span>, skipinitialspace=<span class="literal">True</span>,</span><br><span class="line">                           skiprows=<span class="number">1</span>, names=COLUMNS)</span><br><span class="line">test_set = pd.read_csv(<span class="string">"boston_test.csv"</span>, skipinitialspace=<span class="literal">True</span>,</span><br><span class="line">                       skiprows=<span class="number">1</span>, names=COLUMNS)</span><br><span class="line">prediction_set = pd.read_csv(<span class="string">"boston_predict.csv"</span>, skipinitialspace=<span class="literal">True</span>,</span><br><span class="line">                             skiprows=<span class="number">1</span>, names=COLUMNS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(training_set.head(2))</span></span><br><span class="line"><span class="comment"># print(test_set.head(2))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å®šä¹‰FeatureColumnså¹¶åˆ›å»ºå›å½’</span></span><br><span class="line">feature_cols = [tf.contrib.layers.real_valued_column(k) <span class="keyword">for</span> k <span class="keyword">in</span> FEATURES]</span><br><span class="line">feature_cols</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å®ä¾‹åŒ–ä¸€ä¸ªDNNRegressorç¥ç»ç½‘ç»œå›å½’æ¨¡å‹</span></span><br><span class="line">regressor = tf.contrib.learn.DNNRegressor(feature_columns=feature_cols,</span><br><span class="line">                                          hidden_units=[<span class="number">10</span>, <span class="number">10</span>],</span><br><span class="line">                                          model_dir=<span class="string">"/tmp/boston_model"</span>)</span><br><span class="line">                                          </span><br><span class="line"><span class="comment"># 4. æ„å»ºinput_fn                                          </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">input_fn</span><span class="params">(data_set)</span>:</span></span><br><span class="line">    feature_cols = &#123;k: tf.constant(data_set[k].values)</span><br><span class="line">                    <span class="keyword">for</span> k <span class="keyword">in</span> FEATURES&#125;</span><br><span class="line">    labels = tf.constant(data_set[LABEL].values)</span><br><span class="line">    <span class="keyword">return</span> feature_cols, labels</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. è®­ç»ƒå›å½’å™¨</span></span><br><span class="line">regressor.fit(input_fn=<span class="keyword">lambda</span>: input_fn(training_set), steps=<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. è¯„ä¼°æ¨¡å‹</span></span><br><span class="line">ev = regressor.evaluate(input_fn=<span class="keyword">lambda</span>: input_fn(test_set), steps=<span class="number">1</span>)</span><br><span class="line">loss_score = ev[<span class="string">"loss"</span>]</span><br><span class="line">print(<span class="string">"Loss: &#123;0:f&#125;"</span>.format(loss_score))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. é¢„æµ‹</span></span><br><span class="line">y = regressor.predict_scores(input_fn=<span class="keyword">lambda</span>: input_fn(prediction_set), batch_size=<span class="literal">None</span>)</span><br><span class="line"><span class="comment"># .predict() returns an iterator; convert to a list and print predictions</span></span><br><span class="line">predictions = list(itertools.islice(y, <span class="number">6</span>))</span><br><span class="line">print(<span class="string">"Predictions: &#123;&#125;"</span>.format(str(predictions)))</span><br></pre></td></tr></table></figure></p>
<h2>3. å…¶ä»–èµ„æº</h2>
<p>ä¸ºç¥ç»ç½‘ç»œå›å½’å™¨åˆ›å»ºä¸€ä¸ªinput_fnã€‚è¦äº†è§£æœ‰å…³å°†input_fnç”¨äºå…¶ä»–ç±»å‹æ¨¡å‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ä»¥ä¸‹èµ„æºï¼š</p>
<ul>
<li><a href="https://www.tensorflow.org/tutorials/linear" target="_blank" rel="noopener">TensorFlowçš„å¤§è§„æ¨¡çº¿æ€§æ¨¡å‹</a>ï¼šä»‹ç»TensorFlowä¸­çº¿æ€§æ¨¡å‹ï¼Œæä¾›è½¬æ¢è¾“å…¥æ•°æ®çš„ç‰¹å¾åˆ—å’ŒæŠ€æœ¯çš„é«˜çº§æ¦‚è¿°ã€‚</li>
<li><a href="https://www.tensorflow.org/tutorials/wide" target="_blank" rel="noopener">TensorFlowçº¿æ€§æ¨¡å‹æ•™ç¨‹</a>ï¼šFeatureColumnså’Œ input_fnï¼Œçº¿æ€§åˆ†ç±»æ¨¡å‹ï¼Œæ®äººå£è´¢äº§æ™®æŸ¥æ•°æ®é¢„æµ‹æ”¶å…¥èŒƒå›´ã€‚</li>
<li><a href="https://www.tensorflow.org/tutorials/wide_and_deep" target="_blank" rel="noopener">TensorFlow Wideï¼†Deep Learningæ•™ç¨‹</a>ï¼šåŸºäº<a href="https://www.tensorflow.org/tutorials/wide" target="_blank" rel="noopener">çº¿æ€§æ¨¡å‹æ•™ç¨‹</a>ï¼Œæœ¬æ•™ç¨‹æ¶µç›– FeatureColumn å’Œ input_fnï¼Œåˆ›å»ºäº†ä¸€ä¸ªâ€œå®½è€Œæ·±â€çš„æ¨¡å‹ï¼Œå®ƒèåˆäº†ä¸€ä¸ªçº¿æ€§æ¨¡å‹å’Œä½¿ç”¨ DNNLinearCombinedClassifier çš„ç¥ç»ç½‘ç»œ ã€‚</li>
</ul>
<h2>Reference</h2>
<ul>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029487" target="_blank" rel="noopener">ä½¿ç”¨tf.contrib.learnæ„å»ºè¾“å…¥å‡½æ•°</a></li>
<li><a href="http://funhacks.net/2017/02/13/itertools/" target="_blank" rel="noopener">é«˜æ•ˆçš„ itertools æ¨¡å—</a></li>
<li><a href="http://www.cnblogs.com/datablog/p/6127000.html" target="_blank" rel="noopener">pandas.read_csvå‚æ•°æ•´ç†</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-5.1-contrib-learn-Quickstart" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/10/31/tensorflow/tf-5.1-contrib-learn-Quickstart/"><strong>TensorFlow - tf.contrib.learn å¿«é€Ÿå…¥é—¨</strong></a>
      <small class=article-date-index>&nbsp; 2018-10-31</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/10/31/tensorflow/tf-5.1-contrib-learn-Quickstart/" class="article-date">
  <time datetime="2018-10-31T08:10:21.000Z" itemprop="datePublished">2018-10-31</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/10/31/tensorflow/tf-5.1-contrib-learn-Quickstart/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>TensorFlow çš„é«˜çº§æœºå™¨å­¦ä¹ APIï¼ˆtf.contrib.learnï¼‰å¯ä»¥è½»æ¾é…ç½®ï¼Œè®­ç»ƒå’Œè¯„ä¼°å„ç§æœºå™¨å­¦ä¹ æ¨¡å‹ã€‚</p>
<p>ä½¿ç”¨tf.contrib.learnæ„å»º ç¥ç»ç½‘ç»œ åˆ†ç±»å™¨å¹¶åœ¨<strong>Iris</strong>æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒ. åŸºäºèŠ±è¼/èŠ±ç“£å‡ ä½•å½¢çŠ¶æ¥é¢„æµ‹èŠ±ç§ã€‚</p>
<p>&lt;!-- more --&gt;</p>
<p>ä¾ç…§ä»¥ä¸‹äº”ä¸ªæ­¥éª¤ç¼–å†™ä»£ç ï¼š</p>
<ol>
<li>å°†åŒ…å«Irisè®­ç»ƒ/æµ‹è¯•æ•°æ®çš„CSVåŠ è½½åˆ°TensorFlowæ•°æ®é›†ä¸­</li>
<li>æ„å»ºç¥ç»ç½‘ç»œåˆ†ç±»å™¨</li>
<li>ä½¿ç”¨è®­ç»ƒæ•°æ®æ‹Ÿåˆæ¨¡å‹</li>
<li>è¯„ä¼°æ¨¡å‹çš„å‡†ç¡®æ€§</li>
<li>åˆ†ç±»æ–°æ ·æœ¬</li>
</ol>
<h2>1. å®Œæ•´çš„ç¥ç»ç½‘ç»œæºä»£ç </h2>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Data sets</span></span><br><span class="line">IRIS_TRAINING = <span class="string">"iris_training.csv"</span></span><br><span class="line">IRIS_TRAINING_URL = <span class="string">"http://download.tensorflow.org/data/iris_training.csv"</span></span><br><span class="line"></span><br><span class="line">IRIS_TEST = <span class="string">"iris_test.csv"</span></span><br><span class="line">IRIS_TEST_URL = <span class="string">"http://download.tensorflow.org/data/iris_test.csv"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># First download iris_training.csv and iris_test.csv</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load datasets.</span></span><br><span class="line">    training_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">        filename=IRIS_TRAINING,</span><br><span class="line">        target_dtype=np.int,</span><br><span class="line">        features_dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    test_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">        filename=IRIS_TEST,</span><br><span class="line">        target_dtype=np.int,</span><br><span class="line">        features_dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Specify that all features have real-value data</span></span><br><span class="line">    feature_columns = [tf.contrib.layers.real_valued_column(<span class="string">""</span>, dimension=<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Build 3 layer DNN with 10, 20, 10 units respectively.</span></span><br><span class="line">    classifier = tf.contrib.learn.DNNClassifier(feature_columns=feature_columns,</span><br><span class="line">                                                hidden_units=[<span class="number">10</span>, <span class="number">20</span>, <span class="number">10</span>],</span><br><span class="line">                                                n_classes=<span class="number">3</span>,</span><br><span class="line">                                                model_dir=<span class="string">"/tmp/iris_model"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Define the training inputs</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_train_inputs</span><span class="params">()</span>:</span></span><br><span class="line">        x = tf.constant(training_set.data)</span><br><span class="line">        y = tf.constant(training_set.target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fit model.</span></span><br><span class="line">    classifier.fit(input_fn=get_train_inputs, steps=<span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Define the test inputs</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_test_inputs</span><span class="params">()</span>:</span></span><br><span class="line">        x = tf.constant(test_set.data)</span><br><span class="line">        y = tf.constant(test_set.target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line">    <span class="string">'''Evaluate accuracy'''</span> </span><br><span class="line">    <span class="comment"># &#123;'loss': 0.098150678, 'accuracy': 0.96666664, 'global_step': 4000&#125;</span></span><br><span class="line">    accuracy_score = classifier.evaluate(input_fn=get_test_inputs,</span><br><span class="line">                                         steps=<span class="number">1</span>)[<span class="string">"accuracy"</span>]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"\nTest Accuracy: &#123;0:f&#125;\n"</span>.format(accuracy_score))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Classify two new flower samples.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">new_samples</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> np.array(</span><br><span class="line">            [[<span class="number">6.4</span>, <span class="number">3.2</span>, <span class="number">4.5</span>, <span class="number">1.5</span>],</span><br><span class="line">             [<span class="number">5.8</span>, <span class="number">3.1</span>, <span class="number">5.0</span>, <span class="number">1.7</span>]], dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    predictions = list(classifier.predict(input_fn=new_samples))</span><br><span class="line"></span><br><span class="line">    print(</span><br><span class="line">        <span class="string">"New Samples, Class Predictions:    &#123;&#125;\n"</span></span><br><span class="line">            .format(predictions))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<h2>2. å°†Iris CSVæ•°æ®åŠ è½½åˆ°TFä¸­</h2>
<p>è¯¥<a href="https://en.wikipedia.org/wiki/Iris_flower_data_set" target="_blank" rel="noopener">Iris data set</a>åŒ…å«150è¡Œæ•°æ®ï¼ŒåŒ…æ‹¬æ¥è‡ªæ¯ä¸‰ä¸ªç›¸å…³Irisç§ç±»çš„50ä¸ªæ ·å“ï¼š ris setosa, Iris virginica, ä»¥åŠ Iris versicolorã€‚</p>
<p>&lt;img src=&quot;/images/tensorflow/tf-5.1-Iris-data_1.jpg&quot; width=&quot;700&quot; /&gt;</p>
<blockquote>
<p>ä»å·¦åˆ°å³ï¼Œ Iris setosaï¼ˆ Radomilï¼ŒCC BY-SA 3.0ï¼‰ï¼Œ Iris versicolorï¼ˆDlangloisï¼ŒCC BY-SA 3.0ï¼‰å’ŒIris virginicaï¼ˆFrank Mayfieldï¼ŒCC BY-SA 2.0ï¼‰ï¼‰ã€‚</p>
<p>æ¯è¡ŒåŒ…å«æ¯ä¸ªèŠ±æ ·å“çš„ä»¥ä¸‹æ•°æ®ï¼š èŠ±è¼é•¿åº¦ï¼ŒèŠ±è¼å®½åº¦ï¼Œ èŠ±ç“£é•¿åº¦ï¼ŒèŠ±ç“£å®½åº¦å’ŒèŠ±ç§ã€‚èŠ±ç§ä»¥æ•´æ•°è¡¨ç¤ºï¼Œ0è¡¨ç¤ºIris setosaï¼Œ1è¡¨ç¤ºIris versicolorï¼Œ2è¡¨ç¤ºIris virginicaã€‚</p>
</blockquote>
<p>&lt;img src=&quot;/images/tensorflow/tf-5.1-Iris-data_2.jpg&quot; width=&quot;400&quot; /&gt;</p>
<blockquote>
<p>Irisæ•°æ®å·²è¢«éšæœºåˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„CSVï¼š</p>
<ul>
<li>å«120ä¸ªæ ·æœ¬çš„è®­ç»ƒé›†ï¼ˆiris_training.csvï¼‰</li>
<li>å«30ä¸ªæ ·æœ¬çš„æµ‹è¯•é›†ï¼ˆiris_test.csvï¼‰ã€‚</li>
</ul>
</blockquote>
<p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨learn.datasets.baseä¸­çš„<a href="https://www.github.com/tensorflow/tensorflow/blob/r1.1/tensorflow/contrib/learn/python/learn/datasets/base.py" target="_blank" rel="noopener">load_csv_with_header()</a> æ–¹æ³•å°†è®­ç»ƒé›†å’Œæµ‹è¯•é›†åŠ è½½åˆ°datasetsä¸­ã€‚è¯¥load_csv_with_header()æ–¹æ³•éœ€è¦ä¸‰ä¸ªå¿…ä¸å¯å°‘çš„å‚æ•°ï¼š</p>
<ul>
<li>filenameï¼Œå¸¦æœ‰æ–‡ä»¶è·¯å¾„çš„CSVæ–‡ä»¶ã€‚</li>
<li>target_dtypeï¼Œæ•°æ®é›†çš„å½¢å¼ä¸ºnumpy æ•°æ®ç±»å‹ã€‚</li>
<li>features_dtypeï¼Œæ•°æ®ç‰¹å¾é›†çš„å½¢å¼ä¸ºnumpy æ•°æ®ç±»å‹ã€‚</li>
</ul>
<p>åœ¨è¿™é‡Œï¼Œç›®æ ‡ï¼ˆä½ æ­£åœ¨è®­ç»ƒé¢„æµ‹æ¨¡å‹çš„å€¼ï¼‰æ˜¯èŠ±ç§ï¼Œå®ƒæ˜¯0-2çš„æ•´æ•°ï¼Œæ‰€ä»¥é€‚å½“çš„numpyæ•°æ®ç±»å‹æ˜¯np.intï¼š</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Load datasets.</span></span><br><span class="line">training_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">    filename=IRIS_TRAINING,</span><br><span class="line">    target_dtype=np.int,</span><br><span class="line">    features_dtype=np.float32)</span><br><span class="line">    </span><br><span class="line">test_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">    filename=IRIS_TEST,</span><br><span class="line">    target_dtype=np.int,</span><br><span class="line">    features_dtype=np.float32)</span><br></pre></td></tr></table></figure></p>
<p>test_set æ•°æ®å½¢å¼</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">Dataset(</span><br><span class="line">       data=array([</span><br><span class="line">          [ <span class="number">5.9000001</span> ,  <span class="number">3.</span> ,  <span class="number">4.19999981</span>,  <span class="number">1.5</span>],</span><br><span class="line">          [ <span class="number">6.9000001</span> ,  <span class="number">3.0999999</span> ,  <span class="number">5.4000001</span> ,  <span class="number">2.0999999</span> ],</span><br><span class="line">          ......</span><br><span class="line">          [ <span class="number">6.69999981</span>,  <span class="number">3.29999995</span>,  <span class="number">5.69999981</span>,  <span class="number">2.5</span>       ],</span><br><span class="line">          [ <span class="number">6.4000001</span> ,  <span class="number">2.9000001</span> ,  <span class="number">4.30000019</span>,  <span class="number">1.29999995</span>]</span><br><span class="line">       ], dtype=float32), </span><br><span class="line">   		</span><br><span class="line">       target=array(</span><br><span class="line">          [<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>test_set.data æ•°æ®å½¢å¼</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[[ 5.9000001   3.          4.19999981  1.5       ]</span><br><span class="line"> [ 6.9000001   3.0999999   5.4000001   2.0999999 ]</span><br><span class="line"> ......</span><br><span class="line"> [ 6.4000001   2.9000001   4.30000019  1.29999995]]</span><br></pre></td></tr></table></figure></p>
<p>test_set.target æ•°æ®å½¢å¼</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[1 2 0 1 1 1 0 2 1 2 2 0 2 1 1 0 1 0 0 2 0 1 2 1 1 1 0 1 2 1]</span><br></pre></td></tr></table></figure></p>
<p>tf.contrib.learnä¸­çš„datasetsè¢«å‘½åä¸º tuples ; æ‚¨å¯ä»¥é€šè¿‡dataå’Œtarget å±æ€§è®¿é—®ç‰¹å¾æ•°æ®å’Œç›®æ ‡å€¼ã€‚è¿™é‡Œçš„training_set.dataï¼Œtraining_set.targetåŒ…å«è®­ç»ƒé›†çš„ç‰¹å¾æ•°æ®å’Œç›®æ ‡å€¼ï¼Œtest_set.data ï¼Œtest_set.targetåŒ…å«æµ‹è¯•é›†çš„ç‰¹å¾æ•°æ®å’Œç›®æ ‡å€¼ã€‚</p>
<p>åœ¨ â€œåœ¨Irisè®­ç»ƒæ•°æ®ä¸­æ‹ŸåˆDNNCåˆ†ç±»å™¨â€ï¼Œ æ‚¨å°†ä½¿ç”¨training_set.dataå’Œ training_set.targetè®­ç»ƒæ‚¨çš„æ¨¡å‹ï¼Œåœ¨ â€œè¯„ä¼°æ¨¡å‹ç²¾åº¦â€ æ—¶ï¼Œæ‚¨å°†ä½¿ç”¨test_set.dataå’Œ test_set.targetã€‚</p>
<h2>3. æ„å»ºæ·±å±‚ç¥ç»ç½‘ç»œåˆ†ç±»å™¨</h2>
<p>tf.contrib.learnæä¾›äº†å„ç§é¢„å®šä¹‰çš„æ¨¡å‹ï¼Œç§°ä¸º <a href="https://www.tensorflow.org/api_guides/python/contrib.learn#estimators" target="_blank" rel="noopener">Estimators</a>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨â€œout of the boxâ€æ–¹å¼å¯¹æ•°æ®è¿›è¡Œè®­ç»ƒå’Œè¯„ä¼°æ“ä½œã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæ‚¨å°†é…ç½®æ·±å±‚ç¥ç»ç½‘ç»œåˆ†ç±»å™¨æ¨¡å‹ä»¥æ‹ŸåˆIrisæ•°æ®ã€‚åˆ©ç”¨tf.contrib.learnï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‡ è¡Œä»£ç å®ä¾‹åŒ–<a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/DNNClassifier" target="_blank" rel="noopener">tf.contrib.learn.DNNClassifier</a>ï¼š</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Specify that all features have real-value data</span></span><br><span class="line">feature_columns = [tf.contrib.layers.real_valued_column(<span class="string">""</span>, dimension=<span class="number">4</span>)]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Build 3 layer DNN with 10, 20, 10 units respectively.</span></span><br><span class="line">classifier = tf.contrib.learn.DNNClassifier(feature_columns=feature_columns,</span><br><span class="line">                                            hidden_units=[<span class="number">10</span>, <span class="number">20</span>, <span class="number">10</span>],</span><br><span class="line">                                            n_classes=<span class="number">3</span>,</span><br><span class="line">                                            model_dir=<span class="string">"/tmp/iris_model"</span>)</span><br></pre></td></tr></table></figure></p>
<h3>3.1 feature_columns å½¢å¼</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[_RealValuedColumn(column_name=<span class="string">''</span>, dimension=4, default_value=None, dtype=tf.float32, normalizer=None)]</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä»£ç é¦–å…ˆå®šä¹‰äº†æ¨¡å‹çš„ç‰¹å¾åˆ—ï¼Œå®ƒä»¬æŒ‡å®šæ•°æ®é›†ä¸­çš„ç‰¹å¾æ•°æ®ç±»å‹ã€‚æ‰€æœ‰çš„ç‰¹å¾æ•°æ®æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥tf.contrib.layers.real_valued_columnä½¿ç”¨ç›¸åº”çš„å‡½æ•°æ¥æ„é€ ç‰¹å¾åˆ—ã€‚æ•°æ®é›†ä¸­æœ‰å››ä¸ªç‰¹å¾ï¼ˆèŠ±è¼å®½åº¦ï¼ŒèŠ±è¼é«˜åº¦ï¼ŒèŠ±ç“£å®½åº¦å’ŒèŠ±ç“£é«˜åº¦ï¼‰ï¼Œå› æ­¤dimension å¿…é¡»è®¾ç½®ä¸º4ä¿å­˜æ‰€æœ‰æ•°æ®ã€‚</p>
<h3>3.2 classifier å½¢å¼</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DNNClassifier(params=&#123;</span><br><span class="line"><span class="string">'head'</span>: &lt;tensorflow.contrib.learn.python.learn.estimators.head._MultiClassHead object at 0x1089c0c18&gt;, </span><br><span class="line"><span class="string">'hidden_units'</span>: [10, 20, 10], </span><br><span class="line"><span class="string">'feature_columns'</span>: (_RealValuedColumn(column_name=<span class="string">''</span>, dimension=4, default_value=None, dtype=tf.float32, normalizer=None),), </span><br><span class="line"><span class="string">'optimizer'</span>: None, </span><br><span class="line"><span class="string">'activation_fn'</span>: &lt;<span class="keyword">function</span> relu at 0x11590ad08&gt;, </span><br><span class="line"><span class="string">'dropout'</span>: None, </span><br><span class="line"><span class="string">'gradient_clip_norm'</span>: None, </span><br><span class="line"><span class="string">'embedding_lr_multipliers'</span>: None, </span><br><span class="line"><span class="string">'input_layer_min_slice_size'</span>: None&#125;)</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åï¼Œä»£ç ä½¿ç”¨ä»¥ä¸‹å‚æ•°åˆ›å»ºä¸€ä¸ªDNNClassifieræ¨¡å‹ï¼š</p>
<ul>
<li>feature_columns=feature_columnsã€‚ä¸Šé¢å®šä¹‰çš„ç‰¹å¾åˆ—é›†åˆã€‚</li>
<li>hidden_units=[10, 20, 10]ã€‚ä¸‰ä¸ªéšå«å±‚ï¼Œåˆ†åˆ«å«æœ‰10,20å’Œ10ä¸ªç¥ç»å…ƒã€‚</li>
<li>n_classes=3ã€‚ä¸‰ä¸ªç›®æ ‡ç±»åˆ«ï¼Œä»£è¡¨ä¸‰ç§Irisç‰©ç§ã€‚</li>
<li>model_dir=/tmp/iris_modelã€‚TensorFlowå°†åœ¨æ¨¡å‹è®­ç»ƒæœŸé—´ä¿å­˜æ£€æŸ¥ç‚¹æ•°æ®çš„ç›®å½•ã€‚æœ‰å…³ä½¿ç”¨TensorFlowè¿›è¡Œæ—¥å¿—è®°å½•å’Œç›‘è§†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Logging and Monitoring Basics with tf.contrib.learn.ã€‚</li>
</ul>
<h2>4. è®­ç»ƒçš„è¾“å…¥æµ</h2>
<p>tf.contrib.learnAPIä½¿ç”¨è¾“å…¥å‡½æ•°ï¼Œåˆ›å»ºä¸ºæ¨¡å‹ç”Ÿæˆæ•°æ®çš„TensorFlowæ“ä½œã€‚æœ¬ä¾‹ä¸­ï¼Œæ•°æ®è¶³å¤Ÿå°ï¼Œå¯ä»¥TensorFlow constants å­˜å‚¨ã€‚ä»¥ä¸‹ä»£ç ç”Ÿæˆæœ€ç®€å•çš„è¾“å…¥ï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Define the test inputs</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_train_inputs</span><span class="params">()</span>:</span></span><br><span class="line">  x = tf.constant(training_set.data)</span><br><span class="line">  y = tf.constant(training_set.target)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> x, y</span><br></pre></td></tr></table></figure></p>
<h2>5. åœ¨Irisè®­ç»ƒæ•°æ®ä¸Šæ‹ŸåˆDNNåˆ†ç±»å™¨</h2>
<p>ç°åœ¨æ‚¨å·²ç»é…ç½®äº†DNN classifieræ¨¡å‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥<a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/BaseEstimator#fit" target="_blank" rel="noopener">fit</a>æ–¹æ³•å°†å…¶æ‹ŸåˆIrisè®­ç»ƒæ•°æ®ã€‚å°†get_train_inputsä¼ é€’ç»™input_fnï¼ŒæŒ‡å®šè®­ç»ƒçš„æ­¥éª¤ï¼ˆè¿™é‡Œå–2000ï¼‰ï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fit model.</span></span><br><span class="line">classifier.fit(input_fn=get_train_inputs, steps=<span class="number">2000</span>)</span><br></pre></td></tr></table></figure></p>
<p>æ¨¡å‹çš„çŠ¶æ€ä¿ç•™åœ¨classifierï¼Œè¿™æ„å‘³ç€å¦‚æœä½ å–œæ¬¢ï¼Œä½ å¯ä»¥åˆ†å¸ƒè®­ç»ƒã€‚ä¾‹å¦‚ï¼Œä»¥ä¸Šä»£ç ç›¸å½“äºï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">classifier.fit(x=training_set.data, y=training_set.target, steps=<span class="number">1000</span>)</span><br><span class="line">classifier.fit(x=training_set.data, y=training_set.target, steps=<span class="number">1000</span>)</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å¸Œæœ›åœ¨è®­ç»ƒæ—¶è·Ÿè¸ªæ¨¡å‹ï¼Œåˆ™å¯èƒ½éœ€è¦ä½¿ç”¨TensorFlow <a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/monitors" target="_blank" rel="noopener">monitor</a> æ¥æ‰§è¡Œæ—¥å¿—è®°å½•æ“ä½œã€‚æœ‰å…³æ­¤ä¸»é¢˜çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…
â€œLogging and Monitoring Basics with tf.contrib.learnâ€æ•™ç¨‹ ã€‚</p>
<h2>6. è¯„ä¼°æ¨¡å‹ç²¾åº¦</h2>
<p>æ‚¨å·²ç»åœ¨Irisè®­ç»ƒæ•°æ®ä¸Šæ‹ŸåˆDNNClassifieræ¨¡å‹; ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥<a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/BaseEstimator#evaluate" target="_blank" rel="noopener">evaluate</a>æ–¹æ³•æ£€æŸ¥å…¶å¯¹Irisæµ‹è¯•æ•°æ®çš„å‡†ç¡®æ€§ ã€‚æ­£å¦‚fitï¼Œ evaluateéœ€è¦ä¸€ä¸ªæ„å»ºå…¶è¾“å…¥æ¸ é“çš„è¾“å…¥å‡½æ•°ã€‚evaluate è¿”å›ä¸€ä¸ªè¯„ä¼°ç»“æœdictã€‚ä¸‹é¢çš„ä»£ç é€šè¿‡Irisæµ‹è¯•æ•°æ®- test_set.dataå’Œtest_set.targetè¿›è¡Œevaluateå¹¶æ‰“å°ç»“æœçš„ç²¾åº¦ï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Define the test inputs</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_test_inputs</span><span class="params">()</span>:</span></span><br><span class="line">  x = tf.constant(test_set.data)</span><br><span class="line">  y = tf.constant(test_set.target)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> x, y</span><br><span class="line"> </span><br><span class="line"><span class="string">'''Evaluate accuracy.'''</span> </span><br><span class="line"><span class="comment"># &#123;'loss': 0.098150678, 'accuracy': 0.96666664, 'global_step': 4000&#125;</span></span><br><span class="line">accuracy_score = classifier.evaluate(input_fn=get_test_inputs,</span><br><span class="line">                                     steps=<span class="number">1</span>)[<span class="string">"accuracy"</span>]</span><br><span class="line"> </span><br><span class="line">print(<span class="string">"\nTest Accuracy: &#123;0:f&#125;\n"</span>.format(accuracy_score))</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼šè¿™é‡Œçš„stepså‚æ•°å¯¹evaluateå¾ˆé‡è¦ã€‚ evaluateç›´åˆ°å®ƒåˆ°è¾¾è¾“å…¥çš„æœ«å°¾æ‰åœæ­¢è¿è¡Œã€‚</p>
<h2>7. åˆ†ç±»æ–°æ ·æœ¬</h2>
<p>ä½¿ç”¨estimatorçš„predict()æ–¹æ³•å¯¹æ–°æ ·æœ¬è¿›è¡Œåˆ†ç±»ã€‚ä¾‹å¦‚ï¼Œè¯´ä½ æœ‰è¿™ä¸¤ä¸ªæ–°çš„èŠ±æœµæ ·ä¾‹ï¼š</p>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Classify two new flower samples.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_samples</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">return</span> np.array(</span><br><span class="line">    [[<span class="number">6.4</span>, <span class="number">3.2</span>, <span class="number">4.5</span>, <span class="number">1.5</span>],</span><br><span class="line">     [<span class="number">5.8</span>, <span class="number">3.1</span>, <span class="number">5.0</span>, <span class="number">1.7</span>]], dtype=np.float32)</span><br><span class="line"> </span><br><span class="line">predictions = list(classifier.predict(input_fn=new_samples))</span><br><span class="line"> </span><br><span class="line">print(</span><br><span class="line">    <span class="string">"New Samples, Class Predictions:    &#123;&#125;\n"</span></span><br><span class="line">    .format(predictions))</span><br></pre></td></tr></table></figure></p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨è¯¥predict()æ–¹æ³•é¢„æµ‹å…¶ç‰©ç§ã€‚predictè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬æ¢æˆä¸€ä¸ªåˆ—è¡¨ã€‚ä»¥ä¸‹ä»£ç å–å¾—å¹¶æ‰“å°åˆ†ç±»çš„é¢„æµ‹ç»“æœï¼š</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">New Samples, Class Predictions:    [1 2]</span><br></pre></td></tr></table></figure></p>
<h2>8. å…¶ä»–èµ„æº</h2>
<ul>
<li>å…¶ä»–èµ„æºæœ‰å…³tf.contrib.learnçš„æ›´å¤šå‚è€ƒèµ„æ–™ï¼Œè¯·å‚é˜…å®˜æ–¹ <a href="https://www.tensorflow.org/api_guides/python/contrib.learn" target="_blank" rel="noopener">APIæ–‡æ¡£</a>ã€‚</li>
<li>æœ‰å…³ä½¿ç”¨tf.contrib.learnåˆ›å»ºçº¿æ€§æ¨¡å‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://www.tensorflow.org/tutorials/linear" target="_blank" rel="noopener">Large-scale Linear Models with TensorFlow.</a></li>
<li>è¦ä½¿ç”¨tf.contrib.learn APIæ„å»ºè‡ªå·±çš„Estimatorï¼Œè¯·æŸ¥çœ‹åœ¨ <a href="https://www.tensorflow.org/extend/estimators" target="_blank" rel="noopener">tf.contrib.learnä¸­åˆ›å»ºä¼°è®¡å™¨</a>ã€‚</li>
<li>è¦åœ¨æµè§ˆå™¨ä¸­å®éªŒç¥ç»ç½‘ç»œå»ºæ¨¡å’Œå¯è§†åŒ–ï¼Œè¯·æŸ¥çœ‹<a href="http://playground.tensorflow.org/" target="_blank" rel="noopener">Deep Playground</a>ã€‚</li>
<li>æœ‰å…³ç¥ç»ç½‘ç»œçš„æ›´å¤šé«˜çº§æ•™ç¨‹ï¼Œè¯·å‚é˜… <a href="https://www.tensorflow.org/tutorials/images/deep_cnn" target="_blank" rel="noopener">å·ç§¯ç¥ç»ç½‘ç»œ</a>å’Œ<a href="https://www.tensorflow.org/tutorials/sequences/recurrent" target="_blank" rel="noopener">å¾ªç¯ç¥ç»ç½‘ç»œ</a>ã€‚</li>
</ul>
<h2>Reference</h2>
<ul>
<li><a href="http://mli.github.io/gpu/2016/01/17/build-gpu-clusters/" target="_blank" rel="noopener">GPUé›†ç¾¤æŠ˜è…¾æ‰‹è®°â€”â€”2015</a></li>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029485" target="_blank" rel="noopener">TensorFlow R1.2 ä¸­æ–‡æ–‡æ¡£</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-metrics_learn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/10/23/tensorflow/tf-metrics_learn/"><strong>Tensorflow è¸©å‘è®°ä¹‹ tf.metrics</strong></a>
      <small class=article-date-index>&nbsp; 2018-10-23</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/10/23/tensorflow/tf-metrics_learn/" class="article-date">
  <time datetime="2018-10-23T08:10:21.000Z" itemprop="datePublished">2018-10-23</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/10/23/tensorflow/tf-metrics_learn/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>æ€»ç»“ä¸€ä¸‹ tf.metrics é‡åˆ°çš„ä¸€äº›å‘ã€‚</p>
<p>&lt;!-- more --&gt;</p>
<p><strong>ç²¾ç¡®ç‡çš„è®¡ç®—å…¬å¼</strong></p>
<h2>Reference</h2>
<ul>
<li><a href="https://blog.csdn.net/qq_37747262/article/details/82223155" target="_blank" rel="noopener">Tensorflowè¸©å‘è®°ä¹‹tf.metrics</a></li>
<li><a href="https://github.com/blair101/tensorflow_metrics_learn/blob/master/tensorflow_metrics_learn.ipynb" target="_blank" rel="noopener">TensorFlow Github tf.metrics å®è·µ</a></li>
<li><a href="http://ronny.rest/blog/post_2017_09_11_tf_metrics/" target="_blank" rel="noopener">Ronny Restrepo - tf.metrics.accuracy()è®²è§£æ»´å¾ˆæ¸…æ¥š</a></li>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029489" target="_blank" rel="noopener">ApacheCN å¼€æºç»„ç»‡ tf.contrib.learnåŸºç¡€çš„è®°å½•å’Œç›‘æ§æ•™ç¨‹</a></li>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029377" target="_blank" rel="noopener">ApacheCN å¼€æºç»„ç»‡ TensorFlowå…¥é—¨</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-app_run_&amp;_tf_flags" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/10/23/tensorflow/tf-app_run_&_tf_flags/"><strong>Tensorflow tf.app.run()ä¸å‘½ä»¤è¡Œå‚æ•°è§£æ</strong></a>
      <small class=article-date-index>&nbsp; 2018-10-23</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/10/23/tensorflow/tf-app_run_&_tf_flags/" class="article-date">
  <time datetime="2018-10-23T05:10:21.000Z" itemprop="datePublished">2018-10-23</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/10/23/tensorflow/tf-app_run_&_tf_flags/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>tf.app.run() ä¸ å‘½ä»¤è¡Œå‚æ•°è§£æ tf.flags</p>
<p>&lt;!-- more --&gt;</p>
<p>é¦–å…ˆç»™å‡ºä¸€æ®µå¸¸è§çš„ä»£ç ï¼š</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    tf.app.run()</span><br></pre></td></tr></table></figure></p>
<p>æ‰¾åˆ° Tensorflow ä¸­å…³äºä¸Šè¿° å‡½æ•°<code>run()</code> çš„æºç ï¼š</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(main=None, argv=None)</span>:</span></span><br><span class="line">  <span class="string">"""Runs the program with an optional 'main' function and 'argv' list."""</span></span><br><span class="line">  f = flags.FLAGS</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Extract the args from the optional `argv` list.</span></span><br><span class="line">  args = argv[<span class="number">1</span>:] <span class="keyword">if</span> argv <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Parse the known flags from that list, or from the command</span></span><br><span class="line">  <span class="comment"># line otherwise.</span></span><br><span class="line">  <span class="comment"># pylint: disable=protected-access</span></span><br><span class="line">  flags_passthrough = f._parse_flags(args=args)</span><br><span class="line">  <span class="comment"># pylint: enable=protected-access</span></span><br><span class="line"></span><br><span class="line">  main = main <span class="keyword">or</span> _sys.modules[<span class="string">'__main__'</span>].main</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Call the main function, passing through any arguments</span></span><br><span class="line">  <span class="comment"># to the final program.</span></span><br><span class="line">  _sys.exit(main(_sys.argv[:<span class="number">1</span>] + flags_passthrough))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_allowed_symbols = [</span><br><span class="line">    <span class="string">'run'</span>,</span><br><span class="line">    <span class="comment"># Allowed submodule.</span></span><br><span class="line">    <span class="string">'flags'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">remove_undocumented(__name__, _allowed_symbols)</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°æºç ä¸­çš„è¿‡ç¨‹æ˜¯é¦–å…ˆåŠ è½½ <code>flags</code> çš„å‚æ•°é¡¹ï¼Œç„¶åæ‰§è¡Œ <code>main</code> å‡½æ•°ã€‚å‚æ•°æ˜¯ä½¿ç”¨<code>tf.app.flags.FLAGS</code> å®šä¹‰çš„ã€‚</p>
<h2>tf.app.flags.FLAGS</h2>
<p>å…³äº <code>tf.app.flags.FLAGS</code> çš„ä½¿ç”¨ï¼š</p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># fila_name: temp.py</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">FLAGS = tf.app.flags.FLAGS</span><br><span class="line"></span><br><span class="line">tf.app.flags.DEFINE_string(<span class="string">'string'</span>, <span class="string">'train'</span>, <span class="string">'This is a string'</span>)</span><br><span class="line">tf.app.flags.DEFINE_float(<span class="string">'learning_rate'</span>, <span class="number">0.001</span>, <span class="string">'This is the rate in training'</span>)</span><br><span class="line">tf.app.flags.DEFINE_boolean(<span class="string">'flag'</span>, <span class="literal">True</span>, <span class="string">'This is a flag'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'string: '</span>, FLAGS.string)</span><br><span class="line">print(<span class="string">'learning_rate: '</span>, FLAGS.learning_rate)</span><br><span class="line">print(<span class="string">'flag: '</span>, FLAGS.flag)</span><br></pre></td></tr></table></figure></p>
<p>è¾“å‡ºï¼š</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(<span class="string">'string: '</span>, <span class="string">'train'</span>)</span><br><span class="line">(<span class="string">'learning_rate: '</span>, 0.001)</span><br><span class="line">(<span class="string">'flag: '</span>, True)</span><br></pre></td></tr></table></figure></p>
<h2>Reference</h2>
<ul>
<li><a href="https://blog.csdn.net/TwT520Ly/article/details/79759448" target="_blank" rel="noopener">tf.app.run()ä¸å‘½ä»¤è¡Œå‚æ•°è§£æ</a></li>
<li><a href="https://blog.csdn.net/spring_willow/article/details/80111993" target="_blank" rel="noopener">TensorFlowä¸­çš„å°çŸ¥è¯†ï¼štf.flags.DEFINE_xxx()</a></li>
<li><a href="https://www.jianshu.com/p/7ccfe8cf4aa1" target="_blank" rel="noopener">Tensorflow 1.0ï¼šè€å¸æœºç«‹ä¸‹çš„Flag</a></li>
<li><a href="https://blog.csdn.net/yanqianglifei/article/details/83020992" target="_blank" rel="noopener">Tensorflowæ•™ç¨‹(åå››) å‘½ä»¤è¡Œå‚æ•°tf.flagsçš„ä½¿ç”¨</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-seq2seq" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/10/15/tensorflow/tf-seq2seq/"><strong>ä» Encoder åˆ° Decoder å®ç° Seq2Seq æ¨¡å‹</strong></a>
      <small class=article-date-index>&nbsp; 2018-10-15</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/10/15/tensorflow/tf-seq2seq/" class="article-date">
  <time datetime="2018-10-15T05:10:21.000Z" itemprop="datePublished">2018-10-15</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/10/15/tensorflow/tf-seq2seq/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>ç®€å•çš„ Seq2Seq å®ç°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ TensorFlow æ¥å®ç°ä¸ªåŸºç¡€ç‰ˆçš„ Seq2Seqï¼Œä¸»è¦å¸®åŠ©ç†è§£ Seq2Seq ä¸­çš„åŸºç¡€æ¶æ„ã€‚</p>
<p>&lt;!-- more --&gt;</p>
<p>&lt;img src=&quot;/images/tensorflow/tf-nlp-seq2seq.jpg&quot; width=&quot;800&quot; /&gt;</p>
<p>è‡ªå·±åšäº†ä¸€ä¸ªç¤ºæ„å›¾ï¼Œå¸Œæœ›å¸®åŠ©åˆå­¦è€…æ›´å¥½åœ°ç†è§£.</p>
<h2>Reference</h2>
<ul>
<li><a href="https://coolshell.cn/articles/17583.html" target="_blank" rel="noopener">æŠ€æœ¯äººå‘˜çš„å‘å±•ä¹‹è·¯</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/27608348" target="_blank" rel="noopener">ä» Encoder åˆ° Decoder å®ç° Seq2Seq æ¨¡å‹</a></li>
<li><a href="https://github.com/NELSONZHAO/zhihu/tree/master/basic_seq2seq?1521452873816" target="_blank" rel="noopener">zhihu/basic_seq2seq/</a></li>
<li><a href="https://www.zhihu.com/question/41949741" target="_blank" rel="noopener">éš”å£å°ç‹ LSTM ç¥ç»ç½‘ç»œè¾“å…¥è¾“å‡ºç©¶ç«Ÿæ˜¯æ€æ ·çš„ï¼Ÿ</a></li>
<li><a href="https://colab.research.google.com" target="_blank" rel="noopener">colab.research.google</a></li>
<li><a href="https://zh.gluon.ai/" target="_blank" rel="noopener">zh.gluon.ai åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ </a></li>
<li><a href="http://discuss.gluon.ai/" target="_blank" rel="noopener">discuss.gluon.ai è®ºå›</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-mnist-1-beginners" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2018/10/04/tensorflow/tf-mnist-1-beginners/"><strong>ç®€å•å‰é¦ˆç½‘ç»œå®ç° mnist åˆ†ç±»</strong></a>
      <small class=article-date-index>&nbsp; 2018-10-04</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/10/04/tensorflow/tf-mnist-1-beginners/" class="article-date">
  <time datetime="2018-10-04T13:10:21.000Z" itemprop="datePublished">2018-10-04</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/10/04/tensorflow/tf-mnist-1-beginners/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªéå¸¸ç®€å•çš„ä¸¤å±‚ FC å…¨è¿æ¥ç½‘ç»œæ¥å®Œæˆ MNISTæ•°æ® çš„åˆ†ç±»</p>
<p>&lt;!-- more --&gt;</p>
<p>è¾“å…¥ [-1,28*28]ï¼Œ FC1 æœ‰ 1024 ä¸ªneuronsï¼Œ FC2 æœ‰ 10 ä¸ªneuronsã€‚</p>
<blockquote>
<p>è¿™ä¹ˆç®€å•çš„ä¸€ä¸ªå…¨è¿æ¥ç½‘ç»œï¼Œç»“æœæµ‹è¯•å‡†ç¡®ç‡è¾¾åˆ°äº† 0.98ã€‚è¿˜æ˜¯éå¸¸æ£’çš„ï¼ï¼ï¼</p>
<p>MNIST æ•°æ®é›† åŒ…å«äº† 60000 å¼ å›¾ç‰‡æ¥ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œ10000 å¼ å›¾ç‰‡ä½œä¸ºæµ‹è¯•æ•°æ®ã€‚æ¯å¼ å›¾ç‰‡éƒ½ä»£è¡¨äº† 0~9 ä¸­çš„ä¸€ä¸ªæ•°å­—ã€‚å›¾ç‰‡å¤§å°éƒ½ä¸º 28*28ï¼Œå¤„ç†åçš„æ¯å¼ å›¾ç‰‡æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 784 çš„ä¸€ç»´æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ å¯¹åº”å›¾ç‰‡åƒç´ çŸ©é˜µæä¾›ç»™ç¥ç»ç½‘ç»œçš„è¾“å…¥å±‚ï¼Œåƒç´ çŸ©é˜µä¸­å…ƒç´ çš„å–å€¼èŒƒå›´ [0, 1]ï¼Œ å®ƒä»£è¡¨äº†é¢œè‰²çš„æ·±æµ…ã€‚å…¶ä¸­ 0 è¡¨ç¤ºç™½è‰²èƒŒæ™¯(background)ï¼Œ1 è¡¨ç¤ºé»‘è‰²å‰æ™¯(foreground)ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ï¼Œ input_data.read_data_sets å‡½æ•°ç”Ÿæˆçš„ç±»è¿˜æä¾›äº† mnist.train.next.batch å‡½æ•°ï¼Œå®ƒå¯ä»¥ä»æ‰€æœ‰è®­ç»ƒæ•°æ®ä¸­è¯»å–ä¸€å°éƒ¨åˆ†ä½œä¸ºä¸€ä¸ªè®­ç»ƒ batchã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">MNIST æ•°æ®ä¸‹è½½åœ°å€å’Œå†…å®¹</th>
<th style="text-align:center">å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Extracting MNIST_data/train-images-idx3-ubyte.gz</td>
<td style="text-align:center">è®­ç»ƒæ•°æ®å›¾ç‰‡</td>
</tr>
<tr>
<td style="text-align:center">Extracting MNIST_data/train-labels-idx1-ubyte.gz</td>
<td style="text-align:center">è®­ç»ƒæ•°æ®ç­”æ¡ˆ</td>
</tr>
<tr>
<td style="text-align:center">Extracting MNIST_data/t10k-images-idx3-ubyte.gz</td>
<td style="text-align:center">æµ‹è¯•æ•°æ®å›¾ç‰‡</td>
</tr>
<tr>
<td style="text-align:center">Extracting MNIST_data/t10k-labels-idx1-ubyte.gz</td>
<td style="text-align:center">æµ‹è¯•æ•°æ®ç­”æ¡ˆ</td>
</tr>
</tbody>
</table>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æŒ‰éœ€ä½¿ç”¨ GPU</span></span><br><span class="line">config = tf.ConfigProto()</span><br><span class="line">config.gpu_options.allow_growth = <span class="literal">True</span></span><br><span class="line">sess = tf.InteractiveSession(config=config)</span><br></pre></td></tr></table></figure></p>
<h2>1. å¯¼å…¥æ•°æ®</h2>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”¨tensorflow å¯¼å…¥æ•°æ®</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># input_data.read_data_sets è‡ªåŠ¨å°† MNIST æ•°æ®é›†åˆ’åˆ†ä¸º trainã€validationã€test ä¸‰ä¸ªæ•°æ®é›†</span></span><br><span class="line">mnist = input_data.read_data_sets(<span class="string">'MNIST_data'</span>, one_hot=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># train é›†åˆæœ‰ 55000 å¼ å›¾ç‰‡</span></span><br><span class="line"><span class="comment"># validation é›†åˆæœ‰ 5000 å¼ å›¾ç‰‡</span></span><br><span class="line"><span class="comment"># test é›†åˆæœ‰ 10000 å¼ å›¾ç‰‡ï¼Œå›¾ç‰‡æ¥è‡ª MNIST æä¾›çš„æµ‹è¯•æ•°æ®é›†</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'training data shape '</span>, mnist.train.images.shape)</span><br><span class="line">print(<span class="string">'training label shape '</span>, mnist.train.labels.shape)</span><br><span class="line"></span><br><span class="line"><span class="comment"># training data shape  (55000, 784)</span></span><br><span class="line"><span class="comment"># training label shape  (55000, 10)</span></span><br></pre></td></tr></table></figure></p>
<h2>2. æ„å»ºç½‘ç»œ</h2>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æƒå€¼åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">weight_variable</span><span class="params">(shape)</span>:</span></span><br><span class="line">    <span class="comment"># ç”¨æ­£æ€åˆ†å¸ƒæ¥åˆå§‹åŒ–æƒå€¼</span></span><br><span class="line">    initial = tf.truncated_normal(shape, stddev=<span class="number">0.1</span>)</span><br><span class="line">    <span class="keyword">return</span> tf.Variable(initial)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bias_variable</span><span class="params">(shape)</span>:</span></span><br><span class="line">    <span class="comment"># æœ¬ä¾‹ä¸­ç”¨reluæ¿€æ´»å‡½æ•°ï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªå¾ˆå°çš„æ­£åç½®è¾ƒå¥½</span></span><br><span class="line">    initial = tf.constant(<span class="number">0.1</span>, shape=shape)</span><br><span class="line">    <span class="keyword">return</span> tf.Variable(initial)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># input_layer</span></span><br><span class="line">X_ = tf.placeholder(tf.float32, [<span class="literal">None</span>, <span class="number">784</span>])</span><br><span class="line">y_ = tf.placeholder(tf.float32, [<span class="literal">None</span>, <span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># FC1</span></span><br><span class="line">W_fc1 = weight_variable([<span class="number">784</span>, <span class="number">1024</span>])</span><br><span class="line">b_fc1 = bias_variable([<span class="number">1024</span>])</span><br><span class="line">h_fc1 = tf.nn.relu(tf.matmul(X_, W_fc1) + b_fc1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># FC2</span></span><br><span class="line">W_fc2 = weight_variable([<span class="number">1024</span>, <span class="number">10</span>])</span><br><span class="line">b_fc2 = bias_variable([<span class="number">10</span>])</span><br><span class="line">y_pre = tf.nn.softmax(tf.matmul(h_fc1, W_fc2) + b_fc2)</span><br></pre></td></tr></table></figure></p>
<h2>3. è®­ç»ƒå’Œè¯„ä¼°</h2>
<p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.æŸå¤±å‡½æ•°ï¼šcross_entropy</span></span><br><span class="line">cross_entropy = -tf.reduce_sum(y_ * tf.log(y_pre))</span><br><span class="line"><span class="comment"># 2.ä¼˜åŒ–å‡½æ•°ï¼šAdamOptimizer, ä¼˜åŒ–é€Ÿåº¦è¦æ¯” GradientOptimizer å¿«å¾ˆå¤š</span></span><br><span class="line">train_step = tf.train.AdamOptimizer(<span class="number">0.001</span>).minimize(cross_entropy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.é¢„æµ‹ç»“æœè¯„ä¼°</span></span><br><span class="line"><span class="comment">#ã€€é¢„æµ‹å€¼ä¸­æœ€å¤§å€¼ï¼ˆï¼‘ï¼‰å³åˆ†ç±»ç»“æœï¼Œæ˜¯å¦ç­‰äºåŸå§‹æ ‡ç­¾ä¸­çš„ï¼ˆï¼‘ï¼‰çš„ä½ç½®ã€‚argmax()å–æœ€å¤§å€¼æ‰€åœ¨çš„ä¸‹æ ‡</span></span><br><span class="line">correct_prediction = tf.equal(tf.argmax(y_pre, <span class="number">1</span>), tf.arg_max(y_, <span class="number">1</span>))  </span><br><span class="line">accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹è¿è¡Œ</span></span><br><span class="line">sess.run(tf.global_variables_initializer())</span><br><span class="line"><span class="comment"># è¿™å¤§æ¦‚è¿­ä»£äº†ä¸åˆ° 10 ä¸ª epochï¼Œ è®­ç»ƒå‡†ç¡®ç‡å·²ç»è¾¾åˆ°äº†0.98</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5000</span>):</span><br><span class="line">    X_batch, y_batch = mnist.train.next_batch(batch_size=<span class="number">100</span>)</span><br><span class="line">    train_step.run(feed_dict=&#123;X_: X_batch, y_: y_batch&#125;)</span><br><span class="line">    <span class="keyword">if</span> (i+<span class="number">1</span>) % <span class="number">200</span> == <span class="number">0</span>:</span><br><span class="line">        train_accuracy = accuracy.eval(feed_dict=&#123;X_: mnist.train.images, y_: mnist.train.labels&#125;)</span><br><span class="line">        print(<span class="string">"step %d, training acc %g"</span> % (i+<span class="number">1</span>, train_accuracy))</span><br><span class="line">    <span class="keyword">if</span> (i+<span class="number">1</span>) % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">        test_accuracy = accuracy.eval(feed_dict=&#123;X_: mnist.test.images, y_: mnist.test.labels&#125;)</span><br><span class="line">        print(<span class="string">"= "</span> * <span class="number">10</span>, <span class="string">"step %d, testing acc %g"</span> % (i+<span class="number">1</span>, test_accuracy))</span><br></pre></td></tr></table></figure></p>
<p><strong>Output:</strong></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">step 200, training acc 0.937364</span><br><span class="line">step 400, training acc 0.965818</span><br><span class="line">step 600, training acc 0.973364</span><br><span class="line">step 800, training acc 0.977709</span><br><span class="line">step 1000, training acc 0.981528</span><br><span class="line">= = = = = = = = = =  step 1000, testing acc 0.9688</span><br><span class="line">step 1200, training acc 0.988437</span><br><span class="line">step 1400, training acc 0.988728</span><br><span class="line">step 1600, training acc 0.987491</span><br><span class="line">step 1800, training acc 0.993873</span><br><span class="line">step 2000, training acc 0.992527</span><br><span class="line">= = = = = = = = = =  step 2000, testing acc 0.9789</span><br><span class="line">step 2200, training acc 0.995309</span><br><span class="line">step 2400, training acc 0.995455</span><br><span class="line">step 2600, training acc 0.9952</span><br><span class="line">step 2800, training acc 0.996073</span><br><span class="line">step 3000, training acc 0.9964</span><br><span class="line">= = = = = = = = = =  step 3000, testing acc 0.9778</span><br><span class="line">step 3200, training acc 0.996709</span><br><span class="line">step 3400, training acc 0.998109</span><br><span class="line">step 3600, training acc 0.997455</span><br><span class="line">step 3800, training acc 0.995055</span><br><span class="line">step 4000, training acc 0.997291</span><br><span class="line">= = = = = = = = = =  step 4000, testing acc 0.9808</span><br><span class="line">step 4200, training acc 0.997746</span><br><span class="line">step 4400, training acc 0.996073</span><br><span class="line">step 4600, training acc 0.998564</span><br><span class="line">step 4800, training acc 0.997946</span><br><span class="line">step 5000, training acc 0.998673</span><br><span class="line">= = = = = = = = = =  step 5000, testing acc 0.98</span><br></pre></td></tr></table></figure></p>
<h2>Reference</h2>
<ul>
<li><a href="https://blog.csdn.net/jerr__y/article/category/6747409" target="_blank" rel="noopener">å¤§å­¦ä¹‹é“ï¼Œåœ¨æ˜æ˜å¾· æ°¸æ°¸å¤œ Tensorflowå­¦ä¹ ä¹‹è·¯</a></li>
<li><a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-c1ov28so.html" target="_blank" rel="noopener">W3cschool MNISTæ•°æ®é›† ä¾†é¾å»è„ˆè¬›è§£çš„æ¸…æ¸…æ¥šæ¥š</a></li>
<li><a href="http://colah.github.io/posts/2015-09-Visual-Information/" target="_blank" rel="noopener">Visual-Information äº¤å‰ç†µ</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/3/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/5/">Next &amp;raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Blair Chan&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos" target="_blank" rel="noopener">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = 'blairos-sn';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
