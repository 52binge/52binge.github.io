<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Everyone should not forget his dream">
<meta property="og:type" content="website">
<meta property="og:title" content="Home">
<meta property="og:url" content="http://iequa.com/page/9/index.html">
<meta property="og:site_name" content="Home">
<meta property="og:description" content="Everyone should not forget his dream">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Home">
<meta name="twitter:description" content="Everyone should not forget his dream">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8864dc75a81a27b7e44c00138af95d66";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/nlp">Data Mining</a>
        
          <a class="main-nav-link" href="/project">Project</a>
        
          <a class="main-nav-link" href="/ielts">English</a>
        
          <a class="main-nav-link" href="/tweet">Tweet</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://iequa.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-ml-keras-some-concept" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/02/23/ml-keras-some-concept/"><strong>About Keras Some Concepts</strong></a>
      <small class=article-date-index>&nbsp; 2017-02-23</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/23/ml-keras-some-concept/" class="article-date">
  <time datetime="2017-02-23T05:28:21.000Z" itemprop="datePublished">2017-02-23</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/machine-learning/">machine-learning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/02/23/ml-keras-some-concept/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>


<h2 id="1-symbolic-computation"><a href="#1-symbolic-computation" class="headerlink" title="1. symbolic computation"></a>1. symbolic computation</h2><p>Keras的底层库使用Theano或TensorFlow，这两个库也称为Keras的后端。</p>
<blockquote>
<p>无论是Theano还是TensorFlow，都是一个“符号主义”的库。</p>
</blockquote>
<h2 id="2-tensor-张量"><a href="#2-tensor-张量" class="headerlink" title="2. tensor (张量)"></a>2. tensor (张量)</h2><p>张量可以看作是向量、矩阵的自然推广，我们用张量来表示广泛的数据类型。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a = np.array([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]])</span><br><span class="line">sum0 = np.sum(a, axis=<span class="number">0</span>)</span><br><span class="line">sum1 = np.sum(a, axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> sum0</span><br><span class="line"><span class="keyword">print</span> sum1</span><br></pre></td></tr></table></figure>
<p>[4 6]<br>[3 7]</p>
<h2 id="3-‘th’与’tf’"><a href="#3-‘th’与’tf’" class="headerlink" title="3. ‘th’与’tf’"></a>3. ‘th’与’tf’</h2><p>在如何表示一组彩色图片的问题上，Theano和TensorFlow发生了分歧</p>
<h2 id="4-batch"><a href="#4-batch" class="headerlink" title="4. batch"></a>4. batch</h2><p><code>batch gradient descent</code></p>
<p>遍历全部数据集算一次损失函数，然后算函数对各个参数的梯度，更新梯度。这种方法每更新一次参数都要把数据集里的所有样本都看一遍，计算量开销大，计算速度慢，不支持在线学习，这称为Batch gradient descent，批梯度下降。</p>
<p><code>stochastic gradient descent</code></p>
<p>每看一个数据就算一下损失函数，然后求梯度更新参数，这个称为随机梯度下降，stochastic gradient descent。这个方法速度比较快，但是收敛性能不太好，可能在最优点附近晃来晃去，hit不到最优点。两次参数的更新也有可能互相抵消掉，造成目标函数震荡的比较剧烈。</p>
<p><code>mini batch gradient decent</code></p>
<p>为了克服 batch 和 stochastic 两种方法的缺点，现在一般采用的是一种折中手段，mini-batch gradient decent，小批的梯度下降，这种方法把数据分为若干个批，按批来更新参数，这样，一个批中的一组数据共同决定了本次梯度的方向，下降起来就不容易跑偏，减少了随机性。另一方面因为批的样本数与整个数据集相比小了很多，计算量也不是很大。</p>
<p>基本上现在的梯度下降都是基于mini-batch的，所以Keras的模块中经常会出现batch_size，就是指这个。</p>
<blockquote>
<p>Keras的优化器SGD是stochastic gradient descent的缩写，但不代表是一个样本就更新一回，还是mini-batch</p>
</blockquote>
<h2 id="5-to-new-beginner-explain"><a href="#5-to-new-beginner-explain" class="headerlink" title="5. to new beginner explain"></a>5. to new beginner explain</h2><p><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000" target="_blank" rel="external">Python Learning</a></p>
<ul>
<li>numpy, scipy, scikit-learn, pandas…</li>
<li>generator、lambda</li>
</ul>
<h2 id="6-about-deep-learning-concepts"><a href="#6-about-deep-learning-concepts" class="headerlink" title="6. about deep-learning concepts"></a>6. about deep-learning concepts</h2><blockquote>
<p>Keras 是为深度学习设计的工具</p>
</blockquote>
<ul>
<li>有监督学习，无监督学习，分类，聚类，回归</li>
<li>神经元模型，多层感知器，BP算法</li>
<li>目标函数（损失函数），激活函数，梯度下降法</li>
<li>全连接网络、卷积神经网络、递归神经网络</li>
<li>训练集，测试集，交叉验证，欠拟合，过拟合</li>
<li>数据规范化</li>
</ul>
<h2 id="Refence-article"><a href="#Refence-article" class="headerlink" title="Refence article"></a>Refence article</h2><p><a href="https://keras.io/getting-started/sequential-model-guide/" target="_blank" rel="external">keras.io</a><br><a href="http://keras-cn.readthedocs.io/en/latest/" target="_blank" rel="external">keras-cn.readthedocs.io</a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ml-python-numpy-shape" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/02/21/ml-python-numpy-shape/"><strong>Python numpy.shape 和 numpy.reshape</strong></a>
      <small class=article-date-index>&nbsp; 2017-02-21</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/21/ml-python-numpy-shape/" class="article-date">
  <time datetime="2017-02-21T08:43:21.000Z" itemprop="datePublished">2017-02-21</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/machine-learning/">machine-learning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/02/21/ml-python-numpy-shape/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th>Extension lib</th>
<th>introduction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Numpy</td>
<td>提供数组支持，以及相应的高效处理函数</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<h2 id="1-shape"><a href="#1-shape" class="headerlink" title="1. shape"></a>1. shape</h2><p>功能：给予数组一个新的形状，而不改变它的数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># list</span></span><br><span class="line">L=range(<span class="number">5</span>) <span class="comment"># [0, 1, 2, 3, 4]</span></span><br><span class="line">shape(L)   <span class="comment"># [5,]</span></span><br><span class="line">L=[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]] </span><br><span class="line">shape(L)</span><br></pre></td></tr></table></figure>
<p>(2, 3)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># array</span></span><br><span class="line"></span><br><span class="line">arr=array(range(<span class="number">5</span>)) </span><br><span class="line"><span class="keyword">print</span> arr</span><br><span class="line">shape(arr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"======  two dimension  ======"</span></span><br><span class="line"></span><br><span class="line">arr=array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]])</span><br><span class="line"><span class="keyword">print</span> arr</span><br><span class="line">shape(arr)</span><br></pre></td></tr></table></figure>
<p>======  two dimension  ======<br>[[1 2 3]<br>[4 5 6]]</p>
<p>(2, 3)</p>
<h2 id="2-reshape"><a href="#2-reshape" class="headerlink" title="2. reshape"></a>2. reshape</h2><p>newshape：整数值或整数元组。新的形状应该兼容于原始形状。<br>如果是一个整数值，表示一个一维数组的长度；<br>如果是元组，一个元素值可以为-1，此时该元素值表示为指定，此时会从数组的长度和剩余的维度中推断出</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]])  </span><br><span class="line">reshape(a, <span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<p>array([1, 2, 3, 4, 5, 6])</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">reshape(a, (<span class="number">3</span>, <span class="number">-1</span>)) <span class="comment">#为指定的值将被推断出为2</span></span><br></pre></td></tr></table></figure>
<p>array([[1, 2],<br>       [3, 4],<br>       [5, 6]])</p>
<h2 id="Refence-article"><a href="#Refence-article" class="headerlink" title="Refence article"></a>Refence article</h2><p><a href="http://blog.csdn.net/u012005313/article/details/49383551" target="_blank" rel="external">numpy.shape</a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ops-mac-install-tensorflow" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/02/21/ops-mac-install-tensorflow/"><strong>Mac install tensorFlow</strong></a>
      <small class=article-date-index>&nbsp; 2017-02-21</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/21/ops-mac-install-tensorflow/" class="article-date">
  <time datetime="2017-02-21T01:54:16.000Z" itemprop="datePublished">2017-02-21</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/devops/">devops</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/02/21/ops-mac-install-tensorflow/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-instaled-pip"><a href="#1-instaled-pip" class="headerlink" title="1. instaled pip"></a>1. instaled pip</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装完后执行命令pip freeze列出安装的packages验证一下pip安装好没.</span></span><br><span class="line"></span><br><span class="line">$ pip freeze</span><br><span class="line">python-dateutil==1.5</span><br><span class="line">scikit-learn==0.18.dev0</span><br><span class="line">scipy==0.13.0b1</span><br><span class="line">six==1.10.0</span><br><span class="line">tensorflow==0.5.0</span><br><span class="line">terminado==0.6</span><br><span class="line">TFL==2.0.5</span><br><span class="line">tornado==4.3</span><br><span class="line">vboxapi==1.0</span><br><span class="line">virtualenv==15.1.0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="2-install-tensorflow"><a href="#2-install-tensorflow" class="headerlink" title="2. install tensorflow"></a>2. install tensorflow</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Mac OS X, CPU only, Python 2.7:</span></span><br><span class="line">$ <span class="built_in">export</span> TF_BINARY_URL=https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-1.0.0-py2-none-any.whl</span><br><span class="line"></span><br><span class="line"><span class="comment"># Only CPU-version is available at the moment.</span></span><br><span class="line">$ sudo pip install <span class="variable">$TF_BINARY_URL</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>maybe by vpn in China</p>
</blockquote>
<h2 id="3-install-virtualenv"><a href="#3-install-virtualenv" class="headerlink" title="3. install virtualenv"></a>3. install virtualenv</h2><p>virtualenv是python的沙箱工具.我们毕竟是在自己机器上做实验,为了不来回修改各种环境变量,我们一般还是弄个沙箱完比较好.测试完直接删除就行,不用再去改各种配置文件.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo pip install --upgrade virtualenv</span><br><span class="line"></span><br><span class="line">Collecting virtualenv</span><br><span class="line">  Downloading virtualenv-15.1.0-py2.py3-none-any.whl (1.8MB)</span><br><span class="line">    100% |████████████████████████████████| 1.8MB 156kB/s</span><br><span class="line">Installing collected packages: virtualenv</span><br><span class="line">Successfully installed virtualenv-15.1.0</span><br></pre></td></tr></table></figure>
<p>安装好后创建一个工作目录,我直接在home里创建了个文件夹.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ virtualenv --system-site-packages ~/tensorflow</span><br></pre></td></tr></table></figure>
<p>然后进入目录激活沙箱.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cd ~/tensorflow</span><br><span class="line">$ source bin/activate</span><br></pre></td></tr></table></figure>
<h2 id="4-install-tensorflow-in-virtualenv"><a href="#4-install-tensorflow-in-virtualenv" class="headerlink" title="4. install tensorflow in virtualenv"></a>4. install tensorflow in virtualenv</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(tensorflow) ➜  tensorflow pip install <span class="variable">$TF_BINARY_URL</span></span><br></pre></td></tr></table></figure>
<h2 id="5-run-tensorflow"><a href="#5-run-tensorflow" class="headerlink" title="5. run tensorflow"></a>5. run tensorflow</h2><p><a href="http://tensorflow.org/get_started/os_setup.md#try_your_first_tensorflow_program" target="_blank" rel="external">hello world</a></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">(tensorflow) ➜  tensorflow python</span><br><span class="line">Python 2.7.10 (default, Jul 14 2015, 19:46:27)</span><br><span class="line">[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.39)] on darwin</span><br><span class="line">Type "help", "copyright", "credits" or "license" for more information.</span><br><span class="line">&gt;&gt;&gt; import tensorflow as tf</span><br><span class="line">&gt;&gt;&gt; hello = tf.constant('Hello,TensorFlow!')</span><br><span class="line">&gt;&gt;&gt; sess = tf.Session()</span><br><span class="line">can't determine number of CPU cores: assuming 4</span><br><span class="line">I tensorflow/core/common_runtime/local_device.cc:25] Local device intra op parallelism threads: 4</span><br><span class="line">can't determine number of CPU cores: assuming 4</span><br><span class="line">I tensorflow/core/common_runtime/local_session.cc:45] Local session inter op parallelism threads: 4</span><br><span class="line">&gt;&gt;&gt; print sess.run(hello)</span><br><span class="line">Hello,TensorFlow!</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>let’s see this tensorflow dir</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜  tensorflow ll</span><br><span class="line">total 4.0K</span><br><span class="line">drwxr-xr-x 16 hp staff 544 Feb 21 10:45 bin/</span><br><span class="line">drwxr-xr-x  3 hp staff 102 Feb 21 10:38 include/</span><br><span class="line">drwxr-xr-x  3 hp staff 102 Feb 21 10:38 lib/</span><br><span class="line">-rw-r--r--  1 hp staff  60 Feb 21 10:45 pip-selfcheck.json</span><br><span class="line">➜  tensorflow</span><br></pre></td></tr></table></figure>
<h2 id="6-install-keras"><a href="#6-install-keras" class="headerlink" title="6. install keras"></a>6. install keras</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo pip install keras</span><br><span class="line"></span><br><span class="line">Successfully installed keras-1.2.2 pyyaml-3.12 theano-0.8.2</span><br></pre></td></tr></table></figure>
<h2 id="Refence"><a href="#Refence" class="headerlink" title="Refence"></a>Refence</h2><ol>
<li><a href="http://tensorflow.org" target="_blank" rel="external">tensorflow官方地址</a></li>
<li><a href="https://pypi.python.org/pypi/pip" target="_blank" rel="external">pip官方地址</a></li>
<li><a href="https://pypi.python.org/pypi/setuptools" target="_blank" rel="external">setuptools官方地址</a></li>
<li><a href="http://www.111cn.net/phper/python/66848.htm" target="_blank" rel="external">python安装setuptools步骤详解</a></li>
<li><a href="http://pan.baidu.com/s/1c1corG8" target="_blank" rel="external">about pdf文件下载</a></li>
<li><a href="http://tflearn.org/installation/#upgrade-tensorflow" target="_blank" rel="external">tflearn.org/installation</a></li>
</ol>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ml-Abalone-Age-2017-02-17-1413" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/02/17/ml-Abalone-Age-2017-02-17-1413/"><strong>Abalone&#39;s Age</strong></a>
      <small class=article-date-index>&nbsp; 2017-02-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/17/ml-Abalone-Age-2017-02-17-1413/" class="article-date">
  <time datetime="2017-02-17T09:28:21.000Z" itemprop="datePublished">2017-02-17</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/machine-learning/">machine-learning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/02/17/ml-Abalone-Age-2017-02-17-1413/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Abalone’s-Age"><a href="#Abalone’s-Age" class="headerlink" title="Abalone’s Age"></a><a href="http://www.pkbigdata.com/common/cmpt/成电大数据培训实践_竞赛信息.html" target="_blank" rel="external">Abalone’s Age</a></h2><p>『Abalone’s Age』</p>
<p>鲍鱼，在现代汉语中有多种含义。最常用的是指一种原始的海洋贝类，属于单壳软体动物，其只有半面外壳，壳坚厚、扁而宽，鲍鱼是中国传统的名贵食材，位居四大海味之首。<br>鲍鱼的优劣与年龄相关。一般来说，我们可以数鲍鱼的生长纹来确定鲍鱼的年龄，但数生长纹也是一件挺麻烦的事情。在这里，我们采用与鲍鱼年龄有关的因素来预测鲍鱼的年龄。</p>
<p>构建Pybrain神经网络的基本步骤：</p>
<ol>
<li>构建神经网路</li>
<li>构造数据集</li>
<li>训练神经网络</li>
<li>预测测试集结果</li>
<li>提交,验证和分析</li>
</ol>
<h2 id="1-分析问题"><a href="#1-分析问题" class="headerlink" title="1. 分析问题"></a>1. 分析问题</h2><p>分析什么特征是更重要的</p>
<p><strong><font color="red">先看看数据长什么样 </font></strong> 还是用pandas加载数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 这个ipython notebook主要是我解决Kaggle Titanic问题的思路和过程</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd <span class="comment">#数据分析</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment">#科学计算</span></span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series,DataFrame</span><br><span class="line"></span><br><span class="line">data_train = pd.read_csv(<span class="string">"traindata.csv"</span>)</span><br><span class="line"><span class="keyword">print</span> data_train.columns</span><br><span class="line"><span class="keyword">print</span> <span class="string">"============ df info ============"</span></span><br><span class="line">data_train.info()</span><br></pre></td></tr></table></figure>
<pre><code>Index([u&apos;Sex&apos;, u&apos;Length&apos;, u&apos;Diameter&apos;, u&apos;Hight&apos;, u&apos;Whole&apos;, u&apos;Shucked&apos;,
       u&apos;Viscera&apos;, u&apos;Shell&apos;, u&apos;Rings&apos;],
      dtype=&apos;object&apos;)
============ df info ============
&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;
RangeIndex: 3177 entries, 0 to 3176
Data columns (total 9 columns):
Sex         3177 non-null object
Length      3177 non-null float64
Diameter    3177 non-null float64
Hight       3177 non-null float64
Whole       3177 non-null float64
Shucked     3177 non-null float64
Viscera     3177 non-null float64
Shell       3177 non-null float64
Rings       3177 non-null int64
dtypes: float64(7), int64(1), object(1)
memory usage: 223.5+ KB
</code></pre><font color="blue">我们看大概有以下这些字段</font>

<ol>
<li>Sex</li>
<li>Length</li>
<li>Diameter</li>
<li>Hight</li>
<li>Whole</li>
<li>Shucked</li>
<li>Viscera</li>
<li>Shell</li>
<li>Rings =&gt; Age</li>
</ol>
<p>上面的数据说什么了？它告诉我们，一共有9 Column 数据，训练数据中总共有 3177 只 abalone，所有的数据都是全的。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data_train.describe()</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>~</th>
<th>Length</th>
<th>Diameter</th>
<th>Hight</th>
<th>Whole</th>
<th>Shucked</th>
<th>Viscera</th>
<th>Shell</th>
<th>Rings</th>
</tr>
</thead>
<tbody>
<tr>
<td>count</td>
<td>3177</td>
<td>3177</td>
<td>3177</td>
<td>3177</td>
<td>3177</td>
<td>3177</td>
<td>3177</td>
<td>3177</td>
</tr>
<tr>
<td>mean</td>
<td>0.52</td>
<td>0.41</td>
<td>0.14</td>
<td>0.83</td>
<td>0.36</td>
<td>0.18</td>
<td>0.24</td>
<td>9.92</td>
</tr>
</tbody>
</table>
<ul>
<li><font color="blue">『对数据的认识太重要了！』<font></font></font></li>
<li><font color="red">『对数据的认识太重要了！』<font></font></font></li>
<li><font color="green">『对数据的认识太重要了！』<font></font></font></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data_train</span><br></pre></td></tr></table></figure>
<h2 id="2-准备数据"><a href="#2-准备数据" class="headerlink" title="2. 准备数据"></a>2. 准备数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 对 sex 进行 one-hot 编码</span></span><br><span class="line">dummies_Sex = pd.get_dummies(data_train[<span class="string">'Sex'</span>], prefix= <span class="string">'Sex'</span>)</span><br><span class="line"></span><br><span class="line">df = pd.concat([data_train, dummies_Sex], axis=<span class="number">1</span>)</span><br><span class="line">df.drop([<span class="string">'Sex'</span>], axis=<span class="number">1</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">train_df = df</span><br><span class="line">train_df</span><br></pre></td></tr></table></figure>
<h2 id="3-构造神经网络-NN"><a href="#3-构造神经网络-NN" class="headerlink" title="3. 构造神经网络 NN"></a>3. 构造神经网络 NN</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series,DataFrame</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas.io.data <span class="keyword">as</span> wb</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pybrain.structure <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pybrain.datasets <span class="keyword">import</span> SupervisedDataSet</span><br><span class="line"><span class="keyword">from</span> pybrain.supervised.trainers <span class="keyword">import</span> BackpropTrainer</span><br><span class="line"></span><br><span class="line"><span class="comment"># createa neural network</span></span><br><span class="line">fnn = FeedForwardNetwork()</span><br><span class="line"></span><br><span class="line"><span class="comment"># create three layers, input layer:2 input unit; hidden layer: 10 units; output layer: 1 output</span></span><br><span class="line">inLayer = LinearLayer(<span class="number">10</span>, name=<span class="string">'inLayer'</span>)</span><br><span class="line">hiddenLayer0 = SigmoidLayer(<span class="number">3</span>, name=<span class="string">'hiddenLayer0'</span>)</span><br><span class="line">outLayer = LinearLayer(<span class="number">1</span>, name=<span class="string">'outLayer'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add three layers to the neural network</span></span><br><span class="line">fnn.addInputModule(inLayer)</span><br><span class="line">fnn.addModule(hiddenLayer0)</span><br><span class="line">fnn.addOutputModule(outLayer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># link three layers</span></span><br><span class="line">in_to_hidden0 = FullConnection(inLayer,hiddenLayer0)</span><br><span class="line">hidden0_to_out = FullConnection(hiddenLayer0, outLayer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the links to neural network</span></span><br><span class="line">fnn.addConnection(in_to_hidden0)</span><br><span class="line">fnn.addConnection(hidden0_to_out)</span><br><span class="line"></span><br><span class="line"><span class="comment"># make neural network come into effect</span></span><br><span class="line">fnn.sortModules()</span><br></pre></td></tr></table></figure>
<h2 id="4-构造数据集"><a href="#4-构造数据集" class="headerlink" title="4. 构造数据集"></a>4. 构造数据集</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># obtain the original data</span></span><br><span class="line"></span><br><span class="line">x1 = train_df[<span class="string">'Length'</span>]</span><br><span class="line">x2 = train_df[<span class="string">'Diameter'</span>]</span><br><span class="line">x3 = train_df[<span class="string">'Hight'</span>]</span><br><span class="line">x4 = train_df[<span class="string">'Whole'</span>]</span><br><span class="line">x5 = train_df[<span class="string">'Shucked'</span>]</span><br><span class="line">x6 = train_df[<span class="string">'Viscera'</span>]</span><br><span class="line">x7 = train_df[<span class="string">'Shell'</span>]</span><br><span class="line">x8 = train_df[<span class="string">'Sex_F'</span>]</span><br><span class="line">x9 = train_df[<span class="string">'Sex_I'</span>]</span><br><span class="line">x10 = train_df[<span class="string">'Sex_M'</span>]</span><br><span class="line"></span><br><span class="line">y = train_df[<span class="string">'Rings'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># definite the dataset as two input , one output</span></span><br><span class="line">DS = SupervisedDataSet(<span class="number">10</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add data element to the dataset</span></span><br><span class="line"><span class="comment"># 往数据集内加样本点</span></span><br><span class="line"><span class="comment"># 假设x1，x2，x3是输入的三个维度向量，y是输出向量，并且它们的长度相同</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.arange(len(train_df)):</span><br><span class="line">    DS.addSample([x1[i],x2[i],x3[i],x4[i],x5[i],x6[i],x7[i],x8[i],x9[i],x10[i]],[y[i]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># you can get your input/output this way</span></span><br><span class="line"><span class="comment"># 如果要获得里面的输入／输出时，可以用</span></span><br><span class="line">X = DS[<span class="string">'input'</span>]</span><br><span class="line">Y = DS[<span class="string">'target'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># split the dataset into train dataset and test dataset</span></span><br><span class="line"><span class="comment"># 如果要把数据集切分成训练集和测试集，可以用下面的语句，训练集：测试集＝8:2</span></span><br><span class="line"><span class="comment"># 为了方便之后的调用，可以把输入和输出拎出来</span></span><br><span class="line">dataTrain, dataTest = DS.splitWithProportion(<span class="number">0.8</span>)</span><br><span class="line">xTrain, yTrain = dataTrain[<span class="string">'input'</span>],dataTrain[<span class="string">'target'</span>]</span><br><span class="line">xTest, yTest = dataTest[<span class="string">'input'</span>], dataTest[<span class="string">'target'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"bulid data sets end ！"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#print xTest[1]</span></span><br><span class="line">type(xTest)</span><br></pre></td></tr></table></figure>
<pre><code>bulid data sets end ！

numpy.ndarray
</code></pre><h2 id="5-训练神经网络"><a href="#5-训练神经网络" class="headerlink" title="5. 训练神经网络"></a>5. 训练神经网络</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># train the NN</span></span><br><span class="line"><span class="comment"># we use BP Algorithm</span></span><br><span class="line"><span class="comment"># verbose = True means print th total error</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"trainer start..."</span></span><br><span class="line">trainer = BackpropTrainer(fnn, dataTrain, verbose=<span class="keyword">False</span>,learningrate=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"run..."</span></span><br><span class="line"><span class="comment"># set the epoch times to make the NN  fit</span></span><br><span class="line">trainer.trainUntilConvergence(maxEpochs=<span class="number">500</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"trainer end!"</span></span><br></pre></td></tr></table></figure>
<pre><code>trainer start...
run...
trainer end!
</code></pre><h2 id="6-预测testdata"><a href="#6-预测testdata" class="headerlink" title="6. 预测testdata"></a>6. 预测testdata</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data_test = pd.read_csv(<span class="string">"testdata.csv"</span>)</span><br><span class="line"><span class="comment"># 对 sex 进行 one-hot 编码</span></span><br><span class="line">dummies_Sex = pd.get_dummies(data_test[<span class="string">'Sex'</span>], prefix= <span class="string">'Sex'</span>)</span><br><span class="line"></span><br><span class="line">df = pd.concat([data_test, dummies_Sex], axis=<span class="number">1</span>)</span><br><span class="line">df.drop([<span class="string">'Sex'</span>], axis=<span class="number">1</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">df_test = df</span><br><span class="line">df_test</span><br><span class="line"></span><br><span class="line">test = df_test.filter(regex=<span class="string">'Length|Diameter|Hight|Whole|Shucked|Viscera|Shell|Sex_F|Sex_I|Sex_M'</span>)</span><br><span class="line">test</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">xTest = test.as_matrix()</span><br><span class="line">xTest</span><br><span class="line"><span class="comment"># prediction = fnn.activate(xTest[1])</span></span><br><span class="line"><span class="comment"># print("the prediction number is :",prediction," the real number is:  ",yTest[1])</span></span><br><span class="line">predict_resutl=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.arange(len(xTest)):</span><br><span class="line">    res = fnn.activate(xTest[i])[<span class="number">0</span>]</span><br><span class="line">    predict_resutl.append(round(res))</span><br><span class="line"></span><br><span class="line">final_res = np.array(predict_resutl).T</span><br><span class="line"></span><br><span class="line">result = pd.DataFrame(&#123;<span class="string">'ID'</span>:data_test[<span class="string">'ID'</span>].as_matrix(), <span class="string">'Rings'</span>:final_res&#125;)</span><br><span class="line">result</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result.to_csv(<span class="string">"abalone_predictions.csv"</span>, index=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ml-NN-BPNN-Titanic-2017-02-16-1732-ipynb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/02/16/ml-NN-BPNN-Titanic-2017-02-16-1732-ipynb/"><strong>Kaggle_Titanic</strong></a>
      <small class=article-date-index>&nbsp; 2017-02-16</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/16/ml-NN-BPNN-Titanic-2017-02-16-1732-ipynb/" class="article-date">
  <time datetime="2017-02-16T09:28:21.000Z" itemprop="datePublished">2017-02-16</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/machine-learning/">machine-learning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/02/16/ml-NN-BPNN-Titanic-2017-02-16-1732-ipynb/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="泰坦尼克号"><a href="#泰坦尼克号" class="headerlink" title="泰坦尼克号"></a><a href="https://www.kaggle.com/c/titanic" target="_blank" rel="external">泰坦尼克号</a></h2><p>『Jack and Rose』的故事，豪华游艇倒了，大家都惊恐逃生，可是救生艇的数量有限，无法人人都有，副船长发话了『lady and kid first！』，所以是否获救其实并非随机，而是基于一些背景有rank先后的。<br><br>训练和测试数据是一些乘客的个人信息以及存活状况，要尝试根据它生成合适的模型并预测其他人的存活状况。<br></p>
<p>这是一个二分类问题，很多分类算法都可以解决。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">构建Pybrain神经网络的基本步骤：</span><br><span class="line"></span><br><span class="line">1. 构建神经网路</span><br><span class="line">2. 构造数据集</span><br><span class="line">3. 训练神经网络</span><br><span class="line">4. 预测测试集结果</span><br><span class="line">5. 验证和分析</span><br></pre></td></tr></table></figure>
<h2 id="1-分析问题"><a href="#1-分析问题" class="headerlink" title="1. 分析问题"></a>1. 分析问题</h2><blockquote>
<p>分析什么特征是更重要的</p>
</blockquote>
<p>先看看数据长什么样？ 还是用pandas加载数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 这个ipython notebook主要是我解决Kaggle Titanic问题的思路和过程</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd <span class="comment">#数据分析</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment">#科学计算</span></span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series,DataFrame</span><br><span class="line"></span><br><span class="line">data_train = pd.read_csv(<span class="string">"Train.csv"</span>)</span><br><span class="line"><span class="keyword">print</span> data_train.columns</span><br><span class="line"><span class="keyword">print</span> <span class="string">"============ df info ============"</span></span><br><span class="line">data_train.info()</span><br></pre></td></tr></table></figure>
<pre><code>Index([u&apos;PassengerId&apos;, u&apos;Survived&apos;, u&apos;Pclass&apos;, u&apos;Name&apos;, u&apos;Sex&apos;, u&apos;Age&apos;,
       u&apos;SibSp&apos;, u&apos;Parch&apos;, u&apos;Ticket&apos;, u&apos;Fare&apos;, u&apos;Cabin&apos;, u&apos;Embarked&apos;],
      dtype=&apos;object&apos;)
============ df info ============
&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;
RangeIndex: 891 entries, 0 to 890
Data columns (total 12 columns):
PassengerId    891 non-null int64
Survived       891 non-null int64
Pclass         891 non-null int64
Name           891 non-null object
Sex            891 non-null object
Age            714 non-null float64
SibSp          891 non-null int64
Parch          891 non-null int64
Ticket         891 non-null object
Fare           891 non-null float64
Cabin          204 non-null object
Embarked       889 non-null object
dtypes: float64(2), int64(5), object(5)
memory usage: 83.6+ KB
</code></pre><p>我们看大概有以下这些字段</p>
<p>PassengerId =&gt; 乘客ID<br>Pclass =&gt; 乘客等级(1/2/3等舱位)<br>Name =&gt; 乘客姓名<br>Sex =&gt; 性别<br>Age =&gt; 年龄<br>SibSp =&gt; 堂兄弟/妹个数<br>Parch =&gt; 父母与小孩个数<br>Ticket =&gt; 船票信息<br>Fare =&gt; 票价<br>Cabin =&gt; 客舱<br>Embarked =&gt; 登船港口</p>
<p>上面的数据说什么了？它告诉我们，训练数据中总共有891名乘客，但是很不幸，我们有些属性的数据不全，比如说：</p>
<ul>
<li>Age（年龄）属性只有714名乘客有记录</li>
<li>Cabin（客舱）更是只有204名乘客是已知的</li>
</ul>
<p>再瞄一眼具体数据数值情况，得到数值型数据的一些分布(因为有些属性，比如姓名，是文本型；而另外一些属性，比如登船港口，是类目型。这些我们用下面的函数是看不到的)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data_train.describe()</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>-</th>
<th>PassengerId</th>
<th>Survived</th>
<th>Pclass</th>
<th>Age</th>
<th>SibSp</th>
<th>Parch</th>
<th>Fare</th>
</tr>
</thead>
<tbody>
<tr>
<td>count</td>
<td>891.000000</td>
<td>891.000000</td>
<td>891.000000</td>
<td>714.000000</td>
<td>891.000000</td>
<td>891.000000</td>
<td>891.000000</td>
</tr>
<tr>
<td>mean</td>
<td>446.000000</td>
<td>0.383838</td>
<td>2.308642</td>
<td>29.699118</td>
<td>0.523008</td>
<td>0.381594</td>
<td>32.204208</td>
</tr>
</tbody>
</table>
<p><font color="red">mean字段告诉我们，大概0.383838的人最后获救了，2/3等舱的人数比1等舱要多，平均乘客年龄大概是29.7岁(计算这个时候会略掉无记录的)等等…<font></font></font></p>
<ul>
<li><font color="blue">『对数据的认识太重要了！』<font></font></font></li>
<li><font color="red">『对数据的认识太重要了！』<font></font></font></li>
<li><font color="green">『对数据的认识太重要了！』<font></font></font></li>
</ul>
<p>总结 : </p>
<ol>
<li>Cabin，没看出什么明显特征，缺失值又太多</li>
<li>Age：可以尝试补全缺失的数据</li>
</ol>
<p><strong>通常遇到缺值的情况，我们会有几种常见的处理方式</strong><br><br></p>
<ol>
<li>如果缺值的样本占总数比例极高，我们可能就直接舍弃了，作为特征加入的话，可能反倒带入noise，影响最后的结果了</li>
<li>如果缺值的样本适中，而该属性非连续值特征属性(比如说类目属性)，那就把NaN作为一个新类别，加到类别特征中</li>
<li>如果缺值的样本适中，而该属性为连续值特征属性，有时候我们会考虑给定一个step(比如这里的age，我们可以考虑每隔2/3岁为一个步长)，然后把它离散化，之后把NaN作为一个type加到属性类目中。</li>
<li>有些情况下，缺失的值个数并不是特别多，那我们也可以试着根据已有的值，拟合一下数据，补充上。</li>
</ol>
<p>本例中，后两种处理方式应该都是可行的，我们先试试拟合补全吧(没有特别多的背景可供我们拟合，这不一定是一个好的选择)</p>
<p>我们这里用scikit-learn中的RandomForest来拟合一下缺失的年龄数据<br></p>
<ol>
<li>从数据来估计 Age 应该是比较重要的, 还有毕竟 副船长发话了『lady and kid first！』</li>
<li>Cabin 缺失值太多了，先按Cabin有无数据，将这个属性处理成Yes和No两种类型吧</li>
</ol>
<h2 id="2-准备数据"><a href="#2-准备数据" class="headerlink" title="2. 准备数据"></a>2. 准备数据</h2><ol>
<li>Age 与 cabin 补全</li>
<li>one-hot 编码</li>
<li>Feature Scaling</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 我们这里用scikit-learn中的RandomForest来拟合一下缺失的年龄数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor</span><br><span class="line"> </span><br><span class="line"><span class="comment">### 使用 RandomForestClassifier 填补缺失的年龄属性</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_missing_ages</span><span class="params">(df)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 把已有的数值型特征取出来丢进Random Forest Regressor中</span></span><br><span class="line">    age_df = df[[<span class="string">'Age'</span>,<span class="string">'Fare'</span>, <span class="string">'Parch'</span>, <span class="string">'SibSp'</span>, <span class="string">'Pclass'</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 乘客分成已知年龄和未知年龄两部分</span></span><br><span class="line">    known_age = age_df[age_df.Age.notnull()].as_matrix()</span><br><span class="line">    unknown_age = age_df[age_df.Age.isnull()].as_matrix()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># y即目标年龄</span></span><br><span class="line">    y = known_age[:, <span class="number">0</span>] <span class="comment">## Age ‘s value list</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># X即特征属性值</span></span><br><span class="line">    X = known_age[:, <span class="number">1</span>:] <span class="comment">## Fare 的值 list</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># fit到RandomForestRegressor之中</span></span><br><span class="line">    rfr = RandomForestRegressor(random_state=<span class="number">0</span>, n_estimators=<span class="number">2000</span>, n_jobs=<span class="number">-1</span>)</span><br><span class="line">    rfr.fit(X, y)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 用得到的模型进行未知年龄结果预测</span></span><br><span class="line">    predictedAges = rfr.predict(unknown_age[:, <span class="number">1</span>::])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 用得到的预测结果填补原缺失数据</span></span><br><span class="line">    df.loc[ (df.Age.isnull()), <span class="string">'Age'</span> ] = predictedAges </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df, rfr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_Cabin_type</span><span class="params">(df)</span>:</span></span><br><span class="line">    df.loc[ (df.Cabin.notnull()), <span class="string">'Cabin'</span> ] = <span class="string">"Yes"</span></span><br><span class="line">    df.loc[ (df.Cabin.isnull()), <span class="string">'Cabin'</span> ] = <span class="string">"No"</span></span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line">data_train, rfr = set_missing_ages(data_train)</span><br><span class="line">data_train = set_Cabin_type(data_train)</span><br><span class="line">data_train</span><br></pre></td></tr></table></figure>
<p><strong>one-hot 编码</strong></p>
<p>因为逻辑回归建模时，需要输入的特征都是数值型特征，我们通常会先对类目型的特征因子化/one-hot编码。 <br><br>什么叫做因子化/one-hot编码？举个例子：<font><br></font></p>
<p>以Embarked为例，原本一个属性维度，因为其取值可以是[‘S’,’C’,’Q‘]，而将其平展开为’Embarked_C’,’Embarked_S’, ‘Embarked_Q’三个属性<font><br></font></p>
<ol>
<li>原Embarked取S的，在此处的”Embarked_S”下取值为1，在’Embarked_C’, ‘Embarked_Q’下取值为0<br></li>
<li>原Embarked取C的，在此处的”Embarked_C”下取值为1，在’Embarked_S’, ‘Embarked_Q’下取值为0<br></li>
<li>原Embarked取Q的，在此处的”Embarked_Q”下取值为1，在’Embarked_C’, ‘Embarked_S’下取值为0<br></li>
</ol>
<p>我们使用pandas的”get_dummies”来完成这个工作，并拼接在原来的”data_train”之上，如下所示。<br></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 因为逻辑回归建模时，需要输入的特征都是数值型特征</span></span><br><span class="line"><span class="comment"># 我们先对类目型的特征离散/因子化</span></span><br><span class="line"><span class="comment"># 以Cabin为例，原本一个属性维度，因为其取值可以是['yes','no']，而将其平展开为'Cabin_yes','Cabin_no'两个属性</span></span><br><span class="line"><span class="comment"># 原本Cabin取值为yes的，在此处的'Cabin_yes'下取值为1，在'Cabin_no'下取值为0</span></span><br><span class="line"><span class="comment"># 原本Cabin取值为no的，在此处的'Cabin_yes'下取值为0，在'Cabin_no'下取值为1</span></span><br><span class="line"><span class="comment"># 我们使用pandas的get_dummies来完成这个工作，并拼接在原来的data_train之上，如下所示</span></span><br><span class="line">dummies_Cabin = pd.get_dummies(data_train[<span class="string">'Cabin'</span>], prefix= <span class="string">'Cabin'</span>)</span><br><span class="line"></span><br><span class="line">dummies_Embarked = pd.get_dummies(data_train[<span class="string">'Embarked'</span>], prefix= <span class="string">'Embarked'</span>)</span><br><span class="line"></span><br><span class="line">dummies_Sex = pd.get_dummies(data_train[<span class="string">'Sex'</span>], prefix= <span class="string">'Sex'</span>)</span><br><span class="line"></span><br><span class="line">dummies_Pclass = pd.get_dummies(data_train[<span class="string">'Pclass'</span>], prefix= <span class="string">'Pclass'</span>)</span><br><span class="line">df = pd.concat([data_train, dummies_Cabin, dummies_Embarked, dummies_Sex, dummies_Pclass], axis=<span class="number">1</span>)</span><br><span class="line">df.drop([<span class="string">'Pclass'</span>, <span class="string">'Name'</span>, <span class="string">'Sex'</span>, <span class="string">'Ticket'</span>, <span class="string">'Cabin'</span>, <span class="string">'Embarked'</span>], axis=<span class="number">1</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>PassengerId</th>
<th>…</th>
<th>Embarked_C</th>
<th>Embarked_Q</th>
<th>Embarked_S</th>
<th>Sex_female</th>
<th>Sex_male</th>
<th>Pclass_1</th>
<th>Pclass_2</th>
<th>Pclass_3</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>…</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
</tbody>
</table>
<p><strong>Feature Scaling</strong></p>
<p><font color="red">Age和Fare两个属性，乘客的数值幅度变化，scaling，其实就是将一些变化幅度较大的特征化到[-1,1]之内。<font></font></font></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 接下来我们要接着做一些数据预处理的工作，比如scaling，将一些变化幅度较大的特征化到[-1,1]之内</span></span><br><span class="line"><span class="comment"># 这样可以加速logistic regression的收敛</span></span><br><span class="line"><span class="keyword">import</span> sklearn.preprocessing <span class="keyword">as</span> preprocessing</span><br><span class="line">scaler = preprocessing.StandardScaler()</span><br><span class="line">age_scale_param = scaler.fit(df[<span class="string">'Age'</span>])</span><br><span class="line">df[<span class="string">'Age_scaled'</span>] = scaler.fit_transform(df[<span class="string">'Age'</span>], age_scale_param)</span><br><span class="line">fare_scale_param = scaler.fit(df[<span class="string">'Fare'</span>])</span><br><span class="line">df[<span class="string">'Fare_scaled'</span>] = scaler.fit_transform(df[<span class="string">'Fare'</span>], fare_scale_param)</span><br><span class="line">df</span><br><span class="line">train_df = df.filter(regex=<span class="string">'Survived|Age_.*|SibSp|Parch|Fare_.*|Cabin_.*|Embarked_.*|Sex_.*|Pclass_.*'</span>)</span><br><span class="line">train_df</span><br></pre></td></tr></table></figure>
<h2 id="3-构造神经网络"><a href="#3-构造神经网络" class="headerlink" title="3. 构造神经网络"></a>3. 构造神经网络</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series,DataFrame</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas.io.data <span class="keyword">as</span> wb</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pybrain.structure <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pybrain.datasets <span class="keyword">import</span> SupervisedDataSet</span><br><span class="line"><span class="keyword">from</span> pybrain.supervised.trainers <span class="keyword">import</span> BackpropTrainer</span><br><span class="line"></span><br><span class="line"><span class="comment"># createa neural network</span></span><br><span class="line">fnn = FeedForwardNetwork()</span><br><span class="line"></span><br><span class="line"><span class="comment"># create three layers, input layer:2 input unit; hidden layer: 10 units; output layer: 1 output</span></span><br><span class="line">inLayer = LinearLayer(<span class="number">9</span>, name=<span class="string">'inLayer'</span>)</span><br><span class="line">hiddenLayer0 = SigmoidLayer(<span class="number">1</span>, name=<span class="string">'hiddenLayer0'</span>)</span><br><span class="line">outLayer = LinearLayer(<span class="number">1</span>, name=<span class="string">'outLayer'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add three layers to the neural network</span></span><br><span class="line">fnn.addInputModule(inLayer)</span><br><span class="line">fnn.addModule(hiddenLayer0)</span><br><span class="line">fnn.addOutputModule(outLayer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># link three layers</span></span><br><span class="line">in_to_hidden0 = FullConnection(inLayer,hiddenLayer0)</span><br><span class="line">hidden0_to_out = FullConnection(hiddenLayer0, outLayer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the links to neural network</span></span><br><span class="line">fnn.addConnection(in_to_hidden0)</span><br><span class="line">fnn.addConnection(hidden0_to_out)</span><br><span class="line"></span><br><span class="line"><span class="comment"># make neural network come into effect</span></span><br><span class="line">fnn.sortModules()</span><br></pre></td></tr></table></figure>
<h2 id="4-构造数据集"><a href="#4-构造数据集" class="headerlink" title="4. 构造数据集"></a>4. 构造数据集</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># obtain the original data</span></span><br><span class="line"></span><br><span class="line">x1 = train_df[<span class="string">'SibSp'</span>]</span><br><span class="line">x2 = train_df[<span class="string">'Parch'</span>]</span><br><span class="line">x3 = train_df[<span class="string">'Sex_female'</span>]</span><br><span class="line">x4 = train_df[<span class="string">'Sex_male'</span>]</span><br><span class="line">x5 = train_df[<span class="string">'Pclass_1'</span>]</span><br><span class="line">x6 = train_df[<span class="string">'Pclass_2'</span>]</span><br><span class="line">x7 = train_df[<span class="string">'Pclass_3'</span>]</span><br><span class="line">x8 = train_df[<span class="string">'Age_scaled'</span>]</span><br><span class="line">x9 = train_df[<span class="string">'Fare_scaled'</span>]</span><br><span class="line"></span><br><span class="line">y = train_df[<span class="string">'Survived'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># definite the dataset as two input , one output</span></span><br><span class="line">DS = SupervisedDataSet(<span class="number">9</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add data element to the dataset</span></span><br><span class="line"><span class="comment"># 往数据集内加样本点</span></span><br><span class="line"><span class="comment"># 假设x1，x2，x3是输入的三个维度向量，y是输出向量，并且它们的长度相同</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.arange(len(train_df)):</span><br><span class="line">    DS.addSample([x1[i],x2[i],x3[i],x4[i],x5[i],x6[i],x7[i],x8[i],x9[i]],[y[i]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># you can get your input/output this way</span></span><br><span class="line"><span class="comment"># 如果要获得里面的输入／输出时，可以用</span></span><br><span class="line">X = DS[<span class="string">'input'</span>]</span><br><span class="line">Y = DS[<span class="string">'target'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># split the dataset into train dataset and test dataset</span></span><br><span class="line"><span class="comment"># 如果要把数据集切分成训练集和测试集，可以用下面的语句，训练集：测试集＝8:2</span></span><br><span class="line"><span class="comment"># 为了方便之后的调用，可以把输入和输出拎出来</span></span><br><span class="line">dataTrain, dataTest = DS.splitWithProportion(<span class="number">0.8</span>)</span><br><span class="line">xTrain, yTrain = dataTrain[<span class="string">'input'</span>],dataTrain[<span class="string">'target'</span>]</span><br><span class="line">xTest, yTest = dataTest[<span class="string">'input'</span>], dataTest[<span class="string">'target'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"bulid data sets end ！"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#print xTest[1]</span></span><br><span class="line">type(xTest)</span><br></pre></td></tr></table></figure>
<pre><code>bulid data sets end ！
numpy.ndarray
</code></pre><h2 id="5-训练神经网络"><a href="#5-训练神经网络" class="headerlink" title="5. 训练神经网络"></a>5. 训练神经网络</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># train the NN</span></span><br><span class="line"><span class="comment"># we use BP Algorithm</span></span><br><span class="line"><span class="comment"># verbose = True means print th total error</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"trainer start..."</span></span><br><span class="line">trainer = BackpropTrainer(fnn, dataTrain, verbose=<span class="keyword">False</span>,learningrate=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"run..."</span></span><br><span class="line"><span class="comment"># set the epoch times to make the NN  fit</span></span><br><span class="line">trainer.trainUntilConvergence(maxEpochs=<span class="number">500</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"trainer end!"</span></span><br></pre></td></tr></table></figure>
<pre><code>trainer start...
run...
trainer end!
</code></pre><h2 id="6-预测-test-csv"><a href="#6-预测-test-csv" class="headerlink" title="6. 预测 test.csv"></a>6. 预测 test.csv</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data_test = pd.read_csv(<span class="string">"test.csv"</span>)</span><br><span class="line">data_test.loc[ (data_test.Fare.isnull()), <span class="string">'Fare'</span> ] = <span class="number">0</span></span><br><span class="line"><span class="comment"># 接着我们对test_data做和train_data中一致的特征变换</span></span><br><span class="line"><span class="comment"># 首先用同样的RandomForestRegressor模型填上丢失的年龄</span></span><br><span class="line">tmp_df = data_test[[<span class="string">'Age'</span>,<span class="string">'Fare'</span>, <span class="string">'Parch'</span>, <span class="string">'SibSp'</span>, <span class="string">'Pclass'</span>]]</span><br><span class="line">null_age = tmp_df[data_test.Age.isnull()].as_matrix()</span><br><span class="line"><span class="comment"># 根据特征属性X预测年龄并补上</span></span><br><span class="line">X = null_age[:, <span class="number">1</span>:]</span><br><span class="line">predictedAges = rfr.predict(X)</span><br><span class="line">data_test.loc[ (data_test.Age.isnull()), <span class="string">'Age'</span> ] = predictedAges</span><br><span class="line"></span><br><span class="line">data_test = set_Cabin_type(data_test)</span><br><span class="line">dummies_Cabin = pd.get_dummies(data_test[<span class="string">'Cabin'</span>], prefix= <span class="string">'Cabin'</span>)</span><br><span class="line">dummies_Embarked = pd.get_dummies(data_test[<span class="string">'Embarked'</span>], prefix= <span class="string">'Embarked'</span>)</span><br><span class="line">dummies_Sex = pd.get_dummies(data_test[<span class="string">'Sex'</span>], prefix= <span class="string">'Sex'</span>)</span><br><span class="line">dummies_Pclass = pd.get_dummies(data_test[<span class="string">'Pclass'</span>], prefix= <span class="string">'Pclass'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df_test = pd.concat([data_test, dummies_Cabin, dummies_Embarked, dummies_Sex, dummies_Pclass], axis=<span class="number">1</span>)</span><br><span class="line">df_test.drop([<span class="string">'Pclass'</span>, <span class="string">'Name'</span>, <span class="string">'Sex'</span>, <span class="string">'Ticket'</span>, <span class="string">'Cabin'</span>, <span class="string">'Embarked'</span>], axis=<span class="number">1</span>, inplace=<span class="keyword">True</span>)</span><br><span class="line">df_test[<span class="string">'Age_scaled'</span>] = scaler.fit_transform(df_test[<span class="string">'Age'</span>], age_scale_param)</span><br><span class="line">df_test[<span class="string">'Fare_scaled'</span>] = scaler.fit_transform(df_test[<span class="string">'Fare'</span>], fare_scale_param)</span><br><span class="line">df_test</span><br><span class="line"></span><br><span class="line">test = df_test.filter(regex=<span class="string">'SibSp|Parch|Sex_female|Sex_male|Pclass_1|Pclass_2|Pclass_3|Age_scaled|Fare_scaled'</span>)</span><br><span class="line">xTest = test.as_matrix()</span><br><span class="line"><span class="comment"># prediction = fnn.activate(xTest[1])</span></span><br><span class="line"><span class="comment"># print("the prediction number is :",prediction," the real number is:  ",yTest[1])</span></span><br><span class="line">predict_resutl=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> np.arange(len(xTest)):</span><br><span class="line">    res = fnn.activate(xTest[i])[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> (res &gt; <span class="number">0.5</span>) :</span><br><span class="line">        res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">    predict_resutl.append(res)</span><br><span class="line"></span><br><span class="line">final_res = np.array(predict_resutl).T</span><br><span class="line"></span><br><span class="line">result = pd.DataFrame(&#123;<span class="string">'PassengerId'</span>:data_test[<span class="string">'PassengerId'</span>].as_matrix(), <span class="string">'Survived'</span>:final_res&#125;)</span><br><span class="line">result</span><br></pre></td></tr></table></figure>
<h2 id="7-结果写入文件"><a href="#7-结果写入文件" class="headerlink" title="7. 结果写入文件"></a>7. 结果写入文件</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result.to_csv(<span class="string">"logistic_regression_predictions.csv"</span>, index=<span class="keyword">False</span>)</span><br></pre></td></tr></table></figure>
<h2 id="8-验证和分析"><a href="#8-验证和分析" class="headerlink" title="8. 验证和分析"></a>8. 验证和分析</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> mod <span class="keyword">in</span> fnn.modules:</span><br><span class="line">  <span class="keyword">print</span> (<span class="string">"Module:"</span>, mod.name)</span><br><span class="line">  <span class="keyword">if</span> mod.paramdim &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"--parameters:"</span>, mod.params)</span><br><span class="line">  <span class="keyword">for</span> conn <span class="keyword">in</span> fnn.connections[mod]:</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"-connection to"</span>, conn.outmod.name)</span><br><span class="line">    <span class="keyword">if</span> conn.paramdim &gt; <span class="number">0</span>:</span><br><span class="line">       <span class="keyword">print</span> (<span class="string">"- parameters"</span>, conn.params)</span><br><span class="line">  <span class="keyword">if</span> hasattr(fnn, <span class="string">"recurrentConns"</span>):</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Recurrent connections"</span>)</span><br><span class="line">    <span class="keyword">for</span> conn <span class="keyword">in</span> fnn.recurrentConns:</span><br><span class="line">       <span class="keyword">print</span> (<span class="string">"-"</span>, conn.inmod.name, <span class="string">" to"</span>, conn.outmod.name)</span><br><span class="line">       <span class="keyword">if</span> conn.paramdim &gt; <span class="number">0</span>:</span><br><span class="line">          <span class="keyword">print</span> (<span class="string">"- parameters"</span>, conn.params)</span><br></pre></td></tr></table></figure>
<pre><code>(&apos;Module:&apos;, &apos;outLayer&apos;)
(&apos;Module:&apos;, &apos;inLayer&apos;)
(&apos;-connection to&apos;, &apos;hiddenLayer0&apos;)
(&apos;- parameters&apos;, array([-0.47294263, -0.04334279,  0.77615167, -2.03865708,  2.38243634,
        0.69678661, -0.82062356, -0.70921933, -0.12044558]))
(&apos;Module:&apos;, &apos;hiddenLayer0&apos;)
(&apos;-connection to&apos;, &apos;outLayer&apos;)
(&apos;- parameters&apos;, array([ 1.08050317]))
</code></pre><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://blog.csdn.net/han_xiaoyang/article/details/49797143" target="_blank" rel="external">寒小阳-Titanic</a></li>
<li><a href="http://www.zengmingxia.com/topics/computing/" target="_blank" rel="external">一蓑烟雨任平生</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ml-python-pandas-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/02/15/ml-python-pandas-2/"><strong>Python pandas.DataFrame 类型数据操作函数 (not finish)</strong></a>
      <small class=article-date-index>&nbsp; 2017-02-15</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/15/ml-python-pandas-2/" class="article-date">
  <time datetime="2017-02-15T08:43:21.000Z" itemprop="datePublished">2017-02-15</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/machine-learning/">machine-learning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/02/15/ml-python-pandas-2/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th>Extension lib</th>
<th>introduction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Numpy</td>
<td>提供数组支持，以及相应的高效处理函数</td>
</tr>
<tr>
<td>Scipy</td>
<td>提供矩阵支持，以及矩阵相关的数值计算模块</td>
</tr>
<tr>
<td>Matplotlib</td>
<td>数据可视化工具，作图库</td>
</tr>
<tr>
<td>Pandas</td>
<td>数据分析和探索工具</td>
</tr>
<tr>
<td>Scikit-Learn</td>
<td>支持回归，分类，聚类 等强大的机器学习库</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Python数据分析工具pandas中DataFrame和Series作为主要的数据结构. 本文主要是介绍如何对DataFrame数据进行操作并结合一个实例测试操作函数。</p>
</blockquote>
<h2 id="1-查看DataFrame数据及属性"><a href="#1-查看DataFrame数据及属性" class="headerlink" title="1. 查看DataFrame数据及属性"></a>1. 查看DataFrame数据及属性</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df_obj = DataFrame() <span class="comment">#创建DataFrame对象</span></span><br><span class="line">df_obj.dtypes <span class="comment">#查看各行的数据格式</span></span><br><span class="line">df_obj[<span class="string">'列名'</span>].astype(int)<span class="comment">#转换某列的数据类型</span></span><br><span class="line">df_obj.head() <span class="comment">#查看前几行的数据,默认前5行</span></span><br><span class="line">df_obj.tail() <span class="comment">#查看后几行的数据,默认后5行</span></span><br><span class="line">df_obj.index <span class="comment">#查看索引</span></span><br><span class="line">df_obj.columns <span class="comment">#查看列名</span></span><br><span class="line">df_obj.values <span class="comment">#查看数据值</span></span><br><span class="line">df_obj.describe() <span class="comment">#描述性统计</span></span><br><span class="line">df_obj.T <span class="comment">#转置</span></span><br><span class="line">df_obj.sort_values(by=[<span class="string">''</span>,<span class="string">''</span>])<span class="comment">#同上</span></span><br></pre></td></tr></table></figure>
<h2 id="2-DataFrame选择数据"><a href="#2-DataFrame选择数据" class="headerlink" title="2. DataFrame选择数据"></a>2. DataFrame选择数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df_obj.ix[<span class="number">1</span>:<span class="number">3</span>] <span class="comment">#获取1-3行的数据,该操作叫切片操作,获取行数据</span></span><br><span class="line">df_obj.ix[columns_index] <span class="comment">#获取列的数据</span></span><br><span class="line">df_obj.ix[<span class="number">1</span>:<span class="number">3</span>，[<span class="number">1</span>,<span class="number">3</span>]]<span class="comment">#获取1列3列的1~3行数据</span></span><br><span class="line">df_obj[columns].drop_duplicates() <span class="comment">#剔除重复行数据</span></span><br></pre></td></tr></table></figure>
<h2 id="3-DataFrame重置数据"><a href="#3-DataFrame重置数据" class="headerlink" title="3. DataFrame重置数据"></a>3. DataFrame重置数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">df_obj.ix[<span class="number">1</span>:<span class="number">3</span>，[<span class="number">1</span>,<span class="number">3</span>]]=<span class="number">1</span> <span class="comment">#所选位置数据替换为1</span></span><br></pre></td></tr></table></figure>
<h2 id="4-DataFrame筛选数据"><a href="#4-DataFrame筛选数据" class="headerlink" title="4. DataFrame筛选数据"></a>4. DataFrame筛选数据</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">alist = [<span class="string">'023-18996609823'</span>]</span><br><span class="line">df_obj[<span class="string">'用户号码'</span>].isin(alist) <span class="comment">#将要过滤的数据放入字典中,使用isin对数据进行筛选,返回行索引以及每行筛选的结果,若匹配则返回ture</span></span><br><span class="line">df_obj[df_obj[<span class="string">'用户号码'</span>].isin(alist)] <span class="comment">#获取匹配结果为ture的行</span></span><br></pre></td></tr></table></figure>
<h2 id="Refence-article"><a href="#Refence-article" class="headerlink" title="Refence article"></a>Refence article</h2><p><a href="http://blog.csdn.net/ly_ysys629/article/details/54428838" target="_blank" rel="external">csdn-LY_ysys629</a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ml-coursera-ng-w4-nn-03" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/02/13/ml-coursera-ng-w4-nn-03/"><strong>Coursera Week 5 - Neural Networks II</strong></a>
      <small class=article-date-index>&nbsp; 2017-02-13</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/13/ml-coursera-ng-w4-nn-03/" class="article-date">
  <time datetime="2017-02-13T02:28:21.000Z" itemprop="datePublished">2017-02-13</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/machine-learning/">machine-learning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/02/13/ml-coursera-ng-w4-nn-03/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

<p><img src="/images/ml/ml-ng-w4-02-02.png" alt=""></p>
<h2 id="1-Cost-Function"><a href="#1-Cost-Function" class="headerlink" title="1. Cost Function"></a>1. Cost Function</h2><p><img src="/images/ml/ml-ng-w4-02-04-2.png" alt=""></p>
<p>fmt.</p>
<p>$$<br>\begin{align} a_1^{(2)} = g(\Theta_{10}^{(1)}x_0 + \Theta_{11}^{(1)}x_1 + \Theta_{12}^{(1)}x_2 + \Theta_{13}^{(1)}x_3) \newline a_2^{(2)} = g(\Theta_{20}^{(1)}x_0 + \Theta_{21}^{(1)}x_1 + \Theta_{22}^{(1)}x_2 + \Theta_{23}^{(1)}x_3) \newline a_3^{(2)} = g(\Theta_{30}^{(1)}x_0 + \Theta_{31}^{(1)}x_1 + \Theta_{32}^{(1)}x_2 + \Theta_{33}^{(1)}x_3) \newline h_\Theta(x) = a_1^{(3)} = g(\Theta_{10}^{(2)}a_0^{(2)} + \Theta_{11}^{(2)}a_1^{(2)} + \Theta_{12}^{(2)}a_2^{(2)} + \Theta_{13}^{(2)}a_3^{(2)}) \newline \end{align}<br>$$</p>
<p>Let’s first define a few variables that we will need to use:</p>
<ul>
<li>$L$ = total number of layers in the network</li>
<li>$s_l$ = number of units (not counting bias unit) in layer l</li>
<li>$K$ = number of output units/classes</li>
</ul>
<p>Recall that in neural networks, we may have many output nodes. We denote $h_\Theta(x)_k$ as being a hypothesis that results in the $k^{th}$ output. Our cost function for neural networks is going to be a generalization of the one we used for logistic regression. Recall that the cost function for regularized logistic regression was:</p>
<p>$$<br>J(\theta) = - \frac{1}{m} \sum_{i=1}^m [ y^{(i)}\ \log (h_\theta (x^{(i)})) + (1 - y^{(i)})\ \log (1 - h_\theta(x^{(i)}))] + \frac{\lambda}{2m}\sum_{j=1}^n \theta_j^2<br>$$</p>
<p>For neural networks, it is going to be slightly more complicated:</p>
<p>$$<br>\begin{gather} J(\Theta) = - \frac{1}{m} \sum_{i=1}^m \sum_{k=1}^K \left[y^{(i)}_k \log ((h_\Theta (x^{(i)}))_k) + (1 - y^{(i)}_k)\log (1 - (h_\Theta(x^{(i)}))_k)\right] + \frac{\lambda}{2m}\sum_{l=1}^{L-1} \sum_{i=1}^{s_l} \sum_{j=1}^{s_{l+1}} ( \Theta_{j,i}^{(l)})^2\end{gather}<br>$$</p>
<p>We have added a few nested summations to account for our multiple output nodes. In the first part of the equation, before the square brackets, we have an additional nested summation that loops through the number of output nodes.</p>
<p>In the regularization part, after the square brackets, we must account for multiple theta matrices. The number of columns in our current theta matrix is equal to the number of nodes in our current layer (including the bias unit). The number of rows in our current theta matrix is equal to the number of nodes in the next layer (excluding the bias unit). As before with logistic regression, we square every term.</p>
<h2 id="2-Backpropagation-Algorithm"><a href="#2-Backpropagation-Algorithm" class="headerlink" title="2. Backpropagation Algorithm"></a>2. Backpropagation Algorithm</h2><p>“Backpropagation” is neural-network terminology for minimizing our cost function, just like what we were doing with gradient descent in logistic and linear regression. Our goal is to compute:</p>
<p>$$<br>\min_\Theta J(\Theta)<br>$$</p>
<p>That is, we want to minimize our cost function $J$ using an optimal set of parameters in theta. In this section we’ll look at the equations we use to compute the partial derivative of J(Θ):</p>
<p>$$<br>\dfrac{\partial}{\partial \Theta_{i,j}^{(l)}}J(\Theta)<br>$$</p>
<p>To do so, we use the following algorithm:</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ml-coursera-ng-w4-nn-02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/02/07/ml-coursera-ng-w4-nn-02/"><strong>Coursera Week 4 - Neural Networks I</strong></a>
      <small class=article-date-index>&nbsp; 2017-02-07</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/02/07/ml-coursera-ng-w4-nn-02/" class="article-date">
  <time datetime="2017-02-07T02:28:21.000Z" itemprop="datePublished">2017-02-07</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/machine-learning/">machine-learning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/02/07/ml-coursera-ng-w4-nn-02/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

<p><img src="/images/ml/ml-ng-w4-02-02.png" alt="NN"></p>
<p>neuron is a computational unit that gets a number of inputs through it input wires and does some computation and then it says outputs via its axon to other nodes or to other neurons in the brain.</p>
<h2 id="1-Model-Representation-I"><a href="#1-Model-Representation-I" class="headerlink" title="1. Model Representation I"></a>1. Model Representation I</h2><p>Let’s examine how we will represent a hypothesis function using neural networks. At a very simple level, neurons are basically computational units that take inputs (<strong>dendrites</strong>) as electrical inputs (called “spikes”) that are channeled to outputs (<strong>axons</strong>). In our model, <strong>our dendrites are like the input features</strong> $x_1\cdots x_n$, and the <strong>output is the result of our hypothesis function</strong>. In this model our $x_0$ input node is sometimes called the “bias unit.” It is always equal to 1. In neural networks, we use the same logistic function as in classification, $\frac{1}{1 + e^{-\theta^Tx}}$, yet we sometimes call it a sigmoid (logistic) <strong>activation</strong> function. In this situation, our “theta” parameters are sometimes called “weights”.</p>
<p>Visually, a simplistic representation looks like:</p>
<p>$$<br>\begin{bmatrix}x_0 \newline x_1 \newline x_2 \newline \end{bmatrix}\rightarrow\begin{bmatrix}\ \ \ \newline \end{bmatrix}\rightarrow h_\theta(x)<br>$$</p>
<p><img src="/images/ml/ml-ng-w4-02-03.png" alt="NN"></p>
<p>Our input nodes (layer 1), also known as the “input layer”, go into another node (layer 2), which finally outputs the hypothesis function, known as the “output layer”.</p>
<p>We can have intermediate layers of nodes between the input and output layers called the “hidden layers.”</p>
<p>In this example, we label these intermediate or “hidden” layer nodes $a^2_0 \cdots a^2_n$ and call them “activation units.”</p>
<p>$$<br>\begin{align} &amp; a_i^{(j)} = \text{“activation” of unit $i$ in layer $j$} \newline&amp; \Theta^{(j)} = \text{matrix of weights controlling function mapping from layer $j$ to layer $j+1$} \end{align}<br>$$</p>
<p>If we had one hidden layer, it would <a href="/images/ml/ml-ng-w4-02-04-2.png">look like</a>:</p>
<p>$$<br>\begin{bmatrix}x_0 \newline x_1 \newline x_2 \newline x_3\end{bmatrix}\rightarrow\begin{bmatrix}a_1^{(2)} \newline a_2^{(2)} \newline a_3^{(2)} \newline \end{bmatrix}\rightarrow h_\theta(x)<br>$$</p>
<p>The values for each of the “activation” nodes is obtained as follows:</p>
<p>$$<br>\begin{align} a_1^{(2)} = g(\Theta_{10}^{(1)}x_0 + \Theta_{11}^{(1)}x_1 + \Theta_{12}^{(1)}x_2 + \Theta_{13}^{(1)}x_3) \newline a_2^{(2)} = g(\Theta_{20}^{(1)}x_0 + \Theta_{21}^{(1)}x_1 + \Theta_{22}^{(1)}x_2 + \Theta_{23}^{(1)}x_3) \newline a_3^{(2)} = g(\Theta_{30}^{(1)}x_0 + \Theta_{31}^{(1)}x_1 + \Theta_{32}^{(1)}x_2 + \Theta_{33}^{(1)}x_3) \newline h_\Theta(x) = a_1^{(3)} = g(\Theta_{10}^{(2)}a_0^{(2)} + \Theta_{11}^{(2)}a_1^{(2)} + \Theta_{12}^{(2)}a_2^{(2)} + \Theta_{13}^{(2)}a_3^{(2)}) \newline \end{align}<br>$$</p>
<p>This is saying that we compute our activation nodes by using a 3×4 matrix of parameters. We apply each row of the parameters to our inputs to obtain the value for one activation node. Our hypothesis output is the logistic function applied to the sum of the values of our activation nodes, which have been multiplied by yet another parameter matrix $\Theta^{(2)}$ containing the weights for our second layer of nodes.</p>
<p>Each layer gets its own matrix of weights, $\Theta^{(j)}$</p>
<p>The dimensions of these matrices of weights is determined as follows:</p>
<p>If network has $s_j$ units in layer $j$ and $s_{j+1}$ units in layer $j+1$, then $\Theta^{(j)}$ will be of dimension $s_{j+1} \times (s_j + 1)$</p>
<p>The +1 comes from the addition in $\Theta^{(j)}$ of the “bias nodes,” $x_0$ and $\Theta_0^{(j)}$. In other words the output nodes will not include the bias nodes while the inputs will. </p>
<h2 id="2-Model-Representation-II"><a href="#2-Model-Representation-II" class="headerlink" title="2. Model Representation II"></a>2. Model Representation II</h2><p>To re-iterate, the following is an example of a neural network:</p>
<p>$$<br>\begin{align} a_1^{(2)} = g(\Theta_{10}^{(1)}x_0 + \Theta_{11}^{(1)}x_1 + \Theta_{12}^{(1)}x_2 + \Theta_{13}^{(1)}x_3) \newline a_2^{(2)} = g(\Theta_{20}^{(1)}x_0 + \Theta_{21}^{(1)}x_1 + \Theta_{22}^{(1)}x_2 + \Theta_{23}^{(1)}x_3) \newline a_3^{(2)} = g(\Theta_{30}^{(1)}x_0 + \Theta_{31}^{(1)}x_1 + \Theta_{32}^{(1)}x_2 + \Theta_{33}^{(1)}x_3) \newline h_\Theta(x) = a_1^{(3)} = g(\Theta_{10}^{(2)}a_0^{(2)} + \Theta_{11}^{(2)}a_1^{(2)} + \Theta_{12}^{(2)}a_2^{(2)} + \Theta_{13}^{(2)}a_3^{(2)}) \newline \end{align}<br>$$</p>
<p>In this section we’ll do a vectorized implementation of the above functions. We’re going to define a new variable $z_k^{(j)}$ that encompasses the parameters inside our g function. In our previous example if we replaced by the variable z for all the parameters we would get:</p>
<p>$$<br>\begin{align}a_1^{(2)} = g(z_1^{(2)}) \newline a_2^{(2)} = g(z_2^{(2)}) \newline a_3^{(2)} = g(z_3^{(2)}) \newline \end{align}<br>$$</p>
<p>In other words, for layer $j=2$ and node $k$, the variable $z$ will be:</p>
<p>$$<br>z_k^{(2)} = \Theta_{k,0}^{(1)}x_0 + \Theta_{k,1}^{(1)}x_1 + \cdots + \Theta_{k,n}^{(1)}x_n<br>$$</p>
<p>The vector representation of $x$ and $z^{j}$ is:</p>
<p>$$<br>\begin{align}x = \begin{bmatrix}x_0 \newline x_1 \newline\cdots \newline x_n\end{bmatrix} &amp;z^{(j)} = \begin{bmatrix}z_1^{(j)} \newline z_2^{(j)} \newline\cdots \newline z_n^{(j)}\end{bmatrix}\end{align}<br>$$</p>
<p>Setting $x = a^{(1)}$, we can rewrite the equation as:</p>
<p>$$<br>z^{(j)} = \Theta^{(j-1)}a^{(j-1)}<br>$$</p>
<p>We are multiplying our matrix $\Theta^{(j-1)}$ with dimensions $s_j\times (n+1)$ (where $s_j$ is the number of our activation nodes) by our vector $a^{(j-1)}$ with height (n+1). This gives us our vector $z^{(j)}$ with height $s_j$. Now we can get a vector of our activation nodes for layer $j$ as follows:</p>
<p>$$<br>a^{(j)} = g(z^{(j)})<br>$$</p>
<p>Where our function $g$ can be applied element-wise to our vector $z^{(j)}$.</p>
<p>We can then add a bias unit (equal to 1) to layer j after we have computed $a^{(j)}$. This will be element $a_0^{(j)}$ and will be equal to 1. To compute our final hypothesis, let’s first compute another $z$ vector:</p>
<p>$$<br>z^{(j+1)} = \Theta^{(j)}a^{(j)}<br>$$</p>
<p>We get this final z vector by multiplying the next theta matrix after $\Theta^{(j-1)}$ with the values of all the activation nodes we just got. This last theta matrix $\Theta^{(j)}$ will have only one row which is multiplied by one column $a^{(j)}$ so that our result is a single number. We then get our final result with:</p>
<p>$$<br>h_\Theta(x) = a^{(j+1)} = g(z^{(j+1)})<br>$$</p>
<h2 id="3-Simple-Example"><a href="#3-Simple-Example" class="headerlink" title="3. Simple Example"></a>3. Simple Example</h2><p><img src="/images/ml/ml-ng-w4-02-06.png" alt="NN"></p>
<h3 id="3-1-x-1-AND-x-2"><a href="#3-1-x-1-AND-x-2" class="headerlink" title="3.1 $x_1$ AND $x_2$"></a>3.1 $x_1$ AND $x_2$</h3><p>A simple example of applying neural networks is by predicting $x_1$ AND $x_2$</p>
<p>$$<br>\begin{align} \begin{bmatrix}x_0 \newline x_1 \newline x_2\end{bmatrix} \rightarrow\begin{bmatrix}g(z^{(2)})\end{bmatrix} \rightarrow h_\Theta(x) \end{align}<br>$$</p>
<p>Let’s set our first theta matrix as:</p>
<p>$$<br>\Theta^{(1)} =\begin{bmatrix}-30 &amp; 20 &amp; 20\end{bmatrix}<br>$$</p>
<p>This will cause the output of our hypothesis to only be positive if both $x_1$ and $x_2$ are 1. In other words:</p>
<p>$$<br>\begin{align}&amp; h_\Theta(x) = g(-30 + 20x_1 + 20x_2) \newline \newline &amp; x_1 = 0 \ \ and \ \ x_2 = 0 \ \ then \ \ g(-30) \approx 0 \newline &amp; x_1 = 0 \ \ and \ \ x_2 = 1 \ \ then \ \ g(-10) \approx 0 \newline &amp; x_1 = 1 \ \ and \ \ x_2 = 0 \ \ then \ \ g(-10) \approx 0 \newline &amp; x_1 = 1 \ \ and \ \ x_2 = 1 \ \ then \ \ g(10) \approx 1\end{align}<br>$$</p>
<p><img src="/images/ml/ml-ng-w4-02-07.png" alt="NN"></p>
<h3 id="3-2-x-1-XNOR-x-2"><a href="#3-2-x-1-XNOR-x-2" class="headerlink" title="3.2 $x_1$ XNOR $x_2$"></a>3.2 $x_1$ XNOR $x_2$</h3><p>The $Θ^{(1)}$ matrices for AND, NOR, and OR are:</p>
<p>$$<br>\begin{align}AND:\newline\Theta^{(1)} &amp;=\begin{bmatrix}-30 &amp; 20 &amp; 20\end{bmatrix} \newline NOR:\newline\Theta^{(1)} &amp;= \begin{bmatrix}10 &amp; -20 &amp; -20\end{bmatrix} \newline OR:\newline\Theta^{(1)} &amp;= \begin{bmatrix}-10 &amp; 20 &amp; 20\end{bmatrix} \newline\end{align}<br>$$</p>
<p>We can combine these to get the XNOR logical operator (which gives 1 if $x_1$ and $x_2$ are both 0 or both 1).</p>
<p>$$<br>\begin{align} \begin{bmatrix}x_0 \newline x_1 \newline x_2\end{bmatrix} \rightarrow\begin{bmatrix}a_1^{(2)} \newline a_2^{(2)} \end{bmatrix} \rightarrow\begin{bmatrix}a^{(3)}\end{bmatrix} \rightarrow h_\Theta(x) \end{align}<br>$$</p>
<p>For the transition between the first and second layer, we’ll use a $Θ^{(1)}$ matrix that combines the values for AND and NOR:</p>
<p>$$<br>\Theta^{(1)} =\begin{bmatrix}-30 &amp; 20 &amp; 20 \newline 10 &amp; -20 &amp; -20\end{bmatrix}<br>$$</p>
<p>Let’s write out the values for all our nodes:</p>
<p>$$<br>\begin{align}&amp; a^{(2)} = g(\Theta^{(1)} \cdot x) \newline&amp; a^{(3)} = g(\Theta^{(2)} \cdot a^{(2)}) \newline&amp; h_\Theta(x) = a^{(3)}\end{align}<br>$$</p>
<p>And there we have the XNOR operator using one hidden layers! The following summarizes the above algorithm:</p>
<p><img src="/images/ml/ml-ng-w4-02-08.png" alt=""></p>
<h2 id="4-Multiclass-Classification"><a href="#4-Multiclass-Classification" class="headerlink" title="4. Multiclass Classification"></a>4. Multiclass Classification</h2><p>To classify data into multiple classes, we let our hypothesis function return a vector of values.</p>
<p><img src="/images/ml/ml-ng-w4-02-09.png" alt=""></p>
<p>We can define our set of resulting classes as y:</p>
<p><img src="/images/ml/ml-ng-w4-02-10.png" alt=""></p>
<p>Each $y^{(i)}$ represents a different image corresponding to either a car, pedestrian, truck, or motorcycle. </p>
<p><img src="/images/ml/ml-ng-w4-02-11.png" alt=""></p>
<p>Our resulting hypothesis for one set of inputs may look like:</p>
<p>$$<br>h_\Theta(x) =\begin{bmatrix}0 \newline 0 \newline 1 \newline 0 \newline\end{bmatrix}<br>$$</p>
<p>In which case our resulting class is the third one down, or $h_\Theta(x)_3$, which represents the motorcycle.</p>
<h2 id="Reference-article"><a href="#Reference-article" class="headerlink" title="Reference article"></a>Reference article</h2>
      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ml-tensorflow" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/01/21/ml-tensorflow/"><strong>tensorflow</strong></a>
      <small class=article-date-index>&nbsp; 2017-01-21</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/01/21/ml-tensorflow/" class="article-date">
  <time datetime="2017-01-21T02:28:21.000Z" itemprop="datePublished">2017-01-21</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/machine-learning/">machine-learning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/01/21/ml-tensorflow/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>


<p><a href="https://www.tensorflow.org/" target="_blank" rel="external">https://www.tensorflow.org/</a></p>
<p><a href="http://www.tensorfly.cn/" target="_blank" rel="external">http://www.tensorfly.cn/</a></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-life-China-modern-history" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/01/21/life-China-modern-history/"><strong>biggest bandit spy</strong></a>
      <small class=article-date-index>&nbsp; 2017-01-21</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/01/21/life-China-modern-history/" class="article-date">
  <time datetime="2017-01-20T23:54:16.000Z" itemprop="datePublished">2017-01-21</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/life/">life</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/01/21/life-China-modern-history/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-biggest-bandit-spy"><a href="#1-biggest-bandit-spy" class="headerlink" title="1. biggest bandit spy"></a>1. biggest bandit spy</h2><p>Guo Rugui</p>
<div class="video-container"><iframe src="//www.youtube.com/embed/O2tc43ceZ-c" frameborder="0" allowfullscreen></iframe></div>
<h2 id="2-Hold-down-Chiang-Kai-shek-pulse"><a href="#2-Hold-down-Chiang-Kai-shek-pulse" class="headerlink" title="2. Hold down Chiang Kai-shek pulse"></a>2. Hold down Chiang Kai-shek pulse</h2><p>Shen Anna</p>
<div class="video-container"><iframe src="//www.youtube.com/embed/dEy8yrB5ZIg" frameborder="0" allowfullscreen></iframe></div>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-db-greenplum-mysql-ext-ods" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/01/20/db-greenplum-mysql-ext-ods/"><strong>Greenplum ods</strong></a>
      <small class=article-date-index>&nbsp; 2017-01-20</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/01/20/db-greenplum-mysql-ext-ods/" class="article-date">
  <time datetime="2017-01-20T07:28:21.000Z" itemprop="datePublished">2017-01-20</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/database/">database</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/01/20/db-greenplum-mysql-ext-ods/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p><a href="https://github.com/blairchan/bigdata/tree/master/greenplum/ext_ods_table" target="_blank" rel="external">code : github ext_ods_table</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">运行本模块之前 :</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ext_ods_table</span><br><span class="line">mkdir <span class="built_in">log</span> flag</span><br><span class="line">mkdir -p <span class="built_in">log</span>/crontab</span><br><span class="line">mkdir data</span><br><span class="line"></span><br><span class="line">构造 datax json file， put it to **data** 目录</span><br></pre></td></tr></table></figure>
<h2 id="1-Needs"><a href="#1-Needs" class="headerlink" title="1. Needs"></a>1. Needs</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;程序自动化拉取数据进入原始层 ODS</p>
<h2 id="2-Data-Flow"><a href="#2-Data-Flow" class="headerlink" title="2. Data Flow"></a>2. Data Flow</h2><p><img src="/images/db/greenplum-ods-flow.png" alt="ods flow"></p>
<blockquote>
<p>具体请以实际线上代码 为准</p>
</blockquote>
<h2 id="3-Involved-technology"><a href="#3-Involved-technology" class="headerlink" title="3. Involved technology"></a>3. Involved technology</h2><ol>
<li><a href="https://zh.wikipedia.org/zh-hans/Unix_shell" target="_blank" rel="external">Shell</a></li>
<li><a href="https://github.com/alibaba/DataX/" target="_blank" rel="external">Datax</a></li>
<li><a href="https://en.wikipedia.org/wiki/PostgreSQL" target="_blank" rel="external">PostgreSQL</a></li>
<li><a href="http://dbaplus.cn/news-21-341-1.html" target="_blank" rel="external">Greenplum</a></li>
<li><a href="http://www.pentaho.com/" target="_blank" rel="external">Pentaho kettle</a></li>
</ol>
<blockquote>
<p><a href="http://www.greenplumdba.com/gpfdist" target="_blank" rel="external">gpfdist protocol</a></p>
</blockquote>
<h2 id="4-Main-Code-Flow"><a href="#4-Main-Code-Flow" class="headerlink" title="4. Main Code Flow"></a>4. Main Code Flow</h2><p>(1). linux crontab</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*/5 00-19 * * * <span class="built_in">source</span> /etc/bashrc; sh /data0/dm/online/ext_ods_table/crontab_job/crontab_job_ods_shop.sh</span><br></pre></td></tr></table></figure>
<blockquote>
<p>source /etc/bashrc; 环境设置</p>
</blockquote>
<p>(2). crontab_job_ods_shop.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">sh ods_dm_shop.sh <span class="variable">$&#123;d1&#125;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>(3). ods_dm_shop.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @date:   2017.01.20</span></span><br><span class="line"><span class="comment"># @desc:   mysql data -&gt; ext shop -&gt; ods shop</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> `dirname <span class="variable">$0</span>`/.. &amp;&amp; wk_dir=`<span class="built_in">pwd</span>` &amp;&amp; <span class="built_in">cd</span> -</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$&#123;wk_dir&#125;</span>/util/env</span><br><span class="line"><span class="built_in">source</span> <span class="variable">$&#123;util_dir&#125;</span>/my_<span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">begin_time=<span class="string">"2010-01-01"</span></span><br><span class="line">end_time=<span class="variable">$&#123;d1&#125;</span></span><br><span class="line"></span><br><span class="line">import_gpdata_from_rds1 <span class="variable">$&#123;begin_time&#125;</span> <span class="variable">$&#123;end_time&#125;</span> <span class="variable">$&#123;data_dir&#125;</span>/xkeshi_com.ext/mysql2textfile-shop.json</span><br><span class="line">check_success</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>_ex <span class="string">"<span class="variable">$&#123;data_integration&#125;</span>/kitchen.sh -file=<span class="variable">$&#123;ktrs_dir&#125;</span>/ods_shop.kjb"</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;data_integration&#125;</span>/kitchen.sh -file=<span class="variable">$&#123;ktrs_dir&#125;</span>/ods_shop.kjb</span><br><span class="line">check_success</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>_ex <span class="string">"import shop end"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
<h2 id="5-Code-Deploy"><a href="#5-Code-Deploy" class="headerlink" title="5. Code Deploy"></a>5. Code Deploy</h2><blockquote>
<p>/data0/dm/online/ext_ods_table  </p>
<p>注意： 版本控制中，涉及的敏感 库地址，用户名，密码 等 不上传。</p>
</blockquote>
<h2 id="6-Frnd-Link"><a href="#6-Frnd-Link" class="headerlink" title="6. Frnd Link"></a>6. Frnd Link</h2><ol>
<li><a href="https://github.com/blairchan/bigdata/tree/master/greenplum/ext_ods_table/doc" target="_blank" rel="external">pull data detail flow</a></li>
<li><a href="https://github.com/blairchan/bigdata/blob/master/greenplum/ext_ods_table/doc/scheduling-framework.md" target="_blank" rel="external">scheduling-framework</a></li>
</ol>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-db-greenplum-manual-dev-steps" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/01/12/db-greenplum-manual-dev-steps/"><strong>Greenplum dev Flow</strong></a>
      <small class=article-date-index>&nbsp; 2017-01-12</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/01/12/db-greenplum-manual-dev-steps/" class="article-date">
  <time datetime="2017-01-12T07:28:21.000Z" itemprop="datePublished">2017-01-12</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/database/">database</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/01/12/db-greenplum-manual-dev-steps/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/images/db/greenplum-flow.png" alt=""></p>
<h2 id="1-Rds-import-oss"><a href="#1-Rds-import-oss" class="headerlink" title="1. Rds import oss"></a>1. Rds import oss</h2><p>通过 datax 从 mysql 导出数据到 OSS</p>
<p>组装 : mysql2oss-e_coupon.json</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "job": &#123;</span><br><span class="line">        "content": [</span><br><span class="line">        &#123;</span><br><span class="line">            "reader": &#123;</span><br><span class="line">                "name": "mysqlreader",</span><br><span class="line">                    "parameter": &#123;</span><br><span class="line">                        "username": "xx",</span><br><span class="line">                        "password": "xx",</span><br><span class="line">                        "connection": [</span><br><span class="line">                        &#123;</span><br><span class="line">                            "jdbcUrl": [</span><br><span class="line">                                "jdbc:mysql://192.168.184.xx:port"</span><br><span class="line">                                ],</span><br><span class="line">                            "table": [</span><br><span class="line">                                "rds-lib-name.e_coupon"</span><br><span class="line">                                ]</span><br><span class="line">                        &#125;</span><br><span class="line">                        ],</span><br><span class="line">                        "column":[</span><br><span class="line">                            "id",</span><br><span class="line">                            "x_card_user_id",</span><br><span class="line">                            "coupon_discount_code",</span><br><span class="line">                            ...</span><br><span class="line">                            "order_merchant_id"</span><br><span class="line">                        ],</span><br><span class="line">                        "where": "created_time BETWEEN '2016-01-01 00:00:00' AND '2017-01-05 23:59:59'"</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">                "writer": &#123;</span><br><span class="line">                    "name": "osswriter",</span><br><span class="line">                    "parameter": &#123;</span><br><span class="line">                        "accessId": "xx",</span><br><span class="line">                        "accessKey": "xx",</span><br><span class="line">                        "bucket": "company-name-data",</span><br><span class="line">                        "encoding": "UTF-8",</span><br><span class="line">                        "endpoint": "http://oss-cn-hangzhou.aliyuncs.com",</span><br><span class="line">                        "fieldDelimiter": "\t",</span><br><span class="line">                        "object": "datax_dev/libin/e_coupon",</span><br><span class="line">                        "writeMode": "truncate"</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ],</span><br><span class="line">        "setting": &#123;</span><br><span class="line">            "speed": &#123;</span><br><span class="line">                "channel": 1</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>触发执行 :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python datax.py mysql2oss-e_coupon.json</span><br></pre></td></tr></table></figure>
<h2 id="2-ext-table"><a href="#2-ext-table" class="headerlink" title="2. ext table"></a>2. ext table</h2><p>创建外部表，ext_dm_e_coupon，并将 location 指向为 oss</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> <span class="keyword">PUBLIC</span>.ext_dm_e_coupon;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> <span class="keyword">PUBLIC</span>.ext_dm_e_coupon (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">bigint</span>,</span><br><span class="line">    x_card_user_id <span class="built_in">varchar</span>,</span><br><span class="line">    coupon_discount_code <span class="built_in">varchar</span>,</span><br><span class="line">    ...</span><br><span class="line">    order_merchant_id <span class="built_in">bigint</span></span><br><span class="line">) LOCATION(</span><br><span class="line">    <span class="string">'oss://oss-cn-hangzhou.aliyuncs.com</span><br><span class="line">        dir=datax_dev/libin/</span><br><span class="line">        id=xx</span><br><span class="line">        key=xx</span><br><span class="line">        bucket=xkeshi-data'</span></span><br><span class="line">) <span class="keyword">FORMAT</span> <span class="string">'text'</span> (<span class="literal">NULL</span> <span class="keyword">AS</span> <span class="string">'null'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 45596 id comment 字段有回车 ,So del comment varchar, don't imported.</span></span><br></pre></td></tr></table></figure>
<h2 id="3-ods-table"><a href="#3-ods-table" class="headerlink" title="3. ods table"></a>3. ods table</h2><p>创建 ods_dm_e_coupon 表，并向其中导入数据</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> ods_dm_e_coupon;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ods_dm_e_coupon <span class="keyword">AS</span> <span class="keyword">SELECT</span></span><br><span class="line">	*</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	ext_dm_e_coupon <span class="keyword">distributed</span> <span class="keyword">BY</span> (<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意 : 这样建表 ods table id，不是 primary key</p>
<p>显示指定 distributed BY (id)，可读性更好</p>
</blockquote>
<h2 id="4-mds-table"><a href="#4-mds-table" class="headerlink" title="4. mds table"></a>4. mds table</h2><p>创建 mds_dm_e_coupon_profile 表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> mds_dm_e_coupon_profile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mds_dm_e_coupon_profile (</span><br><span class="line">	<span class="keyword">id</span> bigserial,</span><br><span class="line">	coupon_info_code <span class="built_in">VARCHAR</span>,</span><br><span class="line">	shop_id <span class="built_in">BIGINT</span>,</span><br><span class="line">	collected_avg_actual_price <span class="built_in">DECIMAL</span> (<span class="number">12</span>, <span class="number">2</span>),</span><br><span class="line">	collected_sum_actual_price <span class="built_in">DECIMAL</span> (<span class="number">12</span>, <span class="number">2</span>),</span><br><span class="line">	collected_count <span class="built_in">INT</span>,</span><br><span class="line">	verified_count <span class="built_in">INT</span>,</span><br><span class="line">	verified_rate <span class="built_in">DECIMAL</span> (<span class="number">12</span>, <span class="number">2</span>)</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">	appendonly = <span class="literal">TRUE</span>,</span><br><span class="line">	compresslevel = <span class="number">5</span></span><br><span class="line">) <span class="keyword">distributed</span> <span class="keyword">BY</span> (<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建表的时候，给一个自增 id. 每一个表都有一个自增 id，是一个比较好的规范</p>
</blockquote>
<h2 id="5-insert-mds-table"><a href="#5-insert-mds-table" class="headerlink" title="5. insert mds table"></a>5. insert mds table</h2><p>insert data to mds_dm_e_coupon_profile</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mds_dm_e_coupon_profile (</span><br><span class="line">	coupon_info_code,</span><br><span class="line">	shop_id,</span><br><span class="line">	collected_avg_actual_price,</span><br><span class="line">	collected_sum_actual_price,</span><br><span class="line">	collected_count,</span><br><span class="line">	verified_count,</span><br><span class="line">	verified_rate</span><br><span class="line">) <span class="keyword">SELECT</span></span><br><span class="line">	tt1.coupon_info_code,</span><br><span class="line">	tt1.shop_id,</span><br><span class="line">	tt1.avg_actual_price <span class="keyword">AS</span> collected_avg_actual_price,</span><br><span class="line">	tt1.sum_actual_price <span class="keyword">AS</span> collected_sum_actual_price,</span><br><span class="line">	tt1.collected_count,</span><br><span class="line">	<span class="keyword">COALESCE</span> (tt2.verified_count, <span class="number">0</span>) <span class="keyword">AS</span> verified_count,</span><br><span class="line">	<span class="keyword">round</span>(</span><br><span class="line">		(</span><br><span class="line">			<span class="keyword">COALESCE</span> (tt2.verified_count, <span class="number">0</span>) * <span class="number">1.0</span></span><br><span class="line">		) / (tt1.collected_count * <span class="number">1.0</span>),</span><br><span class="line">		<span class="number">2</span></span><br><span class="line">	) <span class="keyword">AS</span> verified_rate</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	(</span><br><span class="line">		<span class="keyword">SELECT</span></span><br><span class="line">			t1.coupon_info_code,</span><br><span class="line">			t1.shop_id,</span><br><span class="line">			<span class="keyword">COUNT</span> (t1.<span class="keyword">ID</span>) <span class="keyword">AS</span> collected_count,</span><br><span class="line">			<span class="keyword">round</span>(<span class="keyword">AVG</span>(t1.actual_price), <span class="number">2</span>) <span class="keyword">AS</span> avg_actual_price,</span><br><span class="line">			<span class="keyword">SUM</span> (t1.actual_price) <span class="keyword">AS</span> sum_actual_price</span><br><span class="line">		<span class="keyword">FROM</span></span><br><span class="line">			(</span><br><span class="line">				<span class="keyword">SELECT</span></span><br><span class="line">					*</span><br><span class="line">				<span class="keyword">FROM</span></span><br><span class="line">					ods_dm_e_coupon</span><br><span class="line">				<span class="keyword">WHERE</span></span><br><span class="line">					<span class="keyword">status</span> = <span class="number">1</span></span><br><span class="line">			) t1</span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">			(t1.coupon_info_code, t1.shop_id)</span><br><span class="line">		<span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">			t1.shop_id</span><br><span class="line">	) tt1</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		t2.coupon_info_code,</span><br><span class="line">		t2.shop_id,</span><br><span class="line">		<span class="keyword">COUNT</span> (t2.<span class="keyword">ID</span>) <span class="keyword">AS</span> verified_count,</span><br><span class="line">		<span class="keyword">round</span>(<span class="keyword">AVG</span>(t2.actual_price), <span class="number">2</span>) <span class="keyword">AS</span> avg_actual_price,</span><br><span class="line">		<span class="keyword">SUM</span> (t2.actual_price) <span class="keyword">AS</span> sum_actual_price</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		(</span><br><span class="line">			<span class="keyword">SELECT</span></span><br><span class="line">				*</span><br><span class="line">			<span class="keyword">FROM</span></span><br><span class="line">				ods_dm_e_coupon</span><br><span class="line">			<span class="keyword">WHERE</span></span><br><span class="line">				<span class="keyword">status</span> = <span class="number">1</span></span><br><span class="line">			<span class="keyword">AND</span> <span class="keyword">RESULT</span> = <span class="number">2</span></span><br><span class="line">		) t2</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">		(t2.coupon_info_code, t2.shop_id)</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">		t2.shop_id</span><br><span class="line">) tt2 <span class="keyword">ON</span> tt1.coupon_info_code = tt2.coupon_info_code</span><br><span class="line"><span class="keyword">AND</span> tt1.shop_id = tt2.shop_id</span><br></pre></td></tr></table></figure>
<h2 id="6-validation-results"><a href="#6-validation-results" class="headerlink" title="6. validation results"></a>6. validation results</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> mds_dm_e_coupon_profile <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">limit</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
<p><img src="/images/db/greenplum-man-1.png" alt=""></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-db-greenplum-short-introduce" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/01/04/db-greenplum-short-introduce/"><strong>Greenplum 学习笔记</strong></a>
      <small class=article-date-index>&nbsp; 2017-01-04</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/01/04/db-greenplum-short-introduce/" class="article-date">
  <time datetime="2017-01-04T07:28:21.000Z" itemprop="datePublished">2017-01-04</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/database/">database</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/01/04/db-greenplum-short-introduce/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <style>
img {
        display: block !important;
        width: 500px;
        margin-left: 180px !important;
}
</style>

<p><img src="/images/db/greenplum-1.1.png" alt=""></p>
<table>
<thead>
<tr>
<th>No.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th>OLTP</th>
<th>OLAP</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.</td>
<td>数据在系统中产生</td>
<td>本身不产生数据，基础数据来源于产生系统</td>
</tr>
<tr>
<td>2.</td>
<td>基于交易的处理系统</td>
<td>基于查询的分析系统</td>
</tr>
<tr>
<td>3.</td>
<td>牵扯的数据量很小</td>
<td>牵扯的数据量庞大 (复杂查询经常使用全表扫描等)</td>
</tr>
<tr>
<td>4.</td>
<td>对响应时间要求非常高</td>
<td>响应时间与具体查询有很大关系</td>
</tr>
<tr>
<td>5.</td>
<td>用户数量大，为操作用户</td>
<td>用户数量少，主要有技术人员与业务人员</td>
</tr>
<tr>
<td>6.</td>
<td>各种操作主要基于索引进行</td>
<td>业务问题不固定，数据库的各种操作不能完全基于索引进行</td>
</tr>
</tbody>
</table>
<h2 id="1-Greenplum-介绍"><a href="#1-Greenplum-介绍" class="headerlink" title="1. Greenplum 介绍"></a>1. Greenplum 介绍</h2><p>Greenplum 是 基于数据库的分布式数据存储和并行计算 框架</p>
<blockquote>
<p>Greenplum TB级别表现非常优秀，单机性能比Hadoop快好几倍</p>
</blockquote>
<h3 id="1-1-Greenplum-历程"><a href="#1-1-Greenplum-历程" class="headerlink" title="1.1 Greenplum 历程"></a>1.1 Greenplum 历程</h3><ul>
<li>2003 年 诞生 greenplum</li>
<li>2010 年 收购 被 EMC 整合</li>
<li>2014 年 发布 4.3 version</li>
<li>2015 年 重回 open source, apache</li>
</ul>
<h3 id="1-2-Greenplum-架构"><a href="#1-2-Greenplum-架构" class="headerlink" title="1.2 Greenplum 架构"></a>1.2 Greenplum 架构</h3><p><img src="/images/db/greenplum-1.2.png" alt=""></p>
<blockquote>
<p>Greenplum实现了基于<code>数据库的分布式</code>数据存储和并行计算<br>GoogleMapReduce实现的是基于<code>文件的分布式</code>数据存储和计算</p>
</blockquote>
<h3 id="1-3-Greenplum-amp-Pg"><a href="#1-3-Greenplum-amp-Pg" class="headerlink" title="1.3 Greenplum &amp; Pg"></a>1.3 Greenplum &amp; Pg</h3><p>PostgreSQL 非常先进的 ORDBMS， PostgreSQL 天生为扩展而生。</p>
<p>Mysql 查询优化器对于子查询、复制查询如多表关联、外关联的支持等较弱，Mysql 目前不支持<a href="https://en.wikipedia.org/wiki/Hash_join" target="_blank" rel="external">hash join</a>，缺少这关键功能非常致命，将难于在OLAP领域充当大任。基于MYSQL一到复杂多表关联性能就立马下降。</p>
<h3 id="1-4-Greenplum-应用"><a href="#1-4-Greenplum-应用" class="headerlink" title="1.4 Greenplum 应用"></a>1.4 Greenplum 应用</h3><p>Greenplum 数据引擎是为新一代数据仓库和<code>大规模分析处理</code>而建立的软件解决方案。 (Alibaba 2008年使用Greenplum)</p>
<blockquote>
<p>MPP : Massively Parallel Processing<br>OLTP: On-Line Transaction Processing<br>OLAP: On-Line Analytical Processing </p>
</blockquote>
<h3 id="1-5-MPP-与-Hadoop"><a href="#1-5-MPP-与-Hadoop" class="headerlink" title="1.5 MPP 与 Hadoop"></a>1.5 MPP 与 Hadoop</h3><table>
<thead>
<tr>
<th>&nbsp;&nbsp;Type &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</th>
<th>Greenplum MPP</th>
<th>Hadoop</th>
</tr>
</thead>
<tbody>
<tr>
<td>存储模式</td>
<td>关系数据库行列表存储数据（有模式）</td>
<td>文件切片分布式存储（无模式）</td>
</tr>
<tr>
<td>数据耦合</td>
<td>Hash分布, 计算节点和存储紧密耦合</td>
<td>hdfs文件切块后随机分配，节点数据无耦合</td>
</tr>
<tr>
<td>数据粒度</td>
<td>记录级的更小粒度（一般在1k以下）</td>
<td>文件块级（缺省64MB）</td>
</tr>
<tr>
<td>查询计划</td>
<td>MPP采用SQL并行查询计划</td>
<td>Hadoop采用Mapreduce框架</td>
</tr>
</tbody>
</table>
<p>为保证数据的高性能计算，MPP数据库节点和数据之间是紧耦合的，相反，Hadoop的节点和数据是没有耦合关系的. Hadoop的架构更加灵活-存储节点和计算节点的无关性</p>
<p>Hadoop架构，需要在原生的Mapreduce开发框架基础上的开发，需要技术人员谙熟于JAVA开发和并行原理，不仅业务分析人员无法使用，甚至技术人员也难以学习和操控。为了解决易用性的问题，近年来SQL-0N-HADOOP技术大量涌现出来，几乎成为当前Hadoop开发使用的一个技术热点趋势。</p>
<p>这些技术包括：Hive、Pivotal HAWQ、SPARK SQL、Impala、Prest、Drill、Tajo等等很多，这些技术有些是在Mapreduce上做了优化，例如Spark采用内存中的Mapreduce技术，号称性能比基于文件的的Mapreduce提高10倍；而有些则直接绕开了Mapreduce另起炉灶，如Impala、hawq采用借鉴MPP计算思想来做查询优化和内存数据Pipeline计算，以此来提高性能。</p>
<blockquote>
<p>MapReduce 编程困难, 不如 SQL 方便</p>
</blockquote>
<h2 id="2-Quick-Start"><a href="#2-Quick-Start" class="headerlink" title="2. Quick Start"></a>2. Quick Start</h2><p>Master 和 Segment 都是单独的 PostgreSQL数据库。</p>
<h3 id="2-1-Greenplum-架构"><a href="#2-1-Greenplum-架构" class="headerlink" title="2.1 Greenplum 架构"></a>2.1 Greenplum 架构</h3><p><img src="/images/db/greenplum-2.1.png" alt=""></p>
<p>Client 只与 Master节点 交互，Client将SQL发给 Master，然后 Master对SQL分析后，分配给所有的 Segment 进行操作，并将汇总结果返回给客户端。</p>
<h3 id="2-2-Greenplum-集群"><a href="#2-2-Greenplum-集群" class="headerlink" title="2.2 Greenplum 集群"></a>2.2 Greenplum 集群</h3><p><img src="/images/db/greenplum-2.2.png" alt=""></p>
<h3 id="2-3-Greenplum-畅游"><a href="#2-3-Greenplum-畅游" class="headerlink" title="2.3 Greenplum 畅游"></a>2.3 Greenplum 畅游</h3><h4 id="2-3-1-访问方式"><a href="#2-3-1-访问方式" class="headerlink" title="2.3.1 访问方式"></a>2.3.1 访问方式</h4><ul>
<li>psql cmd</li>
<li>pgAdmin / navicat</li>
</ul>
<h4 id="2-3-2-整体概况"><a href="#2-3-2-整体概况" class="headerlink" title="2.3.2 整体概况"></a>2.3.2 整体概况</h4><ul>
<li>Greenplum 基于 PostgreSQL 8.2 开发</li>
<li>Master不存储数据，Segment为数据节点</li>
</ul>
<p>Student Table 存储在 GP 中</p>
<p><img src="/images/db/greenplum-2.3.png" alt=""></p>
<h4 id="2-3-3-基本语法"><a href="#2-3-3-基本语法" class="headerlink" title="2.3.3 基本语法"></a>2.3.3 基本语法</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[hdfs@node196 libin]$ psql -h 192.168.xx.xx -p xx <span class="_">-d</span> testdb -U xx</span><br><span class="line">psql (9.2.15, server 8.2.15)</span><br><span class="line">WARNING: psql version 9.2, server version 8.2.</span><br><span class="line">         Some psql features might not work.</span><br><span class="line">Type <span class="string">"help"</span> <span class="keyword">for</span> help.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>psql -h192.168.181.xx -p2345 -dcom_db -Ucom_gp -c “select * from ods_dm_e_coupon limit 2”</p>
</blockquote>
<p><strong>1. 语法介绍</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">\h <span class="keyword">create</span></span><br></pre></td></tr></table></figure>
<p><strong>2. CREATE TABLE</strong></p>
<ul>
<li>需要指定表分布键</li>
<li>需要用某个字段分区，partition by</li>
<li>like 类似 create table t1 as select * from t2 limit x</li>
<li>inherits can extend table</li>
</ul>
<p>分类策略 </p>
<ol>
<li>Hash 分布 (默认第一个字段，推荐显示指定)</li>
<li>随机分布 (distributed randomly 性能较差， 主键分布一般)</li>
</ol>
<blockquote>
<p>like 创建的表，结构与原表一样，不指定分布键，默认与原表一样。</p>
<p>appendonly、压缩等特殊属性，不一定一样。</p>
</blockquote>
<p><strong>3. SELECT</strong></p>
<p><strong>4. CREATE TABLE AS 与 SELECT INTO</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test2 <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> test1 <span class="keyword">distributed</span> <span class="keyword">by</span> (<span class="keyword">id</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">INTO</span> test4 <span class="keyword">from</span> test1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SELECT INTO 不能指定分布键，使用默认</p>
</blockquote>
<p><strong>5. INSERT</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test001 <span class="keyword">VALUES</span>(<span class="number">100</span>, <span class="string">'tom'</span>), (<span class="number">101</span>, <span class="string">'jim'</span>); <span class="keyword">INSERT</span> <span class="number">0</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意 : 分布键 绝对不能为空，否则为 null。数据分布到一个节点。</p>
</blockquote>
<p><strong>6. UPDATE</strong></p>
<p>不能批量对 分布key 执行 update 操作</p>
<p><strong>7. DELETE</strong></p>
<p>涉及 子查询，子查询结果还涉及数据重分布，这样报错</p>
<h4 id="2-3-4-数据类型"><a href="#2-3-4-数据类型" class="headerlink" title="2.3.4 数据类型"></a>2.3.4 数据类型</h4><table>
<thead>
<tr>
<th>type</th>
<th>space</th>
<th>description</th>
<th>range</th>
</tr>
</thead>
<tbody>
<tr>
<td>smallint</td>
<td>2</td>
<td></td>
<td>-32768 ~ +32767</td>
</tr>
<tr>
<td>integer</td>
<td>4</td>
<td></td>
<td>-2 147 483 648 ~ +2 147 483 647</td>
</tr>
<tr>
<td>bigint</td>
<td>8</td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>decimal</td>
<td>变长</td>
<td></td>
<td>nolimit</td>
</tr>
<tr>
<td>numeric</td>
<td>变长</td>
<td></td>
<td>nolimit</td>
</tr>
<tr>
<td>double precision</td>
<td>4</td>
<td></td>
<td>-</td>
</tr>
<tr>
<td>serial</td>
<td>4</td>
<td>自增整数</td>
<td>1 ~ 2 147 483 647</td>
</tr>
<tr>
<td>bigserial</td>
<td>8</td>
<td>大范围自增整数</td>
<td></td>
</tr>
<tr>
<td>varchar(n)</td>
<td>变长</td>
<td></td>
<td>limit</td>
</tr>
<tr>
<td>char(n)</td>
<td>定长</td>
<td></td>
<td></td>
</tr>
<tr>
<td>text</td>
<td>变长</td>
<td></td>
<td>nolimit</td>
</tr>
<tr>
<td>timestamp</td>
<td>8</td>
<td>带不带时区，自己选择</td>
<td></td>
</tr>
<tr>
<td>date</td>
<td>4</td>
<td>表示日期</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="2-3-5-常用函数"><a href="#2-3-5-常用函数" class="headerlink" title="2.3.5 常用函数"></a>2.3.5 常用函数</h4><p><a href="http://www.postgres.cn/docs/9.3/" target="_blank" rel="external">postgres 9.3 doc</a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://cread.jd.com/read/startRead.action?bookId=30189846&amp;readType=1" target="_blank" rel="external">JD阅读 : Greenplum企业级应用实战</a></li>
<li><a href="http://dbaplus.cn/news-21-341-1.html" target="_blank" rel="external">聊聊Greenplum的那些事</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ef-l6u2-Going-to-the-doctor&#39;s-l4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2016/12/27/ef-l6u2-Going-to-the-doctor's-l4/"><strong>Going to the doctor&#39;s L4 Accidents and injuries</strong></a>
      <small class=article-date-index>&nbsp; 2016-12-27</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2016/12/27/ef-l6u2-Going-to-the-doctor's-l4/" class="article-date">
  <time datetime="2016-12-26T23:15:16.000Z" itemprop="datePublished">2016-12-27</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/English/">English</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2016/12/27/ef-l6u2-Going-to-the-doctor's-l4/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <style>
img {
        display: block !important;
        width: 500px;
        margin-left: 200px !important;
}
</style>

<h2 id="1-Vocabulary"><a href="#1-Vocabulary" class="headerlink" title="1. Vocabulary"></a>1. Vocabulary</h2><ul>
<li>unconscious</li>
</ul>
<p><img src="/images/english/ef-l6u2l4.png" alt=""></p>
<table>
<thead>
<tr>
<th>A: JAKE - B: PAM - C: SIMON</th>
</tr>
</thead>
<tbody>
<tr>
<td>I fell down some stairs.</td>
<td></td>
</tr>
<tr>
<td>How did you do that?</td>
<td></td>
</tr>
<tr>
<td>I was walking down some stairs. I wasn’t paying attention.</td>
<td></td>
</tr>
<tr>
<td>You were paying attention. He was paying attention to a woman.</td>
<td></td>
</tr>
<tr>
<td>I think the stairs were wet.</td>
<td></td>
</tr>
<tr>
<td>When did this happen?</td>
<td></td>
</tr>
<tr>
<td>[JAKE] Yeah. I bruised three ribs and, sprained my right wrist.</td>
<td></td>
</tr>
<tr>
<td>[PAM] How are you coping with the crutches?</td>
<td></td>
</tr>
<tr>
<td>[JAKE] No problem at all.</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="2-because-of-the-pain"><a href="#2-because-of-the-pain" class="headerlink" title="2. because of the pain"></a>2. because of the pain</h2><p>I was walking down the street when I slipped and fell down, and broke my leg. I haven’t been sleeping since it happened because of the pain. It really hurts!</p>
<table>
<thead>
<tr>
<th>because of the pain</th>
</tr>
</thead>
<tbody>
<tr>
<td>I was walking down the street …</td>
<td></td>
</tr>
<tr>
<td>… when I slipped and fell down …</td>
<td></td>
</tr>
<tr>
<td>… and broke my leg.</td>
<td></td>
</tr>
<tr>
<td>I haven’t been sleeping …</td>
<td></td>
</tr>
<tr>
<td>… since it happened.</td>
<td></td>
</tr>
<tr>
<td>It really hurts!</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="3-Expressions"><a href="#3-Expressions" class="headerlink" title="3. Expressions"></a>3. Expressions</h2><table>
<thead>
<tr>
<th>Ex</th>
</tr>
</thead>
<tbody>
<tr>
<td>I fell off a wall and broke my leg.</td>
<td></td>
</tr>
<tr>
<td>I sprained my wrist.</td>
<td></td>
</tr>
<tr>
<td>I have a bruise on my arm.</td>
<td></td>
</tr>
<tr>
<td>I fell down and bruised my shoulder.</td>
<td></td>
</tr>
<tr>
<td>I broke my arm while playing volleyball.</td>
<td></td>
</tr>
<tr>
<td>I was running for a bus when I sprained my ankle.</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Possessive adjectives</th>
</tr>
</thead>
<tbody>
<tr>
<td>He called his doctor because he had a fever.</td>
<td></td>
</tr>
<tr>
<td>I’m a patient of Dr. Brennan’s. == I’m Dr. Brennan’s patient.</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="4-Reading"><a href="#4-Reading" class="headerlink" title="4. Reading"></a>4. Reading</h2><p>I guess the strangest accident I have ever had was when I was at school. I was playing a game where you had to lie on the ground, and all the others jumped on top of you. It was fine until the biggest kid in school came and jumped on top, too! I broke my finger, <code>bruised my ribs</code> and <code>sprained</code> my wrist. I spent the night in the hospital, and it took me a couple of months to get better.</p>
<h2 id="5-Writing"><a href="#5-Writing" class="headerlink" title="5. Writing"></a>5. Writing</h2><p>I had an accident last winter when I was arriving at work. I was coming into the building, climbing the steps, when I slipped on the icy floor. I fell down the steps and <code>broke my ankle</code>. I also <code>sprained my left wrist and bruised my back badly</code>. I had to go to the hospital, and I stayed there for three days. I hurt a lot! I had to stay at home for two more weeks before I could go back to work.</p>
<hr>
<div class="video-container"><iframe src="//www.youtube.com/embed/XDm4bNQGwWE" frameborder="0" allowfullscreen></iframe></div>
      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-ef-l6u2-Going-to-the-doctor&#39;s-l3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2016/12/16/ef-l6u2-Going-to-the-doctor's-l3/"><strong>Going to the doctor&#39;s L3 Filling a prescription</strong></a>
      <small class=article-date-index>&nbsp; 2016-12-16</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2016/12/16/ef-l6u2-Going-to-the-doctor's-l3/" class="article-date">
  <time datetime="2016-12-15T23:15:16.000Z" itemprop="datePublished">2016-12-16</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/English/">English</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2016/12/16/ef-l6u2-Going-to-the-doctor's-l3/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <style>
img {
        display: block !important;
        width: 500px;
        margin-left: 200px !important;
}
</style>

<h2 id="1-Vocabulary"><a href="#1-Vocabulary" class="headerlink" title="1. Vocabulary"></a>1. Vocabulary</h2><ul>
<li>I’m going to the pharmacy.</li>
<li>He talked to the pharmacist.</li>
<li>teaspoons</li>
</ul>
<table>
<thead>
<tr>
<th>allergic to</th>
<th>medications</th>
<th>dosage </th>
</tr>
</thead>
<tbody>
<tr>
<td>tablets</td>
<td>spicy</td>
<td>capsules</td>
</tr>
</tbody>
</table>
<p><img src="/images/english/ef-l6u2l3.png" alt=""></p>
<table>
<thead>
<tr>
<th>A: PAM - B: PHARMACIST</th>
</tr>
</thead>
<tbody>
<tr>
<td>[A] Hi. I’d like to fill a prescription. James. My first name is Pam. Does my insurance cover this?</td>
<td></td>
</tr>
<tr>
<td>[B] Yes, it does. I’ll be right back. Are you allergic to any other medications?</td>
<td></td>
</tr>
<tr>
<td>[A] Uh, no, I’m not.</td>
<td></td>
</tr>
<tr>
<td>[B] Okay. So this will help stop the diarrhea. The dosage is two tablets every six hours.</td>
<td></td>
</tr>
<tr>
<td>[A] Okay.</td>
<td></td>
</tr>
<tr>
<td>[B] It’s better if you take it with some plain food, like rice or scrambled eggs. Nothing spicy.</td>
<td></td>
</tr>
<tr>
<td>[A] I understand.</td>
<td></td>
</tr>
<tr>
<td>[B] And this is for the nausea and the vomiting. Take two capsules twice a day for three days.</td>
<td></td>
</tr>
<tr>
<td>[B] I hope you feel better.</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="2-Expressions"><a href="#2-Expressions" class="headerlink" title="2. Expressions"></a>2. Expressions</h2><table>
<thead>
<tr>
<th>PAM</th>
<th>PHARMACIST</th>
</tr>
</thead>
<tbody>
<tr>
<td>I’d like to fill a prescription.</td>
<td>Take two capsules twice a day for three days</td>
</tr>
<tr>
<td>I’m here to pick up my medication</td>
<td>It’s better if you take it with some plain food.</td>
</tr>
<tr>
<td>Does my insurance cover this?</td>
<td>Yes, it does.</td>
</tr>
<tr>
<td>I’m not currently taking any medication.</td>
<td>I hope you feel better. </td>
</tr>
</tbody>
</table>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Libin Chan&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = 'blairos-sn';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
