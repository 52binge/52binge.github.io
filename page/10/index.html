<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Auckland New Zealand</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Everyone should not forget his dream">
<meta property="og:type" content="website">
<meta property="og:title" content="Auckland New Zealand">
<meta property="og:url" content="http:&#x2F;&#x2F;iequa.com&#x2F;page&#x2F;10&#x2F;index.html">
<meta property="og:site_name" content="Auckland New Zealand">
<meta property="og:description" content="Everyone should not forget his dream">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8864dc75a81a27b7e44c00138af95d66";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;" target="_blank" rel="noopener"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/ai1">AI</a>
        
          <a class="main-nav-link" href="/tensorflow">TF/Keras</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://iequa.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer">
      <article id="post-devops/ops-mac-mysql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/12/03/devops/ops-mac-mysql/"><strong>mac 安装 mysql 与 常用命令</strong></a>
      <small class=article-date-index>&nbsp; 2017-12-03</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/12/03/devops/ops-mac-mysql/" class="article-date">
  <time datetime="2017-12-03T01:16:21.000Z" itemprop="datePublished">2017-12-03</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/devops/">devops</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/12/03/devops/ops-mac-mysql/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>介绍 Mac 安装 Mysql 与 mysql 在 mac 在的命令</p>
<p>&lt;!-- more --&gt;</p>
<h2>1. brew install</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install mysql</span><br></pre></td></tr></table></figure></p>
<p><strong>在mac下使用 brew 安装 mysql，之前没有使用过，今天启动的时候发现启动不了</strong></p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /usr/local/bin [9:31:54]</span></span><br><span class="line">➜ mysql</span><br><span class="line">ERROR 2002 (HY000): Can<span class="string">'t connect to local MySQL server through socket '</span>/tmp/mysql.sock<span class="string">' (2)</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜ brew info mysql</span><br><span class="line">mysql: stable 8.0.12 (bottled)</span><br></pre></td></tr></table></figure></p>
<h2>2. 启动mysql</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜ mysql.server start</span><br></pre></td></tr></table></figure></p>
<h2>3. 设置密码</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure></p>
<h2>4. 进入mysql</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></p>
<h2>5. 常用命令</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mysql.server start</span><br><span class="line">$ mysql.server restart</span><br><span class="line">$ mysql.server stop</span><br><span class="line">$ mysql.server status</span><br><span class="line">$ mysql -u root -p</span><br></pre></td></tr></table></figure></p>
<h2>Reference</h2>
<ul>
<li><a href="https://blog.csdn.net/plpldog/article/details/80761646" target="_blank" rel="noopener">mac用brew安装mysql,设置初始密码</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-deeplearning/Neural-Networks-and-Deep-Learning-week1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/12/01/deeplearning/Neural-Networks-and-Deep-Learning-week1/"><strong>Neural Networks and Deep Learning (week1) - Introduction to Deep Learning</strong></a>
      <small class=article-date-index>&nbsp; 2017-12-01</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/12/01/deeplearning/Neural-Networks-and-Deep-Learning-week1/" class="article-date">
  <time datetime="2017-12-01T11:55:21.000Z" itemprop="datePublished">2017-12-01</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/deeplearning/">deeplearning</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/12/01/deeplearning/Neural-Networks-and-Deep-Learning-week1/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>Introduction to Deep Learning</li>
<li>What is a Neural Network ?</li>
<li>Why is Deep Learning taking off ?</li>
</ol>
<p>&lt;!-- more --&gt;</p>
<h2>1. Introduction to Deep Learning</h2>
<p>&lt;img src=&quot;/images/deeplearning/light.jpg&quot; width=&quot;420&quot; /&gt;</p>
<h3>What's you'll learn</h3>
<p>&lt;div class=&quot;limg0&quot;&gt;
&lt;img src=&quot;/images/deeplearning/deeplearning-ai-w1-6.jpg&quot; width=&quot;720&quot; /&gt;
&lt;/div&gt;</p>
<h2>2. What is a Neural Network ?</h2>
<h3>Housing Price Prediction</h3>
<p>&lt;img src=&quot;/images/deeplearning/deeplearning-ai-w1-3-housing.jpg&quot; width=&quot;720&quot; /&gt;</p>
<h2>3. Why is Deep Learning taking off ?</h2>
<p>&lt;img src=&quot;/images/deeplearning/deeplearning-ai-w1-4.jpg&quot; width=&quot;720&quot; /&gt;</p>
<ul>
<li><strong>Data</strong> 、 <strong>Computation</strong> 、 <strong>Algorithms</strong></li>
</ul>
<p>&lt;img src=&quot;/images/deeplearning/deeplearning-ai-w1-5.jpg&quot; width=&quot;720&quot; /&gt;</p>
<h2>Reference</h2>
<ul>
<li><a href="https://www.deeplearning.ai/" target="_blank" rel="noopener">Andrew Ng - deeplearning.ai</a></li>
<li><a href="https://mooc.study.163.com/learn/2001281002?tid=2001392029#/learn/content?type=detail&amp;id=2001702004&amp;cid=2001694006" target="_blank" rel="noopener">网易云课堂 - 第一周深度学习概论</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-chatbot/chatbot-research11" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/11/29/chatbot/chatbot-research11/"><strong>Chatbot Research 11 - Chatbot 的第二个版本 (新API实现)</strong></a>
      <small class=article-date-index>&nbsp; 2017-11-29</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/11/29/chatbot/chatbot-research11/" class="article-date">
  <time datetime="2017-11-29T14:00:21.000Z" itemprop="datePublished">2017-11-29</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/chatbot/">chatbot</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/11/29/chatbot/chatbot-research11/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>&lt;!-- 2018 --&gt;</p>
<p>我们使用 tf.contrib.legacy_seq2seq 下的 API 构建了一个简单的 chatbot 对话系统. 代码是1.0之前旧版.</p>
<p>本篇我们学习新版本灵活的的API，这里先来说一下二者的不同：</p>
<p>&lt;!-- more --&gt;</p>
<p><strong>新版本API：</strong></p>
<blockquote>
<ul>
<li>
<p>用 dynamic_rnn 来构造 RNN模型，这样就避免了数据长度不同所带来的困扰，不需要再使用 model_with_buckets 这种方法来构建模型，使得我们数据处理和模型代码都简洁很多。</p>
</li>
<li>
<p>新版本将 Attention、 Decoder 等几个主要的功能都分别进行封装，直接调用相应的 Wapper函数 进行封装即可，更加灵活方便，而且只需要写几个简单的函数既可以自定义的各个模块以满足我们个性化的需求。</p>
</li>
</ul>
<ul>
<li>实现了beam_search功能，可直接调用。</li>
</ul>
</blockquote>
<blockquote>
<p><a href="https://www.zhihu.com/question/52200883" target="_blank" rel="noopener">tensor flow dynamic_rnn 与rnn有啥区别？</a></p>
<p>dynamic_rnn 只在一个 batch 内部进行自动 padding， 不同 batch padding 长度可以不同</p>
</blockquote>
<h2>1. 数据处理</h2>
<blockquote>
<p>word2id is :  { 'decorations': 12002, 'scraps': 4599, ...}</p>
<p>id2word is :  { 0: '&lt;pad&gt;', 1: '&lt;go&gt;', 2: '&lt;eos&gt;', 3: '&lt;unknown&gt;', 4: 'can', 5: 'we', 6: 'make', ... }</p>
<p>trainingSamples is :
[
[ [793, 138, 65], [35, 209, 110, 9016, 208, 382, 35, 22] ],
[ [35, 209, 110, 9016, 208, 382, 35, 22], [26, 92, 1906, 47, 254, 65] ],
...
]</p>
</blockquote>
<h2>2. 模型构建</h2>
<p>代码主要是从 tensorflow官网 给出的nmt例子的代码简化而来，实现了最基本的 <strong>attention</strong> 和 <strong>beam_search</strong> 等功能，同时有将nmt代码中繁杂的代码逻辑进行简化。这里参考nmt中所提到的构建<code>train</code>、<code>eval</code>、<code>inference</code> , 三个图进行模型构建，好处在于 <a href="https://github.com/tensorflow/nmt#building-training-eval-and-inference-graphs" target="_blank" rel="noopener">nmt官方文档 Building Training, Eval, and Inference Graphs </a></p>
<blockquote>
<ul>
<li>inference图 往往与 train 和 eval结构 存在较大差异，所以往往需要单独进行构建
.   （没有decoder输入和目标，需要使用 greedy 或 beam_search 进行 decode，batch_size 也不同等等）</li>
<li>eval图，不需要进行反向传播，只需要得到一个 <strong>loss</strong> 和 <strong>acc</strong>值</li>
<li>数据进行 <code>feed</code>，简化数据操作</li>
<li>变量重用变得简单，因为 train、eval 存在一些公用变量和代码块，就不需要我们重复定义</li>
<li>只需要在 train 时不断保存模型参数，然后在 eval 和 infer 的时候 restore参数 即可</li>
</ul>
</blockquote>
<p>以上，所以我们构建了 train、eval、infer 三个函数来实现上面的功能。在看代码之前我们先来简单说一下新版API几个主要的模块以及相互之间的调用关系。tf.contrib.seq2seq文件夹下面主要有下面6个文件，除了loss文件和之前的sequence_loss函数没有很大区别，这里不介绍之外，其他几个文件都会简单的说一下，这里主要介绍函数和类的功能，源码会放在下篇文章中介绍。</p>
<blockquote>
<ul>
<li>decoder</li>
<li>basic_decoder</li>
<li>helper</li>
<li>attention_wrapper</li>
<li>beam_search_decoder</li>
<li>loss</li>
</ul>
</blockquote>
<h3>2.1 BasicDecoder 类和 dynamic_decode</h3>
<p>decoder文件中定义了</p>
<ul>
<li>Decoder抽象类</li>
<li>dynamic_decode函数</li>
</ul>
<blockquote>
<p>dynamic_decode 可以视为整个解码过程的入口，需要传入的参数就是 Decoder 的一个实例，他会动态的调用 Decoder 的 <code>step</code>函数 按步执行 decode，可以理解为Decoder类定义了单步解码（根据输入求出输出，并将该输出当做下一时刻输入），而dynamic_decode则会调用control_flow_ops.while_loop这个函数来循环执行直到输出&lt;eos&gt;结束编码过程.</p>
</blockquote>
<h3>2.2 cell类型（Attention类型）</h3>
<p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 分为3步，</span></span><br><span class="line"><span class="comment">#.  1. 定义attention机制</span></span><br><span class="line"><span class="comment">#.  2. 定义要是用的基础的RNNCell</span></span><br><span class="line"><span class="comment">#.  3. 使用AttentionWrapper进行封装</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 定义要使用的attention机制。</span></span><br><span class="line">attention_mechanism = tf.contrib.seq2seq.BahdanauAttention(num_units=self.rnn_size, memory=encoder_outputs, memory_sequence_length=encoder_inputs_length)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 定义decoder阶段要是用的LSTMCell，然后为其封装attention wrapper</span></span><br><span class="line">decoder_cell = self._create_rnn_cell()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 使用AttentionWrapper进行封装</span></span><br><span class="line">decoder_cell = tf.contrib.seq2seq.AttentionWrapper(cell=decoder_cell, attention_mechanism=attention_mechanism, attention_layer_size=self.rnn_size, name=<span class="string">'Attention_Wrapper'</span>)</span><br></pre></td></tr></table></figure></p>
<h3>2.3 helper类型</h3>
<p>helper其实就是decode阶段如何根据预测结果得到下一时刻的输入，比如train训练过程中应该直接使用上一时刻的真实值作为下一时刻输入，预测过程中可以使用贪婪的方法选择概率最大的那个值作为下一时刻等等。</p>
<h2>Reference</h2>
<ul>
<li><a href="https://blog.csdn.net/thriving_fcl/article/details/74165062" target="_blank" rel="noopener">Tensorflow新版Seq2Seq接口使用</a></li>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/contrib/legacy_seq2seq" target="_blank" rel="noopener">tensorflow官网API指导</a></li>
<li><a href="https://github.com/Conchylicultor/DeepQA#chatbot" target="_blank" rel="noopener">DeepQA</a></li>
<li><a href="https://github.com/pbhatia243/Neural_Conversation_Models" target="_blank" rel="noopener">Neural_Conversation_Models</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-chatbot/chatbot-research8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/11/17/chatbot/chatbot-research8/"><strong>Chatbot Research 8 - 理论 seq2seq+Attention 机制模型详解</strong></a>
      <small class=article-date-index>&nbsp; 2017-11-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/11/17/chatbot/chatbot-research8/" class="article-date">
  <time datetime="2017-11-17T14:00:21.000Z" itemprop="datePublished">2017-11-17</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/chatbot/">chatbot</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/11/17/chatbot/chatbot-research8/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>从具体的模型细节、公式推导、结构图以及变形等几个方向详细介绍一下 Seq-to-Seq 模型。</p>
<p>&lt;!-- more --&gt;</p>
<ul>
<li>Seq-to-Seq 框架1</li>
<li>Seq-to-Seq 框架2（teacher forcing）</li>
<li>Seq-to-Seq with Attention（NMT）</li>
<li>Seq-to-Seq with Attention 各种变形</li>
<li>Seq-to-Seq with Beam-Search</li>
</ul>
<p>当输入输出都是不定长序列时，我们可以使用编码器—解码器（encoder-decoder）<a href="https://www.youtube.com/watch?v=GQh7wDQDc0Y&amp;index=18&amp;list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax" target="_blank" rel="noopener">1</a> 或者 seq2seq 模型 <a href="https://zh.gluon.ai/chapter_recurrent-neural-networks/gru.html" target="_blank" rel="noopener">2</a>。这两个模型本质上都用到了两个循环神经网络，分别叫做编码器和解码器。编码器用来分析输入序列，解码器用来生成输出序列。</p>
<h2>1. Seq2Seq 框架1</h2>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-1.jpg&quot; width=&quot;300&quot; /&gt;</p>
<p><a href="https://arxiv.org/pdf/1406.1078.pdf" target="_blank" rel="noopener">Learning Phrase Representations using RNN Encoder–Decoder for Statistical Machine Translation</a></p>
<h3>1.1 encode 编码器</h3>
<p>编码器的作用是把一个不定长的输入序列变换成一个定长的背景变量 $c$，并在该背景变量中编码输入序列信息。常用的编码器是循环神经网络。</p>
<p>让我们考虑批量大小为 1 的时序数据样本。假设输入序列是 $x_1,\ldots,x_T$, 例如 $x_i$ 是输入句子中的第 $i$ 个词。在时间步 $t$，循环神经网络将输入 $x_t$ 的特征向量 $x_t$ 和上个时间步的隐藏状态 $\boldsymbol{h}_{t-1}$ 变换为当前时间步的隐藏状态 $h_t$。我们可以用函数 $f$ 表达循环神经网络隐藏层的变换：</p>
<p>$$
\boldsymbol{h}_t = f(\boldsymbol{x}_t, \boldsymbol{h}_{t-1}).
$$</p>
<p>接下来编码器通过自定义函数 $q$ 将各个时间步的隐藏状态变换为背景变量</p>
<p>$$
\boldsymbol{c} =  q(\boldsymbol{h}_1, \ldots, \boldsymbol{h}_T).
$$</p>
<p>例如，当选择 $q(\boldsymbol{h}_1, \ldots, \boldsymbol{h}_T) = \boldsymbol{h}_T$ 时，背景变量是输入序列最终时间步的隐藏状态 $\boldsymbol{h}_T$。</p>
<p>以上描述的编码器是一个单向的 RNN，每个时间步的隐藏状态只取决于该时间步及之前的输入子序列。我们也可以使用 Bi-RNN 构造编码器。这种情况下，编码器每个时间步的隐藏状态同时取决于该时间步之前和之后的子序列（包括当前时间步的输入），并编码了整个序列的信息。</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-5.jpeg&quot; width=&quot;800&quot; /&gt;</p>
<h3>1.2 decode 解码器</h3>
<p>Encode 编码器输出的背景变量 $c$ 编码了整个输入序列 $x_1, \ldots, x_T$ 的信息。给定训练样本中的输出序列 $y_1, y_2, \ldots, y_{T'}$，对每个时间步 $t'$（符号与输入序列或编码器的时间步 $t$ 有区别）， 解码器输出 $y_{t'}$ 的条件概率将基于之前的输出序列 $y_1,\ldots,y_{t'-1}$ 和背景变量 $c$，<strong>即</strong> $\mathbb{P}(y_{t'} \mid y_1, \ldots, y_{t'-1}, \boldsymbol{c})$。</p>
<p>为此，我们可以使用<code>另一个RNN</code>作为解码器。 在输出序列的时间步 $t^\prime$，解码器将上一时间步的输出 $y_{t^\prime-1}$ 以及背景变量 $c$ 作为输入，并将它们与上一时间步的隐藏状态 $\boldsymbol{h}_{t^\prime-1}$ 变换为当前时间步的隐藏状态 $\boldsymbol{h}_{t^\prime}$。因此，我们可以用函数 $g$ 表达解码器隐藏层的变换：</p>
<p>$$
\boldsymbol{h}_{t^\prime} = g(y_{t^\prime-1}, \boldsymbol{c}, \boldsymbol{h}_{t^\prime-1}).
$$</p>
<p>有了decode的隐藏状态后，我们可以使用自定义的输出层和 softmax 运算来计算 $\mathbb{P}(y_{t^\prime} \mid y_1, \ldots, y_{t^\prime-1}, \boldsymbol{c})$，例如基于当前时间步的解码器隐藏状态 $\boldsymbol{h}_{t^\prime}$、上一时间步的输出 $y_{t^\prime-1}$ 以及背景变量 $c$ 来计算当前时间步输出 $y_{t^\prime}$ 的概率分布。</p>
<h3>1.3 train 模型训练</h3>
<p>根据最大似然估计，我们可以最大化输出序列基于输入序列的条件概率</p>
<p>$$
\begin{split}\begin{aligned}
\mathbb{P}(y_1, \ldots, y_{T'} \mid x_1, \ldots, x_T)
&amp;= \prod_{t'=1}^{T'} \mathbb{P}(y_{t'} \mid y_1, \ldots, y_{t'-1}, x_1, \ldots, x_T)\\
&amp;= \prod_{t'=1}^{T'} \mathbb{P}(y_{t'} \mid y_1, \ldots, y_{t'-1}, \boldsymbol{c}),
\end{aligned}\end{split}
$$</p>
<p>并得到该输出序列的损失</p>
<p>$$ - \log\mathbb{P}(y_1, \ldots, y_{T'} \mid x_1, \ldots, x_T) = -\sum_{t'=1}^{T'} \log \mathbb{P}(y_{t'} \mid y_1,  \ldots, y_{t'-1}, \boldsymbol{c}),
$$</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-6.png&quot; width=&quot;800&quot; /&gt;</p>
<p>在模型训练中，所有输出序列损失的均值通常作为需要最小化的损失函数。在图中所描述的模型预测中，我们需要将decode在上一个时间步的输出作为当前时间步的输入。与此不同，在训练中我们也可以将标签序列在上一个时间步的标签作为decode在当前时间步的输入。这叫做强制教学（teacher forcing）。</p>
<h3>1.4 小结</h3>
<ul>
<li>编码器 - 解码器（seq2seq）可以输入并输出不定长的序列。</li>
<li>编码器—解码器使用了两个循环神经网络。</li>
<li>在编码器—解码器的训练中，我们可以采用强制教学。 （这也是 Seq2Seq 2 的内容）</li>
</ul>
<h2>2. Seq2Seq 框架2</h2>
<p>第二个要讲的Seq-to-Seq模型来自于 “<a href="https://arxiv.org/pdf/1409.3215.pdf" target="_blank" rel="noopener">Sequence to Sequence Learning with Neural Networks</a>”，其模型结构图如下所示：</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-2.jpg&quot; width=&quot;600&quot; /&gt;</p>
<p>与上面模型最大的区别在于其source编码后的 向量$C$ 直接作为Decoder阶段RNN的初始化state，而不是在每次decode时都作为<code>RNN cell</code>的输入。此外，decode时RNN的输入是目标值，而不是前一时刻的输出。首先看一下编码阶段：</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-3.jpg&quot; width=&quot;500&quot; /&gt;</p>
<p>就是简单的RNN模型，每个词经过RNN之后都会编码为hidden state（e0,e1,e2），并且source序列的编码向量e就是最终的hidden state e2。接下来再看一下解码阶段：</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-4.jpg&quot; width=&quot;500&quot; /&gt;</p>
<p>e向量仅作为RNN的初始化状态传入decode模型。接下来就是标准的循环神经网络，每一时刻输入都是前一时刻的正确label。直到最终输入&lt;eos&gt;符号截止滚动。</p>
<h2>3. Seq2Seq Attention</h2>
<p><strong>decode</strong> 在各个时间步依赖相同的 <strong>背景变量 $c$</strong> 来获取输入序列信息。当 <strong>encode</strong> 为 RNN 时，<strong>背景变量$c$</strong> 来自它最终时间步的隐藏状态。</p>
<blockquote>
<p>英语输入：“They”、“are”、“watching”、“.”
法语输出：“Ils”、“regardent”、“.”</p>
<p>翻译例子：输入为英语序列“They”、“are”、“watching”、“.”，输出为法语序列“Ils”、“regardent”、“.”。，<strong>decode</strong> 在生成输出序列中的每一个词时可能只需利用输入序列某一部分的信息。例如，在输出序列的时间步 1，解码器可以主要依赖“They”、“are”的信息来生成“Ils”，在时间步 2 则主要使用来自“watching”的编码信息生成“regardent”，最后在时间步 3 则直接映射句号“.”。这看上去就像是在 <strong>decode</strong> 的每一时间步对输入序列中不同时间步的编码信息分配不同的注意力一样。这也是注意力机制的由来 <a href="https://www.youtube.com/watch?v=GQh7wDQDc0Y&amp;index=18&amp;list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax" target="_blank" rel="noopener">1</a>。</p>
<p>仍以 RNN 为例，Attention 通过对 Encode 所有时间步的隐藏状态做<strong>加权平均</strong>来得到背景变量$c$。Decode 在每一时间步调整这些权重，即 Attention weight，从而能够在不同时间步分别关注输入序列中的不同部分并编码进相应时间步的背景变量$c$。本节我们将讨论 Attention机制 是怎么工作的。</p>
</blockquote>
<p>在“编码器—解码器（seq2seq）”, 解码器在时间步 $t'$ 的隐藏状态</p>
<p>$$
\boldsymbol{s}_{t'} = g(\boldsymbol{y}_{t'-1}, \boldsymbol{c}, \boldsymbol{s}_{t'-1})
$$</p>
<p>在 Attention机制 中, 解码器的每一时间步将使用可变的背景变量$c$</p>
<p>$$
\boldsymbol{s}_{t'} = g(\boldsymbol{y}_{t'-1}, \boldsymbol{c}_{t'}, \boldsymbol{s}_{t'-1}).
$$</p>
<p>关键是如何计算背景变量 $\boldsymbol{c}_{t'}$ 和如何利用它来更新隐藏状态 $\boldsymbol{s}_{t'}$。以下将分别描述这两个关键点。</p>
<h3>3.1 计算背景变量 c</h3>
<p>$$
\boldsymbol{c}_{t'} = \sum_{t=1}^T \alpha_{t' t} \boldsymbol{h}_t,
$$</p>
<p>其中给定 $t'$ 时，权重 $\alpha_{t' t}$ 在 $t=1,\ldots,T$ 的值是一个概率分布。为了得到概率分布，可以使用 softmax 运算:</p>
<p>$$
\alpha_{t' t} = \frac{\exp(e_{t' t})}{ \sum_{k=1}^T \exp(e_{t' k}) },\quad t=1,\ldots,T.
$$</p>
<p>现在，我们需要定义如何计算上式中 softmax 运算的输入 $e_{t' t}$。由于 $e_{t' t}$ 同时取决于decode的时间步 $t'$ 和encode的时间步 $t$，我们不妨以解码器在时间步 $t'−1$ 的隐藏状态 $\boldsymbol{s}_{t' - 1}$ 与编码器在时间步 $t$ 的隐藏状态 $h_t$ 为输入，并通过函数 $a$ 计算 $e_{t' t}$：</p>
<p>$$
e_{t' t} = a(\boldsymbol{s}_{t' - 1}, \boldsymbol{h}_t).
$$</p>
<p>这里函数 a 有多种选择，如果两个输入向量长度相同，一个简单的选择是计算它们的内积 $a(\boldsymbol{s}, \boldsymbol{h})=\boldsymbol{s}^\top \boldsymbol{h}$。而最早提出Attention机制的论文则将输入连结后通过含单隐藏层的多层感知机MLP 变换</p>
<p>$$
a(\boldsymbol{s}, \boldsymbol{h}) = \boldsymbol{v}^\top \tanh(\boldsymbol{W}_s \boldsymbol{s} + \boldsymbol{W}_h \boldsymbol{h}),
$$</p>
<p>其中 $v、W_s、W_h$ 都是可以学习的模型参数。</p>
<h3>3.2 更新隐藏状态</h3>
<p>以门控循环单元为例，在解码器中我们可以对门控循环单元的设计稍作修改。解码器在时间步 $t'$ 的隐藏状态为</p>
<p>$$
\boldsymbol{s}_{t'} = \boldsymbol{z}_{t'} \odot \boldsymbol{s}_{t'-1}  + (1 - \boldsymbol{z}_{t'}) \odot \tilde{\boldsymbol{s}}_{t'},
$$</p>
<p>其中的重置门、更新门和候选隐含状态分别为 :</p>
<p>$$
\begin{split}\begin{aligned}
\boldsymbol{r}_{t'} &amp;= \sigma(\boldsymbol{W}_{yr} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{sr} \boldsymbol{s}_{t' - 1} + \boldsymbol{W}_{cr} \boldsymbol{c}_{t'} + \boldsymbol{b}_r),\\
\boldsymbol{z}_{t'} &amp;= \sigma(\boldsymbol{W}_{yz} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{sz} \boldsymbol{s}_{t' - 1} + \boldsymbol{W}_{cz} \boldsymbol{c}_{t'} + \boldsymbol{b}_z),\\
\tilde{\boldsymbol{s}}_{t'} &amp;= \text{tanh}(\boldsymbol{W}_{ys} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{ss} (\boldsymbol{s}_{t' - 1} \odot \boldsymbol{r}_{t'}) + \boldsymbol{W}_{cs} \boldsymbol{c}_{t'} + \boldsymbol{b}_s),
\end{aligned}\end{split}
$$</p>
<p>其中含下标的 W 和 b 分别为门控循环单元的权重参数和偏差参数。</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-7.jpeg&quot; width=&quot;800&quot; /&gt;</p>
<h3>3.3 小结</h3>
<ul>
<li>可以在decode的每个时间步使用不同的背景变量，并对输入序列中不同时间步编码的信息分配不同的注意力。</li>
<li>Attention机制可以采用更为高效的矢量化计算。</li>
</ul>
<h2>4. Seq2Seq Attention各种变形</h2>
<p>第四个Seq-to-Seq模型，来自于论文 <a href="http://link.zhihu.com/?target=http%3A//aclweb.org/anthology/D15-1166">Effective Approaches to Attention-based Neural Machine Translation</a> 这篇论文提出了两种 Seq2Seq模型 分别是global Attention 和 local Attention。</p>
<h2>5. Seq2Seq with Beam-Search</h2>
<p>上面讲的几种Seq2Seq模型都是从模型结构上进行的改进，也就说为了从训练的层面上改善模型的效果，但这里要介绍的beam-search是在测试的时候才用到的技术。</p>
<h2>Reference</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=GQh7wDQDc0Y&amp;index=18&amp;list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax" target="_blank" rel="noopener">动手学深度学习第十八课：seq2seq（编码器和解码器）和注意力机制</a></li>
<li><a href="https://zh.gluon.ai/chapter_recurrent-neural-networks/gru.html" target="_blank" rel="noopener">门控循环单元（GRU）</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/32092871" target="_blank" rel="noopener">seq2seq+Attention机制模型详解</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/38064637" target="_blank" rel="noopener">三分钟带你对 Softmax 划重点</a></li>
<li><a href="https://zh.gluon.ai/chapter_deep-learning-basics/softmax-regression.html" target="_blank" rel="noopener">Softmax 回归</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-nlp/seq2seq+Attention" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/11/17/nlp/seq2seq+Attention/"><strong>理论 seq2seq+Attention 机制模型详解</strong></a>
      <small class=article-date-index>&nbsp; 2017-11-17</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/11/17/nlp/seq2seq+Attention/" class="article-date">
  <time datetime="2017-11-17T12:00:21.000Z" itemprop="datePublished">2017-11-17</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/nlp/">nlp</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/11/17/nlp/seq2seq+Attention/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>从具体的模型细节、公式推导、结构图以及变形等几个方向详细介绍一下 Seq-to-Seq 模型。</p>
<p>&lt;!-- more --&gt;</p>
<ul>
<li>Seq-to-Seq 框架1</li>
<li>Seq-to-Seq 框架2（teacher forcing）</li>
<li>Seq-to-Seq with Attention（NMT）</li>
<li>Seq-to-Seq with Attention 各种变形</li>
<li>Seq-to-Seq with Beam-Search</li>
</ul>
<p>当输入输出都是不定长序列时，我们可以使用编码器—解码器（encoder-decoder）<a href="https://www.youtube.com/watch?v=GQh7wDQDc0Y&amp;index=18&amp;list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax" target="_blank" rel="noopener">1</a> 或者 seq2seq 模型 <a href="https://zh.gluon.ai/chapter_recurrent-neural-networks/gru.html" target="_blank" rel="noopener">2</a>。这两个模型本质上都用到了两个循环神经网络，分别叫做编码器和解码器。编码器用来分析输入序列，解码器用来生成输出序列。</p>
<h2>1. Seq2Seq 框架1</h2>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-1.jpg&quot; width=&quot;300&quot; /&gt;</p>
<p><a href="https://arxiv.org/pdf/1406.1078.pdf" target="_blank" rel="noopener">Learning Phrase Representations using RNN Encoder–Decoder for Statistical Machine Translation</a></p>
<h3>1.1 encode 编码器</h3>
<p>编码器的作用是把一个不定长的输入序列变换成一个定长的背景变量 $c$，并在该背景变量中编码输入序列信息。常用的编码器是循环神经网络。</p>
<p>让我们考虑批量大小为 1 的时序数据样本。假设输入序列是 $x_1,\ldots,x_T$, 例如 $x_i$ 是输入句子中的第 $i$ 个词。在时间步 $t$，循环神经网络将输入 $x_t$ 的特征向量 $x_t$ 和上个时间步的隐藏状态 $\boldsymbol{h}_{t-1}$ 变换为当前时间步的隐藏状态 $h_t$。我们可以用函数 $f$ 表达循环神经网络隐藏层的变换：</p>
<p>$$
\boldsymbol{h}_t = f(\boldsymbol{x}_t, \boldsymbol{h}_{t-1}).
$$</p>
<p>接下来编码器通过自定义函数 $q$ 将各个时间步的隐藏状态变换为背景变量</p>
<p>$$
\boldsymbol{c} =  q(\boldsymbol{h}_1, \ldots, \boldsymbol{h}_T).
$$</p>
<p>例如，当选择 $q(\boldsymbol{h}_1, \ldots, \boldsymbol{h}_T) = \boldsymbol{h}_T$ 时，背景变量是输入序列最终时间步的隐藏状态 $\boldsymbol{h}_T$。</p>
<p>以上描述的编码器是一个单向的 RNN，每个时间步的隐藏状态只取决于该时间步及之前的输入子序列。我们也可以使用 Bi-RNN 构造编码器。这种情况下，编码器每个时间步的隐藏状态同时取决于该时间步之前和之后的子序列（包括当前时间步的输入），并编码了整个序列的信息。</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-5.jpeg&quot; width=&quot;800&quot; /&gt;</p>
<h3>1.2 decode 解码器</h3>
<p>Encode 编码器输出的背景变量 $c$ 编码了整个输入序列 $x_1, \ldots, x_T$ 的信息。给定训练样本中的输出序列 $y_1, y_2, \ldots, y_{T'}$，对每个时间步 $t'$（符号与输入序列或编码器的时间步 $t$ 有区别）， 解码器输出 $y_{t'}$ 的条件概率将基于之前的输出序列 $y_1,\ldots,y_{t'-1}$ 和背景变量 $c$，<strong>即</strong> $\mathbb{P}(y_{t'} \mid y_1, \ldots, y_{t'-1}, \boldsymbol{c})$。</p>
<p>为此，我们可以使用<code>另一个RNN</code>作为解码器。 在输出序列的时间步 $t^\prime$，解码器将上一时间步的输出 $y_{t^\prime-1}$ 以及背景变量 $c$ 作为输入，并将它们与上一时间步的隐藏状态 $\boldsymbol{h}_{t^\prime-1}$ 变换为当前时间步的隐藏状态 $\boldsymbol{h}_{t^\prime}$。因此，我们可以用函数 $g$ 表达解码器隐藏层的变换：</p>
<p>$$
\boldsymbol{h}_{t^\prime} = g(y_{t^\prime-1}, \boldsymbol{c}, \boldsymbol{h}_{t^\prime-1}).
$$</p>
<p>有了decode的隐藏状态后，我们可以使用自定义的输出层和 softmax 运算来计算 $\mathbb{P}(y_{t^\prime} \mid y_1, \ldots, y_{t^\prime-1}, \boldsymbol{c})$，例如基于当前时间步的解码器隐藏状态 $\boldsymbol{h}_{t^\prime}$、上一时间步的输出 $y_{t^\prime-1}$ 以及背景变量 $c$ 来计算当前时间步输出 $y_{t^\prime}$ 的概率分布。</p>
<h3>1.3 train 模型训练</h3>
<p>根据最大似然估计，我们可以最大化输出序列基于输入序列的条件概率</p>
<p>$$
\begin{split}\begin{aligned}
\mathbb{P}(y_1, \ldots, y_{T'} \mid x_1, \ldots, x_T)
&amp;= \prod_{t'=1}^{T'} \mathbb{P}(y_{t'} \mid y_1, \ldots, y_{t'-1}, x_1, \ldots, x_T)\\
&amp;= \prod_{t'=1}^{T'} \mathbb{P}(y_{t'} \mid y_1, \ldots, y_{t'-1}, \boldsymbol{c}),
\end{aligned}\end{split}
$$</p>
<p>并得到该输出序列的损失</p>
<p>$$ - \log\mathbb{P}(y_1, \ldots, y_{T'} \mid x_1, \ldots, x_T) = -\sum_{t'=1}^{T'} \log \mathbb{P}(y_{t'} \mid y_1,  \ldots, y_{t'-1}, \boldsymbol{c}),
$$</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-6.png&quot; width=&quot;800&quot; /&gt;</p>
<p>在模型训练中，所有输出序列损失的均值通常作为需要最小化的损失函数。在图中所描述的模型预测中，我们需要将decode在上一个时间步的输出作为当前时间步的输入。与此不同，在训练中我们也可以将标签序列在上一个时间步的标签作为decode在当前时间步的输入。这叫做强制教学（teacher forcing）。</p>
<h3>1.4 小结</h3>
<ul>
<li>编码器 - 解码器（seq2seq）可以输入并输出不定长的序列。</li>
<li>编码器—解码器使用了两个循环神经网络。</li>
<li>在编码器—解码器的训练中，我们可以采用强制教学。 （这也是 Seq2Seq 2 的内容）</li>
</ul>
<h2>2. Seq2Seq 框架2</h2>
<p>第二个要讲的Seq-to-Seq模型来自于 “<a href="https://arxiv.org/pdf/1409.3215.pdf" target="_blank" rel="noopener">Sequence to Sequence Learning with Neural Networks</a>”，其模型结构图如下所示：</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-2.jpg&quot; width=&quot;600&quot; /&gt;</p>
<p>与上面模型最大的区别在于其source编码后的 向量$C$ 直接作为Decoder阶段RNN的初始化state，而不是在每次decode时都作为<code>RNN cell</code>的输入。此外，decode时RNN的输入是目标值，而不是前一时刻的输出。首先看一下编码阶段：</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-3.jpg&quot; width=&quot;500&quot; /&gt;</p>
<p>就是简单的RNN模型，每个词经过RNN之后都会编码为hidden state（e0,e1,e2），并且source序列的编码向量e就是最终的hidden state e2。接下来再看一下解码阶段：</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-4.jpg&quot; width=&quot;500&quot; /&gt;</p>
<p>e向量仅作为RNN的初始化状态传入decode模型。接下来就是标准的循环神经网络，每一时刻输入都是前一时刻的正确label。直到最终输入&lt;eos&gt;符号截止滚动。</p>
<h2>3. Seq2Seq Attention</h2>
<p><strong>decode</strong> 在各个时间步依赖相同的 <strong>背景变量 $c$</strong> 来获取输入序列信息。当 <strong>encode</strong> 为 RNN 时，<strong>背景变量$c$</strong> 来自它最终时间步的隐藏状态。</p>
<blockquote>
<p>英语输入：“They”、“are”、“watching”、“.”
法语输出：“Ils”、“regardent”、“.”</p>
<p>翻译例子：输入为英语序列“They”、“are”、“watching”、“.”，输出为法语序列“Ils”、“regardent”、“.”。，<strong>decode</strong> 在生成输出序列中的每一个词时可能只需利用输入序列某一部分的信息。例如，在输出序列的时间步 1，解码器可以主要依赖“They”、“are”的信息来生成“Ils”，在时间步 2 则主要使用来自“watching”的编码信息生成“regardent”，最后在时间步 3 则直接映射句号“.”。这看上去就像是在 <strong>decode</strong> 的每一时间步对输入序列中不同时间步的编码信息分配不同的注意力一样。这也是注意力机制的由来 <a href="https://www.youtube.com/watch?v=GQh7wDQDc0Y&amp;index=18&amp;list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax" target="_blank" rel="noopener">1</a>。</p>
<p>仍以 RNN 为例，Attention 通过对 Encode 所有时间步的隐藏状态做<strong>加权平均</strong>来得到背景变量$c$。Decode 在每一时间步调整这些权重，即 Attention weight，从而能够在不同时间步分别关注输入序列中的不同部分并编码进相应时间步的背景变量$c$。本节我们将讨论 Attention机制 是怎么工作的。</p>
</blockquote>
<p>在“编码器—解码器（seq2seq）”, 解码器在时间步 $t'$ 的隐藏状态</p>
<p>$$
\boldsymbol{s}_{t'} = g(\boldsymbol{y}_{t'-1}, \boldsymbol{c}, \boldsymbol{s}_{t'-1})
$$</p>
<p>在 Attention机制 中, 解码器的每一时间步将使用可变的背景变量$c$</p>
<p>$$
\boldsymbol{s}_{t'} = g(\boldsymbol{y}_{t'-1}, \boldsymbol{c}_{t'}, \boldsymbol{s}_{t'-1}).
$$</p>
<p>关键是如何计算背景变量 $\boldsymbol{c}_{t'}$ 和如何利用它来更新隐藏状态 $\boldsymbol{s}_{t'}$。以下将分别描述这两个关键点。</p>
<h3>3.1 计算背景变量 c</h3>
<p>$$
\boldsymbol{c}_{t'} = \sum_{t=1}^T \alpha_{t' t} \boldsymbol{h}_t,
$$</p>
<p>其中给定 $t'$ 时，权重 $\alpha_{t' t}$ 在 $t=1,\ldots,T$ 的值是一个概率分布。为了得到概率分布，可以使用 softmax 运算:</p>
<p>$$
\alpha_{t' t} = \frac{\exp(e_{t' t})}{ \sum_{k=1}^T \exp(e_{t' k}) },\quad t=1,\ldots,T.
$$</p>
<p>现在，我们需要定义如何计算上式中 softmax 运算的输入 $e_{t' t}$。由于 $e_{t' t}$ 同时取决于decode的时间步 $t'$ 和encode的时间步 $t$，我们不妨以解码器在时间步 $t'−1$ 的隐藏状态 $\boldsymbol{s}_{t' - 1}$ 与编码器在时间步 $t$ 的隐藏状态 $h_t$ 为输入，并通过函数 $a$ 计算 $e_{t' t}$：</p>
<p>$$
e_{t' t} = a(\boldsymbol{s}_{t' - 1}, \boldsymbol{h}_t).
$$</p>
<p>这里函数 a 有多种选择，如果两个输入向量长度相同，一个简单的选择是计算它们的内积 $a(\boldsymbol{s}, \boldsymbol{h})=\boldsymbol{s}^\top \boldsymbol{h}$。而最早提出Attention机制的论文则将输入连结后通过含单隐藏层的多层感知机MLP 变换</p>
<p>$$
a(\boldsymbol{s}, \boldsymbol{h}) = \boldsymbol{v}^\top \tanh(\boldsymbol{W}_s \boldsymbol{s} + \boldsymbol{W}_h \boldsymbol{h}),
$$</p>
<p>其中 $v、W_s、W_h$ 都是可以学习的模型参数。</p>
<h3>3.2 更新隐藏状态</h3>
<p>以门控循环单元为例，在解码器中我们可以对门控循环单元的设计稍作修改。解码器在时间步 $t'$ 的隐藏状态为</p>
<p>$$
\boldsymbol{s}_{t'} = \boldsymbol{z}_{t'} \odot \boldsymbol{s}_{t'-1}  + (1 - \boldsymbol{z}_{t'}) \odot \tilde{\boldsymbol{s}}_{t'},
$$</p>
<p>其中的重置门、更新门和候选隐含状态分别为 :</p>
<p>$$
\begin{split}\begin{aligned}
\boldsymbol{r}_{t'} &amp;= \sigma(\boldsymbol{W}_{yr} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{sr} \boldsymbol{s}_{t' - 1} + \boldsymbol{W}_{cr} \boldsymbol{c}_{t'} + \boldsymbol{b}_r),\\
\boldsymbol{z}_{t'} &amp;= \sigma(\boldsymbol{W}_{yz} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{sz} \boldsymbol{s}_{t' - 1} + \boldsymbol{W}_{cz} \boldsymbol{c}_{t'} + \boldsymbol{b}_z),\\
\tilde{\boldsymbol{s}}_{t'} &amp;= \text{tanh}(\boldsymbol{W}_{ys} \boldsymbol{y}_{t'-1} + \boldsymbol{W}_{ss} (\boldsymbol{s}_{t' - 1} \odot \boldsymbol{r}_{t'}) + \boldsymbol{W}_{cs} \boldsymbol{c}_{t'} + \boldsymbol{b}_s),
\end{aligned}\end{split}
$$</p>
<p>其中含下标的 W 和 b 分别为门控循环单元的权重参数和偏差参数。</p>
<p>&lt;img src=&quot;/images/chatbot/seq2seq-7.jpeg&quot; width=&quot;800&quot; /&gt;</p>
<h3>3.3 小结</h3>
<ul>
<li>可以在decode的每个时间步使用不同的背景变量，并对输入序列中不同时间步编码的信息分配不同的注意力。</li>
<li>Attention机制可以采用更为高效的矢量化计算。</li>
</ul>
<h2>4. Seq2Seq Attention各种变形</h2>
<p>第四个Seq-to-Seq模型，来自于论文 <a href="http://link.zhihu.com/?target=http%3A//aclweb.org/anthology/D15-1166">Effective Approaches to Attention-based Neural Machine Translation</a> 这篇论文提出了两种 Seq2Seq模型 分别是global Attention 和 local Attention。</p>
<h2>5. Seq2Seq with Beam-Search</h2>
<p>上面讲的几种Seq2Seq模型都是从模型结构上进行的改进，也就说为了从训练的层面上改善模型的效果，但这里要介绍的beam-search是在测试的时候才用到的技术。</p>
<h2>Reference</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=GQh7wDQDc0Y&amp;index=18&amp;list=PLLbeS1kM6teJqdFzw1ICHfa4a1y0hg8Ax" target="_blank" rel="noopener">动手学深度学习第十八课：seq2seq（编码器和解码器）和注意力机制</a></li>
<li><a href="https://zh.gluon.ai/chapter_recurrent-neural-networks/gru.html" target="_blank" rel="noopener">门控循环单元（GRU）</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/32092871" target="_blank" rel="noopener">seq2seq+Attention机制模型详解</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/38064637" target="_blank" rel="noopener">三分钟带你对 Softmax 划重点</a></li>
<li><a href="https://zh.gluon.ai/chapter_deep-learning-basics/softmax-regression.html" target="_blank" rel="noopener">Softmax 回归</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-devops/ops-bandwagonhost-ssh-openvpn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/11/12/devops/ops-bandwagonhost-ssh-openvpn/"><strong>搬瓦工VPS 配置 SSH 与 OpenVpn</strong></a>
      <small class=article-date-index>&nbsp; 2017-11-12</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/11/12/devops/ops-bandwagonhost-ssh-openvpn/" class="article-date">
  <time datetime="2017-11-12T05:16:21.000Z" itemprop="datePublished">2017-11-12</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/devops/">devops</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/11/12/devops/ops-bandwagonhost-ssh-openvpn/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>搬瓦工VPS 配置 ssh 登录 与 iphone 配置使用 openvpn</p>
<p>&lt;!-- more --&gt;</p>
<h2>SSH 配置</h2>
<blockquote>
<p>ssh 登录搬瓦工机器</p>
<ol>
<li>stop server @Main controls</li>
<li>Root password modification</li>
<li>start Server</li>
<li>Root shell - interactive</li>
<li>vi /etc/ssh/sshd_config, add
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PermitRootLogin yes</span><br><span class="line">Port 22 </span><br></pre></td></tr></table></figure></li>
<li>/etc/init.d/sshd restart</li>
<li>ssh root@ip</li>
</ol>
</blockquote>
<h2>OpenVpn 配置</h2>
<blockquote>
<ol>
<li>在iOS设备上打开app store，搜索openvpn，install</li>
<li>打开 <a href="https://bandwagonhost.com/clientarea.php?action=products" target="_blank" rel="noopener">bandwagon my service pandel</a>
<code>My Service Pandel</code> -&gt; <code>KiwiVM Control Pandel</code> -&gt; <code>OpenVPN Server</code> -&gt; <code>install OpenVPN</code> -&gt; <code>Download Key Files</code></li>
<li>把 ca.crt、client1.crt、client1.key 证书放入 .ovpn 配置文件</li>
</ol>
<p>在 .ovpn 文件尾部中新增 标签 <code>&lt;ca&gt;、&lt;cert&gt;、&lt;key&gt;</code> 标签
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ca.crt 文件内容复制到 &lt;ca&gt;和&lt;/ca&gt; 的中间，</span><br><span class="line">client1.crt 文件内容复制到 &lt;cert&gt;和&lt;/cert&gt; 的中间，</span><br><span class="line">client1.key 文件内容复制到 &lt;key&gt;和&lt;/key&gt; 的中间，</span><br><span class="line">修改完成后删除 .ovpn 配置文件中类似</span><br><span class="line">ca ca.crt</span><br><span class="line">cert client1.crt</span><br><span class="line">key client1.key </span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>.ovpn 通过 Airdrop 传到 iphone 手机里</li>
<li>打开OpenVPN，点那些绿色加号，将配置文件导入</li>
<li>向右滑动最下面那个白色滑块至蓝色，连接服务器。</li>
<li>连接成功。如果显示 Connected，表示连接成功了。</li>
</ol>
</blockquote>
<h2>Reference</h2>
<ul>
<li><a href="https://www.yuntionly.com/" target="_blank" rel="noopener">www.yuntionly.com</a></li>
<li><a href="https://www.wisevpn.net/" target="_blank" rel="noopener">www.wisevpn.net</a></li>
<li><a href="https://www.banwago.com/797.html" target="_blank" rel="noopener">www.banwago.com</a></li>
<li><a href="https://www.godaddy.com/" target="_blank" rel="noopener">www.godaddy.com</a></li>
<li><a href="https://www.cnbanwagong.com/4.html" target="_blank" rel="noopener">搬瓦工中文网</a></li>
<li><a href="https://bwh1.net/" target="_blank" rel="noopener">搬瓦工购买页面</a></li>
<li><a href="http://ulis.me/archives/5909" target="_blank" rel="noopener">搬瓦工VPS续费的那些事</a></li>
<li><a href="https://www.igfw.net/archives/13042" target="_blank" rel="noopener">OpenVPN支持iOS啦</a></li>
<li><a href="https://www.igfw.net/archives/1974" target="_blank" rel="noopener">绿色便携汉化可保存密码的OpenVPN客户端</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-nlp/word-language-number-info-history" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/11/08/nlp/word-language-number-info-history/"><strong>文字和语言 vs 数字和信息</strong></a>
      <small class=article-date-index>&nbsp; 2017-11-08</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/11/08/nlp/word-language-number-info-history/" class="article-date">
  <time datetime="2017-11-08T02:08:21.000Z" itemprop="datePublished">2017-11-08</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/nlp/">nlp</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/11/08/nlp/word-language-number-info-history/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>数字、文字、自然语言 一样，都是信息的载体。&lt;!-- more --&gt;
语言和数字的产生为的是同一个目的 ：记录和传播信息。</p>
<blockquote>
<p>1948年，<a href="https://zh.wikipedia.org/wiki/%E5%85%8B%E5%8A%B3%E5%BE%B7%C2%B7%E9%A6%99%E5%86%9C" target="_blank" rel="noopener">香农</a>提出信息论，人们才把 数学和语言 联系起来。</p>
</blockquote>
<h2>1. 信息</h2>
<p>&lt;img src=&quot;/images/nlp/history-info-1.jpg&quot; width=&quot;480&quot; height=&quot;400&quot; align=&quot;middle&quot; /img&gt;</p>
<blockquote>
<p>人类最早利用 voice 进行 通信</p>
</blockquote>
<p>&lt;img src=&quot;/images/nlp/history-info-2.png&quot; width=&quot;650&quot; height=&quot;100&quot; align=&quot;middle&quot; /img&gt;</p>
<blockquote>
<p>人类文明的进步，需要表达的信息量越来越多，人类发明的自然语言</p>
<p>语言的出现是为了人类之间的通信。字母、文字、数字 是信息编码的不同单位。任何一种语言都是一种编码方式，语言的语法规则是编解码的算法。</p>
</blockquote>
<h2>2. 文字和数字</h2>
<p>当语言和词汇多到一定程度，人类大脑记不住所有词汇，高效记录信息的形式出现，人类便发明了 <strong>文字</strong></p>
<h3>文字</h3>
<p>古埃及，读音相同的词用同一个符号来记录。</p>
<p>文字按照<strong>聚类</strong>会带来歧义性，弄不清多义字在特定环境的含义，就要依靠<strong>上下文</strong>。</p>
<p>不同的文明，由于地域原因，历史上互相隔绝，便会有不同的文字。文明的融合与冲突，不同文明下的人们进行交流(通信)，那么<strong>翻译</strong>的需求便产生了。不同的文字系统在记录信息上的能力是等价的。</p>
<p>罗塞塔 Rosetta Stone 石碑 [古埃及象形文字、埃及拼音文字、古希腊文] 的破译对于 NLP 学者的两点指导意义 :</p>
<ol>
<li>信息的冗余是信息安全的保障</li>
<li>语言的数据，我们称之为 语料</li>
</ol>
<blockquote>
<p>Rosetta Stone, Google推出的翻译软件</p>
</blockquote>
<h3>数字</h3>
<p>祖先需要记录物件的个数越来越多，所以开始发明了计数系统，也就有了 数字。因为 10 个手指头，所以发明了 10 进制。</p>
<p>描述数字最有效的是 古印度人，他们发明了 10个 阿拉伯数字。数字的革命性在于它的简单有效，而且 标志着数字和文字的分离。这在客观上让 自然语言的研究 和 数学的研究 在几千年里没有重合的轨迹。</p>
<h2>3. 文字和语言背后的数学</h2>
<p>从 <code>象形文字</code> 到 <code>拼音文字</code> 是一个飞跃，描述物体方式上，从外表进化到了抽象的概念，同时不自觉的采用了对 信息的编码。同时祖先对文字的编码还非常合理，<strong>常用字短，生僻字长</strong>。这完全符合信息论中的 最短编码理论。</p>
<p>这种文字设计(其实是一种编码方法)带来的好处是写起来省时间、省材料。</p>
<blockquote>
<p>公元前26世纪,约4700年前，出现了楔形文字(一种拼音文字)</p>
</blockquote>
<p>在古代，在造纸术发明之前，人们说话还是类似白话文，文字书写要刻在 龟壳、石碑、竹简 等上，很费时间和材料，所以惜墨如金，使得古文非常简洁。</p>
<p>类比信息科学 ：</p>
<ul>
<li>通信时: 如果信道较宽，信息不必压缩，可直接传递;</li>
<li>通信时: 如果信道较窄，信息在传递前需要尽可能压缩，然后在接收端进行解压缩。</li>
</ul>
<p><code>词语</code> ： 是有限和封闭的集合 (其实可设置完备的编码规则)<br>
<code>语言</code> ： 是无限和开放的集合 (不可以设置完备的编码规则)</p>
<p>任何语言的都有语法规则覆盖不到的地方，这些不精确性，也造就了语言的丰富多彩。</p>
<h2>4. 小结</h2>
<p>了解 文字、数字、语言 的历史</p>
<ul>
<li>通信的原理和信息传播的模型</li>
<li>(信源) 编码 和 最短编码</li>
<li>解码的规则 : 语法</li>
<li>聚类的概念</li>
<li>双语对照文本，语料库 和 机器翻译</li>
<li>多义性和利用上下文消除歧义性</li>
</ul>
<h2>Reference</h2>
<ul>
<li>《数学之美》 读书笔记</li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-python/language/py-language-structure-project" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/11/04/python/language/py-language-structure-project/"><strong>python 结构化您的工程</strong></a>
      <small class=article-date-index>&nbsp; 2017-11-04</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/11/04/python/language/py-language-structure-project/" class="article-date">
  <time datetime="2017-11-04T02:05:21.000Z" itemprop="datePublished">2017-11-04</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/python/">python</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/11/04/python/language/py-language-structure-project/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>如何利用Python的特性来创造简洁、高效的代码。 “<strong>结构化</strong>” 意味着通过编写简洁的代码，使逻辑和依赖清晰.</p>
<p>&lt;!--more--&gt;</p>
<h2>仓库的结构</h2>
<p>在一个健康的开发周期中，代码风格，API设计和自动化是非常关键的。同样的，对于工程的 架构 ,仓库的结构也是关键的一部分。</p>
<p>当一个潜在的用户和贡献者登录到您的仓库页面时，他们会看到这些:</p>
<ul>
<li>工程的名字</li>
<li>工程的描述</li>
<li>一系列的文件</li>
</ul>
<blockquote>
<p>拥有良好的布局，事半功倍。</p>
</blockquote>
<h2>仓库样例</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">README.rst</span><br><span class="line">LICENSE</span><br><span class="line">setup.py</span><br><span class="line">requirements.txt</span><br><span class="line">sample/__init__.py</span><br><span class="line">sample/core.py</span><br><span class="line">sample/helpers.py</span><br><span class="line">docs/conf.py</span><br><span class="line">docs/index.rst</span><br><span class="line">tests/test_basic.py</span><br><span class="line">tests/test_advanced.py</span><br></pre></td></tr></table></figure></p>
<h2>License</h2>
<p>除了源代码本身以外，这个毫无疑问是您仓库最重要的一部分。在这个文件中要有完整的许可说明和授权。</p>
<p>如果您不太清楚您应该使用哪种许可方式，请查看 choosealicense.com.</p>
<h2>Setup.py</h2>
<p>...</p>
<h2>Reference</h2>
<ul>
<li><a href="http://pythonguidecn.readthedocs.io/zh/latest/writing/structure.html" target="_blank" rel="noopener">结构化你的工程</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-English/engvid-Taking-care-of-your-pet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/11/02/English/engvid-Taking-care-of-your-pet/"><strong>Taking care of your pet DOG!</strong></a>
      <small class=article-date-index>&nbsp; 2017-11-02</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/11/02/English/engvid-Taking-care-of-your-pet/" class="article-date">
  <time datetime="2017-11-01T23:30:16.000Z" itemprop="datePublished">2017-11-02</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/English/">English</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/11/02/English/engvid-Taking-care-of-your-pet/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>Do you have a dog? Do you want a dog?</p>
<p>&lt;!-- more --&gt;</p>
<p>Here in North America, we have specific rules, laws, and cultural customs that every dog owner must know. And if you’re not a dog owner, you need to know this stuff, too, because you’ll be around a lot of dogs here! In this video, I’ll teach you English vocabulary for the dog-related people you’ll meet: breeders, vets, and groomers; as well as the doggie things you must have, such as a leash, dish, and treats. The best part? Dog owners love to talk about dogs. So you can practice your English by talking to other dog owners. Want more? Check out my friend Emma’s video about pets and animals here!</p>
<p><div class="video-container"><iframe src="//www.youtube.com/embed/CgGicK1q1eg" frameborder="0" allowfullscreen></iframe></div></p>
<blockquote>
<p>&amp;t=171s</p>
</blockquote>
<p>Ruff. Hi. I'm Ronnie. I'm not a dog, but I have a dog, and I like dogs. Not: I like dog. I don't want to eat a dog. No, actually I would eat a dog if you gave it to me. If you barbequed it, I'd eat it. But, oh, we're not talking about eating dogs. We're going to talk about how to actually not eat your dog, how to care for your dog. In English and in our society we call our dog our best friends, although it really has no choice. Even if your dog doesn't like you, it has to hang out with you a lot because you have to care for your dog. So, I'm going to teach you English vocabulary, English verbs for caring for your dog. Hopefully you can learn some stuff. You probably know it in your language, but now you're going to learn English with me because that's what I do.</p>
<p>So, the first thing that we should talk about is someone called a &quot;breeder&quot;. Okay? A breeder is a person who breeds dogs. So, I've written the word &quot;breeds&quot; here as a verb. Now, to breed a dog means that you get the boy dog who's called a stud and you get the girl dog who's called a bitch, and you make them have sex. I don't know how they do this, maybe they give them some doggy wine, play some nice doggy music, but anyways, the boy dog and the girl dog have dog sex, doggy style - and they have puppies. Woo-hoo. So the breeder is the person who cares for the dogs and makes more dogs. They're magical.</p>
<p>It is a really, really bad idea, almost illegal in Canada to buy a dog from the &quot;pet shop&quot;. We have really tried to cut down on dogs who are for sale in pet shops. Just the treatment of the dogs, there's been a lot of controversy. Also, you can find a dog on the internet, you can go to Kijiji or you can go to many websites where you can buy a dog. There's also dog rescue sites where maybe a dog doesn't have a house, a dog is homeless, and you can rescue the dog and make him your... Or her your best friend. So there's many options. I do not recommend the pet shop option, but make sure that your dog is going to be... You're going to be able to take care of a dog before you get one.</p>
<p>So, the place where the dogs or the puppies live and where they have all their doggy sex is called a &quot;kennel&quot;. So the kennel is the place, and the breeder is the person. You can use both of these words interchangeably, but a breeder is always a person. It's important that you go and look at the kennel when you're buying a dog to make sure that it's clean and the dogs are well taken care of. There's some terrible-looking kennels I imagine.</p>
<p>The next person that you're not going to want to go to and your dog is going to hate more than the mailman is the &quot;veterinarian&quot;. Now, in English we don't need to bother saying: &quot;Veterinarian&quot;, which is an animal doctor. What we need to say is: &quot;Vet&quot;. So you're going to say: &quot;Uh-oh, I have to take my dog to the vet&quot;, because maybe your dog is sick. Vets in Canada and probably around the world, America as well, are very, very expensive. So we don't want our dogs to be sick because it costs us a lot of money.</p>
<p>But there is one thing that people or breeders really encourage you to do if you have gotten a puppy and you're not going to breed the dog, you're not going to have... Make more baby dogs with this. That's a whole other business. So, for this you're going to do what we call &quot;get your dog fixed&quot;. Your dog is not broken, don't worry, it's not a toy. So: &quot;Get your dog fixed&quot;, you're going to go to the vet, you're going to go to the animal doctor and what's happened... What's going to happen is you're going to get your animal neutered. &quot;Neutered&quot; means... We have two different meaning... Two different words we use for this. For the boys or for the studs, neutered means &quot;castrated&quot;. Oh, gentlemen, gentlemen, this means they're going to remove the dog's testicles so the dog cannot produce sperm to have little puppies. Don't worry, I'm sure the dog doesn't feel anything, and when he wakes up he is very happy because he has less balls to lick. So, &quot;castrated&quot; is only for boys and they remove the testicles. The word that we use for women, or sorry, girls or bitches, mm-hmm, is &quot;spayed&quot;.</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-devops/linux-cmd-file-search" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/10/24/devops/linux-cmd-file-search/"><strong>Linux Search Cmd</strong></a>
      <small class=article-date-index>&nbsp; 2017-10-24</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/10/24/devops/linux-cmd-file-search/" class="article-date">
  <time datetime="2017-10-24T14:04:21.000Z" itemprop="datePublished">2017-10-24</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/devops/">devops</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/10/24/devops/linux-cmd-file-search/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>which，whereis，locate，find，find exec，find xargs，find...</p>
<p>&lt;!-- more --&gt;</p>
<p>which   查看可执行文件的位置。<br>
whereis 查看文件的位置。<br>
locate  配合数据库查看文件位置。<br>
find    实际搜寻硬盘查询文件名称。</p>
<h2>1. which</h2>
<p>which命令的作用是，在PATH变量指定的路径中，搜索某个系统命令的位置，并且返回第一个搜索结果。</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># which pwd</span></span><br><span class="line">/bin/<span class="built_in">pwd</span></span><br><span class="line">[root@localhost ~]<span class="comment">#  which adduser</span></span><br><span class="line">/usr/sbin/adduser</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p>cd 是bash 内建的命令！</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜ <span class="built_in">which</span> <span class="built_in">cd</span></span><br><span class="line"><span class="built_in">cd</span>: shell built-in <span class="built_in">command</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>which 默认是找 PATH 内所规范的目录，所以当然一定找不到的！</p>
</blockquote>
<h2>2. whereis</h2>
<p>whereis命令只能用于程序名的搜索，而且只搜索二进制文件（参数-b）、man说明文件（参数-m）和源代码文件（参数-s）。如果省略参数，则返回所有信息。</p>
<p>和find相比，whereis查找的速度非常快，这是因为linux系统会将 系统内的所有文件都记录在一个数据库文件中，当使用whereis和下面即将介绍的locate时，会从数据库中查找数据，而不是像find命令那样，通 过遍历硬盘来查找，效率自然会很高。</p>
<p>但是该数据库文件并不是实时更新，默认情况下时一星期更新一次，因此，我们在用whereis和locate 查找文件时，有时会找到已经被删除的数据，或者刚刚建立文件，却无法查找到，原因就是因为数据库文件没有被更新。</p>
<h2>3. locate</h2>
<p>locate命令可以在搜寻数据库时快速找到档案，数据库由updatedb程序来更新，updatedb是由cron daemon周期性建立的，locate命令在搜寻数据库时比由整个由硬盘资料来搜寻资料来得快，但较差劲的是locate所找到的档案若是最近才建立或 刚更名的，可能会找不到，在内定值中，updatedb每天会跑一次，可以由修改crontab来更新设定值。(etc/crontab)</p>
<p>locate指定用在搜寻符合条件的档案，它会去储存档案与目录名称的数据库内，寻找合乎范本样式条件的档案或目录录，可以使用特殊字元（如”<em>” 或”?”等）来指定范本样式，如指定范本为kcpa</em>ner, locate会找出所有起始字串为kcpa且结尾为ner的档案或目录，如名称为kcpartner若目录录名称为kcpa_ner则会列出该目录下包括 子目录在内的所有档案。</p>
<p>locate指令和find找寻档案的功能类似，但locate是透过update程序将硬盘中的所有档案和目录资料先建立一个索引数据库，在 执行loacte时直接找该索引，查询速度会较快，索引数据库一般是由操作系统管理，但也可以直接下达update强迫系统立即修改索引数据库。</p>
<blockquote>
<p>mac 默认没启动 locate</p>
</blockquote>
<h2>4. find</h2>
<h3>4.1 查找指定时间内修改过的文件</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@peidachang ~]<span class="comment"># find -atime -2</span></span><br><span class="line">.</span><br><span class="line">./logs/monitor</span><br><span class="line">./.bashrc</span><br><span class="line">./.bash_profile</span><br><span class="line">./.bash_history</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>说明：超找48小时内修改过的文件</p>
</blockquote>
<h3>4.2 根据关键字查找</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -name <span class="string">"*.log"</span></span><br></pre></td></tr></table></figure></p>
<h3>4.3 查找当前所有目录并排序</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> d | sort</span><br></pre></td></tr></table></figure></p>
<h3>4.4 按类型查找</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -name <span class="string">"*.log"</span></span><br></pre></td></tr></table></figure></p>
<h3>4.5 查找当前所有目录并排序</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> d | sort</span><br></pre></td></tr></table></figure></p>
<h3>4.6 按大小查找文件</h3>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find . -size +1000c -print</span><br></pre></td></tr></table></figure></p>
<h2>5. find命令之exec</h2>
<p>find是我们很常用的一个Linux命令，但是我们一般查找出来的并不仅仅是看看而已，还会有进一步的操作，这个时候exec的作用就显现出来了。</p>
<p><strong>exec解释：</strong></p>
<p>-exec  参数后面跟的是command命令，它的终止是以;为结束标志的，所以这句命令后面的分号是不可缺少的，考虑到各个系统中分号会有不同的意义，所以前面加反斜杠。</p>
<p>{}   花括号代表前面find查找出来的文件名。</p>
<p>使用find时，只要把想要的操作写在一个文件里，就可以用exec来配合find查找，很方便的。在有些操作系统中只允许-exec选项执行诸如l s或ls -l这样的命令。大多数用户使用这一选项是为了查找旧文件并删除它们。建议在真正执行rm命令删除文件之前，最好先用ls命令看一下，确认它们是所要删除的文件。 exec选项后面跟随着所要执行的命令或脚本，然后是一对儿{ }，一个空格和一个\，最后是一个分号。为了使用exec选项，必须要同时使用print选项。如果验证一下find命令，会发现该命令只输出从当前路径起的相对路径及文件名。</p>
<h3>5.1 ls -l命令放find命令的-exec</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ~/ghome/github/test [15:45:03]</span></span><br><span class="line">➜ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:44 log1</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:45 log2</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:45 log3</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:45 log4</span><br><span class="line">(vpy2)</span><br><span class="line"><span class="comment"># ~/ghome/github/test [15:45:03]</span></span><br><span class="line">➜ find . -<span class="built_in">type</span> f -<span class="built_in">exec</span> ls -l &#123;&#125; \;</span><br><span class="line">-rw-r--r--  1 blair  staff  0 Oct 28 15:45 ./log4</span><br><span class="line">-rw-r--r--  1 blair  staff  0 Oct 28 15:45 ./log3</span><br><span class="line">-rw-r--r--  1 blair  staff  0 Oct 28 15:45 ./log2</span><br><span class="line">-rw-r--r--  1 blair  staff  0 Oct 28 15:44 ./log1</span><br><span class="line">(vpy2)</span><br><span class="line"><span class="comment"># ~/ghome/github/test [15:45:04]</span></span><br><span class="line">➜</span><br></pre></td></tr></table></figure></p>
<h3>5.2 更改时间在n日以前的文件并删除</h3>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find . -type f -mtime +14 -exec rm &#123;&#125; \;</span><br></pre></td></tr></table></figure></p>
<h3>5.3 更改时间在n日前文件并提示删除</h3>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ~/ghome/github/test [15:47:35]</span><br><span class="line">➜ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:44 log1</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:45 log2</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:45 log3</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:45 log4</span><br><span class="line">(vpy2)</span><br><span class="line"># ~/ghome/github/test [15:47:38]</span><br><span class="line">➜ find . -name &quot;*log*&quot; -mtime -1 -ok rm &#123;&#125; \;</span><br><span class="line">&quot;rm ./log4&quot;?</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>在目录中查找更改时间在n日以前的文件并删除它们，在删除之前先给出提示</p>
</blockquote>
<h3>5.4 -exec中使用grep命令</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find /etc -name <span class="string">"passwd*"</span> -<span class="built_in">exec</span> grep <span class="string">"root"</span> &#123;&#125; \;</span><br></pre></td></tr></table></figure></p>
<h3>5.5 查找文件移动到指定目录</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find . -name <span class="string">"*.log"</span> -<span class="built_in">exec</span> mv &#123;&#125; .. \;</span><br></pre></td></tr></table></figure></p>
<h3>5.6 exec选项执行cp命令</h3>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find . -name &quot;*.log&quot; -exec cp &#123;&#125; test3 \;</span><br></pre></td></tr></table></figure></p>
<h2>6. find命令之xargs</h2>
<p>在使用 find命令的-exec选项处理匹配到的文件时， find命令将所有匹配到的文件一起传递给exec执行。但有些系统对能够传递给exec的命令长度有限制，这样在find命令运行几分钟之后，就会出现溢出错误。错误信息通常是“参数列太长”或“参数列溢出”。这就是xargs命令的用处所在，特别是与find命令一起使用。</p>
<p>find命令把匹配到的文件传递给xargs命令，而xargs命令每次只获取一部分文件而不是全部，不像-exec选项那样。这样它可以先处理最先获取的一部分文件，然后是下一批，并如此继续下去。</p>
<p>在有些系统中，使用-exec选项会为处理每一个匹配到的文件而发起一个相应的进程，并非将匹配到的文件全部作为参数一次执行；这样在有些情况下就会出现进程过多，系统性能下降的问题，因而效率不高； 而使用xargs命令则只有一个进程。另外，在使用xargs命令时，究竟是一次获取所有的参数，还是分批取得参数，以及每一次获取参数的数目都会根据该命令的选项及系统内核中相应的可调参数来确定。</p>
<h3>6.1 find . -type f -print | xargs file</h3>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ~/ghome/github/test [7:41:40]</span></span><br><span class="line">➜ find . -<span class="built_in">type</span> f -<span class="built_in">print</span> | xargs file</span><br><span class="line">./log4: empty</span><br><span class="line">./log3: empty</span><br><span class="line">./log2: empty</span><br><span class="line">./log1: ASCII text</span><br><span class="line">(vpy2)</span><br></pre></td></tr></table></figure></p>
<h3>6.2 用户具有读、写和执行权限的文件，并收回相应的写权限</h3>
<p>find . -perm -7 -print | xargs chmod o-w</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ~/ghome/github/test [7:44:26]</span></span><br><span class="line">➜ find . -perm -7 -<span class="built_in">print</span></span><br><span class="line">./log3</span><br><span class="line">(vpy2)</span><br><span class="line"><span class="comment"># ~/ghome/github/test [7:44:27]</span></span><br><span class="line">➜ find . -perm -7 -<span class="built_in">print</span> | xargs chmod o-w</span><br><span class="line">(vpy2)</span><br><span class="line"><span class="comment"># ~/ghome/github/test [7:44:49]</span></span><br><span class="line">➜ ll</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--  1 blair  staff    32B Oct 28 15:54 log1</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:45 log2</span><br><span class="line">-rwxrwxr-x  1 blair  staff     0B Oct 28 15:45 log3</span><br><span class="line">-rw-r--r--  1 blair  staff     0B Oct 28 15:45 log4</span><br><span class="line">(vpy2)</span><br><span class="line"><span class="comment"># ~/ghome/github/test [7:44:50]</span></span><br></pre></td></tr></table></figure></p>
<h3>6.3 grep命令在所有的普通文件中搜索hostname这个词</h3>
<p>find . -type f -print | xargs grep &quot;hostname&quot;</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find . -type f -print | xargs grep "hostname"</span></span><br><span class="line">./log2013.log:hostnamebaidu=baidu.com</span><br><span class="line">./log2013.log:hostnamesina=sina.com</span><br><span class="line">./log2013.log:hostnames=<span class="literal">true</span>[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<h3>6.4 使用xargs执行mv</h3>
<p>find . -name &quot;*.log&quot; | xargs -i mv {} test4</p>
<blockquote>
<p>使用-i参数默认的前面输出用{}代替，-I参数可以指定其他代替字符</p>
</blockquote>
<h3>6.5 xargs的-p参数的使用</h3>
<p>find . -name &quot;*.log&quot; | xargs -p -i mv {} ..</p>
<blockquote>
<p>-p参数会提示让你确认是否执行后面的命令,y执行，n不执行。</p>
</blockquote>
<h2>7. <a href="http://www.cnblogs.com/peida/archive/2012/11/16/2773289.html" target="_blank" rel="noopener">find 命令的参数详解</a></h2>
<h2>Reference</h2>
<ul>
<li><a href="http://www.cnblogs.com/peida/archive/2012/12/05/2803591.html" target="_blank" rel="noopener">每天一个linux命令目录</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-devops/linux-cmd-1-file-directory-operation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/10/23/devops/linux-cmd-1-file-directory-operation/"><strong>Linux File Basic Cmd</strong></a>
      <small class=article-date-index>&nbsp; 2017-10-23</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/10/23/devops/linux-cmd-1-file-directory-operation/" class="article-date">
  <time datetime="2017-10-23T14:04:21.000Z" itemprop="datePublished">2017-10-23</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/devops/">devops</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/10/23/devops/linux-cmd-1-file-directory-operation/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>ls, cd, pwd, mkdir, rm, rmdir, mv, cp, touch, cat, nl, more, less, head, tail</p>
<p>&lt;!-- more --&gt;</p>
<h2>1. ls</h2>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ls -l -R /home/blair/ghome</span><br><span class="line">ls -ctrl s*</span><br></pre></td></tr></table></figure></p>
<p>列出 /opt/soft 文件下面的子目录</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ls -F /opt/soft |grep /$</span><br></pre></td></tr></table></figure></p>
<p>目录于名称后加&quot;/&quot;, 可执行档于名称后加&quot;*&quot;</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ls -AFl</span><br></pre></td></tr></table></figure></p>
<p>列出当前目录下的所有文件（包括隐藏文件）的绝对路径， 对目录不做递归</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find <span class="variable">$PWD</span> -maxdepth 1 | xargs ls -ld</span><br></pre></td></tr></table></figure></p>
<p>递归列出当前目录下的所有文件（包括隐藏文件）的绝对路径</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find <span class="variable">$PWD</span> | xargs ls -ld</span><br></pre></td></tr></table></figure></p>
<h2>2. cd</h2>
<blockquote>
<p><code>cd -</code> or <code>cd</code> or <code>cd ~</code></p>
</blockquote>
<h2>3. pwd</h2>
<p><code>pwd -P</code> 显示出实际路径，而非使用连接（link）路径</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># /usr/local/xsoft/software/scala [22:17:59]</span><br><span class="line">➜ pwd</span><br><span class="line">/usr/local/xsoft/software/scala</span><br><span class="line">(vpy3)</span><br><span class="line"># /usr/local/xsoft/software/scala [22:17:59]</span><br><span class="line">➜ pwd -P</span><br><span class="line">/usr/local/xsoft/deploy/scala-2.11.7</span><br><span class="line">(vpy3)</span><br><span class="line"># /usr/local/xsoft/software/scala [22:18:02]</span><br><span class="line">➜</span><br></pre></td></tr></table></figure></p>
<h2>4. mkdir</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir test1</span><br><span class="line">mkdir -p test2/test22</span><br><span class="line">mkdir -m 777 test3</span><br><span class="line">mkdir -v test4</span><br></pre></td></tr></table></figure></p>
<p>一个命令创建项目的目录结构</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ~/ghome/seek/test2 [22:23:06]</span></span><br><span class="line">➜ mkdir -vp scf/&#123;lib/,bin/,doc/&#123;info,product&#125;,logs/&#123;info,product&#125;,service/deploy/&#123;info,product&#125;&#125;</span><br><span class="line">(vpy3)</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ~/ghome/seek/test2 [22:23:08]</span><br><span class="line">➜ tree</span><br><span class="line">.</span><br><span class="line">└── scf</span><br><span class="line">    ├── bin</span><br><span class="line">    ├── doc</span><br><span class="line">    │   ├── info</span><br><span class="line">    │   └── product</span><br><span class="line">    ├── lib</span><br><span class="line">    ├── logs</span><br><span class="line">    │   ├── info</span><br><span class="line">    │   └── product</span><br><span class="line">    └── service</span><br><span class="line">        └── deploy</span><br><span class="line">            ├── info</span><br><span class="line">            └── product</span><br><span class="line"></span><br><span class="line">13 directories, 0 files</span><br><span class="line">(vpy3)</span><br><span class="line"># ~/ghome/seek/test2 [22:23:10]</span><br></pre></td></tr></table></figure></p>
<h2>5. rm</h2>
<p>-f, --force    忽略不存在的文件，从不给出提示。
-i, --interactive 进行交互式删除
-r, -R, --recursive   指示rm将参数中列出的全部目录和子目录均递归地删除。
-v, --verbose    详细显示进行的步骤</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ~/ghome/seek/test2 [22:29:28]</span></span><br><span class="line">➜ rm -i f1</span><br><span class="line">remove f1?</span><br></pre></td></tr></table></figure></p>
<p><strong>自定义回收站功能</strong></p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">myrm</span></span>()&#123; D=/tmp/$(date +%Y%m%d%H%M%S); mkdir -p <span class="variable">$D</span>; mv <span class="string">"<span class="variable">$@</span>"</span> <span class="variable">$D</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"moved to <span class="variable">$D</span> ok"</span>; &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>for example</strong>:</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost test]# myrm()&#123; D=/tmp/$(date +%Y%m%d%H%M%S); mkdir -p $D; mv &quot;$@&quot; $D &amp;&amp; echo &quot;moved to $D ok&quot;; &#125;</span><br><span class="line">[root@localhost test]# alias rm=&apos;myrm&apos;</span><br><span class="line">[root@localhost test]# touch 1.log 2.log 3.log</span><br><span class="line">[root@localhost test]# ll</span><br><span class="line">总计 16</span><br><span class="line">-rw-r--r-- 1 root root    0 10-26 15:08 1.log</span><br><span class="line">-rw-r--r-- 1 root root    0 10-26 15:08 2.log</span><br><span class="line">-rw-r--r-- 1 root root    0 10-26 15:08 3.log</span><br><span class="line">drwxr-xr-x 7 root root 4096 10-25 18:07 scf</span><br><span class="line">drwxrwxrwx 2 root root 4096 10-25 17:46 test3</span><br><span class="line">drwxr-xr-x 2 root root 4096 10-25 17:56 test4</span><br><span class="line">drwxr-xr-x 3 root root 4096 10-25 17:56 test5</span><br><span class="line">[root@localhost test]# rm [123].log</span><br><span class="line">moved to /tmp/20121026150901 ok</span><br><span class="line">[root@localhost test]# ll</span><br><span class="line">总计 16drwxr-xr-x 7 root root 4096 10-25 18:07 scf</span><br><span class="line">drwxrwxrwx 2 root root 4096 10-25 17:46 test3</span><br><span class="line">drwxr-xr-x 2 root root 4096 10-25 17:56 test4</span><br><span class="line">drwxr-xr-x 3 root root 4096 10-25 17:56 test5</span><br><span class="line">[root@localhost test]# ls /tmp/20121026150901/</span><br><span class="line">1.log  2.log  3.log</span><br><span class="line">[root@localhost test]#</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>**Reference: ** <a href="http://www.cnblogs.com/peida/archive/2012/10/26/2740521.html" target="_blank" rel="noopener">每天一个linux命令（5）：rm 命令</a></p>
</blockquote>
<h2>6. rmdir</h2>
<blockquote>
<p>删除空目录</p>
<p>rmdir -p 当子目录被删除后使它也成为空目录的话，则顺便一并删除</p>
</blockquote>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost scf]<span class="comment"># rmdir -p logs</span></span><br><span class="line">rmdir: logs: 目录非空</span><br><span class="line"></span><br><span class="line">[root@localhost scf]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">|-- bin</span><br><span class="line">|-- doc</span><br><span class="line">|-- lib</span><br><span class="line">|-- logs</span><br><span class="line">|   `-- product</span><br><span class="line">`-- service</span><br><span class="line">    `-- deploy</span><br><span class="line">        |-- info</span><br><span class="line">        `-- product</span><br><span class="line"> </span><br><span class="line">9 directories, 0 files</span><br></pre></td></tr></table></figure></p>
<p>[root@localhost scf]# rmdir -p logs/product</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost scf]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">|-- bin</span><br><span class="line">|-- doc</span><br><span class="line">|-- lib</span><br><span class="line">`-- service</span><br><span class="line">`-- deploy</span><br><span class="line">        |-- info</span><br><span class="line">        `-- product</span><br></pre></td></tr></table></figure></p>
<h2>7. mv</h2>
<p>-i ：若目标文件 (destination) 已经存在时，就会询问是否覆盖！
-t  ： --target-directory=DIRECTORY move all SOURCE arguments into DIRECTORY，即指定mv的目标目录，该选项适用于移动多个源文件到一个目录的情况，此时目标目录在前，源文件在后。</p>
<h2>8. cp</h2>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp -a test3 test4</span><br><span class="line">cp -s log.log log_link.log</span><br></pre></td></tr></table></figure></p>
<h2>9. touch</h2>
<p>设定文件的时间戳</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch -t 201211142234.50 log.log</span><br></pre></td></tr></table></figure></p>
<p>更新 log2012.log 的时间和 log.log 时间戳相同</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch -r log.log log2012.log</span><br></pre></td></tr></table></figure></p>
<h2>10. cat</h2>
<ol>
<li>一次显示整个文件:cat filename</li>
<li>从键盘创建一个文件:cat &gt; filename 只能创建新文件,不能编辑已有文件.</li>
<li>将几个文件合并为一个文件:cat file1 file2 &gt; file</li>
</ol>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜ cat -n log.log log2012.log</span><br><span class="line">     1	asd</span><br><span class="line">     2</span><br><span class="line">     3	asd</span><br><span class="line">     1	k1</span><br><span class="line">     2	k2</span><br><span class="line">     3</span><br><span class="line">     4	k3</span><br><span class="line">(vpy3)</span><br><span class="line"><span class="comment"># ~/ghome/seek/test2 [23:02:19]</span></span><br><span class="line">➜</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>tac (反向列示).
tac log.txt</p>
</blockquote>
<h2>11. nl</h2>
<p>nl命令在linux系统中用来计算文件中行号。nl 可以将输出的文件内容自动的加上行号！</p>
<p>命令参数：</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-b  ：指定行号指定的方式，主要有两种：</span><br><span class="line">-b a ：表示不论是否为空行，也同样列出行号(类似 cat -n)；</span><br><span class="line">-b t ：如果有空行，空的那一行不要列出行号(默认值)；</span><br><span class="line">-n  ：列出行号表示的方法，主要有三种：</span><br><span class="line">-n ln ：行号在萤幕的最左方显示；</span><br><span class="line">-n rn ：行号在自己栏位的最右方显示，且不加 0 ；</span><br><span class="line">-n rz ：行号在自己栏位的最右方显示，且加 0 ；</span><br><span class="line">-w  ：行号栏位的占用的位数。</span><br><span class="line">-p 在逻辑定界符处不重新开始计算。</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># nl log2012.log </span></span><br><span class="line">     1  2012-01</span><br><span class="line">     2  2012-02</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">     3  ======[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost test]# nl -b a log2012.log </span><br><span class="line">     1  2012-01</span><br><span class="line">     2  2012-02</span><br><span class="line">     3</span><br><span class="line">     4</span><br><span class="line">     5  ======[root@localhost test]#</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># nl -b a -n rz log2014.log </span></span><br><span class="line">000001  2014-01</span><br><span class="line">000002  2014-02</span><br><span class="line">000003  2014-03</span><br><span class="line">000004  2014-04</span><br><span class="line">000005  2014-05</span><br><span class="line">000006  2014-06</span><br><span class="line">000007  2014-07</span><br><span class="line">000008  2014-08</span><br><span class="line">000009  2014-09</span><br><span class="line">000010  2014-10</span><br><span class="line">000011  2014-11</span><br><span class="line">000012  2014-12</span><br><span class="line">000013  =======</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># nl -b a -n rz -w 3 log2014.log </span></span><br><span class="line">001     2014-01</span><br><span class="line">002     2014-02</span><br><span class="line">003     2014-03</span><br><span class="line">004     2014-04</span><br><span class="line">005     2014-05</span><br><span class="line">006     2014-06</span><br><span class="line">007     2014-07</span><br><span class="line">008     2014-08</span><br><span class="line">009     2014-09</span><br><span class="line">010     2014-10</span><br><span class="line">011     2014-11</span><br><span class="line">012     2014-12</span><br><span class="line">013     =======</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>说明： nl -b a -n rz 命令行号默认为六位，要调整位数可以加上参数 -w 3 调整为3位。</p>
</blockquote>
<h2>12. more</h2>
<p>命令参数：</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+n       从笫n行开始显示</span><br><span class="line">-n       定义屏幕大小为n行</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost test]# cat log2012.log </span><br><span class="line">2012-01</span><br><span class="line">2012-02</span><br><span class="line">2012-03</span><br><span class="line">2012-04-day1</span><br><span class="line">2012-04-day2</span><br><span class="line">2012-04-day3</span><br><span class="line">======[root@localhost test]# more +3 log2012.log </span><br><span class="line">2012-03</span><br><span class="line">2012-04-day1</span><br><span class="line">2012-04-day2</span><br><span class="line">2012-04-day3</span><br><span class="line">======[root@localhost test]#</span><br></pre></td></tr></table></figure></p>
<p>设定每屏显示行数   more -5 log2012.log.</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># more -5 log2012.log </span></span><br><span class="line">2012-01</span><br><span class="line">2012-02</span><br><span class="line">2012-03</span><br><span class="line">2012-04-day1</span><br><span class="line">2012-04-day2</span><br></pre></td></tr></table></figure></p>
<p>列一个目录下的文件，由于内容太多，我们应该学会用more来分页显示。这得和管道 | 结合起来</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ls -l  | more -5</span><br></pre></td></tr></table></figure></p>
<h2>13. less</h2>
<p>less 工具也是对文件或其它输出进行分页显示的工具，应该说是linux正统查看文件内容的工具，功能极其强大。</p>
<p>less 的用法比起 more 更加的有弹性。在 more 的时候，我们并没有办法向前面翻， 只能往后面看，但若使用了 less 时，就可以使用 [pageup] [pagedown] 等按键的功能来往前往后翻看文件，更容易用来查看一个文件的内容！</p>
<p>在 less 里头可以拥有更多的搜索功能，不止可以向下搜，也可以向上搜。</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">less log2013.log</span><br><span class="line"></span><br><span class="line">ps -ef |less</span><br><span class="line"></span><br><span class="line"><span class="built_in">history</span> | less</span><br></pre></td></tr></table></figure></p>
<p>输出文件除了最后n行的全部内容</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">head -n -6 log2014.log</span><br></pre></td></tr></table></figure></p>
<h2>14. head</h2>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost test]# head -n 5 log2014.log </span><br><span class="line">2014-01</span><br><span class="line">2014-02</span><br><span class="line">2014-03</span><br><span class="line">2014-04</span><br><span class="line">2014-05[root@localhost test]#</span><br></pre></td></tr></table></figure></p>
<p>显示文件前n个字节  head -c 20 log2014.log</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># head -c 20 log2014.log</span></span><br><span class="line">2014-01</span><br><span class="line">2014-02</span><br><span class="line">2014</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p>输出文件除了最后n行的全部内容</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">head -n -6 log2014.log</span><br></pre></td></tr></table></figure></p>
<h2>15. tail</h2>
<p>显示文件末尾内容. tail -n 5 log2014.log</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># tail -n 5 log2014.log </span></span><br><span class="line">2014-09</span><br><span class="line">2014-10</span><br><span class="line">2014-11</span><br><span class="line">2014-12</span><br><span class="line">==============================[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p>循环查看文件内容 tail -f test.log</p>
<h2>Reference</h2>
<ul>
<li><a href="http://www.cnblogs.com/peida/tag/%E6%AF%8F%E6%97%A5%E4%B8%80linux%E5%91%BD%E4%BB%A4/" target="_blank" rel="noopener">每日一linux命令</a></li>
<li><a href="http://www.cnblogs.com/peida/archive/2012/12/05/2803591.html" target="_blank" rel="noopener">每天一个linux命令目录</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-tensorflow/tf-doc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/10/23/tensorflow/tf-doc/"><strong>Tensorflow 快速学习 &amp; 文档</strong></a>
      <small class=article-date-index>&nbsp; 2017-10-23</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/10/23/tensorflow/tf-doc/" class="article-date">
  <time datetime="2017-10-23T13:00:21.000Z" itemprop="datePublished">2017-10-23</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/10/23/tensorflow/tf-doc/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>介绍 Tensorflow 的学习流程 与 <a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-bm7y28si.html" target="_blank" rel="noopener">W3C shchool Tensorflow</a> 的中文文档。</p>
<p>&lt;!-- more --&gt;</p>
<h2>1. 结构目录</h2>
<h3>1.1 Tensorflow 入门介绍</h3>
<h3>1.2 Tensorflow 使用指南</h3>
<p>TensorFlow <a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-85v22c69.html" target="_blank" rel="noopener">张量变换</a></p>
<p>TensorFlow <a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-y6p82c6e.html" target="_blank" rel="noopener">Training函数</a> ： tf.train 提供了一组帮助训练模型的类和函数。</p>
<h3>1.3 Tensorflow 函数介绍</h3>
<p>函数模块 : tf</p>
<p>TensorFlow <a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-58lx2coj.html" target="_blank" rel="noopener">app模块 : 定义通用入口点脚本</a></p>
<p>TensorFlow contrib模块</p>
<p>TensorFlow 的 errors模块</p>
<p>estimator 模块 <a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-xp3r2dl5.html" target="_blank" rel="noopener">估算器（Estimator）</a> ： 用于处理模型的高级工具。</p>
<blockquote>
<ul>
<li>TensorFlow的estimator类函数：<a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-hd9a2oyb.html" target="_blank" rel="noopener">tf.estimator.Estimator</a></li>
</ul>
</blockquote>
<p>TensorFlow 的 image模块</p>
<p>TensorFlow 使用之 <strong>tf.initializers</strong></p>
<p>TensorFlow 使用之 tf.keras</p>
<p>TensorFlow <a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-59ay2s9i.html" target="_blank" rel="noopener">使用之 tf.layers</a></p>
<p>TensorFlow 使用之 <strong>tf.losses</strong></p>
<p>TensorFlow <a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-ke8y2yhg.html" target="_blank" rel="noopener">使用之 tf.metrics</a></p>
<h3>1.4 TensorFlow 功能函数</h3>
<p><strong>tf.get_variable</strong> 函数</p>
<p>TensorFlow范数：<code>tf.norm</code>函数</p>
<p>TensorFlow函数：<code>tf.ones</code></p>
<p>tf.one_hot函数：返回one-hot张量</p>
<p>TensorFlow随机值：tf.random_normal函数</p>
<p>tf.random_normal_initializer：TensorFlow初始化器</p>
<p>TensorFlow函数：tf.ones_initializer</p>
<p>TensorFlow占位符：<code>tf.placeholder</code></p>
<p>TensorFlow函数： <a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-hckq2htb.html" target="_blank" rel="noopener">tf.reduce_mean</a></p>
<p>TensorFlow函数：<code>tf.reduce_sum</code></p>
<blockquote>
<p>axis = 0， 为纵向
axis = 1， 为横向</p>
</blockquote>
<h3>1.5 TensorFlow 手写数字分类问题</h3>
<h2>Reference</h2>
<ul>
<li><a href="https://www.tensorflow.org/" target="_blank" rel="noopener">tensorflow.org</a></li>
<li><a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-bm7y28si.html" target="_blank" rel="noopener">TensorFlow 入门基础 W3C school</a></li>
<li><a href="https://blog.csdn.net/jerr__y/article/category/6747409" target="_blank" rel="noopener">大学之道，在明明德 - 我的Tensorflow学习之路</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-devops/oh-my-zsh-config" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/10/21/devops/oh-my-zsh-config/"><strong>My Zsh Config Files</strong></a>
      <small class=article-date-index>&nbsp; 2017-10-21</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/10/21/devops/oh-my-zsh-config/" class="article-date">
  <time datetime="2017-10-21T10:16:21.000Z" itemprop="datePublished">2017-10-21</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/devops/">devops</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/10/21/devops/oh-my-zsh-config/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>我的配置文件 <strong>~/.zprofile</strong> 和 <strong>~/.zshrc</strong></p>
<p>&lt;!-- more --&gt;</p>
<h2>1. python</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### IPython ###</span></span><br><span class="line"><span class="built_in">alias</span> ipython=<span class="string">'python -m IPython'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Pyenv ###</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">"/Users/blair/.pyenv/bin:<span class="variable">$PATH</span>"</span></span><br><span class="line"><span class="built_in">alias</span> pyenv_init=<span class="string">'eval "$(pyenv init -)" &amp;&amp; eval "$(pyenv virtualenv-init -)"'</span></span><br><span class="line">pyenv_init</span><br><span class="line"><span class="comment">#export PYENV_VIRTUALENV_DISABLE_PROMPT=1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pip list</span></span><br><span class="line"><span class="built_in">alias</span> pipl=<span class="string">'pip list --format=columns'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pyenv</span></span><br><span class="line"><span class="built_in">alias</span> pyenv_install_python_pre=<span class="string">'source $MS/custom-machine/pyenv-install.sh'</span></span><br><span class="line"><span class="built_in">alias</span> py2=<span class="string">'pyenv_init &amp;&amp; pyenv activate vpy2 &amp;&amp; clear &amp;&amp; python -V'</span></span><br><span class="line"><span class="built_in">alias</span> py3=<span class="string">'pyenv_init &amp;&amp; pyenv activate vpy3.5 &amp;&amp; clear &amp;&amp; python -V'</span></span><br><span class="line"><span class="built_in">alias</span> vca3=<span class="string">'pyenv activate vconda3 &amp;&amp; clear &amp;&amp; python -V'</span></span><br><span class="line"><span class="built_in">alias</span> pyde=<span class="string">'pyenv deactivate'</span></span><br><span class="line"><span class="built_in">alias</span> pys=<span class="string">'pyenv activate vpy3 &amp;&amp; pyenv global system &amp;&amp; pyde &amp;&amp; python -V'</span></span><br></pre></td></tr></table></figure></p>
<h2>2. hexo blog</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hexo</span></span><br><span class="line"><span class="built_in">alias</span> hs=<span class="string">'cd ~/ghome/blog &amp;&amp; hexo clean &amp;&amp; hexo s -p 5000 &amp;'</span></span><br><span class="line"><span class="built_in">alias</span> hsy=<span class="string">'cd ~/ghome/blogyih &amp;&amp; hexo clean &amp;&amp; hexo s -p 5001 &amp;'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># deploy blog</span></span><br><span class="line"><span class="built_in">alias</span> db=<span class="string">'~/ghome/blog &amp;&amp; sh dp.sh'</span></span><br><span class="line"><span class="built_in">alias</span> dby=<span class="string">'~/ghome/blogyih &amp;&amp; sh dp.sh'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> gp=<span class="string">'cd ~/ghome/blog/source &amp;&amp; git pull &amp;&amp; cd ~/ghome/blog/52binge.github.io &amp;&amp; git pull &amp;&amp; cd .. &amp;&amp; clear'</span></span><br><span class="line"><span class="built_in">alias</span> gpy=<span class="string">'cd ~/ghome/blogyih/source &amp;&amp; git pull &amp;&amp; cd ~/ghome/blogyih/52binge.github.io &amp;&amp; git pull &amp;&amp; cd .. &amp;&amp; clear'</span></span><br></pre></td></tr></table></figure></p>
<h2>3. shortcut approach</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Fast Function ###</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show ip</span></span><br><span class="line"><span class="built_in">alias</span> ip=<span class="string">'ipconfig getifaddr en0'</span></span><br><span class="line"><span class="built_in">alias</span> ip0=<span class="string">'ipconfig getifaddr en0'</span></span><br><span class="line"><span class="built_in">alias</span> ip1=<span class="string">'ipconfig getifaddr en1'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shutdown</span></span><br><span class="line"><span class="built_in">alias</span> shuth=<span class="string">'sudo shutdown -h now'</span></span><br><span class="line"><span class="built_in">alias</span> shutr=<span class="string">'sudo shutdown -r now'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># grep</span></span><br><span class="line"><span class="built_in">alias</span> fgstr=<span class="string">'find . | xargs grep -ri'</span></span><br><span class="line"><span class="comment">#find .|xargs grep -ri "IBM" </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># lsof -i:port</span></span><br><span class="line"><span class="built_in">alias</span> lsofi=<span class="string">'lsof -i:'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># zshrc</span></span><br><span class="line"><span class="built_in">alias</span> vzp=<span class="string">'vim ~/.zprofile'</span></span><br><span class="line"><span class="built_in">alias</span> szp=<span class="string">'source ~/.zprofile'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pyenv-virtualenv: prompt changing will be removed from future release. configure `export PYENV_VIRTUALENV_DISABLE_PROMPT=1' to simulate the behavior.</span></span><br></pre></td></tr></table></figure></p>
<h2>4. docker, k8s</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Docker</span></span><br><span class="line"><span class="built_in">alias</span> dis=<span class="string">'docker images'</span></span><br><span class="line"><span class="built_in">alias</span> dri=<span class="string">'docker rmi'</span></span><br><span class="line"><span class="built_in">alias</span> dpa=<span class="string">'docker ps -a'</span></span><br><span class="line"><span class="built_in">alias</span> dks=<span class="string">'docker stop'</span></span><br><span class="line"><span class="built_in">alias</span> dck=<span class="string">'docker container kill'</span></span><br><span class="line"><span class="built_in">alias</span> dcr=<span class="string">'docker container rm'</span></span><br><span class="line"><span class="built_in">alias</span> dlog=<span class="string">'docker logs'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># k8s</span></span><br><span class="line"><span class="built_in">alias</span> kb=<span class="string">'kubectl'</span></span><br><span class="line"><span class="built_in">alias</span> kbg=<span class="string">'kubectl get'</span></span><br><span class="line"><span class="built_in">alias</span> kbd=<span class="string">'kubectl delete'</span></span><br><span class="line"><span class="built_in">alias</span> kbgdps=<span class="string">'kbg deploy,po,svc'</span></span><br><span class="line"><span class="built_in">alias</span> kbdev=<span class="string">'export KUBECONFIG=~/kube/dev-kubeconfig'</span></span><br><span class="line"><span class="built_in">alias</span> kbtest=<span class="string">'export KUBECONFIG=~/kube/test-kubeconfig'</span></span><br></pre></td></tr></table></figure></p>
<h2>5. work</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># work</span></span><br><span class="line"><span class="built_in">alias</span> rqh=<span class="string">'rsync -v --progress qh:'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> cw=<span class="string">'cd ~/ghome/6E/work_project'</span></span><br><span class="line"><span class="built_in">alias</span> cs=<span class="string">'cd ~/ghome/6E/self_project'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> cmlar=<span class="string">'cd ~/ghome/6E/work_project/mlar'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> sqh=<span class="string">'ssh -L 8889:localhost:8888 -CN qh'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> catm=<span class="string">'conda activate mlar'</span></span><br><span class="line"><span class="built_in">alias</span> catn=<span class="string">'conda activate nn_framework'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> cata=<span class="string">'conda activate anaconda3'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> doc=<span class="string">'~/ghome/6E/chenlibin/data-doc'</span></span><br></pre></td></tr></table></figure></p>
<h2>6. node.js</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Node.js ###</span></span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">"<span class="variable">$HOME</span>/.nvm"</span></span><br><span class="line"><span class="comment">#[ -s "$NVM_DIR/nvm.sh" ] &amp;&amp; \. "$NVM_DIR/nvm.sh"  # This loads nvm</span></span><br><span class="line"><span class="comment">#[ -s "$NVM_DIR/bash_completion" ] &amp;&amp; \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion</span></span><br></pre></td></tr></table></figure></p>
<h2>7. mac env</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### LANG ###</span></span><br><span class="line"><span class="built_in">export</span> LC_ALL=en_US.UTF-8</span><br><span class="line"><span class="built_in">export</span> LANG=en_US.UTF-8</span><br></pre></td></tr></table></figure></p>
<h2>8. Java</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### JAVA ###</span></span><br><span class="line">JAVA_HOME=/Library/Java/JavaVirtualMachines/Contents/Home</span><br><span class="line">JAVA_BIN=<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="variable">$JAVA_HOME</span>/jre/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/jre/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME JAVA_BIN PATH CLASSPATH</span><br><span class="line"></span><br><span class="line"><span class="comment">### Maven ###</span></span><br><span class="line">M2_HOME=/usr/<span class="built_in">local</span>/xsoft/software/apache-maven</span><br><span class="line">MAVEN_HOME=<span class="variable">$M2_HOME</span></span><br><span class="line">M3_HOME=<span class="variable">$M2_HOME</span></span><br><span class="line">PATH=<span class="variable">$M3_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">MAVEN_OPTS=<span class="string">"-Xms128m -Xmx512m"</span></span><br><span class="line"><span class="built_in">export</span> MAVEN_HOME M2_HOME PATH</span><br><span class="line"></span><br><span class="line"><span class="comment">### Tomcat ###</span></span><br><span class="line">CATALINA_HOME=/usr/<span class="built_in">local</span>/xsoft/software/apache-tomcat</span><br><span class="line">PATH=<span class="variable">$CATALINA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CATALINA_HOME PATH</span><br></pre></td></tr></table></figure></p>
<h2>9. Scala</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Scala ###</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/xsoft/software/scala</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;SCALA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#export SCALA_HOME=/usr/local/Cellar/scala/2.11.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Kafka</span></span><br><span class="line">KAFKA_HOME=/usr/<span class="built_in">local</span>/Cellar/kafka/2.1.0</span><br><span class="line">PATH=<span class="variable">$KAFKA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_HOME PATH</span><br><span class="line"></span><br><span class="line"><span class="comment">### Spark ###</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/usr/<span class="built_in">local</span>/xsoft/software/spark</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure></p>
<h2>10. zshrc</h2>
<p><figure class="highlight zsh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># If you come from bash you might have to change your $PATH.</span></span><br><span class="line"><span class="comment"># export PATH=$HOME/bin:/usr/local/bin:$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to your oh-my-zsh installation.</span></span><br><span class="line"><span class="built_in">export</span> ZSH=/Users/blair/.oh-my-zsh</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set name of the theme to load. Optionally, if you set this to "random"</span></span><br><span class="line"><span class="comment"># it'll load a random theme each time that oh-my-zsh is loaded.</span></span><br><span class="line"><span class="comment"># See https://github.com/robbyrussell/oh-my-zsh/wiki/Themes</span></span><br><span class="line">ZSH_THEME=<span class="string">"robbyrussell"</span></span><br><span class="line">ZSH_THEME=<span class="string">"astro"</span> </span><br><span class="line"></span><br><span class="line">plugins=(git)</span><br><span class="line">plugins=(git autojump) <span class="comment"># by blair add @2017-10-10</span></span><br><span class="line"><span class="comment">#[[ -s $(brew --prefix)/etc/profile.d/autojump.sh ]] &amp;&amp; . $(brew --prefix)/etc/profile.d/autojump.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> <span class="variable">$ZSH</span>/oh-my-zsh.sh</span><br></pre></td></tr></table></figure></p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-devops/ops-mac-for-shadowsocks" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/10/19/devops/ops-mac-for-shadowsocks/"><strong>Macos Terminal Set Shadowsocks</strong></a>
      <small class=article-date-index>&nbsp; 2017-10-19</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/10/19/devops/ops-mac-for-shadowsocks/" class="article-date">
  <time datetime="2017-10-19T14:24:21.000Z" itemprop="datePublished">2017-10-19</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/devops/">devops</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/10/19/devops/ops-mac-for-shadowsocks/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>first, you need to have vps</li>
<li>second, you need to have shadowsocks app</li>
</ol>
<p>&lt;!-- more --&gt;</p>
<p>&lt;img src=&quot;/images/ops/ops-vpn-shadowsocks.png&quot; width=&quot;520&quot; height=&quot;300&quot; align=&quot;middle&quot; /img&gt;</p>
<h2>install</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install polipo</span><br></pre></td></tr></table></figure></p>
<h2>config</h2>
<p>设置每次登陆启动polipo</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ln -sfv /usr/local/opt/polipo/*.plist ~/Library/LaunchAgents</span><br></pre></td></tr></table></figure></p>
<p>修改文件 <code>/usr/local/opt/polipo/homebrew.mxcl.polipo.plist</code> 设置parentProxy</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version=&quot;1.0&quot;&gt;</span><br><span class="line">  &lt;dict&gt;</span><br><span class="line">    &lt;key&gt;Label&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;homebrew.mxcl.polipo&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;RunAtLoad&lt;/key&gt;</span><br><span class="line">    &lt;true/&gt;</span><br><span class="line">    &lt;key&gt;KeepAlive&lt;/key&gt;</span><br><span class="line">    &lt;true/&gt;</span><br><span class="line">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">        &lt;string&gt;/usr/local/opt/polipo/bin/polipo&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;socksParentProxy=localhost:1080&lt;/string&gt;</span><br><span class="line">    &lt;/array&gt;</span><br><span class="line">    &lt;!-- Set `ulimit -n 20480`. The default OS X limit is 256, that&apos;s</span><br><span class="line">         not enough for Polipo (displays &apos;too many files open&apos; errors).</span><br><span class="line">         It seems like you have no reason to lower this limit</span><br><span class="line">         (and unlikely will want to raise it). --&gt;</span><br><span class="line">    &lt;key&gt;SoftResourceLimits&lt;/key&gt;</span><br><span class="line">    &lt;dict&gt;</span><br><span class="line">      &lt;key&gt;NumberOfFiles&lt;/key&gt;</span><br><span class="line">      &lt;integer&gt;20480&lt;/integer&gt;</span><br><span class="line">    &lt;/dict&gt;</span><br><span class="line">  &lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure></p>
<p>修改的地方是增加了 <code>&lt;string&gt;socksParentProxy=localhost:1080&lt;/string&gt;</code></p>
<h2>start / stop</h2>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">launchctl unload ~/Library/LaunchAgents/homebrew.mxcl.polipo.plist</span><br><span class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.polipo.plist</span><br></pre></td></tr></table></figure></p>
<h2>setting profile</h2>
<p>vim ~/.zshrc</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#export http_proxy=http://localhost:8123</span><br><span class="line">alias hp=&quot;http_proxy=http://localhost:8123&quot;</span><br></pre></td></tr></table></figure></p>
<p>source ~/.zshrc</p>
<h2>test</h2>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">➜ hp curl ip.cn</span><br><span class="line">当前 IP：97.64.**.** 来自：美国</span><br></pre></td></tr></table></figure></p>
<h2>reference article</h2>
<ul>
<li><a href="http://droidyue.com/blog/2016/04/04/set-shadowsocks-proxy-for-terminal/" target="_blank" rel="noopener">技术小黑屋</a></li>
<li><a href="https://segmentfault.com/a/1190000008449046" target="_blank" rel="noopener">Mac+shadowsocks+polipo快捷实现终端科学上网</a></li>
<li><a href="http://blog.liujiangbei.com/14532622130324.html" target="_blank" rel="noopener">VPS-install-shadowsocks-proxy</a></li>
</ul>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <article id="post-devops/ops-mac-sierra-some-tips" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <myh11 itemprop="name">
      <a class="article-title-index" href="/2017/10/19/devops/ops-mac-sierra-some-tips/"><strong>Macos Sierra Uninstall App &amp; Solve Allow apps Anywhere</strong></a>
      <small class=article-date-index>&nbsp; 2017-10-19</small>
      <!--<a>
      <div = post.date  </div>
      </a>-->
      <br>
      <br> <!-- blair add -->
    </myh11>
  


      </header>
    
    <div class="article-meta">
      <!--<a href="/2017/10/19/devops/ops-mac-sierra-some-tips/" class="article-date">
  <time datetime="2017-10-19T13:57:21.000Z" itemprop="datePublished">2017-10-19</time>
</a>-->
      <!--
  <div class="article-category-index">
    <a class="article-category-index-link" href="/categories/devops/">devops</a>
  </div>

-->
      <!--
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2017/10/19/devops/ops-mac-sierra-some-tips/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
	
    <div class="article-entry" itemprop="articleBody">
      
        <p>Here are some tips to help you fun macos sierra</p>
<p>&lt;!-- more --&gt;</p>
<h2>MacOS Sierra &amp; High Sierra Complete Uninstall App</h2>
<blockquote>
<p>About This Mac -&gt; Storage -&gt; Manage -&gt; Applications -&gt; Delete</p>
</blockquote>
<h2>How to Allow Apps from Anywhere in Gatekeeper for macOS High Sierra</h2>
<p>1). Open the Terminal app from the /Applications/Utilities/ folder and then enter the following command syntax:</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo spctl --master-disable</span><br></pre></td></tr></table></figure></p>
<p>Hit return and authenticate with an admin password</p>
<p>2). Relaunch System Preferences and go to “Security &amp; Privacy” and the “General” tab</p>
<p>3). You will now see the “Anywhere” option under ‘Allow apps downloaded from:’ Gatekeeper options</p>

      
    </div>
	
    <!--
	
    -->
    <!--
    
      <footer class="article-footer">
      </footer>
    
    -->
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/9/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/11/">Next &amp;raquo;</a>
      </nav>
    

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Blair Chan&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos" target="_blank" rel="noopener">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = 'blairos-sn';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
