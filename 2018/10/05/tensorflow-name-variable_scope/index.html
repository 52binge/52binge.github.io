<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>TensorFlow ï¼š name_scope / variable_scope å‘½åæ–¹æ³• - Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="æœ¬ä¾‹å­ä¸»è¦ä»‹ç» name_scope å’Œ variable_scope çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼ï¼Œå­¦ä¹ å¹¶ç†è§£æœ¬ä¾‹ä¹‹åï¼Œä½ å°±èƒ½å¤ŸçœŸæ­£è¯»æ‡‚ TensorFlow çš„å¾ˆå¤šä»£ç å¹¶èƒ½å¤Ÿæ¸…æ™°åœ°ç†è§£æ¨¡å‹ç»“æ„äº†">
<meta property="og:type" content="article">
<meta property="og:title" content="TensorFlow ï¼š name_scope / variable_scope å‘½åæ–¹æ³•">
<meta property="og:url" content="http://iequa.com/2018/10/05/tensorflow-name-variable_scope/index.html">
<meta property="og:site_name" content="Home">
<meta property="og:description" content="æœ¬ä¾‹å­ä¸»è¦ä»‹ç» name_scope å’Œ variable_scope çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼ï¼Œå­¦ä¹ å¹¶ç†è§£æœ¬ä¾‹ä¹‹åï¼Œä½ å°±èƒ½å¤ŸçœŸæ­£è¯»æ‡‚ TensorFlow çš„å¾ˆå¤šä»£ç å¹¶èƒ½å¤Ÿæ¸…æ™°åœ°ç†è§£æ¨¡å‹ç»“æ„äº†">
<meta property="og:image" content="http://iequa.com/images/tensorflow/tf-4.3_1.jpg">
<meta property="og:updated_time" content="2018-10-05T13:21:20.546Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TensorFlow ï¼š name_scope / variable_scope å‘½åæ–¹æ³•">
<meta name="twitter:description" content="æœ¬ä¾‹å­ä¸»è¦ä»‹ç» name_scope å’Œ variable_scope çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼ï¼Œå­¦ä¹ å¹¶ç†è§£æœ¬ä¾‹ä¹‹åï¼Œä½ å°±èƒ½å¤ŸçœŸæ­£è¯»æ‡‚ TensorFlow çš„å¾ˆå¤šä»£ç å¹¶èƒ½å¤Ÿæ¸…æ™°åœ°ç†è§£æ¨¡å‹ç»“æ„äº†">
<meta name="twitter:image" content="http://iequa.com/images/tensorflow/tf-4.3_1.jpg">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8864dc75a81a27b7e44c00138af95d66";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/chatbot">Bot</a>
        
          <a class="main-nav-link" href="/tensorflow">TF</a>
        
          <a class="main-nav-link" href="/deeplearning">Deep Learning</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://iequa.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer"><article id="post-tensorflow-name-variable_scope" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      TensorFlow ï¼š name_scope / variable_scope å‘½åæ–¹æ³•
      <small class=article-detail-date-index>&nbsp; 2018-10-05</small>
    </h1>
  


        <div class=page-title></div>
        <br>
      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/10/05/tensorflow-name-variable_scope/" class="article-date">
  <time datetime="2018-10-05T04:10:21.000Z" itemprop="datePublished">2018-10-05</time>
</a>-->
      <!-- 
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

--><!-- by blair 160724 -->
      <!-- by blair
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/10/05/tensorflow-name-variable_scope/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>æœ¬ä¾‹å­ä¸»è¦ä»‹ç» name_scope å’Œ variable_scope çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼ï¼Œå­¦ä¹ å¹¶ç†è§£æœ¬ä¾‹ä¹‹åï¼Œä½ å°±èƒ½å¤ŸçœŸæ­£è¯»æ‡‚ TensorFlow çš„å¾ˆå¤šä»£ç å¹¶èƒ½å¤Ÿæ¸…æ™°åœ°ç†è§£æ¨¡å‹ç»“æ„äº†</p>
<a id="more"></a> 
<p>scope èƒ½è®©ä½ å‘½åå˜é‡çš„æ—¶å€™è½»æ¾å¾ˆå¤š. åŒæ—¶ä¹Ÿä¼šåœ¨ reusing variable ä»£ç ä¸­å¸¸å¸¸è§åˆ°. æ‰€ä»¥ä»Šå¤©æˆ‘ä»¬ä¼šæ¥è®¨è®ºä¸‹ tensorflow å½“ä¸­çš„ä¸¤ç§å®šä¹‰ scope çš„æ–¹å¼. æœ€åå¹¶é™„åŠ ä¸€ä¸ª RNN è¿ç”¨ reuse variable çš„ä¾‹å­.</p>
<p>åœ¨ TensorFlow ä¸­ï¼Œç»å¸¸çœ‹åˆ° name_scope å’Œ variable_scope ä¸¤ä¸ªä¸œä¸œï¼Œè¿™åˆ°åº•æ˜¯ä»€ä¹ˆé¬¼ï¼Œåˆ°åº•ç³»åšå’©å™¶!!! åœ¨åš LSTM çš„æ—¶å€™é‡åˆ°äº†ä¸‹é¢çš„é”™è¯¯ï¼š <code>ValueError: Variable rnn/basic_lstm_cell/weights already exists, disallowed.</code></p>
<h2 id="1-å…ˆè¯´ç»“è®º"><a href="#1-å…ˆè¯´ç»“è®º" class="headerlink" title="1. å…ˆè¯´ç»“è®º"></a>1. å…ˆè¯´ç»“è®º</h2><p>è¦ç†è§£  name_scope å’Œ variable_scopeï¼Œ é¦–å…ˆå¿…é¡»æ˜ç¡®äºŒè€…çš„ä½¿ç”¨ç›®çš„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå’Œæ™®é€šæ¨¡å‹ç›¸æ¯”ï¼Œç¥ç»ç½‘ç»œçš„èŠ‚ç‚¹éå¸¸å¤šï¼ŒèŠ‚ç‚¹èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥ï¼ˆæƒå€¼çŸ©é˜µï¼‰ä¹Ÿéå¸¸å¤šã€‚æ‰€ä»¥æˆ‘ä»¬è´¹å°½å¿ƒæ€ï¼Œå‡†å¤‡æ­å»ºä¸€ä¸ªç½‘ç»œï¼Œç„¶åæœ‰äº†å›¾1çš„ç½‘ç»œï¼ŒWTF! å› ä¸ºå˜é‡å¤ªå¤šï¼Œæˆ‘ä»¬æ„é€ å®Œç½‘ç»œä¹‹åï¼Œä¸€çœ‹ï¼Œä»€ä¹ˆé¬¼ï¼Œè¿™ä¸ªå˜é‡åˆ°åº•æ˜¯å“ªå±‚çš„ï¼Ÿï¼Ÿ</p>
<p><img src="/images/tensorflow/tf-4.3_1.jpg" width="750"></p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº† <strong>name_scope</strong> å’Œ <strong>variable_scope</strong>ï¼Œ äºŒè€…åˆåˆ†åˆ«æ‰¿æ‹…ç€ä¸åŒçš„è´£ä»»ï¼š</p>
<ul>
<li>name_scope: ä¸ºäº†æ›´å¥½åœ°ç®¡ç†å˜é‡çš„å‘½åç©ºé—´è€Œæå‡ºçš„ã€‚æ¯”å¦‚åœ¨ tensorboard ä¸­ï¼Œå› ä¸ºå¼•å…¥äº† name_scopeï¼Œ æˆ‘ä»¬çš„ Graph çœ‹èµ·æ¥æ‰äº•ç„¶æœ‰åºã€‚</li>
<li>variable_scope: å¤§å¤§å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè·Ÿ <code>tf.get_variable()</code> é…åˆä½¿ç”¨ï¼Œå®ç°å˜é‡å…±äº«çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>ä¸‹é¢é€šè¿‡ä¸¤ç»„å®éªŒæ¥æ¢ç´¢ TensorFlow çš„å‘½åæœºåˆ¶ã€‚</p>
<h2 id="2-name-scope-variable-scope-å®éªŒ-ğŸŒ°"><a href="#2-name-scope-variable-scope-å®éªŒ-ğŸŒ°" class="headerlink" title="2. name_scope/variable_scope å®éªŒ ğŸŒ°"></a>2. name_scope/variable_scope å®éªŒ ğŸŒ°</h2><p><strong>å®éªŒ 1 ä¸‰ç§æ–¹å¼åˆ›å»ºå˜é‡ï¼š</strong></p>
<p>ä¸‰ç§æ–¹å¼åˆ›å»ºå˜é‡ï¼š <strong>tf.placeholder</strong>, <strong>tf.Variable</strong>, <strong>tf.get_variable</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="comment"># è®¾ç½®GPUæŒ‰éœ€å¢é•¿</span></span><br><span class="line">config = tf.ConfigProto()</span><br><span class="line">config.gpu_options.allow_growth = <span class="keyword">True</span></span><br><span class="line">sess = tf.Session(config=config)</span><br></pre></td></tr></table></figure>
<h3 id="2-1-placeholder"><a href="#2-1-placeholder" class="headerlink" title="2.1 placeholder"></a>2.1 placeholder</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.placeholder </span></span><br><span class="line">v1 = tf.placeholder(tf.float32, shape=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">print(v1.name)</span><br><span class="line">v1 = tf.placeholder(tf.float32, shape=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], name=<span class="string">'ph'</span>)</span><br><span class="line">print(v1.name)</span><br><span class="line">v1 = tf.placeholder(tf.float32, shape=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>], name=<span class="string">'ph'</span>)</span><br><span class="line">print(v1.name)</span><br><span class="line">print(type(v1))</span><br><span class="line">print(v1)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Placeholder:0</span><br><span class="line">ph:0</span><br><span class="line">ph_1:0</span><br><span class="line">&lt;class &apos;tensorflow.python.framework.ops.Tensor&apos;&gt;</span><br><span class="line">Tensor(&quot;ph_1:0&quot;, shape=(2, 3, 4), dtype=float32)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-tf-Variable"><a href="#2-2-tf-Variable" class="headerlink" title="2.2 tf.Variable()"></a>2.2 tf.Variable()</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 2. tf.Variable()</span></span><br><span class="line">v2 = tf.Variable([<span class="number">1</span>,<span class="number">2</span>], dtype=tf.float32)</span><br><span class="line">print(v2.name)</span><br><span class="line">v2 = tf.Variable([<span class="number">1</span>,<span class="number">2</span>], dtype=tf.float32, name=<span class="string">'V'</span>)</span><br><span class="line">print(v2.name)</span><br><span class="line">v2 = tf.Variable([<span class="number">1</span>,<span class="number">2</span>], dtype=tf.float32, name=<span class="string">'V'</span>)</span><br><span class="line">print(v2.name)</span><br><span class="line">print(type(v2))</span><br><span class="line">print(v2)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Variable:0</span><br><span class="line">V:0</span><br><span class="line">V_1:0</span><br><span class="line">&lt;class &apos;tensorflow.python.ops.variables.Variable&apos;&gt;</span><br><span class="line">Tensor(&quot;V_1/read:0&quot;, shape=(2,), dtype=float32)</span><br></pre></td></tr></table></figure>
<h3 id="2-3-tf-get-variable"><a href="#2-3-tf-get-variable" class="headerlink" title="2.3 tf.get_variable()"></a>2.3 tf.get_variable()</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 3.tf.get_variable() åˆ›å»ºå˜é‡çš„æ—¶å€™å¿…é¡»è¦æä¾› name</span></span><br><span class="line">v3 = tf.get_variable(name=<span class="string">'gv'</span>, shape=[])  </span><br><span class="line">print(v3.name)</span><br><span class="line">v4 = tf.get_variable(name=<span class="string">'gv'</span>, shape=[<span class="number">2</span>])</span><br><span class="line">print(v4.name)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gv:0</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">ValueError                                Traceback (most recent call last)</span><br><span class="line"></span><br><span class="line">&lt;ipython-input-7-29efaac2d76c&gt; in &lt;module&gt;()</span><br><span class="line">      2 v3 = tf.get_variable(name=&apos;gv&apos;, shape=[])</span><br><span class="line">      3 print(v3.name)</span><br><span class="line">----&gt; 4 v4 = tf.get_variable(name=&apos;gv&apos;, shape=[2])</span><br><span class="line">      5 print(v4.name)</span><br><span class="line">æ­¤å¤„è¿˜æœ‰ä¸€å †é”™è¯¯ä¿¡æ¯ã€‚ã€‚ã€‚</span><br><span class="line">ValueError: Variable gv already exists, disallowed. Did you mean to set reuse=True in VarScope? Originally defined at:</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(type(v3))</span><br><span class="line">print(v3)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;class &apos;tensorflow.python.ops.variables.Variable&apos;&gt;</span><br><span class="line">Tensor(&quot;gv/read:0&quot;, shape=(), dtype=float32)</span><br></pre></td></tr></table></figure>
<p>è¿˜è®°å¾—æœ‰è¿™ä¹ˆä¸ªå‡½æ•°å—ï¼Ÿ <strong>tf.trainable_variables(</strong>), å®ƒèƒ½å¤Ÿå°†æˆ‘ä»¬å®šä¹‰çš„æ‰€æœ‰çš„ trainable=True çš„æ‰€æœ‰å˜é‡ä»¥ä¸€ä¸ª list çš„å½¢å¼è¿”å›ã€‚ very good, ç°åœ¨è¦æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">vs = tf.trainable_variables()</span><br><span class="line">print(len(vs))</span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> vs:</span><br><span class="line">    print(v)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">4</span><br><span class="line">Tensor(&quot;Variable/read:0&quot;, shape=(2,), dtype=float32)</span><br><span class="line">Tensor(&quot;V/read:0&quot;, shape=(2,), dtype=float32)</span><br><span class="line">Tensor(&quot;V_1/read:0&quot;, shape=(2,), dtype=float32)</span><br><span class="line">Tensor(&quot;gv/read:0&quot;, shape=(), dtype=float32)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>å®éªŒ1 ç»“è®º:</strong></p>
<p>ä»ä¸Šé¢çš„å®éªŒç»“æœæ¥çœ‹ï¼Œè¿™ä¸‰ç§æ–¹å¼æ‰€å®šä¹‰çš„å˜é‡å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚</p>
<p>åªæœ‰ <code>tf.get_variable()</code> åˆ›å»ºçš„å˜é‡ä¹‹é—´ä¼šå‘ç”Ÿ <strong>å‘½åå†²çª</strong>ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸‰ç§åˆ›å»ºå˜é‡æ–¹å¼çš„ç”¨é€”åˆ†å·¥éå¸¸æ˜ç¡®ã€‚</p>
<ul>
<li>tf.placeholder() å ä½ç¬¦ã€‚ trainable==False</li>
<li>tf.Variable() ä¸€èˆ¬å˜é‡ç”¨è¿™ç§æ–¹å¼å®šä¹‰ã€‚ å¯ä»¥é€‰æ‹© trainable ç±»å‹</li>
<li>tf.get_variable() ä¸€èˆ¬éƒ½æ˜¯å’Œ tf.variable_scope() é…åˆä½¿ç”¨ï¼Œä»è€Œå®ç°å˜é‡å…±äº«çš„åŠŸèƒ½ã€‚  å¯ä»¥é€‰æ‹© trainable ç±»å‹</li>
</ul>
</blockquote>
<h2 id="3-æ¢ç´¢-name-scope-å’Œ-variable-scope"><a href="#3-æ¢ç´¢-name-scope-å’Œ-variable-scope" class="headerlink" title="3. æ¢ç´¢ name_scope å’Œ variable_scope"></a>3. æ¢ç´¢ name_scope å’Œ variable_scope</h2><p>å®éªŒç›®çš„ï¼š ç†Ÿæ‚‰ä¸¤ç§å‘½åç©ºé—´çš„åº”ç”¨æƒ…æ™¯</p>
<h3 id="3-1-tf-name-scope"><a href="#3-1-tf-name-scope" class="headerlink" title="3.1 tf.name_scope()"></a>3.1 tf.name_scope()</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.name_scope(<span class="string">'nsc1'</span>):</span><br><span class="line">    v1 = tf.Variable([<span class="number">1</span>], name=<span class="string">'v1'</span>)</span><br><span class="line">    <span class="keyword">with</span> tf.variable_scope(<span class="string">'vsc1'</span>):</span><br><span class="line">        v2 = tf.Variable([<span class="number">1</span>], name=<span class="string">'v2'</span>)</span><br><span class="line">        v3 = tf.get_variable(name=<span class="string">'v3'</span>, shape=[])</span><br><span class="line">print(<span class="string">'v1.name: '</span>, v1.name)</span><br><span class="line">print(<span class="string">'v2.name: '</span>, v2.name)</span><br><span class="line">print(<span class="string">'v3.name: '</span>, v3.name)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">v1.name:  nsc1/v1:0</span><br><span class="line">v2.name:  nsc1/vsc1/v2:0</span><br><span class="line">v3.name:  vsc1/v3:0</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.name_scope(<span class="string">'nsc1'</span>):</span><br><span class="line">    v4 = tf.Variable([<span class="number">1</span>], name=<span class="string">'v4'</span>)</span><br><span class="line">print(<span class="string">'v4.name: '</span>, v4.name) <span class="comment"># v4.name:  nsc1_1/v4:0</span></span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>tf.name_scope() å¹¶ä¸ä¼šå¯¹ tf.get_variable() åˆ›å»ºçš„å˜é‡æœ‰ä»»ä½•å½±å“ã€‚ </li>
<li><p>tf.name_scope() ä¸»è¦æ˜¯ç”¨æ¥ç®¡ç†å‘½åç©ºé—´çš„ï¼Œè¿™æ ·å­è®©æˆ‘ä»¬çš„æ•´ä¸ªæ¨¡å‹æ›´åŠ æœ‰æ¡ç†ã€‚</p>
</li>
<li><p>tf.variable_scope() çš„ä½œç”¨æ˜¯ä¸ºäº†å®ç°<strong>å˜é‡å…±äº«</strong>ï¼Œå®ƒå’Œ tf.get_variable() æ¥å®Œæˆå˜é‡å…±äº«çš„åŠŸèƒ½ã€‚</p>
</li>
</ul>
</blockquote>
<h3 id="3-2-tf-variable-scope"><a href="#3-2-tf-variable-scope" class="headerlink" title="3.2 tf.variable_scope()"></a>3.2 tf.variable_scope()</h3><p>å¦‚æœæƒ³è¦è¾¾åˆ°é‡å¤åˆ©ç”¨å˜é‡çš„æ•ˆæœ, æˆ‘ä»¬å°±è¦ä½¿ç”¨ <code>tf.variable_scope()</code>, å¹¶æ­é… <code>tf.get_variable()</code> è¿™ç§æ–¹å¼äº§ç”Ÿå’Œæå–å˜é‡. ä¸åƒ <code>tf.Variable()</code> æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿæ–°çš„å˜é‡, <code>tf.get_variable()</code> å¦‚æœé‡åˆ°äº†åŒæ ·åå­—çš„å˜é‡æ—¶, å®ƒä¼šå•çº¯çš„æå–è¿™ä¸ªåŒæ ·åå­—çš„å˜é‡(é¿å…äº§ç”Ÿæ–°å˜é‡). è€Œåœ¨é‡å¤ä½¿ç”¨çš„æ—¶å€™, ä¸€å®šè¦åœ¨ä»£ç ä¸­å¼ºè°ƒ <code>scope.reuse_variables()</code>, å¦åˆ™ç³»ç»Ÿå°†ä¼šæŠ¥é”™, ä»¥ä¸ºä½ åªæ˜¯å•çº¯çš„ä¸å°å¿ƒé‡å¤ä½¿ç”¨åˆ°äº†ä¸€ä¸ªå˜é‡.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">"a_variable_scope"</span>) <span class="keyword">as</span> scope:</span><br><span class="line">    initializer = tf.constant_initializer(value=<span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    var3 = tf.get_variable(name=<span class="string">'var3'</span>, shape=[<span class="number">1</span>], dtype=tf.float32, initializer=initializer)</span><br><span class="line">    scope.reuse_variables()</span><br><span class="line">    var3_reuse = tf.get_variable(name=<span class="string">'var3'</span>,)</span><br><span class="line">    </span><br><span class="line">    var4 = tf.Variable(name=<span class="string">'var4'</span>, initial_value=[<span class="number">4</span>], dtype=tf.float32)</span><br><span class="line">    var4_reuse = tf.Variable(name=<span class="string">'var4'</span>, initial_value=[<span class="number">4</span>], dtype=tf.float32)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(tf.global_variables_initializer())</span><br><span class="line">    </span><br><span class="line">    print(var3.name)            <span class="comment"># a_variable_scope/var3:0</span></span><br><span class="line">    print(sess.run(var3))       <span class="comment"># [ 3.]</span></span><br><span class="line">    print(var3_reuse.name)      <span class="comment"># a_variable_scope/var3:0</span></span><br><span class="line">    print(sess.run(var3_reuse)) <span class="comment"># [ 3.]</span></span><br><span class="line">    </span><br><span class="line">    print(var4.name)            <span class="comment"># a_variable_scope/var4:0</span></span><br><span class="line">    print(sess.run(var4))       <span class="comment"># [ 4.]</span></span><br><span class="line">    print(var4_reuse.name)      <span class="comment"># a_variable_scope/var4_1:0</span></span><br><span class="line">    print(sess.run(var4_reuse)) <span class="comment"># [ 4.]</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬è¦ç¡®ç«‹ä¸€ç§ Graph çš„æ€æƒ³ã€‚åœ¨ TensorFlow ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œç›¸å½“äºå¾€ Graph ä¸­æ·»åŠ äº†ä¸€ä¸ªèŠ‚ç‚¹ã€‚å’Œæ™®é€šçš„ python å‡½æ•°ä¸ä¸€æ ·ï¼Œåœ¨ä¸€èˆ¬çš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯¹è¾“å…¥è¿›è¡Œå¤„ç†ï¼Œç„¶åè¿”å›ä¸€ä¸ªç»“æœï¼Œè€Œå‡½æ•°é‡Œè¾¹å®šä¹‰çš„ä¸€äº›å±€éƒ¨å˜é‡æˆ‘ä»¬å°±ä¸ç®¡äº†ã€‚ä½†æ˜¯åœ¨ TensorFlow ä¸­ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°é‡Œè¾¹åˆ›å»ºäº†ä¸€ä¸ªå˜é‡ï¼Œå°±æ˜¯å¾€ Graph ä¸­æ·»åŠ äº†ä¸€ä¸ªèŠ‚ç‚¹ã€‚å‡ºäº†è¿™ä¸ªå‡½æ•°åï¼Œè¿™ä¸ªèŠ‚ç‚¹è¿˜æ˜¯å­˜åœ¨äº Graph ä¸­çš„ã€‚</p>
</blockquote>
<h2 id="4-RNN-åº”ç”¨ä¾‹å­"><a href="#4-RNN-åº”ç”¨ä¾‹å­" class="headerlink" title="4. RNN åº”ç”¨ä¾‹å­"></a>4. RNN åº”ç”¨ä¾‹å­</h2><p>æ•´ä¸ª RNN çš„ç»“æ„å·²ç»åœ¨è¿™é‡Œå®šä¹‰å¥½äº†. åœ¨ training RNN å’Œ test RNN çš„æ—¶å€™, RNN çš„ <code>time_steps</code> ä¼šæœ‰ä¸åŒçš„å–å€¼, è¿™å°†ä¼šå½±å“åˆ°æ•´ä¸ª RNN çš„ç»“æ„, æ‰€ä»¥å¯¼è‡´åœ¨ test çš„æ—¶å€™, ä¸èƒ½å•çº¯åœ°ä½¿ç”¨ training æ—¶å»ºç«‹çš„é‚£ä¸ª RNN. ä½†æ˜¯ training RNN å’Œ test RNN åˆå¿…é¡»æ˜¯æœ‰åŒæ ·çš„ weights biases çš„å‚æ•°. æ‰€ä»¥, è¿™æ—¶, å°±æ˜¯ä½¿ç”¨ reuse variable çš„å¥½æ—¶æœº.</p>
<p>é¦–å…ˆå®šä¹‰ training å’Œ test çš„ä¸åŒå‚æ•°.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrainConfig</span>:</span></span><br><span class="line">    batch_size = <span class="number">20</span></span><br><span class="line">    time_steps = <span class="number">20</span></span><br><span class="line">    input_size = <span class="number">10</span></span><br><span class="line">    output_size = <span class="number">2</span></span><br><span class="line">    cell_size = <span class="number">11</span></span><br><span class="line">    learning_rate = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestConfig</span><span class="params">(TrainConfig)</span>:</span></span><br><span class="line">    time_steps = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">train_config = TrainConfig()</span><br><span class="line">test_config = TestConfig()</span><br></pre></td></tr></table></figure>
<p>ç„¶åè®© <code>train_rnn</code> å’Œ <code>test_rnn</code> åœ¨åŒä¸€ä¸ª <code>tf.variable_scope(&#39;rnn&#39;)</code> ä¹‹ä¸‹. å¹¶ä¸”å®šä¹‰ <strong>scope.reuse_variables()</strong>, ä½¿æˆ‘ä»¬èƒ½æŠŠ <code>train_rnn</code> çš„æ‰€æœ‰ weights, biases å‚æ•°å…¨éƒ¨ç»‘å®šåˆ° <code>test_rnn</code> ä¸­. </p>
<p>è¿™æ ·, ä¸ç®¡ä¸¤è€…çš„ <code>time_steps</code> æœ‰å¤šä¸åŒ, ç»“æ„æœ‰å¤šä¸åŒ, <code>train_rnn</code> W, b å‚æ•°æ›´æ–°æˆä»€ä¹ˆæ ·, <code>test_rnn</code> çš„å‚æ•°ä¹Ÿæ›´æ–°æˆä»€ä¹ˆæ ·.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.variable_scope(<span class="string">'rnn'</span>) <span class="keyword">as</span> scope:</span><br><span class="line">    sess = tf.Session()</span><br><span class="line">    train_rnn = RNN(train_config)</span><br><span class="line">    scope.reuse_variables()</span><br><span class="line">    test_rnn = RNN(test_config)</span><br><span class="line">    sess.run(tf.global_variables_initializer())</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://blog.csdn.net/jerr__y/article/category/6747409" target="_blank" rel="external">å¤§å­¦ä¹‹é“ï¼Œåœ¨æ˜æ˜å¾· æ°¸æ°¸å¤œ Tensorflowå­¦ä¹ ä¹‹è·¯</a></li>
<li><a href="https://morvanzhou.github.io/tutorials/machine-learning/tensorflow/5-12-scope/" target="_blank" rel="external">morvanzhou, scope å‘½åæ–¹æ³•</a></li>
</ul>

      
     <!-- by blair add this if sentence at 20160725 -->
      <br>
      
<div id="bottom-donation-section">
<span style="font-size: 1.0em; padding:0em 1em 0.5em 1em; margin: 0 auto;">
  <strong style="vertical-align: top;">åˆ†äº«åˆ°:</strong>
    <div class="j_handlclick"  style="background: url(/images/tech-logos/share_facebook_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/tech-logos/share_weibo_icon.png);background-size: contain;display: inline-block; width:50px; height:50px" href="https://service.weibo.com/share/share.php?url" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/tech-logos/share_wechat_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/tech-logos/share_twitter_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://twitter.com/intent/tweet?url=" target="_blank">
    </div>
  <br>  
  <br>  
  &nbsp;&nbsp;å¦‚æœæ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹æ‚¨çš„å­¦ä¹ å¾ˆæœ‰å¸®åŠ©, è¯·æ‚¨ä¹Ÿåˆ†äº«å®ƒ, è®©å®ƒèƒ½å†æ¬¡å¸®åŠ©åˆ°æ›´å¤šçš„éœ€è¦å­¦ä¹ çš„äºº.
æ‚¨çš„<a href="/2017/11/05/support-pay-blog/"><strong>æ”¯æŒ</strong></a>å°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ !
  <br>  

</span>
<!--
<h3 id="bottom-donation-title">æ”¯æŒ è®©æ–‡ç« å˜å¾—æ›´ä¼˜è´¨</h3>
<div>
<a id="bottom-donation-button" href="/2017/11/05/support">ç‚¹æˆ‘ èµåŠ© ä½œè€…</a>
</div>
-->
</div>
<div class="well">
  åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜ï¼š è½¬è½½è‡ª<a href="http://www.iequa.com"> Blair Chan's Blog</a>ï¼Œä½œè€…ï¼š
  <a href="http://www.iequa.com/about">Blair Chan</a> <br>
  æœ¬æ–‡åŸºäº<a target="_blank" title="Creative Commons Attribution 4.0 international License" href="https://creativecommons.org/licenses/by-nc/4.0/">ç½²å4.0å›½é™…è®¸å¯åè®®</a>å‘å¸ƒï¼Œè½¬è½½è¯·ä¿ç•™æœ¬æ–‡ç½²åå’Œæ–‡ç« é“¾æ¥ã€‚ å¦‚æ‚¨æœ‰ä»»ä½•æˆæƒæ–¹é¢çš„åå•†ï¼Œè¯·é‚®ä»¶è”ç³»æˆ‘ã€‚
</div>

 <!-- by blair add 160724-->
    
    </div>
    
      <div class="article-toc">
        <h3>Contents</h3>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-å…ˆè¯´ç»“è®º"><span class="toc-number"></span> <span class="toc-text">1. å…ˆè¯´ç»“è®º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-name-scope-variable-scope-å®éªŒ-ğŸŒ°"><span class="toc-number"></span> <span class="toc-text">2. name_scope/variable_scope å®éªŒ ğŸŒ°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-placeholder"><span class="toc-number"></span> <span class="toc-text">2.1 placeholder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-tf-Variable"><span class="toc-number"></span> <span class="toc-text">2.2 tf.Variable()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-tf-get-variable"><span class="toc-number"></span> <span class="toc-text">2.3 tf.get_variable()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-æ¢ç´¢-name-scope-å’Œ-variable-scope"><span class="toc-number"></span> <span class="toc-text">3. æ¢ç´¢ name_scope å’Œ variable_scope</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-tf-name-scope"><span class="toc-number"></span> <span class="toc-text">3.1 tf.name_scope()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-tf-variable-scope"><span class="toc-number"></span> <span class="toc-text">3.2 tf.variable_scope()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-RNN-åº”ç”¨ä¾‹å­"><span class="toc-number"></span> <span class="toc-text">4. RNN åº”ç”¨ä¾‹å­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number"></span> <span class="toc-text">Reference</span></a></li></ol>
      </div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/python/">python</a>
  </div>

 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        
  <div class="article-tag">
    <a class="article-tag-link" href="/tags/tensorflow/">tensorflow</a>
  </div>


      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/10/06/tensorflow-Understanding-LSTMs/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          (è½¬) ç†è§£ LSTM ç½‘ç»œ ï¼ˆUnderstanding LSTM Networks by colahï¼‰
        
      </div>
    </a>
  
  
    <a href="/2018/10/04/tensorflow-mnist-1-beginners/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">ç®€å•å‰é¦ˆç½‘ç»œå®ç° mnist åˆ†ç±»&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Libin Chan&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = 'blairos-sn';
  
  var disqus_url = 'http://iequa.com/2018/10/05/tensorflow-name-variable_scope/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
