<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>TensorFlow - tf.contrib.learn 快速入门 - Auckland New Zealand</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="TensorFlow 的高级机器学习API（tf.contrib.learn）可以轻松配置，训练和评估各种机器学习模型。 使用tf.contrib.learn构建 神经网络 分类器并在Iris数据集上进行训练. 基于花萼&#x2F;花瓣几何形状来预测花种。">
<meta name="keywords" content="tensorflow">
<meta property="og:type" content="article">
<meta property="og:title" content="TensorFlow - tf.contrib.learn 快速入门">
<meta property="og:url" content="http:&#x2F;&#x2F;iequa.com&#x2F;2018&#x2F;10&#x2F;31&#x2F;tensorflow&#x2F;tf-5.1-contrib-learn-Quickstart&#x2F;index.html">
<meta property="og:site_name" content="Auckland New Zealand">
<meta property="og:description" content="TensorFlow 的高级机器学习API（tf.contrib.learn）可以轻松配置，训练和评估各种机器学习模型。 使用tf.contrib.learn构建 神经网络 分类器并在Iris数据集上进行训练. 基于花萼&#x2F;花瓣几何形状来预测花种。">
<meta property="og:locale" content="en">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;tensorflow&#x2F;tf-5.1-Iris-data_1.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;tensorflow&#x2F;tf-5.1-Iris-data_2.jpg">
<meta property="og:updated_time" content="2019-10-20T04:30:35.060Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;tensorflow&#x2F;tf-5.1-Iris-data_1.jpg">
  
  
    <link rel="icon" href="/css/images/favicon-Tiktok.ico">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8864dc75a81a27b7e44c00138af95d66";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- blair add baidu tongji end ! @2017.10.03 -->

<!-- jiangting add start... @2020.08.30 -->
<!-- <div id="menu" class="duration-main" style="background-color: #e7e7e7"> -->
<!--   <p class="links-p" href="/">Blair</p> -->
<!--   <address class="icons"> -->
<!--     <a href="https://github.com/blair101" class="icon-font icon linkedin" target="_blank"></a> -->
<!--     <a href="https://cn.linkedin.com/pub/tianyu-dai/a8/818/44a" class="icon-font icon linkedin" target="_blank"></a> -->
<!--   </address> -->
<!--   <div class="hr1"></div> -->
<!--   <nav> -->
<!--     <div> -->
<!--     <a class="home" href="/">Home</a></div> -->
<!--     <p class="links-p" href="/">Home</p> -->
<!--     <nav class="tag-ath"> -->
<!--       <a class="proj" href="/categories">Category</a> -->
<!--       <a class="authors" href="/about">About</a> -->
<!--     </nav> -->
<!--   </nav> -->
<!--   <div class="hr2"></div> -->
<!--     <p class="links-p">Links</p> -->
<!--       <address class="links"> -->
<!--       <a class="proj" href="/article/Create-MyWorld">Projects</a> -->
<!--       <a class="friend">Friends</a></address><div class="hr3"> -->
<!--   </div> -->
<!--   <p class="end"></p> -->
<!--   <div id="menu-links" class="duration-main" style="top: -400px; background-color: #f5f5f5"> -->
<!--     <address> -->
<!--       <li><a target="_blank" href="http://lm7.xxxxxxxx.jp">Lm7</a></li> -->
<!--       <li><a target="_blank" href="http://www.pixiv.net/member.php?id=4933015">Domik</a></li> -->
<!--       <li><a target="_blank" href="http://hana-ui.moe">hana-ui</a></li> -->
<!--       <li><a target="_blank" href="http://fil.dtysky.moe">F-I-L</a></li> -->
<!--       <li><a target="_blank" href="http://paradise.dtysky.moe">Paradise</a></li> -->
<!--       <li><a target="_blank" href="http://moe-notes.dtysky.moe">MoeNotes</a></li> -->
<!--       <li><a target="_blank" href="http://kanata.dtysky.moe">Kanata</a></li> -->
<!--       <li><a target="_blank" href="http://blog.nekohand.moe">Nekohand</a></li> -->
<!--       <li><a target="_blank" href="http://www.jerryfu.net">JerryFu</a></li> -->
<!--       <li><a target="_blank" href="http://kawabangga.com">南史</a></li> -->
<!--       <li><a>Hide Links</a></li> -->
<!--       <li><a></a></li> -->
<!--     </address> -->
<!--   </div> -->
<!-- </div> -->
<!-- jiangting add end !  @2020.08.30 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;" target="_blank" rel="noopener"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/ai">AI</a>
        
          <a class="main-nav-link" href="/tweet">Tweet</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://iequa.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer"><article id="post-tensorflow/tf-5.1-contrib-learn-Quickstart" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      TensorFlow - tf.contrib.learn 快速入门
      <small class=article-detail-date-index>&nbsp; 2018-10-31</small>
    </h1>
  


        <div class=page-title></div>
        <br>
      </header>
    
    <div class="article-meta">
      <!--<a href="/2018/10/31/tensorflow/tf-5.1-contrib-learn-Quickstart/" class="article-date">
  <time datetime="2018-10-31T08:10:21.000Z" itemprop="datePublished">2018-10-31</time>
</a>-->
      <!-- 
  <div class="article-category">
    <a class="article-category-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

--><!-- by blair 160724 -->
      <!-- by blair
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2018/10/31/tensorflow/tf-5.1-contrib-learn-Quickstart/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>TensorFlow 的高级机器学习API（tf.contrib.learn）可以轻松配置，训练和评估各种机器学习模型。</p>
<p>使用tf.contrib.learn构建 神经网络 分类器并在<strong>Iris</strong>数据集上进行训练. 基于花萼/花瓣几何形状来预测花种。</p>
<a id="more"></a> 
<p>依照以下五个步骤编写代码：</p>
<ol>
<li>将包含Iris训练/测试数据的CSV加载到TensorFlow数据集中</li>
<li>构建神经网络分类器</li>
<li>使用训练数据拟合模型</li>
<li>评估模型的准确性</li>
<li>分类新样本</li>
</ol>
<h2 id="1-完整的神经网络源代码"><a href="#1-完整的神经网络源代码" class="headerlink" title="1. 完整的神经网络源代码"></a>1. 完整的神经网络源代码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Data sets</span></span><br><span class="line">IRIS_TRAINING = <span class="string">"iris_training.csv"</span></span><br><span class="line">IRIS_TRAINING_URL = <span class="string">"http://download.tensorflow.org/data/iris_training.csv"</span></span><br><span class="line"></span><br><span class="line">IRIS_TEST = <span class="string">"iris_test.csv"</span></span><br><span class="line">IRIS_TEST_URL = <span class="string">"http://download.tensorflow.org/data/iris_test.csv"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># First download iris_training.csv and iris_test.csv</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load datasets.</span></span><br><span class="line">    training_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">        filename=IRIS_TRAINING,</span><br><span class="line">        target_dtype=np.int,</span><br><span class="line">        features_dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    test_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">        filename=IRIS_TEST,</span><br><span class="line">        target_dtype=np.int,</span><br><span class="line">        features_dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Specify that all features have real-value data</span></span><br><span class="line">    feature_columns = [tf.contrib.layers.real_valued_column(<span class="string">""</span>, dimension=<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Build 3 layer DNN with 10, 20, 10 units respectively.</span></span><br><span class="line">    classifier = tf.contrib.learn.DNNClassifier(feature_columns=feature_columns,</span><br><span class="line">                                                hidden_units=[<span class="number">10</span>, <span class="number">20</span>, <span class="number">10</span>],</span><br><span class="line">                                                n_classes=<span class="number">3</span>,</span><br><span class="line">                                                model_dir=<span class="string">"/tmp/iris_model"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Define the training inputs</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_train_inputs</span><span class="params">()</span>:</span></span><br><span class="line">        x = tf.constant(training_set.data)</span><br><span class="line">        y = tf.constant(training_set.target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Fit model.</span></span><br><span class="line">    classifier.fit(input_fn=get_train_inputs, steps=<span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Define the test inputs</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_test_inputs</span><span class="params">()</span>:</span></span><br><span class="line">        x = tf.constant(test_set.data)</span><br><span class="line">        y = tf.constant(test_set.target)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x, y</span><br><span class="line"></span><br><span class="line">    <span class="string">'''Evaluate accuracy'''</span> </span><br><span class="line">    <span class="comment"># &#123;'loss': 0.098150678, 'accuracy': 0.96666664, 'global_step': 4000&#125;</span></span><br><span class="line">    accuracy_score = classifier.evaluate(input_fn=get_test_inputs,</span><br><span class="line">                                         steps=<span class="number">1</span>)[<span class="string">"accuracy"</span>]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"\nTest Accuracy: &#123;0:f&#125;\n"</span>.format(accuracy_score))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Classify two new flower samples.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">new_samples</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> np.array(</span><br><span class="line">            [[<span class="number">6.4</span>, <span class="number">3.2</span>, <span class="number">4.5</span>, <span class="number">1.5</span>],</span><br><span class="line">             [<span class="number">5.8</span>, <span class="number">3.1</span>, <span class="number">5.0</span>, <span class="number">1.7</span>]], dtype=np.float32)</span><br><span class="line"></span><br><span class="line">    predictions = list(classifier.predict(input_fn=new_samples))</span><br><span class="line"></span><br><span class="line">    print(</span><br><span class="line">        <span class="string">"New Samples, Class Predictions:    &#123;&#125;\n"</span></span><br><span class="line">            .format(predictions))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="2-将Iris-CSV数据加载到TF中"><a href="#2-将Iris-CSV数据加载到TF中" class="headerlink" title="2. 将Iris CSV数据加载到TF中"></a>2. 将Iris CSV数据加载到TF中</h2><p>该<a href="https://en.wikipedia.org/wiki/Iris_flower_data_set" target="_blank" rel="noopener">Iris data set</a>包含150行数据，包括来自每三个相关Iris种类的50个样品： ris setosa, Iris virginica, 以及 Iris versicolor。</p>
<p><img src="/images/tensorflow/tf-5.1-Iris-data_1.jpg" width="700" /></p>
<blockquote>
<p>从左到右， Iris setosa（ Radomil，CC BY-SA 3.0）， Iris versicolor（Dlanglois，CC BY-SA 3.0）和Iris virginica（Frank Mayfield，CC BY-SA 2.0））。</p>
<p>每行包含每个花样品的以下数据： 花萼长度，花萼宽度， 花瓣长度，花瓣宽度和花种。花种以整数表示，0表示Iris setosa，1表示Iris versicolor，2表示Iris virginica。</p>
</blockquote>
<p><img src="/images/tensorflow/tf-5.1-Iris-data_2.jpg" width="400" /></p>
<blockquote>
<p>Iris数据已被随机分为两个独立的CSV：</p>
<ul>
<li>含120个样本的训练集（iris_training.csv）</li>
<li>含30个样本的测试集（iris_test.csv）。</li>
</ul>
</blockquote>
<p>接下来，使用learn.datasets.base中的<a href="https://www.github.com/tensorflow/tensorflow/blob/r1.1/tensorflow/contrib/learn/python/learn/datasets/base.py" target="_blank" rel="noopener">load_csv_with_header()</a> 方法将训练集和测试集加载到datasets中。该load_csv_with_header()方法需要三个必不可少的参数：</p>
<ul>
<li>filename，带有文件路径的CSV文件。</li>
<li>target_dtype，数据集的形式为numpy 数据类型。</li>
<li>features_dtype，数据特征集的形式为numpy 数据类型。</li>
</ul>
<p>在这里，目标（你正在训练预测模型的值）是花种，它是0-2的整数，所以适当的numpy数据类型是np.int：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Load datasets.</span></span><br><span class="line">training_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">    filename=IRIS_TRAINING,</span><br><span class="line">    target_dtype=np.int,</span><br><span class="line">    features_dtype=np.float32)</span><br><span class="line">    </span><br><span class="line">test_set = tf.contrib.learn.datasets.base.load_csv_with_header(</span><br><span class="line">    filename=IRIS_TEST,</span><br><span class="line">    target_dtype=np.int,</span><br><span class="line">    features_dtype=np.float32)</span><br></pre></td></tr></table></figure>
<p>test_set 数据形式</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">Dataset(</span><br><span class="line">       data=array([</span><br><span class="line">          [ <span class="number">5.9000001</span> ,  <span class="number">3.</span> ,  <span class="number">4.19999981</span>,  <span class="number">1.5</span>],</span><br><span class="line">          [ <span class="number">6.9000001</span> ,  <span class="number">3.0999999</span> ,  <span class="number">5.4000001</span> ,  <span class="number">2.0999999</span> ],</span><br><span class="line">          ......</span><br><span class="line">          [ <span class="number">6.69999981</span>,  <span class="number">3.29999995</span>,  <span class="number">5.69999981</span>,  <span class="number">2.5</span>       ],</span><br><span class="line">          [ <span class="number">6.4000001</span> ,  <span class="number">2.9000001</span> ,  <span class="number">4.30000019</span>,  <span class="number">1.29999995</span>]</span><br><span class="line">       ], dtype=float32), </span><br><span class="line">   		</span><br><span class="line">       target=array(</span><br><span class="line">          [<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>test_set.data 数据形式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[[ 5.9000001   3.          4.19999981  1.5       ]</span><br><span class="line"> [ 6.9000001   3.0999999   5.4000001   2.0999999 ]</span><br><span class="line"> ......</span><br><span class="line"> [ 6.4000001   2.9000001   4.30000019  1.29999995]]</span><br></pre></td></tr></table></figure>
<p>test_set.target 数据形式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[1 2 0 1 1 1 0 2 1 2 2 0 2 1 1 0 1 0 0 2 0 1 2 1 1 1 0 1 2 1]</span><br></pre></td></tr></table></figure>
<p>tf.contrib.learn中的datasets被命名为 tuples ; 您可以通过data和target 属性访问特征数据和目标值。这里的training_set.data，training_set.target包含训练集的特征数据和目标值，test_set.data ，test_set.target包含测试集的特征数据和目标值。</p>
<p>在 “在Iris训练数据中拟合DNNC分类器”， 您将使用training_set.data和 training_set.target训练您的模型，在 “评估模型精度” 时，您将使用test_set.data和 test_set.target。</p>
<h2 id="3-构建深层神经网络分类器"><a href="#3-构建深层神经网络分类器" class="headerlink" title="3. 构建深层神经网络分类器"></a>3. 构建深层神经网络分类器</h2><p>tf.contrib.learn提供了各种预定义的模型，称为 <a href="https://www.tensorflow.org/api_guides/python/contrib.learn#estimators" target="_blank" rel="noopener">Estimators</a>，您可以使用“out of the box”方式对数据进行训练和评估操作。</p>
<p>在这里，您将配置深层神经网络分类器模型以拟合Iris数据。利用tf.contrib.learn，您可以使用几行代码实例化<a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/DNNClassifier" target="_blank" rel="noopener">tf.contrib.learn.DNNClassifier</a>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Specify that all features have real-value data</span></span><br><span class="line">feature_columns = [tf.contrib.layers.real_valued_column(<span class="string">""</span>, dimension=<span class="number">4</span>)]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Build 3 layer DNN with 10, 20, 10 units respectively.</span></span><br><span class="line">classifier = tf.contrib.learn.DNNClassifier(feature_columns=feature_columns,</span><br><span class="line">                                            hidden_units=[<span class="number">10</span>, <span class="number">20</span>, <span class="number">10</span>],</span><br><span class="line">                                            n_classes=<span class="number">3</span>,</span><br><span class="line">                                            model_dir=<span class="string">"/tmp/iris_model"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-1-feature-columns-形式"><a href="#3-1-feature-columns-形式" class="headerlink" title="3.1 feature_columns 形式"></a>3.1 feature_columns 形式</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[_RealValuedColumn(column_name=<span class="string">''</span>, dimension=4, default_value=None, dtype=tf.float32, normalizer=None)]</span><br></pre></td></tr></table></figure>
<p>上面的代码首先定义了模型的特征列，它们指定数据集中的特征数据类型。所有的特征数据是连续的，所以tf.contrib.layers.real_valued_column使用相应的函数来构造特征列。数据集中有四个特征（花萼宽度，花萼高度，花瓣宽度和花瓣高度），因此dimension 必须设置为4保存所有数据。</p>
<h3 id="3-2-classifier-形式"><a href="#3-2-classifier-形式" class="headerlink" title="3.2 classifier 形式"></a>3.2 classifier 形式</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">DNNClassifier(params=&#123;</span><br><span class="line"><span class="string">'head'</span>: &lt;tensorflow.contrib.learn.python.learn.estimators.head._MultiClassHead object at 0x1089c0c18&gt;, </span><br><span class="line"><span class="string">'hidden_units'</span>: [10, 20, 10], </span><br><span class="line"><span class="string">'feature_columns'</span>: (_RealValuedColumn(column_name=<span class="string">''</span>, dimension=4, default_value=None, dtype=tf.float32, normalizer=None),), </span><br><span class="line"><span class="string">'optimizer'</span>: None, </span><br><span class="line"><span class="string">'activation_fn'</span>: &lt;<span class="keyword">function</span> relu at 0x11590ad08&gt;, </span><br><span class="line"><span class="string">'dropout'</span>: None, </span><br><span class="line"><span class="string">'gradient_clip_norm'</span>: None, </span><br><span class="line"><span class="string">'embedding_lr_multipliers'</span>: None, </span><br><span class="line"><span class="string">'input_layer_min_slice_size'</span>: None&#125;)</span><br></pre></td></tr></table></figure>
<p>然后，代码使用以下参数创建一个DNNClassifier模型：</p>
<ul>
<li>feature_columns=feature_columns。上面定义的特征列集合。</li>
<li>hidden_units=[10, 20, 10]。三个隐含层，分别含有10,20和10个神经元。</li>
<li>n_classes=3。三个目标类别，代表三种Iris物种。</li>
<li>model_dir=/tmp/iris_model。TensorFlow将在模型训练期间保存检查点数据的目录。有关使用TensorFlow进行日志记录和监视的更多信息，请参阅Logging and Monitoring Basics with tf.contrib.learn.。</li>
</ul>
<h2 id="4-训练的输入流"><a href="#4-训练的输入流" class="headerlink" title="4. 训练的输入流"></a>4. 训练的输入流</h2><p>tf.contrib.learnAPI使用输入函数，创建为模型生成数据的TensorFlow操作。本例中，数据足够小，可以TensorFlow constants 存储。以下代码生成最简单的输入：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Define the test inputs</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_train_inputs</span><span class="params">()</span>:</span></span><br><span class="line">  x = tf.constant(training_set.data)</span><br><span class="line">  y = tf.constant(training_set.target)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> x, y</span><br></pre></td></tr></table></figure>
<h2 id="5-在Iris训练数据上拟合DNN分类器"><a href="#5-在Iris训练数据上拟合DNN分类器" class="headerlink" title="5. 在Iris训练数据上拟合DNN分类器"></a>5. 在Iris训练数据上拟合DNN分类器</h2><p>现在您已经配置了DNN classifier模型，您可以使用该<a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/BaseEstimator#fit" target="_blank" rel="noopener">fit</a>方法将其拟合Iris训练数据。将get_train_inputs传递给input_fn，指定训练的步骤（这里取2000）：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Fit model.</span></span><br><span class="line">classifier.fit(input_fn=get_train_inputs, steps=<span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<p>模型的状态保留在classifier，这意味着如果你喜欢，你可以分布训练。例如，以上代码相当于：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">classifier.fit(x=training_set.data, y=training_set.target, steps=<span class="number">1000</span>)</span><br><span class="line">classifier.fit(x=training_set.data, y=training_set.target, steps=<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>但是，如果您希望在训练时跟踪模型，则可能需要使用TensorFlow <a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/monitors" target="_blank" rel="noopener">monitor</a> 来执行日志记录操作。有关此主题的更多信息，请参阅<br>“Logging and Monitoring Basics with tf.contrib.learn”教程 。</p>
<h2 id="6-评估模型精度"><a href="#6-评估模型精度" class="headerlink" title="6. 评估模型精度"></a>6. 评估模型精度</h2><p>您已经在Iris训练数据上拟合DNNClassifier模型; 现在，您可以使用该<a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/BaseEstimator#evaluate" target="_blank" rel="noopener">evaluate</a>方法检查其对Iris测试数据的准确性 。正如fit， evaluate需要一个构建其输入渠道的输入函数。evaluate 返回一个评估结果dict。下面的代码通过Iris测试数据- test_set.data和test_set.target进行evaluate并打印结果的精度：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Define the test inputs</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_test_inputs</span><span class="params">()</span>:</span></span><br><span class="line">  x = tf.constant(test_set.data)</span><br><span class="line">  y = tf.constant(test_set.target)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> x, y</span><br><span class="line"> </span><br><span class="line"><span class="string">'''Evaluate accuracy.'''</span> </span><br><span class="line"><span class="comment"># &#123;'loss': 0.098150678, 'accuracy': 0.96666664, 'global_step': 4000&#125;</span></span><br><span class="line">accuracy_score = classifier.evaluate(input_fn=get_test_inputs,</span><br><span class="line">                                     steps=<span class="number">1</span>)[<span class="string">"accuracy"</span>]</span><br><span class="line"> </span><br><span class="line">print(<span class="string">"\nTest Accuracy: &#123;0:f&#125;\n"</span>.format(accuracy_score))</span><br></pre></td></tr></table></figure>
<p>注意：这里的steps参数对evaluate很重要。 evaluate直到它到达输入的末尾才停止运行。</p>
<h2 id="7-分类新样本"><a href="#7-分类新样本" class="headerlink" title="7. 分类新样本"></a>7. 分类新样本</h2><p>使用estimator的predict()方法对新样本进行分类。例如，说你有这两个新的花朵样例：</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Classify two new flower samples.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_samples</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">return</span> np.array(</span><br><span class="line">    [[<span class="number">6.4</span>, <span class="number">3.2</span>, <span class="number">4.5</span>, <span class="number">1.5</span>],</span><br><span class="line">     [<span class="number">5.8</span>, <span class="number">3.1</span>, <span class="number">5.0</span>, <span class="number">1.7</span>]], dtype=np.float32)</span><br><span class="line"> </span><br><span class="line">predictions = list(classifier.predict(input_fn=new_samples))</span><br><span class="line"> </span><br><span class="line">print(</span><br><span class="line">    <span class="string">"New Samples, Class Predictions:    &#123;&#125;\n"</span></span><br><span class="line">    .format(predictions))</span><br></pre></td></tr></table></figure>
<p>您可以使用该predict()方法预测其物种。predict返回一个生成器，可以很容易地转换成一个列表。以下代码取得并打印分类的预测结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">New Samples, Class Predictions:    [1 2]</span><br></pre></td></tr></table></figure>
<h2 id="8-其他资源"><a href="#8-其他资源" class="headerlink" title="8. 其他资源"></a>8. 其他资源</h2><ul>
<li>其他资源有关tf.contrib.learn的更多参考资料，请参阅官方 <a href="https://www.tensorflow.org/api_guides/python/contrib.learn" target="_blank" rel="noopener">API文档</a>。</li>
<li>有关使用tf.contrib.learn创建线性模型的更多信息，请参阅 <a href="https://www.tensorflow.org/tutorials/linear" target="_blank" rel="noopener">Large-scale Linear Models with TensorFlow.</a></li>
<li>要使用tf.contrib.learn API构建自己的Estimator，请查看在 <a href="https://www.tensorflow.org/extend/estimators" target="_blank" rel="noopener">tf.contrib.learn中创建估计器</a>。</li>
<li>要在浏览器中实验神经网络建模和可视化，请查看<a href="http://playground.tensorflow.org/" target="_blank" rel="noopener">Deep Playground</a>。</li>
<li>有关神经网络的更多高级教程，请参阅 <a href="https://www.tensorflow.org/tutorials/images/deep_cnn" target="_blank" rel="noopener">卷积神经网络</a>和<a href="https://www.tensorflow.org/tutorials/sequences/recurrent" target="_blank" rel="noopener">循环神经网络</a>。</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://mli.github.io/gpu/2016/01/17/build-gpu-clusters/" target="_blank" rel="noopener">GPU集群折腾手记——2015</a></li>
<li><a href="http://cwiki.apachecn.org/pages/viewpage.action?pageId=10029485" target="_blank" rel="noopener">TensorFlow R1.2 中文文档</a></li>
</ul>

      
     <!-- by blair add this if sentence at 20160725 -->
      <br>
      
<div id="bottom-donation-section">
<span style="font-size: 1.0em; padding:0em 1em 0.5em 1em; margin: 0 auto;">
  <strong style="vertical-align: top;">分享到:</strong>
    <div class="j_handlclick"  style="background: url(/images/logos/share_facebook_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_twitter_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://twitter.com/intent/tweet?url=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_line_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.addtoany.com/add_to/line?linkurl=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_wechat_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=" target="_blank">
    </div>
  <br>  
  <br>  
  &nbsp;&nbsp;如果您觉得这篇文章对您的学习很有帮助, 请您也分享它, 让它能再次帮助到更多的需要学习的人.
您的<a href="/support/"><strong>支持</strong></a>将鼓励我继续创作 !
  <br>  

</span>
<!--
<h3 id="bottom-donation-title">支持 让文章变得更优质</h3>
<div>
<a id="bottom-donation-button" href="/support">点我 赞助 作者</a>
</div>
-->
</div>
<div class="well">
  <!--
  原创文章，转载请注明： 转载自<a href="http://52binge.github.io" target="_blank" rel="noopener"> Blair Chan's Blog</a>，作者：
  <a href="/about">Blair Chan</a> <br>
  -->
  本文基于<a target="_blank" title="Creative Commons Attribution 4.0 international License" href="https://creativecommons.org/licenses/by-nc/4.0/">署名4.0国际许可协议</a>发布，转载请保留本文署名和文章链接。 如您有任何授权方面的协商，请邮件联系我。
</div>
 <!-- by blair add 160724-->
    
    </div>
    
      <div class="article-toc">
        <h3>Contents</h3>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-完整的神经网络源代码"><span class="toc-text">1. 完整的神经网络源代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-将Iris-CSV数据加载到TF中"><span class="toc-text">2. 将Iris CSV数据加载到TF中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-构建深层神经网络分类器"><span class="toc-text">3. 构建深层神经网络分类器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-feature-columns-形式"><span class="toc-text">3.1 feature_columns 形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-classifier-形式"><span class="toc-text">3.2 classifier 形式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-训练的输入流"><span class="toc-text">4. 训练的输入流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-在Iris训练数据上拟合DNN分类器"><span class="toc-text">5. 在Iris训练数据上拟合DNN分类器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-评估模型精度"><span class="toc-text">6. 评估模型精度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-分类新样本"><span class="toc-text">7. 分类新样本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-其他资源"><span class="toc-text">8. 其他资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-text">Reference</span></a></li></ol>
      </div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/tensorflow/">tensorflow</a>
  </div>

 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        
  <div class="article-tag">
    <a class="article-tag-link" href="/tags/tensorflow/" rel="tag">tensorflow</a>
  </div>


      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/11/01/tensorflow/tf-5.2-contrib-learn-Input-fn/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          TensorFlow - tf.contrib.learn 构建输入函数
        
      </div>
    </a>
  
  
    <a href="/2018/10/23/tensorflow/tf-metrics_learn/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Tensorflow 踩坑记之 tf.metrics&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Blair Chan&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos" target="_blank" rel="noopener">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = 'blairos-sn';
  
  var disqus_url = 'http://iequa.com/2018/10/31/tensorflow/tf-5.1-contrib-learn-Quickstart/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
