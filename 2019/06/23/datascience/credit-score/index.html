<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>User Credit Score - Auckland New Zealand</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="Credit-Score">
<meta property="og:type" content="article">
<meta property="og:title" content="User Credit Score">
<meta property="og:url" content="http:&#x2F;&#x2F;iequa.com&#x2F;2019&#x2F;06&#x2F;23&#x2F;datascience&#x2F;credit-score&#x2F;index.html">
<meta property="og:site_name" content="Auckland New Zealand">
<meta property="og:locale" content="en">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-02.jpg">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-01.jpeg">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-03.png">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-04.svg">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-05.svg">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-06.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;www.zhihu.com&#x2F;equation?tex=IV_i+%3D%28%5Cfrac%7B%5C%23B_i%7D%7B%5C%23B_T%7D-%5Cfrac%7B%5C%23G_i%7D%7B%5C%23G_T%7D%29+%2A+log+%28%5Cfrac%7B%5C%23B_i%2F%5C%23B_T%7D%7B%5C%23G_i%2F%5C%23G_T%7D%29%3D%28%5Cfrac%7B%5C%23B_i%7D%7B%5C%23B_T%7D-%5Cfrac%7B%5C%23G_i%7D%7B%5C%23G_T%7D%29+%2A+WOE_i+%5C%5C">
<meta property="og:image" content="https:&#x2F;&#x2F;www.zhihu.com&#x2F;equation?tex=IV+%3D+%5Csum%5Climits_i%5En+IV_i+%5C%5C">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-07.svg">
<meta property="og:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-08.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;www.zhihu.com&#x2F;equation?tex=%5Ctext%7Blog%7D%28+%5Ctext%7Bodds%7D%29+%3D+%5Ctheta%5ETx+%5C%5C">
<meta property="og:image" content="https:&#x2F;&#x2F;www.zhihu.com&#x2F;equation?tex=Score+%3D+A+-B+%5Ctimes+%5Ctext%7Blog%7D%28+%5Ctext%7Bodds%7D%29+%5C%5C">
<meta property="og:image" content="https:&#x2F;&#x2F;pic2.zhimg.com&#x2F;80&#x2F;v2-fec98ff9de65d835a5be217f01f678a5_hd.jpg">
<meta property="og:updated_time" content="2019-10-20T04:30:35.074Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;iequa.com&#x2F;images&#x2F;datascience&#x2F;credit-score-02.jpg">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8864dc75a81a27b7e44c00138af95d66";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;" target="_blank" rel="noopener"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/reading">Reading</a>
        
          <a class="main-nav-link" href="/ai1">AI</a>
        
          <a class="main-nav-link" href="/tensorflow">TF/Keras</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://iequa.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer"><article id="post-datascience/credit-score" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      User Credit Score
      <small class=article-detail-date-index>&nbsp; 2019-06-23</small>
    </h1>
  


        <div class=page-title></div>
        <br>
      </header>
    
    <div class="article-meta">
      <!--<a href="/2019/06/23/datascience/credit-score/" class="article-date">
  <time datetime="2019-06-23T05:28:21.000Z" itemprop="datePublished">2019-06-23</time>
</a>-->
      <!-- 
  <div class="article-category">
    <a class="article-category-link" href="/categories/datascience/">datascience</a>
  </div>

--><!-- by blair 160724 -->
      <!-- by blair
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2019/06/23/datascience/credit-score/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="/images/datascience/credit-score-02.jpg" width="550" alt="Credit Score Card"/>
<a id="more"></a>
<p>信用评分卡模型是最常见的金融风控手段之一，它是指根据客户的各种属性和行为数据，利用一定的信用评分模型，对客户进行信用评分，据此决定是否给予授信以及授信的额度和利率，从而识别和减少在金融交易中存在的交易风险。</p>
<p>按照借贷用户的借贷时间，评分卡模型可以划分为以下三种：</p>
<ul>
<li>贷前： Application score card， 又称为A卡</li>
<li>贷中： Behavior score card， 又称为B卡</li>
<li>贷后： Collection score card， 又称为C卡</li>
</ul>
<p>申请评分卡要求最为严格，也最为重要，可解释性也要求最强，一般主流模型为 LR.</p>
<blockquote>
<p>如需了解更多关于 互联网金融风控 的相关背景知识，请参阅：</p>
<ul>
<li>
<p><a href="/2018/04/20/datascience/internet-finance-1/">Internet Financial Risk Control (part1) ： The Fraud Risk of Financial Technology Enterprises</a></p>
</li>
<li>
<p><a href="/2018/04/21/datascience/internet-finance-2/">Internet Financial Risk Control (part2) ： model strategy</a></p>
</li>
<li>
<p><a href="/2018/04/23/datascience/internet-finance-3/">Internet Financial Risk Control (part3) ： Lending Club Data dev</a></p>
</li>
</ul>
</blockquote>
<h2 id="1-数据获取"><a class="markdownIt-Anchor" href="#1-数据获取"></a> 1. 数据获取</h2>
<ul>
<li>金融机构自身字段： 年龄，户籍，性别，收入，…；</li>
<li>第三方机构的数据： 消费行为…</li>
</ul>
<blockquote>
<p><strong>数据情况：</strong></p>
<p>23W+ 去掉一些灰用户，剩余</p>
<p>M1标准： 好/坏: 13W+ 坏 4K</p>
<p>30~50 : 1 都是正常的</p>
</blockquote>
<h2 id="2-eda"><a class="markdownIt-Anchor" href="#2-eda"></a> 2. EDA</h2>
<p>Exploratory Data Analysis</p>
<blockquote>
<p>每个字段的缺失值情况、异常值情况、平均值、中位数、最大值、最小值、分布情况等</p>
</blockquote>
<ul>
<li><a href="https://www.zhihu.com/question/22320408/answer/141973314" target="_blank" rel="noopener">牛顿插值的几何解释是怎么样的？</a></li>
<li><a href="https://www.zhihu.com/question/58333118" target="_blank" rel="noopener">如何直观地理解拉格朗日插值法？</a></li>
<li><a href="https://www.matongxue.com/madocs/126.html" target="_blank" rel="noopener">从牛顿插值法到泰勒公式</a></li>
<li><a href="https://www.zhihu.com/question/21149770/answer/111173412" target="_blank" rel="noopener">泰勒公式一句话描述：就是用多项式函数去逼近光滑函数</a></li>
</ul>
<blockquote>
<p>缺失值的处理，还可以用 RF 去拟合.</p>
</blockquote>
<h2 id="3-数据预处理"><a class="markdownIt-Anchor" href="#3-数据预处理"></a> 3. 数据预处理</h2>
<p>(1). 数据清洗</p>
<p>(2). 变量分箱</p>
<p>(3). WOE 编码</p>
<blockquote>
<ol>
<li>缺失值太多</li>
<li>非数值变量多 (emp_title…)</li>
<li>id, member_id 等</li>
<li>loan_amnt != df.funded_amnt</li>
<li>空值填充为 0</li>
<li>带 % 的浮点，去掉 %</li>
</ol>
</blockquote>
<blockquote>
<p>好坏比是 34:1 是非常难以处理的样本了.</p>
</blockquote>
<h3 id="31-数据清洗"><a class="markdownIt-Anchor" href="#31-数据清洗"></a> 3.1 数据清洗</h3>
<p>缺失值太多</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 处理对象类型的缺失，unique</span></span><br><span class="line">df.select_dtypes(include=[<span class="string">'O'</span>]).describe().T.\</span><br><span class="line">assign(missing_pct=df.apply(<span class="keyword">lambda</span> x : (len(x)-x.count())/float(len(x))))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缺失值特别高的可以删除掉</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们可以对 非数值型 变量，做一个循环，发现 zip_code 有 873 个 unique 的值，那么先不处理</span></span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> df.select_dtypes(include=[<span class="string">'object'</span>]).columns:</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Column &#123;&#125; has &#123;&#125; unique instances"</span>.format( col, len(df[col].unique())) )</span><br></pre></td></tr></table></figure>
<h3 id="32-变量分箱"><a class="markdownIt-Anchor" href="#32-变量分箱"></a> 3.2 变量分箱</h3>
<ul>
<li>对连续变量进行分段离散化；</li>
<li>将多状态的离散变量进行合并，减少离散变量的状态数。</li>
</ul>
<p>先可以粗分箱，之后在合并。 比如 年龄取值数有 30个，那么分为 30 箱，最后合为 5 箱。<br />
其他变量可能粗分箱为 100 箱，之后合并.</p>
<blockquote>
<p>分箱方法很多，最常见的方法之一： Merge分箱中的 Chimerge 分箱.</p>
<p>Chimerge 其基本思想是如果两个相邻的区间具有类似的类分布，则这两个区间合并；<br />
否则，它们应保持分开。Chimerge通常采用<strong>卡方值</strong>来衡量两相邻区间的类分布情况。</p>
<ul>
<li>连续值按升序排列，离散值先转化为坏客户的比率，然后再按升序排列；</li>
<li>为了减少计算量，对于状态数大于某一阈值 (建议为100) 的变量，利用等频分箱进行粗分箱。</li>
<li>若有缺失值，则缺失值单独作为一个分箱。</li>
</ul>
</blockquote>
<p><strong>分箱的最大区间数 &amp; 分箱初始化</strong></p>
<blockquote>
<p>这里我取： n = 5</p>
</blockquote>
<blockquote>
<ol>
<li>连续值按升序排列，离散值先转化为坏客户的比率，然后再按升序排列；</li>
<li>为了减少计算量，对于状态数大于某一阈值 (建议为100) 的变量，利用等频分箱进行粗分箱。</li>
<li>若有缺失值，则缺失值单独作为一个分箱。</li>
</ol>
</blockquote>
<p><strong>合并区间：</strong></p>
<blockquote>
<ol>
<li>将卡方值最小的一对区间合并</li>
</ol>
</blockquote>
<p><strong>分箱后处理：</strong></p>
<blockquote>
<ol>
<li>对于坏客户比例为 0 或 1 的分箱进行合并 (一个分箱内不能全为好客户或者全为坏客户)。</li>
<li>对于分箱后某一箱样本占比超过 95% 的箱子进行删除。</li>
<li>检查缺失分箱的坏客户比例是否和非缺失分箱相等，如果相等，进行合并。</li>
</ol>
</blockquote>
<p><strong>总结一下特征分箱的优势</strong>：</p>
<blockquote>
<ol>
<li>特征分箱可以有效处理特征中的缺失值和异常值。</li>
<li>特征分箱后，数据和模型会更稳定。</li>
<li>特征分箱可以简化逻辑回归模型，降低模型过拟合的风险，提高模型的泛化能力。</li>
<li>将所有特征统一变换为类别型变量。</li>
<li>分箱后变量才可以使用标准的评分卡格式，即对不同的分段进行评分。</li>
</ol>
<p>列表内容特征离散化后，模型会更稳定，比如如果对用户年龄离散化，20-30作为一个区间，不会因为一个用户年龄长了一岁就变成一个完全不同的人。当然处于区间相邻处的样本会刚好相反，所以怎么划分区间是门学问；</p>
</blockquote>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/52312186" target="_blank" rel="noopener">变量分箱实践</a></li>
<li><a href="http://www.jiehuozhe.com/article/3" target="_blank" rel="noopener">One-Hot编码与哑变量</a></li>
<li><a href="https://blog.csdn.net/zengxiantao1994/article/details/77855644" target="_blank" rel="noopener">方差、标准差和均方根误差的区别总结</a></li>
<li><a href="https://www.cnblogs.com/wzdLY/p/9649101.html" target="_blank" rel="noopener">基于卡方分箱的评分卡建模</a></li>
</ul>
<hr />
<p><a href="https://www.cnblogs.com/wzdLY/p/9649101.html" target="_blank" rel="noopener">good 基于卡方分箱的评分卡建模 , 卡方分布—chi-square distribution, χ2-distribution</a></p>
<p><strong>卡方值的意义,举个例子：</strong></p>
<p>某医院对某种病症的患者使用了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span></span></span></span> 两种不同的疗法，结果如表1，问两种疗法有无差别？</p>
<table>
<thead>
<tr>
<th style="text-align:center">组别</th>
<th style="text-align:center">有效</th>
<th style="text-align:center">无效</th>
<th style="text-align:center">合计</th>
<th style="text-align:center">有效率（%）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">A组</td>
<td style="text-align:center">19</td>
<td style="text-align:center">24</td>
<td style="text-align:center">43</td>
<td style="text-align:center">44.2</td>
</tr>
<tr>
<td style="text-align:center">B组</td>
<td style="text-align:center">34</td>
<td style="text-align:center">10</td>
<td style="text-align:center">44</td>
<td style="text-align:center">77.3</td>
</tr>
<tr>
<td style="text-align:center">合计</td>
<td style="text-align:center">53</td>
<td style="text-align:center">34</td>
<td style="text-align:center">87</td>
<td style="text-align:center">60.9</td>
</tr>
</tbody>
</table>
<p>可以计算出各格内的期望频数：</p>
<p>第1行1列： 43×53/87=26.2 ,</p>
<p>第1行2列： 43×34/87=16.8 ,</p>
<p>第2行1列： 44×53/87=26.8 ,</p>
<p>第2行2列： 44×34/87=17.2</p>
<p>A箱</p>
<p>(26.2-19)*(26.2-19) / 26.2  -&gt; <strong>(26.2 是 正类的期望频数， 19 是真实频数)</strong></p>
<p>(16.8-24)*(16.8-24) / 16.8 (16.8 是 负类的期望频数)</p>
<p>B箱</p>
<p>(26.8-34)*(26.8-34) / 26.8 (26.8 是 正类的期望频数)</p>
<p>(17.2-10)*(17.2-10) / 17.2 (17.2 是 负类的期望频数)</p>
<p>先建立原假设：A、B两种疗法没有区别。根据卡方值的计算公式，计算：卡方值=10.01。得到卡方值以后，接下来需要查询卡方分布表来判断p值，从而做出接受或拒绝原假设的决定。</p>
<details>
  <summary> 点击时的区域标题： 卡方分布—chi-square distribution, χ2-distribution </summary>
<p><strong>χ2-distribution:</strong></p>
<strong>
若 $k$ 个独立的随机变量 $Z\_1, Z\_2, ..., Z\_k$ 满足标准正态分布 $N(0,1)$ , 则这 $k$ 个随机变量的平方和：
<img src="/images/datascience/credit-score-01.jpeg" width="150" alt=""/>
<p>卡方检验—χ2检验是以χ2分布为基础的一种假设检验方法，主要用于分类变量之间的独立性检验</p>
<p>思想是根据样本数据推断 <strong><code>总体分布与期望分布 是否有显著性差异</code></strong>，或者推断两个分类变量是否相关或者独立。</p>
<p>一般可以设原假设为 ：观察频数与期望频数没有差异，或者两个变量相互独立不相关。</p>
<p>实际应用中，我们先假设原假设成立，计算出卡方值，卡方表示观察值与理论值间的偏离程度。</p>
<img src="/images/datascience/credit-score-03.png" width="500" alt=""/>
<p>卡方值只是一个中间过程，通过卡方值计算出p值，p值才是我们最重要需要的。p小于0.05意味着存在显著差异。</p>
<p>卡方值是非参数检验中的一个统计量，主要用于非参数统计分析中。它的作用是检验数据的相关性。如果卡方值的显著性（即SIG.）小于0.05，说明两个变量是显著相关的。<br />
</strong></p>
</details>
<hr />
<h3 id="33-woe-weight-of-evidence"><a class="markdownIt-Anchor" href="#33-woe-weight-of-evidence"></a> 3.3 WOE (weight of evidence)</h3>
<blockquote>
<p>WOE 称为证据权重(weight of evidence) , 将离散变量转化为连续变量。</p>
</blockquote>
<p>WOE 将预测类别的集中度的属性作为编码的数值。对于自变量第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 箱的WOE值为：</p>
<img src="/images/datascience/credit-score-04.svg" width="600" alt=""/>
<blockquote>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mn>1</mn></mrow></mrow><annotation encoding="application/x-tex">p\_{i1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9695199999999999em;vertical-align:-0.31em;"></span><span class="mord mathdefault">p</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathdefault">i</span><span class="mord">1</span></span></span></span></span> 是第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 箱中坏客户占所有坏客户比例</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mi mathvariant="normal">_</mi><mrow><mi>i</mi><mn>0</mn></mrow></mrow><annotation encoding="application/x-tex">p\_{i0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9695199999999999em;vertical-align:-0.31em;"></span><span class="mord mathdefault">p</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord"><span class="mord mathdefault">i</span><span class="mord">0</span></span></span></span></span> 是第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 箱中好客户占所有好客户比例</p>
<p><strong><code>WOE: 当前分箱中坏客户和好客户的比值，和所有样本中这个比值的差异</code></strong></p>
</blockquote>
<blockquote>
<p>当分箱中坏客户和好客户的比例等于随机坏客户和好客户的比值时，说明这个分箱没有预测能力，即WOE=0。 (WOE为0，说明该箱出的特征对结果没有区分度)</p>
</blockquote>
<p>实际上WOE编码相当于把分箱后的特征从非线性可分映射到近似线性可分的空间内:</p>
<img src="/images/datascience/credit-score-05.svg" width="600" alt=""/>
<p>总结一下WOE编码的优势：</p>
<blockquote>
<ol>
<li>可提升模型的预测效果</li>
<li>将自变量规范到同一尺度上</li>
<li>WOE能反映自变量取值的贡献情况</li>
<li>有利于对变量的每个分箱进行评分</li>
<li>转化为连续变量之后，便于分析变量与变量之间的相关性</li>
<li>与独热向量编码相比，可以保证变量的完整性，同时避免稀疏矩阵和维度灾难</li>
</ol>
</blockquote>
<hr />
<h2 id="4-变量筛选"><a class="markdownIt-Anchor" href="#4-变量筛选"></a> 4. 变量筛选</h2>
<p>主要衡量标准: 变量的预测能力和变量的线性相关性。</p>
<p>挑选入模变量:</p>
<blockquote>
<ol>
<li>变量的预测能力</li>
<li>变量之间的线性相关性</li>
<li>变量在业务上的可解释性</li>
</ol>
</blockquote>
<p>变量两两相关性分析，变量的多重共线性分析。</p>
<h3 id="41-单变量筛选"><a class="markdownIt-Anchor" href="#41-单变量筛选"></a> 4.1 单变量筛选</h3>
<p>IV 信息价值(information value)，自变量的IV值越大，表示自变量的预测能力越强。 类似指标还有信息增益等。</p>
<img src="/images/datascience/credit-score-06.jpg" width="850" alt=""/>
<p><img src="https://www.zhihu.com/equation?tex=IV_i+%3D%28%5Cfrac%7B%5C%23B_i%7D%7B%5C%23B_T%7D-%5Cfrac%7B%5C%23G_i%7D%7B%5C%23G_T%7D%29+%2A+log+%28%5Cfrac%7B%5C%23B_i%2F%5C%23B_T%7D%7B%5C%23G_i%2F%5C%23G_T%7D%29%3D%28%5Cfrac%7B%5C%23B_i%7D%7B%5C%23B_T%7D-%5Cfrac%7B%5C%23G_i%7D%7B%5C%23G_T%7D%29+%2A+WOE_i+%5C%5C" alt="" /></p>
<p>变量对应的IV值为所有分箱对应的 IV 值之和：</p>
<p><img src="https://www.zhihu.com/equation?tex=IV+%3D+%5Csum%5Climits_i%5En+IV_i+%5C%5C" alt="" /></p>
<p>IV 值实际上式变量各个分箱的加权求和。且和决策树中的交叉熵有异曲同工之妙。以下为交叉熵公式：</p>
<img src="/images/datascience/credit-score-07.svg" width="600" alt=""/>
<p>IV值的具体的计算流程如下：</p>
<img src="/images/datascience/credit-score-08.jpg" width="800" alt=""/>
<p>IV排序后，选择IV&gt;0.02的变量，共58个变量IV&gt;0.02</p>
<h3 id="42-多变量分析"><a class="markdownIt-Anchor" href="#42-多变量分析"></a> 4.2 多变量分析</h3>
<p>保留相关性低于阈值0.6的变量，剩余27个变量</p>
<p><strong>为什么要进行相关性分析？</strong></p>
<blockquote>
<p>理想状态下，系数权重会有无数种取法，使系数权重变得无法解释，导致变量的每个分段的得分也有无数种取法（后面我们会发现变量中不同分段的评分会用到变量的系数）</p>
</blockquote>
<p><strong>总结一下变量筛选的意义：</strong></p>
<ol>
<li>剔除跟目标变量不太相关的特征</li>
<li>消除由于线性相关的变量，避免特征冗余</li>
<li>减轻后期验证、部署、监控的负担</li>
<li>保证变量的可解释性</li>
</ol>
<p>特征相关度筛选</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">cor = df.corr()</span><br><span class="line">cor.loc[:,:] = np.tril(cor, k=<span class="number">-1</span>) <span class="comment"># below main lower triangle of an array</span></span><br><span class="line">cor = cor.stack()</span><br><span class="line">cor[(cor &gt; <span class="number">0.55</span>) | (cor &lt; <span class="number">-0.55</span>)] <span class="comment"># 特征相关度筛选</span></span><br></pre></td></tr></table></figure>
<h3 id="43-显著性分析"><a class="markdownIt-Anchor" href="#43-显著性分析"></a> 4.3 显著性分析</h3>
<p>删除P值不显著的变量，剩余12个变量了。</p>
<p><strong>GBDT, GBRT, Xgboost, RF grid search</strong></p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line">param_grid = &#123;</span><br><span class="line">    <span class="string">'learning_rate'</span>: [<span class="number">0.1</span>, <span class="number">0.05</span>, <span class="number">0.02</span>, <span class="number">0.01</span>],</span><br><span class="line">    <span class="string">'max_depth'</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</span><br><span class="line">    <span class="string">'min_samples_split'</span>: [<span class="number">50</span>,<span class="number">100</span>,<span class="number">200</span>,<span class="number">400</span>],</span><br><span class="line">    <span class="string">'n_estimators'</span>: [<span class="number">100</span>,<span class="number">200</span>,<span class="number">400</span>,<span class="number">800</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>特征重要度：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Top Ten， GBRT top 10 的参数有哪些，可以作为参考， GBRT 不仅是一个分类器，还能帮你筛选变量</span><br><span class="line"># 比如 feature_importance = 0 的话，那么下一次 这个特征，你就去掉就可以了</span><br><span class="line"># 重新用模型GBRT重新跑，或者用其他模型LR跑</span><br><span class="line"># 或者其他的 RF 也可以帮助你做特征筛选</span><br></pre></td></tr></table></figure>
<p>最后选择出 84 个变量， 然后在放到不同的模型中做训练，在 ensemble 应该效果还是不错的。</p>
<p><strong>特征不稳定的，不可以作为入模变量：</strong></p>
<blockquote>
<p>挑选变量的时候，开始每个月我一直在看它的均值和方差的变化是否在容忍的范围内，超过50%舍</p>
</blockquote>
<h2 id="5-转化为评分卡"><a class="markdownIt-Anchor" href="#5-转化为评分卡"></a> 5. 转化为评分卡</h2>
<p>将 odds 带入可得：</p>
<p><img src="https://www.zhihu.com/equation?tex=%5Ctext%7Blog%7D%28+%5Ctext%7Bodds%7D%29+%3D+%5Ctheta%5ETx+%5C%5C" alt="" /></p>
<p>评分卡的分值可以定义为比率对数的线性表达来，即：</p>
<p><img src="https://www.zhihu.com/equation?tex=Score+%3D+A+-B+%5Ctimes+%5Ctext%7Blog%7D%28+%5Ctext%7Bodds%7D%29+%5C%5C" alt="" /></p>
<p>最终得到评分卡模型：</p>
<p><img src="https://pic2.zhimg.com/80/v2-fec98ff9de65d835a5be217f01f678a5_hd.jpg" alt="" /></p>
<p>需要设定两个假设：</p>
<ul>
<li>某个特定的违约概率下的预期评分，即比率 即比率 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>odds</mtext></mrow><annotation encoding="application/x-tex">\text{odds}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">odds</span></span></span></span></span> 为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>θ</mi><mi mathvariant="normal">_</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">θ\_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord">0</span></span></span></span> 时的分数为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mi mathvariant="normal">_</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">P\_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord">0</span></span></span></span></li>
<li>该odds为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mi>θ</mi><mi mathvariant="normal">_</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">2θ\_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.02778em;">θ</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord">0</span></span></span></span>情况下评分的减少量（PDO）</li>
</ul>
<h2 id="6-ks-评估"><a class="markdownIt-Anchor" href="#6-ks-评估"></a> 6. KS 评估</h2>
<p>K-S曲线其实数据来源和本质和ROC曲线是一致的，只是ROC曲线是把真正率和假正率当作横纵轴，而K-S曲线是把真正率和假正率都当作是纵轴，横轴则由选定的阈值来充当。</p>
<blockquote>
<p>由于ks值能找出模型中差异最大的一个分段，因此适合用于cut_off，像评分卡这种就很适合用ks值来评估。但是ks值只能反映出哪个分段是区分最大的，而不能总体反映出所有分段的效果，因果AUC值更能胜任。</p>
<p>KS值表示了模型将+和-区分开来的能力。值越大，模型的预测准确性越好。</p>
</blockquote>
<p>KS 值表示了模型区分好坏客户的能力。</p>
<p>等分 10 份，两条洛伦兹曲线， TPR 与 FPR 的差值. 好坏客户的区程度.</p>
<p>其实质是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mi>P</mi><mi>R</mi><mo>−</mo><mi>F</mi><mi>P</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">TPR - FPR</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span></span></span></span> 随好坏客户阈值变化的最大值。KS 值越大，模型的预测准确性越好。一般，KS &gt; 0.4 即认为模型有很好的预测性能。</p>
<h2 id="reference"><a class="markdownIt-Anchor" href="#reference"></a> Reference</h2>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/34370741" target="_blank" rel="noopener">Python三大评分卡之行为评分卡</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/36539125" target="_blank" rel="noopener">玩转逻辑回归之金融评分卡模型</a></li>
<li><a href="http://www.sfinst.com/?p=1389" target="_blank" rel="noopener">拍拍贷教你如何用GBDT做评分卡</a></li>
<li><a href="https://blog.csdn.net/zs15321583801/article/details/88217839" target="_blank" rel="noopener">模型区分度指标 KS 值</a></li>
<li><a href="https://blog.csdn.net/Orange_Spotty_Cat/article/details/82425113" target="_blank" rel="noopener">分类模型评判指标 ROC，AUC，GINI，KS</a></li>
<li><a href="https://www.cnblogs.com/gczr/p/10354646.html" target="_blank" rel="noopener">深入理解KS</a></li>
<li><a href="http://rosen.xyz/2018/02/01/AUC%E5%92%8CKS%E6%8C%87%E6%A0%87" target="_blank" rel="noopener">AUC和KS指标</a></li>
<li><a href="https://blog.csdn.net/sscc_learning/article/details/86707005" target="_blank" rel="noopener">一文完全理解模型ks指标含义并画出ks曲线</a></li>
</ul>

      
     <!-- by blair add this if sentence at 20160725 -->
      <br>
      
<div id="bottom-donation-section">
<span style="font-size: 1.0em; padding:0em 1em 0.5em 1em; margin: 0 auto;">
  <strong style="vertical-align: top;">分享到:</strong>
    <div class="j_handlclick"  style="background: url(/images/logos/share_facebook_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_weibo_icon.png);background-size: contain;display: inline-block; width:50px; height:50px" href="https://service.weibo.com/share/share.php?url" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_wechat_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/logos/share_twitter_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://twitter.com/intent/tweet?url=" target="_blank">
    </div>
  <br>  
  <br>  
  &nbsp;&nbsp;如果您觉得这篇文章对您的学习很有帮助, 请您也分享它, 让它能再次帮助到更多的需要学习的人.
您的<a href="/support/"><strong>支持</strong></a>将鼓励我继续创作 !
  <br>  

</span>
<!--
<h3 id="bottom-donation-title">支持 让文章变得更优质</h3>
<div>
<a id="bottom-donation-button" href="/support">点我 赞助 作者</a>
</div>
-->
</div>
<div class="well">
  <!--
  原创文章，转载请注明： 转载自<a href="http://52binge.github.io" target="_blank" rel="noopener"> Blair Chan's Blog</a>，作者：
  <a href="/about">Blair Chan</a> <br>
  -->
  本文基于<a target="_blank" title="Creative Commons Attribution 4.0 international License" href="https://creativecommons.org/licenses/by-nc/4.0/">署名4.0国际许可协议</a>发布，转载请保留本文署名和文章链接。 如您有任何授权方面的协商，请邮件联系我。
</div>
 <!-- by blair add 160724-->
    
    </div>
    
      <div class="article-toc">
        <h3>Contents</h3>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-数据获取"><span class="toc-text"> 1. 数据获取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-eda"><span class="toc-text"> 2. EDA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-数据预处理"><span class="toc-text"> 3. 数据预处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-数据清洗"><span class="toc-text"> 3.1 数据清洗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-变量分箱"><span class="toc-text"> 3.2 变量分箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-woe-weight-of-evidence"><span class="toc-text"> 3.3 WOE (weight of evidence)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-变量筛选"><span class="toc-text"> 4. 变量筛选</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-单变量筛选"><span class="toc-text"> 4.1 单变量筛选</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-多变量分析"><span class="toc-text"> 4.2 多变量分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-显著性分析"><span class="toc-text"> 4.3 显著性分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-转化为评分卡"><span class="toc-text"> 5. 转化为评分卡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-ks-评估"><span class="toc-text"> 6. KS 评估</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reference"><span class="toc-text"> Reference</span></a></li></ol>
      </div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/datascience/">datascience</a>
  </div>

 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        
  <div class="article-tag">
    <a class="article-tag-link" href="/tags/Credit-Score/" rel="tag">Credit-Score</a>
  </div>


      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/06/25/nlp/Fine-grained-Sentiment-Analysis-of-User-Online-Reviews/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          Fine-grained Sentiment Analysis of User Online Reviews
        
      </div>
    </a>
  
  
    <a href="/2019/06/21/nlp/BERT-Simple/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Bert 最简单的打开姿势&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Blair Chan&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos" target="_blank" rel="noopener">blairos</a>
    </div>
  </div>
</footer>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = 'blairos-sn';
  
  var disqus_url = 'http://iequa.com/2019/06/23/datascience/credit-score/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
