<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Chatbot Research 5 - 基于深度学习的检索聊天机器人 - Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="MathJax.Hub.Config({
    extensions: [&quot;tex2jax.js&quot;],
    jax: [&quot;input/TeX&quot;],
    tex2jax: {
      inlineMath: [ [&apos;$&apos;,&apos;$&apos;], [&apos;\\(&apos;,&apos;\\)&apos;] ],
      displayMath: [ [&apos;$$&apos;,&apos;$$&apos;]],
      processEscapes:">
<meta property="og:type" content="article">
<meta property="og:title" content="Chatbot Research 5 - 基于深度学习的检索聊天机器人">
<meta property="og:url" content="http://iequa.com/2019/08/15/chatbot-research5/index.html">
<meta property="og:site_name" content="Home">
<meta property="og:description" content="MathJax.Hub.Config({
    extensions: [&quot;tex2jax.js&quot;],
    jax: [&quot;input/TeX&quot;],
    tex2jax: {
      inlineMath: [ [&apos;$&apos;,&apos;$&apos;], [&apos;\\(&apos;,&apos;\\)&apos;] ],
      displayMath: [ [&apos;$$&apos;,&apos;$$&apos;]],
      processEscapes:">
<meta property="og:image" content="http://iequa.com/images/chatbot/chatbot-5_1.jpg">
<meta property="og:image" content="http://iequa.com/images/chatbot/chatbot-5_2.png">
<meta property="og:image" content="http://iequa.com/images/chatbot/chatbot-5_3.png">
<meta property="og:image" content="http://iequa.com/images/chatbot/chatbot-5_4.png">
<meta property="og:image" content="http://iequa.com/images/chatbot/chatbot-5_5.png">
<meta property="og:updated_time" content="2018-10-19T03:14:14.126Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chatbot Research 5 - 基于深度学习的检索聊天机器人">
<meta name="twitter:description" content="MathJax.Hub.Config({
    extensions: [&quot;tex2jax.js&quot;],
    jax: [&quot;input/TeX&quot;],
    tex2jax: {
      inlineMath: [ [&apos;$&apos;,&apos;$&apos;], [&apos;\\(&apos;,&apos;\\)&apos;] ],
      displayMath: [ [&apos;$$&apos;,&apos;$$&apos;]],
      processEscapes:">
<meta name="twitter:image" content="http://iequa.com/images/chatbot/chatbot-5_1.jpg">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <!-- blair add baidu tongji start... @2017.10.03 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8864dc75a81a27b7e44c00138af95d66";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- blair add baidu tongji end ! @2017.10.03 -->

<header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/chatbot">Bot</a>
        
          <a class="main-nav-link" href="/tensorflow">TF</a>
        
          <a class="main-nav-link" href="/deeplearning">Deep Learning</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://iequa.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>

    <br>
    <section id="main" class="outer"><article id="post-chatbot-research5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Chatbot Research 5 - 基于深度学习的检索聊天机器人
      <small class=article-detail-date-index>&nbsp; 2019-08-15</small>
    </h1>
  


        <div class=page-title></div>
        <br>
      </header>
    
    <div class="article-meta">
      <!--<a href="/2019/08/15/chatbot-research5/" class="article-date">
  <time datetime="2019-08-15T06:00:21.000Z" itemprop="datePublished">2019-08-15</time>
</a>-->
      <!-- 
  <div class="article-category">
    <a class="article-category-link" href="/categories/deeplearning/">deeplearning</a>
  </div>

--><!-- by blair 160724 -->
      <!-- by blair
      
        <div class="article-comment-link-wrap">
          <a href="http://iequa.com/2019/08/15/chatbot-research5/#disqus_thread" class="article-comment-link">Comments</a>
        </div>
      
      -->
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX"],
    tex2jax: {
      inlineMath: [ ['$','$'], ['\\(','\\)'] ],
      displayMath: [ ['$$','$$']],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML,http://myserver.com/MathJax/config/local/local.js">
</script>

<p>介绍基于检索式机器人。检索式架构有预定好的语料答复库。</p>
<p>检索式模型的输入是上下文潜在的答复。模型输出对这些答复的打分，可以选择最高分的答案作为回复。</p>
<a id="more"></a>
<blockquote>
<p>既然生成式的模型更弹性，也不需要预定义的语料，为何不选择它呢？</p>
<p>生成式模型的问题就是实际使用起来并不能好好工作，至少现在是。因为答复比较自由，容易犯语法错误和不相关、不合逻辑的答案，并且需要大量的数据且很难做优化。</p>
<p>大量的生产系统上还是采用检索模型或者检索模型和生成模型结合的方式。</p>
<ul>
<li>例如 google 的 <a href="https://arxiv.org/abs/1606.04870" target="_blank" rel="external">smart reply</a>。</li>
</ul>
<p>生成模型是研究的热门领域，但是我们还没到应用它的程度。如果你想要做一个聊天机器人，最好还是选用检索式模型</p>
</blockquote>
<p>更聪明的聊天机器人</p>
<ol>
<li>生成式模型 VS 检索匹配模型 </li>
<li>Chatterbot的进化: 深度学习提高智能度</li>
</ol>
<p>模型构建 </p>
<ol>
<li>问题的分析与转化</li>
<li>数据集与样本构造方法 </li>
<li>网络结构的构建 </li>
<li>模型的评估 </li>
<li>代码实现与解析</li>
</ol>
<h2 id="1-聊天机器人"><a href="#1-聊天机器人" class="headerlink" title="1. 聊天机器人"></a>1. 聊天机器人</h2><p><img src="/images/chatbot/chatbot-5_1.jpg" width="700"></p>
<h3 id="1-1-基于检索的-chatbot"><a href="#1-1-基于检索的-chatbot" class="headerlink" title="1.1 基于检索的 chatbot"></a>1.1 基于检索的 chatbot</h3><ul>
<li>根据 input 和 context，结合知识库的算法得到合适回复    </li>
<li>从一个固定的数据集中找到合适的内容作为回复</li>
<li>检索和匹配的方式有很多种</li>
<li>数据和匹配方法对质量有很大影响</li>
</ul>
<h3 id="1-2-基于生成模型的chatbot"><a href="#1-2-基于生成模型的chatbot" class="headerlink" title="1.2 基于生成模型的chatbot"></a>1.2 基于生成模型的chatbot</h3><ul>
<li>典型的是 seq2seq 的方法</li>
<li>生成的结果需要考虑通畅度和准确度</li>
</ul>
<blockquote>
<p>以前者为主(可控度高)，后者为辅</p>
</blockquote>
<h2 id="2-回顾-chatterbot"><a href="#2-回顾-chatterbot" class="headerlink" title="2. 回顾 chatterbot"></a>2. 回顾 chatterbot</h2><p><img src="/images/chatbot/chatbot-5_2.png" width="600"></p>
<h3 id="2-1-chatterbot-的问题"><a href="#2-1-chatterbot-的问题" class="headerlink" title="2.1 chatterbot 的问题"></a>2.1 chatterbot 的问题</h3><p><strong>应答模式的匹配方式太粗暴</strong></p>
<blockquote>
<ul>
<li>编辑距离无法捕获深层语义信息   </li>
<li>核心词 + word2vec 无法捕获整句话语义   </li>
<li>LSTM 等 RNN模型 能捕获序列信息<br>…<br>用深度学习来提高匹配阶段准确率!!</li>
</ul>
</blockquote>
<p>心得 :</p>
<blockquote>
<p>Open Domain 的 chatbot 很难做，话题太广，因为无法预知用户会问到什么问题. </p>
<p>你想吃什么 ： 随便<br>你感觉怎么样 : 还好</p>
<p>没问题其实</p>
<p>所以针对一个 Closed Domain + 检索 + 知识库，还应该可以做一个可以用的机器人.</p>
</blockquote>
<h3 id="2-2-应该怎么做"><a href="#2-2-应该怎么做" class="headerlink" title="2.2 应该怎么做"></a>2.2 应该怎么做</h3><p><strong>匹配本身是一个模糊的场景</strong></p>
<blockquote>
<p>转成排序问题</p>
</blockquote>
<p><strong>排序问题怎么处理?</strong>  </p>
<blockquote>
<p>转成能输出概率的01分类问题</p>
<p><strong>Q1 -&gt; { A1: 0.8, A2: 0.1, A3: 0.05, A4: 0.2 }</strong></p>
</blockquote>
<p><strong>数据构建?</strong></p>
<blockquote>
<p>我们需要正样本(正确的回答) 和 负样本(不对的回答)</p>
<p><strong>{ 正样本 : Q1-A1 1 }, { 负样本 : Q1-A3 0 }</strong></p>
</blockquote>
<p><strong>Loss function?</strong></p>
<blockquote>
<p>回忆一下 logistic regression</p>
</blockquote>
<p><strong>心得 :</strong></p>
<blockquote>
<p>定义问题 和 解决问题 很重要</p>
<p>有一个问题，可以转换为 机器学习 或 深度学习 可以解决的问题，这非常重要。</p>
</blockquote>
<h2 id="3-用深度学习来完成"><a href="#3-用深度学习来完成" class="headerlink" title="3. 用深度学习来完成"></a>3. 用深度学习来完成</h2><p><img src="/images/chatbot/chatbot-5_3.png" width="700"></p>
<blockquote>
<p><a href="http://www.wildml.com/2016/07/deep-learning-for-chatbots-2-retrieval-based-model-tensorflow/" target="_blank" rel="external">2016 Google Brain deep-learning-for-chatbots-2-retrieval-based-model-tensorflow, wildml blog</a></p>
</blockquote>
<h2 id="4-数据-Ubuntu-对话语料库"><a href="#4-数据-Ubuntu-对话语料库" class="headerlink" title="4. 数据 - Ubuntu 对话语料库"></a>4. 数据 - Ubuntu 对话语料库</h2><p>ubuntu 语料库（UDC），它是目前公开的最大的数据集。</p>
<h3 id="4-1-Train-sets"><a href="#4-1-Train-sets" class="headerlink" title="4.1 Train sets"></a>4.1 Train sets</h3><p><img src="/images/chatbot/chatbot-5_4.png" width="900"></p>
<blockquote>
<p>注意: </p>
<ul>
<li>上面的数据集生成脚本已经使用 <a href="http://www.nltk.org/" target="_blank" rel="external">NLTK</a> 做了一系列的语料处理包括（<a href="http://www.nltk.org/api/nltk.tokenize.html#module-nltk.tokenize" target="_blank" rel="external">分词</a>，<a href="http://www.nltk.org/api/nltk.stem.html#module-nltk.stem.snowball" target="_blank" rel="external">提取词干</a>，<a href="http://www.nltk.org/api/nltk.stem.html#module-nltk.stem.wordnet" target="_blank" rel="external">词意恢复</a>）</li>
<li>脚本也做了把 名字、地点、组织、URL。系统路径等实体信息用特殊的 token 来替代。</li>
</ul>
<p>这些预处理不是严格必要的，但是能改善一些系统的表现。</p>
<p>语料的上下文平均有86个词语，答复平均有17个词语长。有人做了语料的统计分析：<a href="https://github.com/dennybritz/chatbot-retrieval/blob/master/notebooks/Data%20Exploration.ipynb" target="_blank" rel="external">data analysis</a></p>
</blockquote>
<h3 id="4-2-Test-Validation-sets"><a href="#4-2-Test-Validation-sets" class="headerlink" title="4.2 Test / Validation sets"></a>4.2 Test / Validation sets</h3><ul>
<li>每个样本，有一个正例和九个负例数据 (也称为干扰数据)。</li>
<li>建模的目标在于给正例的得分尽可能的高，而给负例的得分尽可能的低。(有点类似分类任务)</li>
<li>语料做过分词、stemmed、lemmatized 等文本预处理。 </li>
<li>用 NER(命名实体识别) 将文本中的 <strong>实体</strong>，如姓名、地点、组织、URL等 替换成特殊字符</li>
</ul>
<p><img src="/images/chatbot/chatbot-5_5.png" width="900"></p>
<h2 id="5-评估准则"><a href="#5-评估准则" class="headerlink" title="5. 评估准则"></a>5. 评估准则</h2><p><strong>Recall@K</strong></p>
<blockquote>
<ul>
<li>常见的 Kaggle 比赛评判准则</li>
<li>经模型对候选的 response 排序后，前 k 个候选中 存在正例数据(正确的那个)的占比。<br> 让 K=10，这就得到一个 100% 的召回率，因最多就 10 个备选。如果 K=1，模型只一次机会选中正确答案。</li>
<li>K 值 越大，指标值越高，对模型性能的要求越松。</li>
</ul>
</blockquote>
<p><strong>9个干扰项目怎么选出来</strong></p>
<blockquote>
<p>这个数据集里是随机的方法选择的。</p>
<p>但是现实世界里你可能数百万的可能答复，并且你并不知道答复是否合理正确。你没能力从数百万的可能的答复里去挑选一个得分最高的正确答复。成本太高了！ google 的 smart reply 用分布式集群技术计算一系列的可能答复去挑选,.</p>
<p>可能你只有百来个备选答案，可以去评估每一个。</p>
</blockquote>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://chatterbot.readthedocs.io/en/stable/" target="_blank" rel="external">About ChatterBot</a></li>
<li><a href="http://www.wildml.com/2016/07/deep-learning-for-chatbots-2-retrieval-based-model-tensorflow/" target="_blank" rel="external">2016 Google Brain deep-learning-for-chatbots-2-retrieval-based-model-tensorflow, wildml blog</a></li>
<li><a href="https://www.jianshu.com/p/412bcfa67770" target="_blank" rel="external">聊天机器人深度学习应用-part2：基于tensorflow实现检索架构模型</a></li>
<li><a href="https://www.jianshu.com/p/4fb194d143cf" target="_blank" rel="external">聊天机器人深度学习应用-part1：引言</a></li>
</ul>

      
     <!-- by blair add this if sentence at 20160725 -->
      <br>
      
<div id="bottom-donation-section">
<span style="font-size: 1.0em; padding:0em 1em 0.5em 1em; margin: 0 auto;">
  <strong style="vertical-align: top;">分享到:</strong>
    <div class="j_handlclick"  style="background: url(/images/tech-logos/share_facebook_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://www.facebook.com/sharer/sharer.php?u=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/tech-logos/share_weibo_icon.png);background-size: contain;display: inline-block; width:50px; height:50px" href="https://service.weibo.com/share/share.php?url" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/tech-logos/share_wechat_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://api.addthis.com/oexchange/0.8/forward/wechat/offer?url=" target="_blank">
    </div>
    <div class="j_handlclick"  style="background: url(/images/tech-logos/share_twitter_icon.jpg);background-size: contain;display: inline-block; width:50px; height:50px" href="https://twitter.com/intent/tweet?url=" target="_blank">
    </div>
  <br>  
  <br>  
  &nbsp;&nbsp;如果您觉得这篇文章对您的学习很有帮助, 请您也分享它, 让它能再次帮助到更多的需要学习的人.
您的<a href="/2017/11/05/support-pay-blog/"><strong>支持</strong></a>将鼓励我继续创作 !
  <br>  

</span>
<!--
<h3 id="bottom-donation-title">支持 让文章变得更优质</h3>
<div>
<a id="bottom-donation-button" href="/2017/11/05/support">点我 赞助 作者</a>
</div>
-->
</div>
<div class="well">
  原创文章，转载请注明： 转载自<a href="http://www.iequa.com"> Blair Chan's Blog</a>，作者：
  <a href="http://www.iequa.com/about">Blair Chan</a> <br>
  本文基于<a target="_blank" title="Creative Commons Attribution 4.0 international License" href="https://creativecommons.org/licenses/by-nc/4.0/">署名4.0国际许可协议</a>发布，转载请保留本文署名和文章链接。 如您有任何授权方面的协商，请邮件联系我。
</div>

 <!-- by blair add 160724-->
    
    </div>
    
      <div class="article-toc">
        <h3>Contents</h3>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-聊天机器人"><span class="toc-number"></span> <span class="toc-text">1. 聊天机器人</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-基于检索的-chatbot"><span class="toc-number"></span> <span class="toc-text">1.1 基于检索的 chatbot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-基于生成模型的chatbot"><span class="toc-number"></span> <span class="toc-text">1.2 基于生成模型的chatbot</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-回顾-chatterbot"><span class="toc-number"></span> <span class="toc-text">2. 回顾 chatterbot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-chatterbot-的问题"><span class="toc-number"></span> <span class="toc-text">2.1 chatterbot 的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-应该怎么做"><span class="toc-number"></span> <span class="toc-text">2.2 应该怎么做</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-用深度学习来完成"><span class="toc-number"></span> <span class="toc-text">3. 用深度学习来完成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-数据-Ubuntu-对话语料库"><span class="toc-number"></span> <span class="toc-text">4. 数据 - Ubuntu 对话语料库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-Train-sets"><span class="toc-number"></span> <span class="toc-text">4.1 Train sets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Test-Validation-sets"><span class="toc-number"></span> <span class="toc-text">4.2 Test / Validation sets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-评估准则"><span class="toc-number"></span> <span class="toc-text">5. 评估准则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number"></span> <span class="toc-text">Reference</span></a></li></ol>
      </div>
    
    
      <footer class="article-footer">
        <!-- <div class="well" style="width:100px; height:30px;"></div>  by blair-->
        
  <div class="article-category">
    <a class="article-category-link" href="/categories/deeplearning/">deeplearning</a>
  </div>

 <!-- by blair add 160724-->
        <!--
        <div style="width:100px; height:30px;"></div> by blair add 160724
        -->
        
  <div class="article-tag">
    <a class="article-tag-link" href="/tags/deeplearning-ai/">deeplearning.ai</a>
  </div>


      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/08/16/chatbot-research6/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          Chatbot Research 6 - 更多论文 (感谢 PaperWeekly)
        
      </div>
    </a>
  
  
    <a href="/2019/08/14/chatbot-research4/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Chatbot Research 4 - 深度学习知识回顾&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Libin Chan&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/52binge/hexo-theme-blairos">blairos</a>
    </div>
  </div>
</footer>

    
<script type="text/javascript"> <!-- add by blair 0724 type=text/javascript -->
  var disqus_shortname = 'blairos-sn';
  
  var disqus_url = 'http://iequa.com/2019/08/15/chatbot-research5/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
